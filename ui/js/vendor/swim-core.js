// swim-core-3.9.0; copyright 2015-2019 SWIM.AI inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).swim=t.swim||{})}(this,function(t){"use strict";var e;String.prototype.codePointAt||Object.defineProperty(String.prototype,"codePointAt",{value:function(t){var e=this.length;if((t=t?Number(t):0)!=t&&(t=0),t>=0&&t<e){var r=this.charCodeAt(t);if(r<=55295||r>=57344)return r;if(r<=56319&&t+1<e){var n=this.charCodeAt(t+1);if(n>=56320&&n<=57343)return 65536+((1023&r)<<10+n&1023)}}},configurable:!0,writable:!0}),String.prototype.offsetByCodePoints||Object.defineProperty(String.prototype,"offsetByCodePoints",{value:function(t,e){if(e>0)for(var r=this.length;e>0&&t<r;)(i=this.charCodeAt(t))<=55295||i>=57344?t+=1:t+=i<=56319&&t+1<r&&(n=this.charCodeAt(t+1))>=56320&&n<=57343?2:1,e-=1;else if(e<0)for(;e<0&&t>0;){var n;if((n=this.charCodeAt(t-1))<=55295||n>=57344)t-=1;else if(n>=56320&&n<=57343&&t-1>0){var i;t-=(i=this.charCodeAt(t-2))>=55296&&i<=57343?2:1}else t-=1;e-=1}return t},configurable:!0,writable:!0}),(e=t.ByteOrder||(t.ByteOrder={})).BigEndian="BE",e.LittleEndian="LE";var r=function(){var t=new ArrayBuffer(2);new Uint16Array(t)[0]=65279;var e=new Uint8Array(t);if(254===e[0]&&255===e[1])return"BE";if(255===e[0]&&254===e[1])return"LE";throw new Error}(),n="undefined"!=typeof window&&(window.crypto||window.msCrypto);function i(t){n.getRandomValues(t)}function o(t){if(t instanceof Int8Array)for(var e=0;e<t.length;e+=1)t[e]=128-Math.round(256*Math.random());else if(t instanceof Uint8Array)for(e=0;e<t.length;e+=1)t[e]=Math.round(256*Math.random());else if(t instanceof Int16Array)for(e=0;e<t.length;e+=1)t[e]=32768-Math.round(65536*Math.random());else if(t instanceof Uint16Array)for(e=0;e<t.length;e+=1)t[e]=Math.round(65536*Math.random());else if(t instanceof Int32Array)for(e=0;e<t.length;e+=1)t[e]=2147483648-Math.round(4294967296*Math.random());else{if(!(t instanceof Uint32Array))throw new TypeError(""+t);for(e=0;e<t.length;e+=1)t[e]=Math.round(4294967296*Math.random())}}var s=function(){function t(){}return t.fillBytes=n?i:o,t}(),u=new ArrayBuffer(8),a=new Float64Array(u),p=new Int32Array(u);function h(t,e){return t<<e|t>>>32-e}var f=function(){function t(){}return t.seed=function(e){return"object"==typeof e&&e&&(e=e.constructor&&"string"==typeof e.constructor.name?e.constructor.name:e.toString()),t.hash(e)},t.hash=function(e){if(e instanceof Uint8Array||"string"==typeof e)return t.mash(t.mix(0,e));if("number"==typeof e)return~~e===e?~~e:(a[0]=e,p[0]^p[1]);if("boolean"==typeof e)return e?3:2;if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},t.mixUint8ArrayBE=function(e,r){for(var n=0,i=r.length;n+3<i;){var o=(255&r[n])<<24|(255&r[n+1])<<16|(255&r[n+2])<<8|255&r[n+3];e=t.mix(e,o),n+=4}if(n<i){o=(255&r[n])<<24;n+1<i&&(o|=(255&r[n+1])<<16,n+2<i&&(o|=(255&r[n+2])<<8)),e^=o=461845907*(65535&(o=h(o=3432918353*(65535&o)+((3432918353*(o>>>16)&65535)<<16)&4294967295,15)))+((461845907*(o>>>16)&65535)<<16)&4294967295}return e^i},t.mixUInt8ArrayLE=function(e,r){for(var n=0,i=r.length;n+3<i;){var o=255&r[n]|(255&r[n+1])<<8|(255&r[n+2])<<16|(255&r[n+3])<<24;e=t.mix(e,o),n+=4}if(n<i){o=255&r[n];n+1<i&&(o|=(255&r[n+1])<<8,n+2<i&&(o|=(255&r[n+2])<<16)),e^=o=461845907*(65535&(o=h(o=3432918353*(65535&o)+((3432918353*(o>>>16)&65535)<<16)&4294967295,15)))+((461845907*(o>>>16)&65535)<<16)&4294967295}return e^i},t.mixStringBE=function(e,r){for(var n=0,i=32,o=0,s=r.length,u=0;o<s;){var a=r.codePointAt(o);void 0===a&&(a=r.charCodeAt(o)),a>=0&&a<=127?(n|=a<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),u+=1):a>=128&&a<=2047?(n|=(192|a>>>6)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=(128|63&a)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),u+=2):a>=2048&&a<=65535||a>=57344&&a<=65535?(n|=(224|a>>>12)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=(128|a>>>6&63)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=(128|63&a)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),u+=3):a>=65536&&a<=1114111?(n|=(240|a>>>18)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=(128|a>>>12&63)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=(128|a>>>6&63)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=(128|63&a)<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),u+=4):(n|=239<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=191<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),n|=189<<(i-=8),0===i&&(e=t.mix(e,n),n=0,i=32),u+=3),o=r.offsetByCodePoints(o,1)}return 32!==i&&(e^=n=461845907*(65535&(n=h(n=3432918353*(65535&n)+((3432918353*(n>>>16)&65535)<<16)&4294967295,15)))+((461845907*(n>>>16)&65535)<<16)&4294967295),e^u},t.mixStringLE=function(e,r){for(var n=0,i=0,o=0,s=r.length,u=0;o<s;){var a=r.codePointAt(o);void 0===a&&(a=r.charCodeAt(o)),a>=0&&a<=127?(n|=a<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),u+=1):a>=128&&a<=2047?(n|=(192|a>>>6)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=(128|63&a)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),u+=2):a>=2048&&a<=65535||a>=57344&&a<=65535?(n|=(224|a>>>12)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=(128|a>>>6&63)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=(128|63&a)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),u+=3):a>=65536&&a<=1114111?(n|=(240|a>>>18)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=(128|a>>>12&63)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=(128|a>>>6&63)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=(128|63&a)<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),u+=4):(n|=239<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=191<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),n|=189<<i,32===(i+=8)&&(e=t.mix(e,n),n=0,i=0),u+=3),o=r.offsetByCodePoints(o,1)}return 32!==i&&(e^=n=461845907*(65535&(n=h(n=3432918353*(65535&n)+((3432918353*(n>>>16)&65535)<<16)&4294967295,15)))+((461845907*(n>>>16)&65535)<<16)&4294967295),e^u},t.mix=function(e,n){if("number"==typeof n)return n=h(n=3432918353*(65535&n)+((3432918353*(n>>>16)&65535)<<16)&4294967295,15),e=27492+(65535&(e=5*(65535&(e=h(e^=n=461845907*(65535&n)+((461845907*(n>>>16)&65535)<<16)&4294967295,13)))+((5*(e>>>16)&65535)<<16)&4294967295))+((58964+(e>>>16)&65535)<<16);if("string"==typeof n){if("BE"===r)return t.mixStringBE(e,n);if("LE"===r)return t.mixStringLE(e,n)}else if(n instanceof Uint8Array){if("BE"===r)return t.mixUint8ArrayBE(e,n);if("LE"===r)return t.mixUInt8ArrayLE(e,n)}throw new TypeError(""+n)},t.mash=function(t){return t=2246822507*(65535&(t^=t>>>16))+((2246822507*(t>>>16)&65535)<<16)&4294967295,t=3266489909*(65535&(t^=t>>>13))+((3266489909*(t>>>16)&65535)<<16)&4294967295,(t^=t>>>16)>>>0},t}(),c=function(){function t(){}return t.compare=function(e,r){if(e instanceof Date&&(e=e.getTime()),r instanceof Date&&(r=r.getTime()),void 0===e)return void 0===r?0:1;if(null===e)return void 0===r?-1:null===r?0:1;if("number"==typeof e)return null==r?-1:"number"==typeof r?e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0:1;if("string"==typeof e)return null==r||"number"==typeof r?-1:"string"==typeof r?e<r?-1:e>r?1:0:1;if("object"==typeof e&&"function"==typeof e.compareTo){var n=e.compareTo(r);return n<0?-1:n>0?1:0}return Array.isArray(e)?null==r||"number"==typeof r||"string"==typeof r?-1:Array.isArray(r)?t.compareArray(e,r):1:null==r||"number"==typeof r||"string"==typeof r||Array.isArray(r)?-1:t.compareObject(e,r)},t.compareArray=function(e,r){for(var n=e.length,i=r.length,o=0,s=0,u=Math.min(n,i);s<u&&0===o;s+=1)o=t.compare(e[s],r[s]);return 0!==o?o:n>i?1:n<i?-1:0},t.compareObject=function(e,r){for(var n=Object.keys(e),i=Object.keys(r),o=n.length,s=i.length,u=Math.min(o,s),a=0,p=0;p<u&&0===a;p+=1){var h=n[p],f=i[p];0===(a=t.compare(h,f))&&(a=t.compare(e[h],r[f]))}return 0!==a?a:o>s?1:o<s?-1:0},t.equal=function(e,r){if(e instanceof Date&&(e=e.getTime()),r instanceof Date&&(r=r.getTime()),e===r)return!0;if("number"==typeof e){if("number"==typeof r)return isNaN(e)&&isNaN(r)}else{if("object"==typeof e&&e&&"function"==typeof e.equals)return e.equals(r);if(Array.isArray(e)){if(Array.isArray(r))return t.equalArray(e,r)}else if("object"==typeof e&&e&&"object"==typeof r&&r)return t.equalObject(e,r)}return!1},t.equalArray=function(e,r){var n=e.length;if(n!==r.length)return!1;for(var i=0;i<n;i+=1)if(!t.equal(e[i],r[i]))return!1;return!0},t.equalObject=function(e,r){var n=Object.keys(e),i=Object.keys(r),o=n.length;if(o!==i.length)return!1;for(var s=0;s<o;s+=1){var u=n[s];if(u!==i[s]||!t.equal(e[u],r[u]))return!1}return!0},t.hash=function(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e)return f.hash(e);if("object"==typeof e&&"function"==typeof e.hashCode)return e.hashCode();if(Array.isArray(e))return t.hashArray(e);if("object"==typeof e)return t.hashObject(e);throw new TypeError(""+e)},t.hashArray=function(e){for(var r=0,n=e.length,i=0;i<n;i+=1)r=f.mix(r,t.hash(e[i]));return f.mash(r)},t.hashObject=function(t){for(var e=0,r=Object.keys(t),n=r.length,i=0;i<n;i+=1){var o=r[i];e=f.mix(f.mix(e,f.hash(o)),t[o])}return f.mash(e)},t}(),l=function(){function t(){}return t.prototype.set=function(t){throw new Error("immutable")},t.prototype.delete=function(){throw new Error("immutable")},t.empty=function(){return t._empty||(t._empty=new t.Empty),t._empty},t.unary=function(e){return new t.Unary(e)},t.array=function(e,r,n){return void 0===r&&(r=0),void 0===n&&(n=e.length),new t.Array(e,r,n)},t}(),d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function y(t,e){function r(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function _(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.isEmpty=function(){return!0},e.prototype.head=function(){throw new Error("empty")},e.prototype.step=function(){throw new Error("empty")},e.prototype.skip=function(t){},e.prototype.hasNext=function(){return!1},e.prototype.nextIndex=function(){return 0},e.prototype.next=function(){return{done:!0}},e.prototype.hasPrevious=function(){return!1},e.prototype.previousIndex=function(){return-1},e.prototype.previous=function(){return{done:!0}},e}(l);l.Empty=v;var m=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r._index=0,r}return y(e,t),e.prototype.isEmpty=function(){return 0!==this._index},e.prototype.head=function(){if(0===this._index)return this._value;throw new Error("empty")},e.prototype.step=function(){if(0!==this._index)throw new Error("empty");this._index=1},e.prototype.skip=function(t){this._index=Math.min(Math.max(0,this._index+t),1)},e.prototype.hasNext=function(){return 0===this._index},e.prototype.nextIndex=function(){return this._index},e.prototype.next=function(){return 0===this._index?(this._index=1,{value:this._value,done:!0}):{done:!0}},e.prototype.hasPrevious=function(){return 1===this._index},e.prototype.previousIndex=function(){return this._index-1},e.prototype.previous=function(){return 1===this._index?(this._index=0,{value:this._value,done:!0}):{done:!0}},e}(l);l.Unary=m;var w=function(t){function e(e,r,n){var i=t.call(this)||this;return i._array=e,i._index=r,i._limit=n,i}return y(e,t),e.prototype.isEmpty=function(){return this._index>=this._limit},e.prototype.head=function(){if(this._index<this._limit)return this._array[this._index];throw new Error("empty")},e.prototype.step=function(){if(!(this._index<this._limit))throw new Error("empty");this._index=1},e.prototype.skip=function(t){this._index=Math.min(this._index+t,this._limit)},e.prototype.hasNext=function(){return this._index<this._limit},e.prototype.nextIndex=function(){return this._index},e.prototype.next=function(){var t=this._index;return t<this._limit?(this._index=t+1,{value:this._array[t],done:this._index===this._limit}):(this._index=this._limit,{done:!0})},e.prototype.hasPrevious=function(){return this._index>0},e.prototype.previousIndex=function(){return this._index-1},e.prototype.previous=function(){var t=this._index-1;return t>=0?(this._index=t,{value:this._array[t],done:0===t}):(this._index=0,{done:!0})},e}(l);l.Array=w;var g=function(t){function e(r){var n=t.call(this,r)||this;return n.__proto__=e.prototype,n}return y(e,t),e}(Error),b=function(t,e){if(!t)throw new g(e)};b.ok=function(t,e){if(!t)throw new g(e)},b.notOk=function(t,e){if(t)throw new g(e)},b.equal=function(t,e,r){if(!c.equal(t,e))throw new g(r)},b.notEqual=function(t,e,r){if(c.equal(t,e))throw new g(r)},b.identity=function(t,e,r){if(t!==e)throw new g(r)},b.notIdentity=function(t,e,r){if(t===e)throw new g(r)},b.compareLessThan=function(t,e,r){if(!(c.compare(t,e)<0))throw new g(r)},b.compareNotLessThan=function(t,e,r){if(c.compare(t,e)<0)throw new g(r)},b.compareLessThanOrEqual=function(t,e,r){if(!(c.compare(t,e)<=0))throw new g(r)},b.compareNotLessThanOrEqual=function(t,e,r){if(c.compare(t,e)<=0)throw new g(r)},b.compareEqual=function(t,e,r){if(0!==c.compare(t,e))throw new g(r)},b.compareNotEqual=function(t,e,r){if(0===c.compare(t,e))throw new g(r)},b.compareGreaterThanOrEqual=function(t,e,r){if(!(c.compare(t,e)>=0))throw new g(r)},b.compareNotGreaterThanOrEqual=function(t,e,r){if(c.compare(t,e)>=0)throw new g(r)},b.compareGreaterThan=function(t,e,r){if(!(c.compare(t,e)>0))throw new g(r)},b.compareNotGreaterThan=function(t,e,r){if(c.compare(t,e)>0)throw new g(r)};var S=function(){function t(t,e){this._level=t,this._label=e}return t.prototype.level=function(){return this._level},t.prototype.label=function(e){return void 0===e?this._label:t.create(this._level,e)},t.prototype.isTrace=function(){return this._level===t.TRACE_LEVEL},t.prototype.isDebug=function(){return this._level===t.DEBUG_LEVEL},t.prototype.isInfo=function(){return this._level===t.INFO_LEVEL},t.prototype.isNote=function(){return this._level===t.NOTE_LEVEL},t.prototype.isWarning=function(){return this._level===t.WARNING_LEVEL},t.prototype.isError=function(){return this._level===t.ERROR_LEVEL},t.prototype.isAlert=function(){return this._level===t.ALERT_LEVEL},t.prototype.isFatal=function(){return this._level===t.FATAL_LEVEL},t.prototype.compareTo=function(t){return this===t?0:this._level<t._level?-1:this._level>t._level?1:this._label.localeCompare(t._label)},t.prototype.equals=function(e){return this===e||e instanceof t&&(this._level===e._level&&this._label===e._label)},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(f.mix(t._hashSeed,this._level),f.hash(this._label)))},t.prototype.toString=function(){return this._label},t.create=function(e,r){switch(e){case t.TRACE_LEVEL:return t.trace(r);case t.DEBUG_LEVEL:return t.debug(r);case t.INFO_LEVEL:return t.info(r);case t.NOTE_LEVEL:return t.note(r);case t.WARNING_LEVEL:return t.warning(r);case t.ERROR_LEVEL:return t.error(r);case t.ALERT_LEVEL:return t.alert(r);case t.FATAL_LEVEL:return t.fatal(r);default:throw new Error(""+e)}},t.trace=function(e){return void 0===e&&(e="trace"),"trace"===e?(t._trace||(t._trace=new t(t.TRACE_LEVEL,e)),t._trace):new t(t.TRACE_LEVEL,e)},t.debug=function(e){return void 0===e&&(e="debug"),"debug"===e?(t._debug||(t._debug=new t(t.DEBUG_LEVEL,e)),t._debug):new t(t.DEBUG_LEVEL,e)},t.info=function(e){return void 0===e&&(e="info"),"info"===e?(t._info||(t._info=new t(t.INFO_LEVEL,e)),t._info):new t(t.INFO_LEVEL,e)},t.note=function(e){return void 0===e&&(e="note"),"note"===e?(t._note||(t._note=new t(t.NOTE_LEVEL,e)),t._note):new t(t.NOTE_LEVEL,e)},t.warning=function(e){return void 0===e&&(e="warning"),"warning"===e?(t._warning||(t._warning=new t(t.WARNING_LEVEL,e)),t._warning):new t(t.WARNING_LEVEL,e)},t.error=function(e){return void 0===e&&(e="error"),"error"===e?(t._error||(t._error=new t(t.ERROR_LEVEL,e)),t._error):new t(t.ERROR_LEVEL,e)},t.alert=function(e){return void 0===e&&(e="alert"),"alert"===e?(t._alert||(t._alert=new t(t.ALERT_LEVEL,e)),t._alert):new t(t.ALERT_LEVEL,e)},t.fatal=function(e){return void 0===e&&(e="fatal"),"fatal"===e?(t._fatal||(t._fatal=new t(t.FATAL_LEVEL,e)),t._fatal):new t(t.FATAL_LEVEL,e)},t.TRACE_LEVEL=0,t.DEBUG_LEVEL=1,t.INFO_LEVEL=2,t.NOTE_LEVEL=3,t.WARNING_LEVEL=4,t.ERROR_LEVEL=5,t.ALERT_LEVEL=6,t.FATAL_LEVEL=7,t}(),x=function(){function t(t){this._buckets=new Array(t),this._gen4Hits=0,this._gen3Hits=0,this._gen2Hits=0,this._gen1Hits=0,this._misses=0}return t.prototype.get=function(t){if(0!==this._buckets.length){var e=Math.abs(c.hash(t))%this._buckets.length,r=this._buckets[e];if(r){var n=r._gen4Key;if(void 0!==n&&c.equal(t,n)){var i=r._gen4Val;if(void 0!==i)return this._gen4Hits+=1,r._gen4Weight++,i;r._gen4Key=void 0}var o=r._gen3Key;if(void 0!==o&&c.equal(t,o)){var s=r._gen3Val;if(void 0!==s)return this._gen3Hits+=1,r._gen3Weight++>r._gen4Weight&&(this._buckets[e]=new E(r._gen3Key,r._gen3Val,r._gen3Weight,r._gen4Key,r._gen4Val,r._gen4Weight,r._gen2Key,r._gen2Val,r._gen2Weight,r._gen1Key,r._gen1Val,r._gen1Weight)),s;r._gen3Key=void 0}var u=r._gen2Key;if(void 0!==u&&c.equal(t,u)){var a=r._gen2Val;if(void 0!==a)return this._gen2Hits+=1,r._gen2Weight++>r._gen3Weight&&(this._buckets[e]=new E(r._gen4Key,r._gen4Val,r._gen4Weight,r._gen2Key,r._gen2Val,r._gen2Weight,r._gen3Key,r._gen3Val,r._gen3Weight,r._gen1Key,r._gen1Val,r._gen1Weight)),a;r._gen2Key=void 0}var p=r._gen1Key;if(void 0!==p&&c.equal(t,p)){var h=r._gen1Val;if(void 0!==h)return this._gen1Hits+=1,r._gen1Weight++>r._gen2Weight&&(this._buckets[e]=new E(r._gen4Key,r._gen4Val,r._gen4Weight,r._gen3Key,r._gen3Val,r._gen3Weight,r._gen1Key,r._gen1Val,r._gen1Weight,r._gen2Key,r._gen2Val,r._gen2Weight)),h;r._gen1Key=void 0}this._misses+=1}}},t.prototype.put=function(t,e){if(0===this._buckets.length)return e;var r=Math.abs(c.hash(t))%this._buckets.length,n=this._buckets[r]||new E,i=n._gen4Key;if(void 0!==i&&c.equal(t,i)){var o=n._gen4Val;if(void 0!==o)return this._gen4Hits+=1,n._gen4Weight++,o;n._gen4Key=void 0,i=void 0}var s=n._gen3Key;if(void 0!==s&&c.equal(t,s)){var u=n._gen3Val;if(void 0!==u)return this._gen3Hits+=1,n._gen3Weight++>n._gen4Weight&&(this._buckets[r]=new E(n._gen3Key,n._gen3Val,n._gen3Weight,n._gen4Key,n._gen4Val,n._gen4Weight,n._gen2Key,n._gen2Val,n._gen2Weight,n._gen1Key,n._gen1Val,n._gen1Weight)),u;n._gen3Key=void 0,s=void 0}var a=n._gen2Key;if(void 0!==a&&c.equal(t,a)){var p=n._gen2Val;if(void 0!==p)return this._gen2Hits+=1,n._gen2Weight++>n._gen3Weight&&(this._buckets[r]=new E(n._gen4Key,n._gen4Val,n._gen4Weight,n._gen2Key,n._gen2Val,n._gen2Weight,n._gen3Key,n._gen3Val,n._gen3Weight,n._gen1Key,n._gen1Val,n._gen1Weight)),p;n._gen2Key=void 0,a=void 0}var h=n._gen1Key;if(void 0!==h&&c.equal(t,h)){var f=n._gen1Val;if(void 0!==f)return this._gen1Hits+=1,n._gen1Weight++>n._gen2Weight&&(this._buckets[r]=new E(n._gen4Key,n._gen4Val,n._gen4Weight,n._gen3Key,n._gen3Val,n._gen3Weight,n._gen1Key,n._gen1Val,n._gen1Weight,n._gen2Key,n._gen2Val,n._gen2Weight)),f;n._gen1Key=void 0,h=void 0}return this._misses+=1,this._buckets[r]=void 0===i?new E(n._gen3Key,n._gen3Val,n._gen3Weight,n._gen2Key,n._gen2Val,n._gen2Weight,n._gen1Key,n._gen1Val,n._gen1Weight,t,e,1):void 0===s?new E(n._gen4Key,n._gen4Val,n._gen4Weight,n._gen2Key,n._gen2Val,n._gen2Weight,n._gen1Key,n._gen1Val,n._gen1Weight,t,e,1):void 0===a?new E(n._gen4Key,n._gen4Val,n._gen4Weight,n._gen3Key,n._gen3Val,n._gen3Weight,n._gen1Key,n._gen1Val,n._gen1Weight,t,e,1):void 0===h?new E(n._gen4Key,n._gen4Val,n._gen4Weight,n._gen3Key,n._gen3Val,n._gen3Weight,n._gen2Key,n._gen2Val,n._gen2Weight,t,e,1):new E(n._gen4Key,n._gen4Val,n._gen4Weight-1,n._gen3Key,n._gen3Val,n._gen3Weight-1,n._gen1Key,n._gen1Val,n._gen1Weight,t,e,1),e},t.prototype.remove=function(t){if(0!==this._buckets.length){var e=Math.abs(c.hash(t))%this._buckets.length,r=this._buckets[e];if(r){var n=r._gen4Key;if(void 0!==n&&c.equal(t,n)){var i=r._gen4Val;return this._buckets[e]=new E(r._gen3Key,r._gen3Val,r._gen3Weight,r._gen2Key,r._gen2Val,r._gen2Weight,r._gen1Key,r._gen1Val,r._gen1Weight,void 0,void 0,0),i}var o=r._gen3Key;if(void 0!==o&&c.equal(t,o)){var s=r._gen3Val;return this._buckets[e]=new E(r._gen4Key,r._gen4Val,r._gen4Weight,r._gen2Key,r._gen2Val,r._gen2Weight,r._gen1Key,r._gen1Val,r._gen1Weight,void 0,void 0,0),s}var u=r._gen2Key;if(void 0!==u&&c.equal(t,u)){var a=r._gen2Val;return this._buckets[e]=new E(r._gen4Key,r._gen4Val,r._gen4Weight,r._gen3Key,r._gen3Val,r._gen3Weight,r._gen1Key,r._gen1Val,r._gen1Weight,void 0,void 0,0),a}var p=r._gen1Key;if(void 0!==p&&c.equal(t,p)){var h=r._gen1Val;return this._buckets[e]=new E(r._gen4Key,r._gen4Val,r._gen4Weight,r._gen3Key,r._gen3Val,r._gen3Weight,r._gen2Key,r._gen2Val,r._gen2Weight,void 0,void 0,0),h}}}},t.prototype.clear=function(){for(var t=0;t<this._buckets.length;t+=1)this._buckets[t]=void 0},t.prototype.hits=function(){return this._gen4Hits+this._gen3Hits+this._gen2Hits+this._gen1Hits},t.prototype.hitRatio=function(){var t=this.hits();return t/(t+this._misses)},t}(),E=function(){return function(t,e,r,n,i,o,s,u,a,p,h,f){void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===f&&(f=0),this._gen4Key=t,this._gen4Val=e,this._gen4Weight=r,this._gen3Key=n,this._gen3Val=i,this._gen3Weight=o,this._gen2Key=s,this._gen2Val=u,this._gen2Weight=a,this._gen1Key=p,this._gen1Val=h,this._gen1Weight=f}}(),k=function(){function t(t){this._buckets=new Array(t),this._gen4Hits=0,this._gen3Hits=0,this._gen2Hits=0,this._gen1Hits=0,this._misses=0}return t.prototype.put=function(t){if(0===this._buckets.length)return t;var e=Math.abs(c.hash(t))%this._buckets.length,r=this._buckets[e]||new C,n=r._gen4Val;if(void 0!==n&&c.equal(t,n))return this._gen4Hits+=1,r._gen4Weight++,n;var i=r._gen3Val;if(void 0!==i&&c.equal(t,i))return this._gen3Hits+=1,r._gen3Weight++>r._gen4Weight&&(this._buckets[e]=new C(r._gen3Val,r._gen3Weight,r._gen4Val,r._gen4Weight,r._gen2Val,r._gen2Weight,r._gen1Val,r._gen1Weight)),i;var o=r._gen2Val;if(void 0!==o&&c.equal(t,o))return this._gen2Hits+=1,r._gen2Weight++>r._gen3Weight&&(this._buckets[e]=new C(r._gen4Val,r._gen4Weight,r._gen2Val,r._gen2Weight,r._gen3Val,r._gen3Weight,r._gen1Val,r._gen1Weight)),o;var s=r._gen1Val;return void 0!==s&&c.equal(t,s)?(this._gen1Hits+=1,r._gen1Weight++>r._gen2Weight&&(this._buckets[e]=new C(r._gen4Val,r._gen4Weight,r._gen3Val,r._gen3Weight,r._gen1Val,r._gen1Weight,r._gen2Val,r._gen2Weight)),s):(this._misses+=1,this._buckets[e]=void 0===n?new C(r._gen3Val,r._gen3Weight,r._gen2Val,r._gen2Weight,r._gen1Val,r._gen1Weight,t,1):void 0===i?new C(r._gen4Val,r._gen4Weight,r._gen2Val,r._gen2Weight,r._gen1Val,r._gen1Weight,t,1):void 0===o?new C(r._gen4Val,r._gen4Weight,r._gen3Val,r._gen3Weight,r._gen1Val,r._gen1Weight,t,1):void 0===s?new C(r._gen4Val,r._gen4Weight,r._gen3Val,r._gen3Weight,r._gen2Val,r._gen2Weight,t,1):new C(r._gen4Val,r._gen4Weight-1,r._gen3Val,r._gen3Weight-1,r._gen1Val,r._gen1Weight,t,1),t)},t.prototype.remove=function(t){if(0===this._buckets.length)return!1;var e=Math.abs(c.hash(t))%this._buckets.length,r=this._buckets[e];if(!r)return!1;var n=r._gen4Val;if(void 0!==n&&c.equal(t,n))return this._buckets[e]=new C(r._gen3Val,r._gen3Weight,r._gen2Val,r._gen2Weight,r._gen1Val,r._gen1Weight,void 0,0),!0;var i=r._gen3Val;if(void 0!==i&&c.equal(t,i))return this._buckets[e]=new C(r._gen4Val,r._gen4Weight,r._gen2Val,r._gen2Weight,r._gen1Val,r._gen1Weight,void 0,0),!0;var o=r._gen2Val;if(void 0!==o&&c.equal(t,o))return this._buckets[e]=new C(r._gen4Val,r._gen4Weight,r._gen3Val,r._gen3Weight,r._gen1Val,r._gen1Weight,void 0,0),!0;var s=r._gen1Val;return!(void 0===s||!c.equal(t,s))&&(this._buckets[e]=new C(r._gen4Val,r._gen4Weight,r._gen3Val,r._gen3Weight,r._gen2Val,r._gen2Weight,void 0,0),!0)},t.prototype.clear=function(){for(var t=0;t<this._buckets.length;t+=1)this._buckets[t]=void 0},t.prototype.hits=function(){return this._gen4Hits+this._gen3Hits+this._gen2Hits+this._gen1Hits},t.prototype.hitRatio=function(){var t=this.hits();return t/(t+this._misses)},t}(),C=function(){return function(t,e,r,n,i,o,s,u){void 0===e&&(e=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===u&&(u=0),this._gen4Val=t,this._gen4Weight=e,this._gen3Val=r,this._gen3Weight=n,this._gen2Val=i,this._gen2Weight=o,this._gen1Val=s,this._gen1Weight=u}}(),O=function(){return function(){}}(),A=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._offset=e,o._line=r,o._column=n,o._note=i,o}return y(e,t),e.prototype.offset=function(){return this._offset},e.prototype.line=function(){return this._line},e.prototype.column=function(){return this._column},e.prototype.note=function(){return this._note},e.prototype.min=function(t){return this._offset<=t._offset?this:t},e.prototype.max=function(t){return this._offset>=t._offset?this:t},e.prototype.start=function(){return this},e.prototype.end=function(){return this},e.prototype.union=function(t){if(t instanceof e)return this._offset===t._offset&&this._line===t._line&&this._column===t._column?this:O.Span.from(this,t);if(t instanceof O.Span){var r=this.min(t._start),n=this.max(t._end);return r===t._start&&n===t._end?t:O.Span.from(r,n)}throw new Error(t.toString())},e.prototype.shift=function(t){var r=this._offset+(this._offset-t._offset),n=this._line+(this._line-t._line),i=this._column;return 1===n&&(i+=this._column-t._column),r===this._offset&&n===this._line&&i===this._column?this:e.at(r,n,i,this._note)},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._offset===t._offset&&this._line===t._line&&this._column===t._column&&this._note===t._note)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(f.mix(f.mix(e._hashSeed,this._offset),this._line),this._column),f.hash(this._note)))},e.prototype.display=function(t){O.Format.displayNumber(this._line,t),t=t.write(58),O.Format.displayNumber(this._column,t),null!==this._note&&(t=t.write(58).write(32).write(this._note))},e.prototype.debug=function(t){t=t.write("Mark").write(".").write("at").write("("),O.Format.debugNumber(this._offset,t),t=t.write(", "),O.Format.debugNumber(this._line,t),t=t.write(", "),O.Format.debugNumber(this._column,t),null!==this._note&&(t=t.write(", "),O.Format.debugString(this._note,t)),t=t.write(")")},e.prototype.toString=function(){return O.Format.display(this)},e.zero=function(){return e._zero||(e._zero=new e(0,1,1,null)),e._zero},e.at=function(t,r,n,i){return void 0===i&&(i=null),new e(t,r,n,i)},e}(O);O.Mark=A;var I=function(t){function e(e,r){var n=t.call(this)||this;return n._start=e,n._end=r,n}return y(e,t),e.prototype.start=function(){return this._start},e.prototype.end=function(){return this._end},e.prototype.union=function(t){if(t instanceof O.Mark){var r=this._start.min(t),n=this._end.max(t);return r===this._start&&n===this._end?this:e.from(r,n)}if(t instanceof e){r=this._start.min(t._start),n=this._end.max(t._end);return r===this._start&&n===this._end?this:e.from(r,n)}throw new Error(t.toString())},e.prototype.shift=function(t){var r=this._start.shift(t),n=this._end.shift(t);return r===this._start&&n===this._end?this:e.from(r,n)},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._start.equals(t._start)&&this._end.equals(t._end))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._start.hashCode()),this._end.hashCode()))},e.prototype.display=function(t){null!==this._start._note&&(t=t.write(this._start._note).write(58).write(32)),O.Format.displayNumber(this._start._line,t),t=t.write(58),O.Format.displayNumber(this._start._column,t),t=t.write(45),O.Format.displayNumber(this._end._line,t),t=t.write(58),O.Format.displayNumber(this._end._column,t),null!==this._end._note&&(t=t.write(58).write(32).write(this._end._note))},e.prototype.debug=function(t){t=t.write("Span").write(".").write("from").write("("),this._start.debug(t),t=t.write(", "),this._end.debug(t),t=t.write(")")},e.prototype.toString=function(){return O.Format.display(this)},e.from=function(t,r){if(t._offset>r._offset){var n=t;t=r,r=n}return new e(t,r)},e}(O);O.Span=I;var D=function(t){function e(r){var n=t.call(this,r)||this;return n.__proto__=e.prototype,n}return y(e,t),e}(Error),M=function(){function t(t,e,r){this._lineSeparator=t,this._isPretty=e,this._isStyled=r}return t.prototype.lineSeparator=function(t){return void 0===t?this._lineSeparator:this.copy(t,this._isPretty,this._isStyled)},t.prototype.isPretty=function(t){return void 0===t?this._isPretty:this.copy(this._lineSeparator,t,this._isStyled)},t.prototype.isStyled=function(t){return void 0===t?this._isStyled:this.copy(this._lineSeparator,this._isPretty,t)},t.prototype.copy=function(e,r,n){return t.create(e,r,n)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this._lineSeparator===e._lineSeparator&&this._isPretty===e._isPretty&&this._isStyled===e._isStyled)},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(f.mix(f.mix(t._hashSeed,f.hash(this._lineSeparator)),f.hash(this._isPretty)),f.hash(this._isStyled)))},t.prototype.debug=function(t){t=t.write("OutputSettings").write(46),t=(t=this._isPretty||this._isStyled?this._isPretty&&!this._isStyled?t.write("pretty"):!this._isPretty&&this._isStyled?t.write("styled"):t.write("prettyStyled"):t.write("standard")).write(40).write(41),Z.lineSeparator()!==this._lineSeparator&&(t=t.write(46).write("lineSeparator").write(40).display(this._lineSeparator).write(41))},t.prototype.toString=function(){return Z.debug(this)},t.standard=function(){return t._standard||(t._standard=new t(Z.lineSeparator(),!1,!1)),t._standard},t.pretty=function(){return t._pretty||(t._pretty=new t(Z.lineSeparator(),!0,!1)),t._pretty},t.styled=function(){return t._styled||(t._styled=new t(Z.lineSeparator(),!1,!0)),t._styled},t.prettyStyled=function(){return t._prettyStyled||(t._prettyStyled=new t(Z.lineSeparator(),!0,!0)),t._prettyStyled},t.create=function(e,r,n){return"string"!=typeof e&&(e=Z.lineSeparator()),"boolean"!=typeof r&&(r=!1),"boolean"!=typeof n&&(n=!1),Z.lineSeparator()===e?r||n?r&&!n?t.pretty():!r&&n?t.styled():t.prettyStyled():t.standard():new t(e,r,n)},t.fromAny=function(e){return e instanceof t?e:"object"==typeof e&&e?t.create(e.lineSeparator,e.isPretty,e.isStyled):t.standard()},t}(),T=function(t){function e(r){var n=t.call(this,r)||this;return n.__proto__=e.prototype,n}return y(e,t),e}(Error),P=function(){function t(){}return t.prototype.writeln=function(t){return"string"==typeof t&&this.write(t),this.write(this.settings().lineSeparator())},t.prototype.display=function(t){return Z.display(t,this),this},t.prototype.debug=function(t){return Z.debug(t,this),this},t.prototype.flush=function(){return this},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t.length,n=0;n<r;n+=1)this.write(t[n])},t.prototype.trap=function(){throw new T},t.prototype.clone=function(){throw new Error},t.full=function(e,r){return void 0===e&&(e=null),void 0===r&&(r=M.standard()),null===e&&r===M.standard()?(t._full||(t._full=new V(e,M.standard())),t._full):new V(e,r)},t.done=function(e,r){return void 0===e&&(e=null),void 0===r&&(r=M.standard()),null===e&&r===M.standard()?(t._done||(t._done=new U(e,M.standard())),t._done):new U(e,r)},t.error=function(t,e){return void 0===e&&(e=M.standard()),new R(t,e)},t}(),V=function(t){function e(e,r){var n=t.call(this)||this;return n._value=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isFull=function(){return!0},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0===t||(t?P.done(this._value,this._settings):this)},e.prototype.write=function(t){return P.error(new T("full"),this._settings)},e.prototype.writeln=function(t){return P.error(new T("full"),this._settings)},e.prototype.bind=function(){return this._value},e.prototype.settings=function(t){return void 0===t?this._settings:P.full(this._value,t)},e.prototype.clone=function(){return this},e}(P),U=function(t){function e(e,r){var n=t.call(this)||this;return n._value=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!0},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&(t?this:P.full(this._value,this._settings))},e.prototype.write=function(t){return P.error(new T("done"),this._settings)},e.prototype.writeln=function(t){return P.error(new T("done"),this._settings)},e.prototype.bind=function(){return this._value},e.prototype.settings=function(t){return void 0===t?this._settings:P.done(this._value,t)},e.prototype.clone=function(){return this},e}(P),R=function(t){function e(e,r){var n=t.call(this)||this;return n._error=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!0},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.write=function(t){return this},e.prototype.writeln=function(t){return this},e.prototype.bind=function(){throw new T},e.prototype.trap=function(){return this._error},e.prototype.settings=function(t){return void 0===t?this._settings:P.error(this._error,t)},e.prototype.clone=function(){return this},e}(P),F=function(){function t(){}return t.prototype.trap=function(){throw new D},t.prototype.offset=function(){return this.mark()._offset},t.prototype.line=function(){return this.mark()._line},t.prototype.column=function(){return this.mark()._column},t.empty=function(e,r,n){return void 0===e&&(e=null),void 0===r&&(r=A.zero()),void 0===n&&(n=Y.standard()),null===e&&r===A.zero()&&n===Y.standard()?(t._empty||(t._empty=new z(null,A.zero(),Y.standard())),t._empty):new z(e,r,n)},t.done=function(e,r,n){return void 0===e&&(e=null),void 0===r&&(r=A.zero()),void 0===n&&(n=Y.standard()),null===e&&r===A.zero()&&n===Y.standard()?(t._done||(t._done=new L(null,A.zero(),Y.standard())),t._done):new L(e,r,n)},t.error=function(t,e,r,n){return void 0===e&&(e=null),void 0===r&&(r=A.zero()),void 0===n&&(n=Y.standard()),new q(t,e,r,n)},t}(),z=function(t){function e(e,r,n){var i=t.call(this)||this;return i._id=e,i._mark=r,i._settings=n,i}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isEmpty=function(){return!0},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0===t||(t?this:F.done(this._id,this._mark,this._settings))},e.prototype.head=function(){throw new D},e.prototype.step=function(){var t=new D("empty step");return F.error(t,this._id,this._mark,this._settings)},e.prototype.seek=function(t){var e=new D("empty seek");return F.error(e,this._id,this._mark,this._settings)},e.prototype.id=function(t){return void 0===t?this._id:F.empty(t,this._mark,this._settings)},e.prototype.mark=function(t){return void 0===t?this._mark:F.empty(this._id,t,this._settings)},e.prototype.settings=function(t){return void 0===t?this._settings:F.empty(this._id,this._mark,t)},e.prototype.clone=function(){return this},e}(F),L=function(t){function e(e,r,n){var i=t.call(this)||this;return i._id=e,i._mark=r,i._settings=n,i}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isEmpty=function(){return!1},e.prototype.isDone=function(){return!0},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&(t?F.empty(this._id,this._mark,this._settings):this)},e.prototype.head=function(){throw new D},e.prototype.step=function(){var t=new D("done step");return F.error(t,this._id,this._mark,this._settings)},e.prototype.seek=function(t){var e=new D("empty seek");return F.error(e,this._id,this._mark,this._settings)},e.prototype.id=function(t){return void 0===t?this._id:F.done(t,this._mark,this._settings)},e.prototype.mark=function(t){return void 0===t?this._mark:F.done(this._id,t,this._settings)},e.prototype.settings=function(t){return void 0===t?this._settings:F.done(this._id,this._mark,t)},e.prototype.clone=function(){return this},e}(F),q=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._error=e,o._id=r,o._mark=n,o._settings=i,o}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isEmpty=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!0},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.head=function(){throw new D},e.prototype.step=function(){var t=new D("error step");return F.error(t,this._id,this._mark,this._settings)},e.prototype.trap=function(){return this._error},e.prototype.seek=function(t){var e=new D("error seek");return F.error(e,this._id,this._mark,this._settings)},e.prototype.id=function(t){return void 0===t?this._id:F.error(this._error,t,this._mark,this._settings)},e.prototype.mark=function(t){return void 0===t?this._mark:F.error(this._error,this._id,t,this._settings)},e.prototype.settings=function(t){return void 0===t?this._settings:F.error(this._error,this._id,this._mark,t)},e.prototype.clone=function(){return this},e}(F),B=function(t){function e(e,r,n,i,o,s,u,a){void 0===r&&(r=null),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=1),void 0===s&&(s=Y.standard()),void 0===u&&(u=0),void 0===a&&(a=!1);var p=t.call(this)||this;return p._string=e,p._id=r,p._offset=n,p._line=i,p._column=o,p._settings=s,p._index=u,p._isPart=a,p}return y(e,t),e.prototype.isCont=function(){return this._index<this._string.length},e.prototype.isEmpty=function(){return this._isPart&&this._index>=this._string.length},e.prototype.isDone=function(){return!this._isPart&&this._index>=this._string.length},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0===t?this._isPart:(this._isPart=t,this)},e.prototype.head=function(){if(this._index<this._string.length){var t=this._string.codePointAt(this._index);return void 0!==t?t:this._string.charCodeAt(this._index)}throw new D},e.prototype.step=function(){var t=this._index;if(t<this._string.length){var e=this._string.codePointAt(t);return this._index=this._string.offsetByCodePoints(t,1),this._offset+=this._index-t,10===e?(this._line+=1,this._column=1):this._column+=1,this}var r=new D("invalid step");return F.error(r,this._id,this.mark(),this._settings)},e.prototype.seek=function(t){if(void 0!==t){var e=this._index+(t._offset-this._offset);if(0<=e&&e<=this._string.length)return this._offset=t._offset,this._line=t._line,this._column=t._column,this._index=e,this;var r=new D("invalid seek to "+t);return F.error(r,this._id,this.mark(),this._settings)}return this._offset=0,this._line=1,this._column=1,this._index=0,this},e.prototype.id=function(t){return void 0===t?this._id:(this._id=t,this)},e.prototype.mark=function(t){return void 0===t?A.at(this._offset,this._line,this._column):(this._offset=t._offset,this._line=t._line,this._column=t._column,this)},e.prototype.offset=function(){return this._offset},e.prototype.line=function(){return this._line},e.prototype.column=function(){return this._column},e.prototype.settings=function(t){return void 0===t?this._settings:(this._settings=Y.fromAny(t),this)},e.prototype.clone=function(){return new e(this._string,this._id,this._offset,this._line,this._column,this._settings,this._index,this._isPart)},e}(F),N=function(t){function e(e,r){var n=t.call(this)||this;return n._string=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!0},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.write=function(t){if("number"==typeof t)if(t>=0&&t<=55295||t>=57344&&t<=65535)t=String.fromCharCode(t);else if(t>=65536&&t<=1114111){var e=t-65536;t=String.fromCharCode(55296|e>>>10,56320|1023&e)}else t="ï¿½";return this._string+=t,this},e.prototype.writeln=function(t){return void 0===t?(this._string=this._string.concat(this._settings._lineSeparator),this):(this._string=this._string.concat(t).concat(this._settings._lineSeparator),this)},e.prototype.settings=function(t){return void 0===t?this._settings:(this._settings=M.fromAny(t),this)},e.prototype.bind=function(){return this._string},e.prototype.clone=function(){return new e(this._string,this._settings)},e.prototype.toString=function(){return this._string},e}(P),K=function(t){function e(r){var n=t.call(this,r)||this;return n.__proto__=e.prototype,n}return y(e,t),e}(Error),W=function(){function t(){}return t.prototype.isCont=function(){return!0},t.prototype.isDone=function(){return!1},t.prototype.isError=function(){return!1},t.prototype.feed=function(t){throw new Error},t.prototype.fork=function(t){return this},t.prototype.bind=function(){throw new Error},t.prototype.trap=function(){throw new Error},t.prototype.asDone=function(){throw new Error},t.prototype.asError=function(){throw new Error},t.prototype.andThen=function(t){return new G(this,t)},t.done=function(e){return void 0===e?(t._done||(t._done=new j(void 0)),t._done):new j(e)},t.error=function(t){return new H(t)},t}(),j=function(t){function e(e){var r=t.call(this)||this;return r._output=e,r}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isDone=function(){return!0},e.prototype.pull=function(t){return this},e.prototype.bind=function(){return this._output},e.prototype.asDone=function(){return this},e.prototype.andThen=function(t){return t},e}(W),H=function(t){function e(e){var r=t.call(this)||this;return r._error=e,r}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isError=function(){return!0},e.prototype.pull=function(t){return this},e.prototype.bind=function(){throw this._error},e.prototype.trap=function(){return this._error},e.prototype.asError=function(){return this},e.prototype.andThen=function(t){return this},e}(W),G=function(t){function e(e,r){var n=t.call(this)||this;return n._head=e,n._tail=r,n}return y(e,t),e.prototype.pull=function(t){var r=this._head;return r.isCont()&&(r=r.pull(t)),r.isError()?r.asError():r.isDone()?this._tail.pull(t):new e(r,this._tail)},e}(W),Q=function(t){function e(e,r,n){void 0===n&&(n=0);var i=t.call(this)||this;return i._value=e,i._input=r,i._index=n,i}return y(e,t),e.prototype.feed=function(t){return new e(t,""+t)},e.prototype.pull=function(t){return e.write(t,this._value,this._input,this._index)},e.write=function(t,r,n,i){void 0===i&&(i=0);for(var o=n.length;i<o&&t.isCont();){var s=n.codePointAt(i);void 0===s&&(s=n.charCodeAt(i)),t=t.write(s),i=n.offsetByCodePoints(i,1)}return i===o?W.done(r):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i)},e}(W),X=function(){function t(){}return t.stringInput=function(t){return new B(t)},t.stringOutput=function(t,e){return void 0===e&&"string"!=typeof t?(e=t,t=""):"string"!=typeof t&&(t=""),e=M.fromAny(e),new N(t,e)},t.stringWriter=function(t){return void 0===t?new Q(void 0,""):new Q(t,""+t)},t.writeString=function(t,e){return Q.write(e,void 0,""+t)},t.isAlpha=function(t){return t>=65&&t<=90||t>=97&&t<=122},t.isSpace=function(t){return 32===t||9===t},t.isNewline=function(t){return 10===t||13===t},t.isWhitespace=function(e){return t.isSpace(e)||t.isNewline(e)},t}(),Z=function(){function t(){}return t.display=function(e,r){var n=!(r instanceof P);if(void 0===e){if(void 0===r)return"undefined";r instanceof P||(r=X.stringOutput(r)),r=r.write("undefined")}else if(null===e){if(void 0===r)return"null";r instanceof P||(r=X.stringOutput(r)),r=r.write("null")}else if("number"==typeof e){if(void 0===r)return""+e;r instanceof P||(r=X.stringOutput(r)),t.displayNumber(e,r)}else if("string"==typeof e){if(void 0===r)return e;r instanceof P||(r=X.stringOutput(r)),r=r.write(e)}else if("object"==typeof e&&"function"==typeof e.display)r instanceof P||(r=X.stringOutput(r)),e.display(r);else{if(void 0===r)return""+e;r instanceof P||(r=X.stringOutput(r)),r=r.write(""+e)}if(n)return r.toString()},t.debug=function(e,r){var n=!(r instanceof P);if(void 0===e){if(void 0===r)return"undefined";r instanceof P||(r=X.stringOutput(r)),r=r.write("undefined")}else if(null===e){if(void 0===r)return"null";r instanceof P||(r=X.stringOutput(r)),r=r.write("null")}else if("number"==typeof e){if(void 0===r)return""+e;r instanceof P||(r=X.stringOutput(r)),t.debugNumber(e,r)}else if("string"==typeof e)r instanceof P||(r=X.stringOutput(r)),t.debugString(e,r);else if("object"==typeof e&&"function"==typeof e.debug)r instanceof P||(r=X.stringOutput(r)),e.debug(r);else{if(void 0===r)return""+e;r instanceof P||(r=X.stringOutput(r)),r=r.write(""+e)}if(n)return r.toString()},t.displayNumber=function(t,e){if(isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<2147483648)if(t<0&&(e=e.write(45)),t>-10&&t<10)e=e.write(48+Math.abs(t));else{for(var r=new Array(19),n=t,i=18;n;)r[i]=Math.abs(n%10|0),n=n/10|0,i-=1;for(i+=1;i<19;)e=e.write(48+r[i]),i+=1}else e=e.write(""+t)},t.debugNumber=function(e,r){t.displayNumber(e,r)},t.debugChar=function(e,r){switch(r=r.write(39),e){case 8:r.write(92).write(98);break;case 9:r.write(92).write(116);break;case 10:r.write(92).write(110);break;case 12:r.write(92).write(102);break;case 13:r.write(92).write(114);break;case 34:r.write(92).write(34);break;case 39:r.write(92).write(39);break;case 92:r.write(92).write(92);break;default:r=e>=0&&e<=31||e>=127&&e<=159?r.write(92).write(117).write(t.encodeHex(e>>>12&15)).write(t.encodeHex(e>>>8&15)).write(t.encodeHex(e>>>4&15)).write(t.encodeHex(15&e)):r.write(e)}r=r.write(39)},t.debugString=function(e,r){r=r.write(34);for(var n=X.stringInput(e);n.isCont();){var i=n.head();switch(i){case 8:r.write(92).write(98);break;case 9:r.write(92).write(116);break;case 10:r.write(92).write(110);break;case 12:r.write(92).write(102);break;case 13:r.write(92).write(114);break;case 34:r.write(92).write(34);break;case 92:r.write(92).write(92);break;default:r=i>=0&&i<=31||i>=127&&i<=159?r.write(92).write(117).write(t.encodeHex(i>>>12&15)).write(t.encodeHex(i>>>8&15)).write(t.encodeHex(i>>>4&15)).write(t.encodeHex(15&i)):r.write(i)}n=n.step()}r=r.write(34)},t.encodeHex=function(t){return t<10?48+t:t-10+65},t.lineSeparator=function(){if(!t._lineSeparator){if("function"==typeof require){var e=require("os");e&&(t._lineSeparator=e.EOL)}t._lineSeparator||(t._lineSeparator="\n")}return t._lineSeparator},t}();O.Format=Z;var Y=function(){function t(t){this._isStrict=t}return t.prototype.isStripped=function(t){return void 0===t?this._isStrict:this.copy(t)},t.prototype.copy=function(e){return t.create(e)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this._isStrict===e._isStrict)},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(t._hashSeed,f.hash(this._isStrict)))},t.prototype.debug=function(t){t=t.write("InputSettings").write(46),t=(t=this._isStrict?t.write("stripped"):t.write("standard")).write(40).write(41)},t.prototype.toString=function(){return Z.debug(this)},t.standard=function(){return t._standard||(t._standard=new t(!1)),t._standard},t.stripped=function(){return t._stripped||(t._stripped=new t(!1)),t._stripped},t.create=function(e){return e?t.stripped():t.standard()},t.fromAny=function(e){return e instanceof t?e:"object"==typeof e&&e?t.create(e.isStripped):t.standard()},t}(),$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.empty=function(t,r,n){return void 0===t&&(t=null),void 0===r&&(r=A.zero()),void 0===n&&(n=Y.standard()),null===t&&r===A.zero()&&n===Y.standard()?(e._emptyBuffer||(e._emptyBuffer=new J(null,A.zero(),Y.standard())),e._emptyBuffer):new J(t,r,n)},e.done=function(t,r,n){return void 0===t&&(t=null),void 0===r&&(r=A.zero()),void 0===n&&(n=Y.standard()),null===t&&r===A.zero()&&n===Y.standard()?(e._doneBuffer||(e._doneBuffer=new tt(null,A.zero(),Y.standard())),e._doneBuffer):new tt(t,r,n)},e.error=function(t,e,r,n){return void 0===e&&(e=null),void 0===r&&(r=A.zero()),void 0===n&&(n=Y.standard()),new et(t,e,r,n)},e}(F),J=function(t){function e(e,r,n){var i=t.call(this)||this;return i._id=e,i._mark=r,i._settings=n,i}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isEmpty=function(){return!0},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0===t||(t?this:$.done(this._id,this._mark,this._settings))},e.prototype.index=function(t){if(void 0===t)return 0;if(0===t)return this;var e=new D("invalid index");return $.error(e,this._id,this._mark,this._settings)},e.prototype.limit=function(t){if(void 0===t)return 0;if(0===t)return this;var e=new D("invalid limit");return $.error(e,this._id,this._mark,this._settings)},e.prototype.capacity=function(){return 0},e.prototype.remaining=function(){return 0},e.prototype.has=function(t){return!1},e.prototype.get=function(t){throw new D},e.prototype.set=function(t,e){throw new D},e.prototype.head=function(){throw new D},e.prototype.step=function(t){var e=new D("empty step");return $.error(e,this._id,this._mark,this._settings)},e.prototype.seek=function(t){var e=new D("empty seek");return $.error(e,this._id,this._mark,this._settings)},e.prototype.id=function(t){return void 0===t?this._id:$.empty(t,this._mark,this._settings)},e.prototype.mark=function(t){return void 0===t?this._mark:$.empty(this._id,t,this._settings)},e.prototype.settings=function(t){return void 0===t?this._settings:$.empty(this._id,this._mark,t)},e.prototype.clone=function(){return this},e}($),tt=function(t){function e(e,r,n){var i=t.call(this)||this;return i._id=e,i._mark=r,i._settings=n,i}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isEmpty=function(){return!1},e.prototype.isDone=function(){return!0},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&(t?$.empty(this._id,this._mark,this._settings):this)},e.prototype.index=function(t){if(void 0===t)return 0;if(0===t)return this;var e=new D("invalid index");return $.error(e,this._id,this._mark,this._settings)},e.prototype.limit=function(t){if(void 0===t)return 0;if(0===t)return this;var e=new D("invalid limit");return $.error(e,this._id,this._mark,this._settings)},e.prototype.capacity=function(){return 0},e.prototype.remaining=function(){return 0},e.prototype.has=function(t){return!1},e.prototype.get=function(t){throw new D},e.prototype.set=function(t,e){throw new D},e.prototype.head=function(){throw new D},e.prototype.step=function(t){var e=new D("done step");return $.error(e,this._id,this._mark,this._settings)},e.prototype.seek=function(t){var e=new D("done seek");return $.error(e,this._id,this._mark,this._settings)},e.prototype.id=function(t){return void 0===t?this._id:$.done(t,this._mark,this._settings)},e.prototype.mark=function(t){return void 0===t?this._mark:$.done(this._id,t,this._settings)},e.prototype.settings=function(t){return void 0===t?this._settings:$.done(this._id,this._mark,t)},e.prototype.clone=function(){return this},e}($),et=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._error=e,o._id=r,o._mark=n,o._settings=i,o}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isEmpty=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!0},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.index=function(t){if(void 0===t)return 0;if(0===t)return this;var e=new D("invalid index");return $.error(e,this._id,this._mark,this._settings)},e.prototype.limit=function(t){if(void 0===t)return 0;if(0===t)return this;var e=new D("invalid limit");return $.error(e,this._id,this._mark,this._settings)},e.prototype.capacity=function(){return 0},e.prototype.remaining=function(){return 0},e.prototype.has=function(t){return!1},e.prototype.get=function(t){throw new D},e.prototype.set=function(t,e){throw new D},e.prototype.head=function(){throw new D},e.prototype.step=function(t){var e=new D("error step");return $.error(e,this._id,this._mark,this._settings)},e.prototype.trap=function(){return this._error},e.prototype.seek=function(t){var e=new D("error seek");return $.error(e,this._id,this._mark,this._settings)},e.prototype.id=function(t){return void 0===t?this._id:$.error(this._error,t,this._mark,this._settings)},e.prototype.mark=function(t){return void 0===t?this._mark:$.error(this._error,this._id,t,this._settings)},e.prototype.settings=function(t){return void 0===t?this._settings:$.error(this._error,this._id,this._mark,t)},e.prototype.clone=function(){return this},e}($),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeln=function(t){return"string"==typeof t&&this.write(t),this.write(this.settings().lineSeparator())},e.prototype.display=function(t){return Z.display(t,this),this},e.prototype.debug=function(t){return Z.debug(t,this),this},e.prototype.flush=function(){return this},e.prototype.clone=function(){throw new Error},e.full=function(t,r){return void 0===t&&(t=null),void 0===r&&(r=M.standard()),null===t&&r===M.standard()?(e._fullBuffer||(e._fullBuffer=new nt(t,M.standard())),e._fullBuffer):new nt(t,r)},e.done=function(t,r){return void 0===t&&(t=null),void 0===r&&(r=M.standard()),null===t&&r===M.standard()?(e._doneBuffer||(e._doneBuffer=new it(t,M.standard())),e._doneBuffer):new it(t,r)},e.error=function(t,e){return void 0===e&&(e=M.standard()),new ot(t,e)},e}(P),nt=function(t){function e(e,r){var n=t.call(this)||this;return n._value=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isFull=function(){return!0},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0===t||(t?rt.done(this._value,this._settings):this)},e.prototype.index=function(t){return void 0===t?0:0===t?this:rt.error(new T("invalid index"),this._settings)},e.prototype.limit=function(t){return void 0===t?0:0===t?this:rt.error(new T("invalid index"),this._settings)},e.prototype.capacity=function(){return 0},e.prototype.remaining=function(){return 0},e.prototype.has=function(t){return!1},e.prototype.get=function(t){throw new T},e.prototype.set=function(t,e){throw new T},e.prototype.write=function(t){return rt.error(new T("full"),this._settings)},e.prototype.writeln=function(t){return rt.error(new T("full"),this._settings)},e.prototype.step=function(t){return void 0===t&&(t=1),0===t?this:rt.error(new T("invalid step"),this._settings)},e.prototype.bind=function(){return this._value},e.prototype.settings=function(t){return void 0===t?this._settings:rt.full(this._value,t)},e.prototype.clone=function(){return this},e}(rt),it=function(t){function e(e,r){var n=t.call(this)||this;return n._value=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!0},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&(t?this:rt.full(this._value,this._settings))},e.prototype.index=function(t){return void 0===t?0:0===t?this:rt.error(new T("invalid index"),this._settings)},e.prototype.limit=function(t){return void 0===t?0:0===t?this:rt.error(new T("invalid index"),this._settings)},e.prototype.capacity=function(){return 0},e.prototype.remaining=function(){return 0},e.prototype.has=function(t){return!1},e.prototype.get=function(t){throw new T},e.prototype.set=function(t,e){throw new T},e.prototype.write=function(t){return rt.error(new T("done"),this._settings)},e.prototype.writeln=function(t){return rt.error(new T("done"),this._settings)},e.prototype.step=function(t){return void 0===t&&(t=1),0===t?this:rt.error(new T("invalid step"),this._settings)},e.prototype.bind=function(){return this._value},e.prototype.settings=function(t){return void 0===t?this._settings:rt.done(this._value,t)},e.prototype.clone=function(){return this},e}(rt),ot=function(t){function e(e,r){var n=t.call(this)||this;return n._error=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!0},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.index=function(t){return void 0===t?0:0===t?this:rt.error(new T("invalid index"),this._settings)},e.prototype.limit=function(t){return void 0===t?0:0===t?this:rt.error(new T("invalid index"),this._settings)},e.prototype.capacity=function(){return 0},e.prototype.remaining=function(){return 0},e.prototype.has=function(t){return!1},e.prototype.get=function(t){throw new T},e.prototype.set=function(t,e){throw new T},e.prototype.write=function(t){return this},e.prototype.writeln=function(t){return this},e.prototype.step=function(t){return void 0===t&&(t=1),0===t?this:rt.error(new T("invalid step"),this._settings)},e.prototype.bind=function(){throw new T},e.prototype.trap=function(){return this._error},e.prototype.settings=function(t){return void 0===t?this._settings:rt.error(this._error,t)},e.prototype.clone=function(){return this},e}(rt),st=function(){function t(){}return t.reset=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(109))},t.bold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(109))},t.faint=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(50).write(109))},t.black=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(48).write(109))},t.red=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(49).write(109))},t.green=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(50).write(109))},t.yellow=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(51).write(109))},t.blue=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(52).write(109))},t.magenta=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(53).write(109))},t.cyan=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(54).write(109))},t.gray=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(55).write(109))},t.blackBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(48).write(109))},t.redBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(49).write(109))},t.greenBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(50).write(109))},t.yellowBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(51).write(109))},t.blueBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(52).write(109))},t.magentaBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(53).write(109))},t.cyanBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(54).write(109))},t.grayBold=function(t){t.settings().isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(55).write(109))},t}(),ut=function(){function t(){}return t.isDigit=function(t){return t>=48&&t<=57},t.decodeDigit=function(t){if(t>=48&&t<=57)return t-48;var e=X.stringOutput();throw e.write("Invalid base-10 digit: "),Z.debugChar(t,e),new Error(e.bind())},t.encodeDigit=function(t){if(t>=0&&t<=9)return 48+t;throw new Error(""+t)},t.countDigits=function(t){var e=0;do{e+=1,t=t/10|0}while(t);return e},t.integerParser=function(){return new t.NumberParser(void 0,void 0,0)},t.parseInteger=function(e){return t.NumberParser.parse(e,void 0,void 0,0)},t.decimalParser=function(){return new t.NumberParser(void 0,void 0,1)},t.parseDecimal=function(e){return t.NumberParser.parse(e,void 0,void 0,1)},t.numberParser=function(){return new t.NumberParser},t.parseNumber=function(e){return t.NumberParser.parse(e)},t.integerWriter=function(e){return void 0===e?new t.IntegerWriter(void 0,0):new t.IntegerWriter(void 0,e)},t.writeInteger=function(e,r){return t.IntegerWriter.write(r,void 0,e)},t}(),at=function(){function t(t,e,r,n,i,o){this._input=t,this._tag=e,this._severity=r,this._message=n,this._note=i,this._cause=o}return t.prototype.input=function(){return this._input.clone()},t.prototype.tag=function(){return this._tag},t.prototype.severity=function(){return this._severity},t.prototype.message=function(){return this._message},t.prototype.note=function(){return this._note},t.prototype.cause=function(){return this._cause},t.prototype.lineDigits=function(){var t=ut.countDigits(this._tag.end().line());return null!==this._cause&&(t=Math.max(t,this._cause.lineDigits())),t},t.prototype.display=function(e){var r=this._input.clone(),n=this._tag.start(),i=this._tag.end(),o=this._severity,s=this._message,u=this._note,a=this._cause,p=this.lineDigits();t.displayDiagnostic(r,n,i,o,s,u,a,2,p,e)},t.prototype.toString=function(t){return Z.display(this,t)},t.from=function(e,r,n,i,o,s){return i instanceof t?(s=i,o=null,i=null):o instanceof t&&(s=o,o=null),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new t(e=e.clone(),r,n,i,o,s)},t.message=function(e,r,n,i,o){null===n||n instanceof t?(o=n,n=void 0):"string"==typeof n&&(i=n,n=void 0),(null===i||i instanceof t)&&(o=i,i=void 0),void 0===i&&(i=null),void 0===n&&(n=S.error());var s=r.mark(),u=r.clone();return u.seek(),t.from(u,s,n,e,i,o)},t.unexpected=function(e,r,n,i){var o;if(null===r||r instanceof t?(i=r,r=void 0):"string"==typeof r&&(n=r,r=void 0),(null===n||n instanceof t)&&(i=n,n=void 0),void 0===n&&(n=null),void 0===r&&(r=S.error()),e.isCont()){var s=X.stringOutput().write("unexpected").write(32);Z.debugChar(e.head(),s),o=s.bind()}else o="unexpected end of input";var u=e.mark(),a=e.clone();return a.seek(),t.from(a,u,r,o,n,i)},t.expected=function(e,r,n,i,o){null===n||n instanceof t?(o=n,n=void 0):"string"==typeof n&&(i=n,n=void 0),(null===i||i instanceof t)&&(o=i,i=void 0),void 0===i&&(i=null),void 0===n&&(n=S.error());var s=X.stringOutput().write("expected").write(32);"number"==typeof e?Z.debugChar(e,s):s=s.write(e),s=s.write(44).write(32).write("but found").write(32),r.isCont()?Z.debugChar(r.head(),s):s=s.write("end of input");var u=s.bind(),a=r.mark(),p=r.clone();return p.seek(),t.from(p,a,n,u,i,o)},t.displayDiagnostic=function(e,r,n,i,o,s,u,a,p,h){for(;;){null!==o&&(t.displayMessage(i,o,h),h=h.writeln()),t.displayAnchor(e,r,p,h),h=h.writeln();var f=t.displayContext(e,r,n,i,s,u,a,p,h);if(null===f)break;h=h.writeln(),e=f._input.clone(),r=f._tag.start(),n=f._tag.end(),i=f._severity,o=f._message,s=f._note,u=f._cause}},t.displayMessage=function(e,r,n){t.formatSeverity(e,n),n=n.write(e.label()),st.reset(n),st.bold(n),n=n.write(58),null!==r&&(n=n.write(32).write(r)),st.reset(n)},t.displayAnchor=function(e,r,n,i){t.displayLineLeadArrow(n,i),i=i.write(32);var o=e.id();null!==o&&Z.display(o,i),i=i.write(58),Z.displayNumber(r._line,i),i=i.write(58),Z.displayNumber(r._column,i),i=i.writeln(),t.displayLineLead(n,i)},t.displayCause=function(e,r,n,i){var o=e._input.clone(),s=e._tag.start(),u=e._tag.end(),a=e._severity,p=e._note,h=e._cause;return t.displayContext(o,s,u,a,p,h,r,n,i)},t.displayContext=function(e,r,n,i,o,s,u,a,p){var h=s,f=null!==s&&null===s._message&&c.equal(e.id(),s._input.id())?r._offset<=s._tag.start()._offset?-1:1:0;return 1===f&&(h=t.displayCause(s,u,a,p),p=p.writeln(),t.displayLineLeadEllipsis(a,p),p=p.writeln()),t.displayLines(e,r,n,i,u,a,p),null!==o&&t.displayNote(o,a,p),-1===f&&(p=p.writeln(),t.displayLineLeadEllipsis(a,p),p=p.writeln(),h=t.displayCause(s,u,a,p)),h},t.displayLines=function(e,r,n,i,o,s,u){for(var a=r.line(),p=n.line(),h=e.line();h<a;)t.consumeLineText(e,h),h+=1;if(p-a>2*o+2){for(;h<=a+o;)t.displayLine(e,r,n,i,h,s,u),h+=1;for(t.displayLineLeadEllipsis(s,u),u=u.write(32),t.formatSeverity(i,u),u=u.write(124),st.reset(u),u=u.writeln();h<p-o;)t.consumeLineText(e,h),h+=1}for(;h<=p;)t.displayLine(e,r,n,i,h,s,u),h+=1},t.displayNote=function(e,r,n){n=n.writeln(),t.displayLineLead(r,n),n=n.writeln(),t.displayLineComment("note",e,r,n)},t.displayLine=function(e,r,n,i,o,s,u){r._line===o&&n._line===o?t.displaySingleLine(e,r,n,i,o,s,u):r._line===o?t.displayStartLine(e,r,i,o,s,u):n._line===o?t.displayEndLine(e,n,i,o,s,u):t.displayMidLine(e,i,o,s,u)},t.displaySingleLine=function(e,r,n,i,o,s,u){t.displayLineLeadNumber(o,s,u),u=u.write(32);for(var a=1;a<e.column();a+=1)u=u.write(32);t.displayLineText(e,o,u),t.displayLineLead(s,u),u=u.write(32);for(var p=1;p<r._column;)u=u.write(32),p+=1;for(t.formatSeverity(i,u);p<=n._column;)u=u.write(94),p+=1;null!==n._note&&(u=u.write(32).write(n._note)),st.reset(u)},t.displayStartLine=function(e,r,n,i,o,s){t.displayLineLeadNumber(i,o,s),s=s.write(32).write(32).write(32);for(var u=1;u<e.column();u+=1)s=s.write(32);t.displayLineText(e,i,s),t.displayLineLead(o,s),s=s.write(32).write(32),t.formatSeverity(n,s),s=s.write(95);for(var a=1;a<r._column;)s=s.write(95),a+=1;s=s.write(94),null!==r._note&&(s=s.write(32).write(r._note)),st.reset(s),s=s.writeln()},t.displayEndLine=function(e,r,n,i,o,s){t.displayLineLeadNumber(i,o,s),s=s.write(32),t.formatSeverity(n,s),s=s.write(124),st.reset(s),s=s.write(32),t.displayLineText(e,i,s),t.displayLineLead(o,s),s=s.write(32),t.formatSeverity(n,s),s=s.write(124).write(95);for(var u=1;u<r._column;)s=s.write(95),u+=1;s=s.write(94),null!==r._note&&(s=s.write(32).write(r._note)),st.reset(s)},t.displayMidLine=function(e,r,n,i,o){t.displayLineLeadNumber(n,i,o),o=o.write(32),t.formatSeverity(r,o),o=o.write(124),st.reset(o),o=o.write(32),t.displayLineText(e,n,o)},t.displayLineComment=function(e,r,n,i){t.displayLineLeadComment(n,i),i=i.write(32),st.bold(i),i=i.write(e).write(58),st.reset(i),null!=r&&(i=i.write(32).write(r))},t.displayLineLead=function(t,e){st.blueBold(e);for(var r=1+t,n=0;n<r;n+=1)e=e.write(32);e=e.write(124),st.reset(e)},t.displayLineLeadComment=function(t,e){st.blueBold(e);for(var r=1+t,n=0;n<r;n+=1)e=e.write(32);e=e.write(61),st.reset(e)},t.displayLineLeadArrow=function(t,e){for(var r=0;r<t;r+=1)e=e.write(32);st.blueBold(e),e=e.write(45).write(45).write(62),st.reset(e)},t.displayLineLeadEllipsis=function(t,e){st.blueBold(e);for(var r=0;r<t;r+=1)e=e.write(46);st.reset(e),e=e.write(32).write(32)},t.displayLineLeadNumber=function(t,e,r){for(var n=e-ut.countDigits(t),i=0;i<n;i+=1)r=r.write(32);st.blueBold(r),Z.displayNumber(t,r),r=r.write(32).write(124),st.reset(r)},t.displayLineText=function(t,e,r){for(;t.isCont()&&t.line()===e;)r=r.write(t.head()),t=t.step();t.line()===e&&(r=r.writeln())},t.consumeLineText=function(t,e){for(;t.isCont()&&t.line()===e;)t=t.step()},t.formatSeverity=function(t,e){switch(t.level()){case S.FATAL_LEVEL:case S.ALERT_LEVEL:case S.ERROR_LEVEL:st.redBold(e);break;case S.WARNING_LEVEL:st.yellowBold(e);break;case S.NOTE_LEVEL:st.greenBold(e);break;case S.INFO_LEVEL:st.cyanBold(e);break;case S.DEBUG_LEVEL:case S.TRACE_LEVEL:default:st.magentaBold(e)}},t}(),pt=function(t){function e(r){var n=t.call(this,r instanceof at?r.message()||void 0:r)||this;return r instanceof at&&(n.diagnostic=r),n.__proto__=e.prototype,n}return y(e,t),e.prototype.toString=function(){return this.diagnostic?this.diagnostic.toString():t.prototype.toString.call(this)},e}(Error),ht=function(){function t(){}return t.prototype.isCont=function(){return!0},t.prototype.isDone=function(){return!1},t.prototype.isError=function(){return!1},t.prototype.fork=function(t){return this},t.prototype.bind=function(){throw new Error},t.prototype.trap=function(){throw new Error},t.prototype.asError=function(){throw new Error},t.done=function(e){return void 0===e?(t._done||(t._done=new ft(void 0)),t._done):new ft(e)},t.error=function(t){return t instanceof Error?new ct(t):new ct(new pt(t))},t}(),ft=function(t){function e(e){var r=t.call(this)||this;return r._output=e,r}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isDone=function(){return!0},e.prototype.feed=function(t){return this},e.prototype.bind=function(){return this._output},e}(ht),ct=function(t){function e(e){var r=t.call(this)||this;return r._error=e,r}return y(e,t),e.prototype.isCont=function(){return!1},e.prototype.isError=function(){return!0},e.prototype.feed=function(t){return this},e.prototype.bind=function(){throw this._error},e.prototype.trap=function(){return this._error},e.prototype.asError=function(){return this},e}(ht),lt=function(){function t(){}return t.prototype.isFatal=function(){return!1},t.prototype.isReplacement=function(){return!1},t.prototype.replacementChar=function(){return 65533},t.prototype.toString=function(){return Z.debug(this)},t.fatal=function(){return t._fatal||(t._fatal=new dt(!1)),t._fatal},t.fatalNonZero=function(){return t._fatalNonZero||(t._fatalNonZero=new dt(!0)),t._fatalNonZero},t.replacement=function(e){return void 0===e||65533===e?(t._replacement||(t._replacement=new yt(65533,!1)),t._replacement):new yt(e,!1)},t.replacementNonZero=function(e){return void 0===e||65533===e?(t._replacementNonZero||(t._replacementNonZero=new yt(65533,!0)),t._replacementNonZero):new yt(e,!0)},t}(),dt=function(t){function e(e){var r=t.call(this)||this;return r._isNonZero=e,r}return y(e,t),e.prototype.isFatal=function(){return!0},e.prototype.isNonZero=function(t){return void 0===t?this._isNonZero:t?lt.fatalNonZero():lt.fatal()},e.prototype.equals=function(t){return this===t||t instanceof e&&this._isNonZero===t._isNonZero},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,f.hash(this._isNonZero)))},e.prototype.debug=function(t){t=t.write("UtfErrorMode").write(46).write(this.isNonZero?"fatalNonZero":"fatal").write(40).write(41)},e}(lt),yt=function(t){function e(e,r){var n=t.call(this)||this;return n._replacementChar=e,n._isNonZero=r,n}return y(e,t),e.prototype.isReplacement=function(){return!0},e.prototype.replacementChar=function(){return this._replacementChar},e.prototype.isNonZero=function(t){return void 0===t?this._isNonZero:65533===this._replacementChar?t?lt.replacementNonZero():lt.replacement():new e(this._replacementChar,t)},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.replacementChar===t.replacementChar&&this.isNonZero===t.isNonZero)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._replacementChar),f.hash(this._isNonZero)))},e.prototype.debug=function(t){t=t.write("UtfErrorMode").write(46).write(this._isNonZero?"replacementNonZero":"replacement").write(40),65533!==this._replacementChar&&Z.debugChar(this._replacementChar,t),t=t.write(41)},e}(lt),_t=function(t){function e(e,r,n,i,o){void 0===i&&(i=M.standard()),void 0===o&&(o=!1);var s=t.call(this)||this;return s._array=e,s._index=r,s._limit=n,s._settings=i,s._isPart=o,s}return y(e,t),e.prototype.isCont=function(){return this._index<this._limit},e.prototype.isFull=function(){return this._isPart&&this._index>=this._limit},e.prototype.isDone=function(){return!this._isPart&&this._index>=this._limit},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0===t?this._isPart:(this._isPart=t,this)},e.prototype.index=function(t){return void 0===t?this._index:0<=t&&t<=this._limit?(this._index=t,this):rt.error(new T("invalid index"),this._settings)},e.prototype.limit=function(t){return void 0===t?this._limit:0<=t&&t<=this._array.length?(this._limit=t,this):rt.error(new T("invalid limit"),this._settings)},e.prototype.capacity=function(){return this._array.length},e.prototype.remaining=function(){return this._limit-this._index},e.prototype.has=function(t){return 0<=t&&t<this._limit},e.prototype.get=function(t){if(0<=t&&t<this._limit)return this._array[t];throw new T},e.prototype.set=function(t,e){if(!(0<=t&&t<this._limit))throw new T;this._array[t]=e},e.prototype.write=function(t){if("number"==typeof t){var e=this._index;return e<this._limit?(this._array[e]=t,this._index=e+1,this):rt.error(new T("full"),this._settings)}return rt.error(new T("binary output"),this._settings)},e.prototype.writeln=function(t){return rt.error(new T("binary output"),this._settings)},e.prototype.step=function(t){var e=this._index+t;return 0<=e&&e<=this._limit?(this._index=e,this):rt.error(new T("invalid step"),this._settings)},e.prototype.bind=function(){return new Uint8Array(this._array.buffer,0,this._index)},e.prototype.settings=function(t){return void 0===t?this._settings:(this._settings=M.fromAny(t),this)},e.prototype.clone=function(){return new e(this._array,this._index,this._limit,this._settings,this._isPart)},e}(rt),vt=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return y(e,t),e.prototype.bind=function(){return this.toUint8Array()},e.prototype.clone=function(){return new e(this.cloneArray(),this._size,this._settings)},e}(function(t){function e(e,r,n){var i=t.call(this)||this;return i._array=e,i._size=r,i._settings=n,i}return y(e,t),e.prototype.isCont=function(){return!0},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.write=function(t){if("number"==typeof t){var r=this._size,n=this._array,i=void 0;return null===n||r+1>n.length?(i=new Uint8Array(e.expand(r+1)),null!==n&&i.set(n,0),this._array=i):i=n,i[r]=t,this._size=r+1,this}throw new TypeError(""+t)},e.prototype.writeln=function(t){throw new TypeError(""+t)},e.prototype.toUint8Array=function(){var t=this._size,e=this._array;if(null!==e&&t===e.length)return e;var r=new Uint8Array(t);return null!==e&&r.set(e.slice(0,t),0),this._array=r,r},e.prototype.cloneArray=function(){var t=this._array;return null!==t?t.slice(0,this._size):null},e.prototype.settings=function(t){return void 0===t?this._settings:(this._settings=M.fromAny(t),this)},e.expand=function(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},e}(P)),mt=function(){function t(){}return t.outputBuffer=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=t.length),new _t(t,e,e+r)},t.uint8ArrayOutput=function(t,e){var r;return void 0===e&&"number"!=typeof t?(e=t,t=void 0):"number"!=typeof t&&(t=void 0),r="number"==typeof t?new Uint8Array(t):null,e=M.fromAny(e),new vt(r,0,e)},t}(),wt=function(){function t(t){this._alphabet=t}return t.prototype.alphabet=function(){return this._alphabet},t.prototype.encodeDigit=function(t){return this._alphabet.charCodeAt(t)},t.prototype.uint8ArrayWriter=function(e){return void 0===e?new t.Writer(void 0,void 0,this):new t.Writer(e,e,this)},t.prototype.writeUint8Array=function(e,r){return t.Writer.write(r,void 0,e,this)},t.prototype.writeInteger=function(e,r,n){return void 0===n&&(n=0),t.IntegerWriter.write(r,void 0,e,n,this)},t.prototype.writeIntegerLiteral=function(e,r,n){return void 0===n&&(n=0),t.IntegerWriter.writeLiteral(r,void 0,e,n,this)},t.lowercase=function(){return t._lowercase||(t._lowercase=new t("0123456789abcdef")),t._lowercase},t.uppercase=function(){return t._uppercase||(t._uppercase=new t("0123456789ABCDEF")),t._uppercase},t.isDigit=function(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102},t.decodeDigit=function(t){if(t>=48&&t<=57)return t-48;if(t>=65&&t<=70)return t-65+10;if(t>=97&&t<=102)return t-97+10;var e=X.stringOutput();throw e.write("Invalid base-16 digit: "),Z.debugChar(t,e),new Error(e.bind())},t.writeQuantum=function(e,r,n){var i=t.decodeDigit(e),o=t.decodeDigit(r);n=n.write(i<<4|o)},t.parser=function(e){return new t.Parser(e)},t.parse=function(e,r){return t.Parser.parse(e,r)},t.parseUint8Array=function(e){return t.Parser.parse(e,mt.uint8ArrayOutput())},t}(),gt=function(t){function e(e,r,n,i,o,s){void 0===n&&(n=-1),void 0===i&&(i=-1),void 0===o&&(o=-1),void 0===s&&(s=0);var u=t.call(this)||this;return u._output=e,u._errorMode=r,u._c1=n,u._c2=i,u._c3=o,u._have=s,u}return y(e,t),e.prototype.isCont=function(){return this._output.isCont()},e.prototype.isFull=function(){return this._output.isFull()},e.prototype.isDone=function(){return this._output.isDone()},e.prototype.isError=function(){return this._output.isError()},e.prototype.isPart=function(t){return void 0===t?this._output.isPart():(this._output=this._output.isPart(t),this)},e.prototype.write=function(t){if("number"==typeof t){var r=this._c1,n=this._c2,i=this._c3,o=-1,s=this._have;if(t>=0)switch(s){case 0:r=255&t,s=1;break;case 1:n=255&t,s=2;break;case 2:i=255&t,s=3;break;case 3:o=255&t,s=4;break;default:throw new Error("unreachable")}if(0===r&&this._errorMode.isNonZero())return P.error(new T("unexpected NUL byte"));if(r>=0&&r<=127)this._output=this._output.write(r),this._have=0;else if(r>=194&&r<=244)if(r>=194&&r<=223&&n>=128&&n<=191)this._output=this._output.write((31&r)<<6|63&n),this._c1=-1,this._have=0;else if(224===r&&n>=160&&n<=191||r>=225&&r<=236&&n>=128&&n<=191||237===r&&n>=128&&n<=159||r>=238&&r<=239&&n>=128&&n<=191)if(i>=128&&i<=191)this._output=this._output.write((15&r)<<12|(63&n)<<6|63&i),this._c1=-1,this._c2=-1,this._have=0;else if(i>=0){if(this._errorMode.isFatal())return P.error(new T(e.invalid(r,n,i)));this._output=this._output.write(this._errorMode.replacementChar()),this._c1=i,this._c2=-1,this._have=1}else{if(t<0||this._output.isDone())return P.error(new T(e.invalid(r,n)));this._c2=n,this._have=2}else if(240===r&&n>=144&&n<=191||r>=241&&r<=243&&n>=128&&n<=191||244===r&&n>=128&&n<=143)if(i>=128&&i<=191)if(o>=128&&o<=191)this._have=4,this._output=this._output.write((7&r)<<18|(63&n)<<12|(63&i)<<6|63&o),this._c1=-1,this._c2=-1,this._c3=-1,this._have=0;else if(o>=0){if(this._errorMode.isFatal())return P.error(new T(e.invalid(r,n,i,o)));this._output=this._output.write(this._errorMode.replacementChar()),this._c1=o,this._c2=-1,this._c3=-1,this._have=1}else{if(t<0||this._output.isDone())return P.error(new T(e.invalid(r,n,i)));this._c3=i,this._have=3}else if(i>=0){if(this._errorMode.isFatal())return P.error(new T(e.invalid(r,n,i)));this._output=this._output.write(this._errorMode.replacementChar()),this._c1=i,this._c2=-1,this._have=1}else{if(t<0||this._output.isDone())return P.error(new T(e.invalid(r,n)));this._c2=n,this._have=2}else if(n>=0){if(this._errorMode.isFatal())return P.error(new T(e.invalid(r,n)));this._output=this._output.write(this._errorMode.replacementChar()),this._c1=n,this._have=1}else{if(t<0||this._output.isDone())return P.error(new T(e.invalid(r)));this._c1=r,this._have=1}else if(r>=0){if(this._errorMode.isFatal())return P.error(new T(e.invalid(r)));this._output=this._output.write(this._errorMode.replacementChar()),this._have=0}return this._output.isError()?this._output:this}if("string"==typeof t)return this._output.write(t),this;throw new TypeError(""+t)},e.invalid=function(t,e,r,n){var i=X.stringOutput();return i=i.write("invalid UTF-8 code unit sequence: "),wt.uppercase().writeIntegerLiteral(t,i,2),void 0!==e&&(i=i.write(" "),wt.uppercase().writeIntegerLiteral(e,i,2),void 0!==r&&(i=i.write(" "),wt.uppercase().writeIntegerLiteral(r,i,2),void 0!==n&&(i=i.write(" "),wt.uppercase().writeIntegerLiteral(n,i,2)))),i.bind()},e.prototype.settings=function(t){return void 0===t?this._output.settings():(this._output.settings(t),this)},e.prototype.bind=function(){return 0===this._have?this._output.bind():this.write(-1).bind()},e.prototype.trap=function(){return this._output.trap()},e.prototype.clone=function(){return new e(this._output.clone(),this._errorMode,this._c1,this._c2,this._c3,this._have)},e}(P),bt=function(t){function e(e,r,n,i,o,s){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=4);var u=t.call(this)||this;return u._output=e,u._errorMode=r,u._c2=n,u._c3=i,u._c4=o,u._index=s,u}return y(e,t),e.prototype.isCont=function(){return this._output.isCont()},e.prototype.isFull=function(){return this._output.isFull()},e.prototype.isDone=function(){return this._output.isDone()},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0===t?this._output.isPart():(this._output=this._output.isPart(t),this)},e.prototype.write=function(t){if("number"==typeof t){for(var e=0,r=this._c2,n=this._c3,i=this._c4,o=this._index;o<4;){if(!this._output.isCont())return P.error(new T("unable to flush buffered code units"));switch(o){case 1:this._output=this._output.write(r),this._c2=0;break;case 2:this._output=this._output.write(n),this._c3=0;break;case 3:this._output=this._output.write(i),this._c4=0;break;default:throw new Error("unreachable")}o+=1}if(t>=0&&t<=127)i=t,o=3;else if(t>=128&&t<=2047)n=192|t>>>6,i=128|63&t,o=2;else if(t>=2048&&t<=65535||t>=57344&&t<=65535)r=224|t>>>12,n=128|t>>>6&63,i=128|63&t,o=1;else{if(!(t>=65536&&t<=1114111))return this._errorMode.isFatal()?P.error(new T("invalid code point: "+t)):this.write(this._errorMode.replacementChar());e=240|t>>>18,r=128|t>>>12&63,n=128|t>>>6&63,i=128|63&t,o=0}do{switch(o){case 0:this._output=this._output.write(e);break;case 1:this._output=this._output.write(r),this._c2=0;break;case 2:this._output=this._output.write(n),this._c3=0;break;case 3:this._output=this._output.write(i),this._c4=0;break;default:throw new Error("unreachable")}o+=1}while(o<4&&this._output.isCont());return o<4&&(o<3&&(o<2&&(this._c2=r),this._c3=n),this._c4=i),this._index=o,this}if("string"==typeof t)return this._output.write(t),this;throw new TypeError(""+t)},e.prototype.flush=function(){for(var t=this._index;t<4;){if(!this._output.isCont())return P.error(new T("unable to flush buffered code units"));switch(t){case 1:this._output=this._output.write(this._c2),this._c2=0;break;case 2:this._output=this._output.write(this._c3),this._c3=0;break;case 3:this._output=this._output.write(this._c4),this._c4=0;break;default:throw new Error("unreachable")}t+=1}return this._index=t,this},e.prototype.settings=function(t){return void 0===t?this._output.settings():(this._output.settings(t),this)},e.prototype.bind=function(){return this._output.bind()},e.prototype.clone=function(){return new e(this._output.clone(),this._errorMode,this._c2,this._c3,this._c4,this._index)},e}(P),St=function(){function t(){}return t.sizeOf=function(e,r){if("number"==typeof e||void 0===e){if("number"==typeof e){if(0===e&&void 0!==r&&r.isNonZero())return 2;if(e>=0&&e<=127)return 1;if(e>=128&&e<=2047)return 2;if(e>=2048&&e<=65535||e>=57344&&e<=65535)return 3;if(e>=65536&&e<=1114111)return 4}return void 0===r?3:r.isReplacement()?t.sizeOf(r.replacementChar()):0}if("string"==typeof e){for(var n=0,i=0,o=e.length;i<o;i=e.offsetByCodePoints(i,1))n+=t.sizeOf(e.charCodeAt(i),r);return n}throw new TypeError(""+e)},t.decodedOutput=function(t,e){return void 0===e&&(e=lt.fatal()),new gt(t,e)},t.encodedOutput=function(t,e){return void 0===e&&(e=lt.fatal()),new bt(t,e)},t.decodedString=function(){return t.decodedOutput(X.stringOutput())},t}(),xt=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._sign=e,o._value=r,o._mode=n,o._step=i,o}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._sign,this._value,this._mode,this._step)},e.parse=function(t,r,n,i,o){void 0===r&&(r=1),void 0===n&&(n=0),void 0===i&&(i=2),void 0===o&&(o=1);var s=0;if(1===o)if(t.isCont())45===(s=t.head())&&(t=t.step(),r=-1),o=2;else if(t.isDone())return ht.error(at.expected("number",t));if(2===o)if(t.isCont())if(48===(s=t.head()))t=t.step(),o=4;else{if(!(s>=49&&s<=57)){if(i>0&&46===s){var u=X.stringOutput();return r<0&&(u=u.write(45)),Et.parse(t,u,i)}return ht.error(at.expected("number",t))}t=t.step(),n=r*(s-48),o=3}else if(t.isDone())return ht.error(at.expected("number",t));if(3===o){for(;t.isCont()&&(s=t.head())>=48&&s<=57;){var a=10*n+r*(s-48);if(!(-9007199254740991<=a&&a<=9007199254740992))return ht.error(at.message("integer overflow",t));n=a,t=t.step()}if(t.isCont())o=4;else if(t.isDone())return ht.done(n)}if(4===o){if(t.isCont()){if(s=t.head(),i>0&&46===s||i>1&&(69===s||101===s)){u=X.stringOutput();return u=r<0&&0===n?u.write(45).write(48):u.write(""+n),Et.parse(t,u,i)}return ht.done(n)}if(t.isDone())return ht.done(n)}return new e(r,n,i,o)},e}(ht);ut.NumberParser=xt;var Et=function(t){function e(e,r,n){var i=t.call(this)||this;return i._output=e,i._mode=r,i._step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._output,this._mode,this._step)},e.parse=function(t,r,n,i){void 0===n&&(n=2),void 0===i&&(i=1);var o=0;if(1===i)if(t.isCont())if(46===(o=t.head()))t=t.step(),r=r.write(o),i=2;else{if(!(n>1)||69!==o&&101!==o)return ht.error(at.expected("decimal or exponent",t));t=t.step(),r=r.write(o),i=5}else if(t.isDone())return ht.error(at.expected("decimal or exponent",t));if(2===i)if(t.isCont()){if(!((o=t.head())>=48&&o<=57))return ht.error(at.expected("digit",t));t=t.step(),r=r.write(o),i=3}else if(t.isDone())return ht.error(at.expected("digit",t));if(3===i){for(;t.isCont()&&(o=t.head())>=48&&o<=57;)t=t.step(),r=r.write(o);if(t.isCont()){if(!(n>1))return ht.done(+r.bind());i=4}else if(t.isDone())return ht.done(+r.bind())}if(4===i){if(69!==(o=t.head())&&101!==o)return ht.done(+r.bind());t=t.step(),r=r.write(o),i=5}if(5===i)if(t.isCont())43!==(o=t.head())&&45!==o||(t=t.step(),r=r.write(o)),i=6;else if(t.isDone())return ht.error(at.unexpected(t));if(6===i)if(t.isCont()){if(!((o=t.head())>=48&&o<=57))return ht.error(at.expected("digit",t));t=t.step(),r=r.write(o),i=7}else if(t.isDone())return ht.error(at.expected("digit",t));if(7===i){for(;t.isCont()&&(o=t.head())>=48&&o<=57;)t=t.step(),r=r.write(o);if(!t.isEmpty())return ht.done(+r.bind())}return new e(r,n,i)},e}(ht),kt=function(t){function e(e,r,n,i){void 0===n&&(n=0),void 0===i&&(i=1);var o=t.call(this)||this;return o._value=e,o._input=r,o._index=n,o._step=i,o}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._value,this._input,this._index,this._step)},e.write=function(t,r,n,i,o){if(void 0===i&&(i=0),void 0===o&&(o=1),0===o)return W.done();if(1===o&&(n<0?t.isCont()&&(t=t.write(45),o=2):o=2),2===o)if(n>-10&&n<10){if(t.isCont())return t=t.write(ut.encodeDigit(Math.abs(0|n))),W.done(r)}else{for(var s=new Array(19),u=n,a=18;u;)s[a]=Math.abs(u%10|0),u=u/10|0,a-=1;for(a+=1+i;a<19&&t.isCont();)t=t.write(ut.encodeDigit(s[a])),i+=1,a+=1;if(19===a)return W.done(r)}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o)},e}(W);ut.IntegerWriter=kt;var Ct=function(t){function e(e,r,n){void 0===r&&(r=0),void 0===n&&(n=1);var i=t.call(this)||this;return i._output=e,i._p=r,i._step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._output.clone(),this._p,this._step)},e.parse=function(t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=1);for(var o=0;!t.isEmpty();){if(1===i)if(t.isCont()&&(o=t.head(),wt.isDigit(o)))t=t.step(),n=o,i=2;else if(!t.isEmpty())return ht.done(r.bind());if(2===i)if(t.isCont()&&(o=t.head(),wt.isDigit(o)))t=t.step(),wt.writeQuantum(n,o,r),n=0,i=1;else if(!t.isEmpty())return ht.error(at.expected("base16 digit",t))}return new e(r,n,i)},e}(ht);wt.Parser=Ct;var Ot=function(t){function e(e,r,n,i,o){void 0===i&&(i=0),void 0===o&&(o=1);var s=t.call(this)||this;return s._value=e,s._input=r,s._base16=n,s._index=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){if(t instanceof Uint8Array)return new e(void 0,t,this._base16);throw new TypeError(""+t)},e.prototype.pull=function(t){return e.write(t,this._value,this._input,this._base16,this._index,this._step)},e.write=function(t,r,n,i,o,s){for(void 0===o&&(o=0),void 0===s&&(s=1);o<n.length;){var u=n[o];1===s&&t.isCont()&&(t=t.write(i.encodeDigit(u>>>4)),s=2),2===s&&t.isCont()&&(t=t.write(i.encodeDigit(15&u)),o+=1,s=1)}return o===n.length?W.done(r):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e}(W);wt.Writer=Ot;var At=function(t){function e(e,r,n,i,o,s){var u=t.call(this)||this;return u._value=e,u._input=r,u._width=n,u._base16=i,u._index=o,u._step=s,u}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._value,this._input,this._width,this._base16,this._index,this._step)},e.write=function(t,r,n,i,o,s,u){if(void 0===s&&(s=0),void 0===u&&(u=3),u<=0)return W.done();if(1===u&&t.isCont()&&(t=t.write(48),u=2),2===u&&t.isCont()&&(t=t.write(120),u=3),3===u)if(n>=0&&n<16&&i<=1){if(t.isCont())return t=t.write(o.encodeDigit(n)),W.done(r)}else{for(var a=15,p=new Array(16),h=n;0!==h||a>=16-i;)p[a]=15&h,h>>>=4,a-=1;for(a+=1+s;a<16&&t.isCont();)t=t.write(o.encodeDigit(p[a])),s+=1,a+=1;if(16===a)return W.done(r)}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s,u)},e.writeLiteral=function(t,r,n,i,o){return e.write(t,r,n,i,o,0,1)},e}(W);wt.IntegerWriter=At;var It=function(){function t(){}return t.prototype.decodeDigit=function(t){if(t>=65&&t<=90)return t-65;if(t>=97&&t<=122)return t+-71;if(t>=48&&t<=57)return t+4;if(43===t||45===t)return 62;if(47===t||95===t)return 63;var e=X.stringOutput();throw e.write("Invalid base-64 digit: "),Z.debugChar(t,e),new Error(e.bind())},t.prototype.encodeDigit=function(t){return this.alphabet().charCodeAt(t)},t.prototype.writeQuantum=function(t,e,r,n,i){var o=this.decodeDigit(t),s=this.decodeDigit(e);if(61!==r){var u=this.decodeDigit(r);if(61!==n){var a=this.decodeDigit(n);i=(i=(i=i.write(o<<2|s>>>4)).write(s<<4|u>>>2)).write(u<<6|a)}else i=(i=i.write(o<<2|s>>>4)).write(s<<4|u>>>2)}else{if(61!==n)throw new Error("Improperly padded base-64");i=i.write(o<<2|s>>>4)}},t.prototype.parser=function(e){return new t.Parser(e,this)},t.prototype.parse=function(e,r){return t.Parser.parse(e,r,this)},t.prototype.parseUint8Array=function(e){return t.Parser.parse(e,mt.uint8ArrayOutput(),this)},t.prototype.uint8ArrayWriter=function(e){return void 0===e?new t.Writer(void 0,void 0,this):new t.Writer(e,e,this)},t.prototype.writeUint8Array=function(e,r){return t.Writer.write(r,void 0,e,this)},t.standard=function(e){return void 0===e&&(e=!0),e?(t._standard||(t._standard=new Dt(!0)),t._standard):(t._standardUnpadded||(t._standardUnpadded=new Dt(!0)),t._standardUnpadded)},t.url=function(e){return void 0===e&&(e=!0),e?(t._url||(t._url=new Mt(!0)),t._url):(t._urlUnpadded||(t._urlUnpadded=new Mt(!1)),t._urlUnpadded)},t}(),Dt=function(t){function e(e){var r=t.call(this)||this;return r._isPadded=e,r}return y(e,t),e.prototype.alphabet=function(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},e.prototype.isPadded=function(t){return void 0===t?this._isPadded:t===this._isPadded?this:It.standard(t)},e.prototype.isDigit=function(t){return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||43===t||47===t},e}(It),Mt=function(t){function e(e){var r=t.call(this)||this;return r._isPadded=e,r}return y(e,t),e.prototype.alphabet=function(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},e.prototype.isPadded=function(t){return void 0===t?this._isPadded:t===this._isPadded?this:It.url(t)},e.prototype.isDigit=function(t){return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||45===t||95===t},e}(It),Tt=function(t){function e(e,r,n,i,o,s){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=1);var u=t.call(this)||this;return u._output=e,u._base64=r,u._p=n,u._q=i,u._r=o,u._step=s,u}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._output.clone(),this._base64,this._p,this._q,this._r,this._step)},e.parse=function(t,r,n,i,o,s,u){void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=1);for(var a=0;!t.isEmpty();){if(1===u)if(t.isCont()&&(a=t.head(),n.isDigit(a)))t=t.step(),i=a,u=2;else if(!t.isEmpty())return ht.done(r.bind());if(2===u)if(t.isCont()&&(a=t.head(),n.isDigit(a)))t=t.step(),o=a,u=3;else if(!t.isEmpty())return ht.error(at.expected("base64 digit",t));if(3===u)if(t.isCont()&&(a=t.head(),n.isDigit(a)||61===a))t=t.step(),s=a,u=61!==a?4:5;else if(!t.isEmpty())return n.isPadded()?ht.error(at.unexpected(t)):(n.writeQuantum(i,o,61,61,r),ht.done(r.bind()));if(4===u){if(t.isCont()&&(a=t.head(),n.isDigit(a)||61===a)){if(t=t.step(),n.writeQuantum(i,o,s,a,r),s=0,o=0,i=0,61===a)return ht.done(r.bind());u=1}else if(!t.isEmpty())return n.isPadded()?ht.error(at.unexpected(t)):(n.writeQuantum(i,o,s,61,r),ht.done(r.bind()))}else if(5===u){if(t.isCont()&&61===(a=t.head()))return t=t.step(),n.writeQuantum(i,o,s,a,r),s=0,o=0,i=0,ht.done(r.bind());if(!t.isEmpty())return ht.error(at.expected(61,t))}}return new e(r,n,i,o,s,u)},e}(ht);It.Parser=Tt;var Pt=function(t){function e(e,r,n,i,o){void 0===i&&(i=0),void 0===o&&(o=1);var s=t.call(this)||this;return s._value=e,s._input=r,s._base64=n,s._index=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){if(t instanceof Uint8Array)return new e(void 0,t,this._base64);throw new TypeError(""+t)},e.prototype.pull=function(t){return e.write(t,this._value,this._input,this._base64,this._index,this._step)},e.write=function(t,r,n,i,o,s){for(void 0===o&&(o=0),void 0===s&&(s=1);o+2<n.length&&t.isCont();){var u=n[o],a=n[o+1],p=n[o+2];1===s&&t.isCont()&&(t=t.write(i.encodeDigit(u>>>2)),s=2),2===s&&t.isCont()&&(t=t.write(i.encodeDigit(63&(u<<4|a>>>4))),s=3),3===s&&t.isCont()&&(t=t.write(i.encodeDigit(63&(a<<2|p>>>6))),s=4),4===s&&t.isCont()&&(t=t.write(i.encodeDigit(63&p)),o+=3,s=1)}if(o+1<n.length&&t.isCont()){u=n[o],a=n[o+1];1===s&&t.isCont()&&(t=t.write(i.encodeDigit(u>>>2)),s=2),2===s&&t.isCont()&&(t=t.write(i.encodeDigit(63&(u<<4|a>>>4))),s=3),3===s&&t.isCont()&&(t=t.write(i.encodeDigit(a<<2&63)),s=4),4===s&&(i.isPadded()?t.isCont()&&(t=t.write(61),o+=2):o+=2)}else if(o<n.length&&t.isCont()){u=n[o];1===s&&t.isCont()&&(t=t.write(i.encodeDigit(u>>>2)),s=2),2===s&&t.isCont()&&(t=t.write(i.encodeDigit(u<<4&63)),s=3),3===s&&(i.isPadded()?t.isCont()&&(t=t.write(61),s=4):o+=1),4===s&&t.isCont()&&(t=t.write(61),o+=1)}return o===n.length?W.done(r):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e}(W);It.Writer=Pt;var Vt=function(t){function e(e){var r=t.call(this)||this;return r._cursor=e,r}return y(e,t),e.prototype.isEmpty=function(){return this._cursor.isEmpty()},e.prototype.head=function(){return this._cursor.head()[0]},e.prototype.step=function(){this._cursor.step()},e.prototype.skip=function(t){this._cursor.skip(t)},e.prototype.hasNext=function(){return this._cursor.hasNext()},e.prototype.nextIndex=function(){return this._cursor.nextIndex()},e.prototype.next=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&e[0],done:r}},e.prototype.hasPrevious=function(){return this._cursor.hasPrevious()},e.prototype.previousIndex=function(){return this._cursor.previousIndex()},e.prototype.previous=function(){var t=this._cursor.previous(),e=t.value,r=t.done;return{value:e&&e[0],done:r}},e.prototype.delete=function(){this._cursor.delete()},e}(l),Ut=function(t){function e(e){var r=t.call(this)||this;return r._cursor=e,r}return y(e,t),e.prototype.isEmpty=function(){return this._cursor.isEmpty()},e.prototype.head=function(){return this._cursor.head()[1]},e.prototype.step=function(){this._cursor.step()},e.prototype.skip=function(t){this._cursor.skip(t)},e.prototype.hasNext=function(){return this._cursor.hasNext()},e.prototype.nextIndex=function(){return this._cursor.nextIndex()},e.prototype.next=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&e[1],done:r}},e.prototype.hasPrevious=function(){return this._cursor.hasPrevious()},e.prototype.previousIndex=function(){return this._cursor.previousIndex()},e.prototype.previous=function(){var t=this._cursor.previous(),e=t.value,r=t.done;return{value:e&&e[1],done:r}},e.prototype.delete=function(){this._cursor.delete()},e}(l),Rt=function(t){function e(e,r,n,i){void 0===r&&(r=0),void 0===n&&(n=0);var o=t.call(this)||this;return o._pages=e,o._index=r,o._pageIndex=n,o._pageCursor=i,o}return y(e,t),e.prototype.isEmpty=function(){for(;;)if(this._pageCursor){if(!this._pageCursor.isEmpty())return!1;this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))return this._pageIndex=this._pages.length,!0;this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.head=function(){for(;;)if(this._pageCursor){if(!this._pageCursor.isEmpty())return this._pageCursor.head();this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))throw this._pageIndex=this._pages.length,new Error("empty");this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.step=function(){for(;;)if(this._pageCursor){if(!this._pageCursor.isEmpty())return void(this._index+=1);this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))throw this._pageIndex=this._pages.length,new Error("empty");this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.skip=function(t){for(;t>0;)if(this._pageCursor)this._pageCursor.hasNext()?(this._index+=1,t-=1,this._pageCursor.next()):this._pageCursor=void 0;else{if(!(this._pageIndex<this._pages.length))break;var e=this._pages[this._pageIndex],r=this.pageSize(e);if(this._pageIndex+=1,r<t){this._pageCursor=this.pageCursor(e),t>0&&(this._index+=t,this._pageCursor.skip(t),t=0);break}this._index+=r,t-=r}},e.prototype.hasNext=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasNext())return!0;this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))return this._pageIndex=this._pages.length,!1;this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.nextIndex=function(){return this._index},e.prototype.next=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasNext())return this._index+=1,this._pageCursor.next();this._pageCursor=void 0}else{if(!(this._pageIndex<this._pages.length))return this._pageIndex=this._pages.length,{done:!0};this._pageCursor=this.pageCursor(this._pages[this._pageIndex]),this._pageIndex+=1}},e.prototype.hasPrevious=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasPrevious())return!0;this._pageCursor=void 0}else{if(!(this._pageIndex>0))return this._pageIndex=0,!1;this._pageCursor=this.reversePageCursor(this._pages[this._pageIndex-1]),this._pageIndex-=1}},e.prototype.previousIndex=function(){return this._index-1},e.prototype.previous=function(){for(;;)if(this._pageCursor){if(this._pageCursor.hasPrevious())return this._index-=1,this._pageCursor.previous();this._pageCursor=void 0}else{if(!(this._pageIndex>0))return this._pageIndex=0,{done:!0};this._pageCursor=this.reversePageCursor(this._pages[this._pageIndex-1]),this._pageIndex-=1}},e.prototype.set=function(t){this._pageCursor.set(t)},e.prototype.delete=function(){this._pageCursor.delete()},e}(l),Ft=function(){function t(){}return t.prototype.compare=function(t,e){return c.compare(t,e)},t.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},t.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},t}();Ft.prototype.pageSplitSize=32;var zt=function(t){function e(r){void 0===r&&(r=e.Page.empty());var n=t.call(this)||this;return n.root=r,n}return y(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this.root.isEmpty()},e.prototype.has=function(t){return this.root.has(t,this)},e.prototype.get=function(t){return this.root.get(t,this)},e.prototype.getEntry=function(t){return this.root.getEntry(t)},e.prototype.firstKey=function(){var t=this.root.firstEntry();return t?t[0]:void 0},e.prototype.firstValue=function(){var t=this.root.firstEntry();return t?t[1]:void 0},e.prototype.firstEntry=function(){return this.root.firstEntry()},e.prototype.lastKey=function(){var t=this.root.lastEntry();return t?t[0]:void 0},e.prototype.lastValue=function(){var t=this.root.lastEntry();return t?t[1]:void 0},e.prototype.lastEntry=function(){return this.root.lastEntry()},e.prototype.nextKey=function(t){var e=this.root.nextEntry(t,this);return e?e[0]:void 0},e.prototype.nextValue=function(t){var e=this.root.nextEntry(t,this);return e?e[1]:void 0},e.prototype.nextEntry=function(t){return this.root.nextEntry(t,this)},e.prototype.previousKey=function(t){var e=this.root.previousEntry(t,this);return e?e[0]:void 0},e.prototype.previousValue=function(t){var e=this.root.previousEntry(t,this);return e?e[1]:void 0},e.prototype.previousEntry=function(t){return this.root.previousEntry(t,this)},e.prototype.set=function(t,e){var r=this.root,n=this.root.updated(t,e,this);return r!==n&&(n.size>r.size&&(n=n.balanced(this)),this.root=n),this},e.prototype.delete=function(t){var e=this.root,r=this.root.removed(t,this);return e!==r&&(this.root=r,!0)},e.prototype.drop=function(t){return t>0&&this.root.size>0&&(t<this.root.size?this.root=this.root.drop(t,this):this.root=e.Page.empty()),this},e.prototype.take=function(t){return t<this.root.size&&this.root.size>0&&(this.root=t>0?this.root.take(t,this):e.Page.empty()),this},e.prototype.clear=function(){this.root=e.Page.empty()},e.prototype.updated=function(t,e){var r=this.root,n=r.updated(t,e,this);return r!==n?(n.size>r.size&&(n=n.balanced(this)),this.copy(n)):this},e.prototype.removed=function(t){var e=this.root,r=e.removed(t,this);return e!==r?this.copy(r):this},e.prototype.cleared=function(){return this.root.isEmpty()?this:this.copy(e.Page.empty())},e.prototype.reduced=function(t,e,r){var n=this.root,i=n.reduced(t,e,r);return n!==i&&(this.root=i),i.fold()},e.prototype.forEach=function(t,e){return this.root.forEach(t,e,this)},e.prototype.keys=function(){return this.root.keys()},e.prototype.values=function(){return this.root.values()},e.prototype.entries=function(){return this.root.entries()},e.prototype.reverseKeys=function(){return this.root.reverseKeys()},e.prototype.reverseValues=function(){return this.root.reverseValues()},e.prototype.reverseEntries=function(){return this.root.reverseEntries()},e.prototype.clone=function(){return this.copy(this.root)},e.prototype.copy=function(t){var r=new e(t);return r.compare!==this.compare&&(r.compare=this.compare),r.pageSplitSize!==this.pageSplitSize&&(r.pageSplitSize=this.pageSplitSize),r},e}(Ft),Lt=function(){function t(){}return t.prototype.keys=function(){return new Vt(this.entries())},t.prototype.values=function(){return new Ut(this.entries())},t.prototype.reverseKeys=function(){return new Vt(this.reverseEntries())},t.prototype.reverseValues=function(){return new Ut(this.reverseEntries())},t.empty=function(){return t._empty||(t._empty=new zt.Leaf([],void 0)),t._empty},t}();zt.Page=Lt;var qt=function(t){function e(e,r){var n=t.call(this)||this;return n._slots=e,n._fold=r,n}return y(e,t),Object.defineProperty(e.prototype,"arity",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._slots.length},e.prototype.fold=function(){return this._fold},e.prototype.minKey=function(){return this._slots[0][0]},e.prototype.maxKey=function(){return this._slots[this._slots.length-1][0]},e.prototype.has=function(t,e){return this.lookup(t,e)>=0},e.prototype.get=function(t,e){var r=this.lookup(t,e);return r>=0?this._slots[r][1]:void 0},e.prototype.getEntry=function(t){return this._slots[t]},e.prototype.firstEntry=function(){return this._slots.length?this._slots[0]:void 0},e.prototype.lastEntry=function(){return this._slots.length?this._slots[this._slots.length-1]:void 0},e.prototype.nextEntry=function(t,e){var r=this.lookup(t,e);return r>=0?r+=1:r=-(r+1),this._slots[r]},e.prototype.previousEntry=function(t,e){var r=this.lookup(t,e);return r>=0?r-=1:r=-(r+2),this._slots[r]},e.prototype.updated=function(t,e,r){var n=this.lookup(t,r);return n>=0?this.updatedSlot(n,t,e):(n=-(n+1),this.insertedSlot(n,t,e))},e.prototype.updatedSlot=function(t,e,r){var n=this._slots;if(r!==n[t][1]){var i=n.slice(0);return i[t]=[e,r],this.newLeaf(i,void 0)}return this},e.prototype.insertedSlot=function(t,e,r){for(var n=this._slots,i=n.length+1,o=new Array(i),s=0;s<t;s+=1)o[s]=n[s];o[t]=[e,r];for(s=t;s<i-1;s+=1)o[s+1]=n[s];return this.newLeaf(o,void 0)},e.prototype.removed=function(t,e){var r=this.lookup(t,e);return r>=0?this._slots.length>1?this.removedSlot(r):Lt.empty():this},e.prototype.removedSlot=function(t){for(var e=this._slots,r=new Array(e.length-1),n=0;n<t;n+=1)r[n]=e[n];for(n=t;n<r.length;n+=1)r[n]=e[n+1];return this.newLeaf(r,void 0)},e.prototype.drop=function(t,e){if(t>0){var r=this._slots;if(t<r.length){for(var n=r.length-t,i=new Array(n),o=0;o<n;o+=1)i[o]=r[o+t];return this.newLeaf(i,void 0)}return Lt.empty()}return this},e.prototype.take=function(t,e){var r=this._slots;if(t<r.length){if(t>0){for(var n=new Array(t),i=0;i<t;i+=1)n[i]=r[i];return this.newLeaf(n,void 0)}return Lt.empty()}return this},e.prototype.balanced=function(t){var e=this._slots.length;if(e>1&&t.pageShouldSplit(this)){var r=e>>>1;return this.split(r)}return this},e.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),n=this.splitRight(t);e[0]=r,e[1]=n;var i=new Array(1);return i[0]=n.minKey(),this.newNode(e,i,void 0,this._slots.length)},e.prototype.splitLeft=function(t){for(var e=this._slots,r=new Array(t),n=0;n<t;n+=1)r[n]=e[n];return this.newLeaf(r,void 0)},e.prototype.splitRight=function(t){for(var e=this._slots,r=e.length-t,n=new Array(r),i=0;i<r;i+=1)n[i]=e[i+t];return this.newLeaf(n,void 0)},e.prototype.reduced=function(t,e,r){if(void 0===this._fold){for(var n=this._slots,i=t,o=0,s=n.length;o<s;o+=1)i=e(i,n[o][1]);return this.newLeaf(n,i)}return this},e.prototype.forEach=function(t,e,r){for(var n=this._slots,i=0,o=n.length;i<o;i+=1){var s=n[i],u=t.call(e,s[0],s[1],r);if(void 0!==u)return u}},e.prototype.entries=function(){return l.array(this._slots)},e.prototype.reverseEntries=function(){return l.array(this._slots,this._slots.length)},e.prototype.lookup=function(t,e){for(var r=0,n=this._slots.length-1;r<=n;){var i=r+n>>>1,o=e.compare(t,this._slots[i][0]);if(o>0)r=i+1;else{if(!(o<0))return i;n=i-1}}return-(r+1)},e.prototype.newLeaf=function(t,r){return new e(t,r)},e.prototype.newNode=function(t,e,r,n){return new zt.Node(t,e,r,n)},e}(Lt);zt.Leaf=qt;var Bt=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._pages=e,o._knots=r,o._fold=n,o._size=i,o}return y(e,t),Object.defineProperty(e.prototype,"arity",{get:function(){return this._pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._size},e.prototype.fold=function(){return this._fold},e.prototype.minKey=function(){return this._pages[0].minKey()},e.prototype.maxKey=function(){return this._pages[this._pages.length-1].maxKey()},e.prototype.has=function(t,e){var r=this.lookup(t,e);if(r>0)r+=1;else{if(!(r<0))return!0;r=-(r+1)}return this._pages[r].has(t,e)},e.prototype.get=function(t,e){var r=this.lookup(t,e);return r>=0?r+=1:r=-(r+1),this._pages[r].get(t,e)},e.prototype.getEntry=function(t){for(var e=this._pages,r=0,n=e.length;r<n;r+=1){var i=e[r];if(t<i.size)return i.getEntry(t);t-=i.size}},e.prototype.firstEntry=function(){var t=this._pages;return t.length?t[0].firstEntry():void 0},e.prototype.lastEntry=function(){var t=this._pages;return t.length?t[t.length-1].lastEntry():void 0},e.prototype.nextEntry=function(t,e){var r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);var n=this._pages,i=n[r].nextEntry(t,e);return void 0===i&&r+1<n.length&&(i=n[r+1].nextEntry(t,e)),i},e.prototype.previousEntry=function(t,e){var r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);var n=this._pages,i=n[r].previousEntry(t,e);return void 0===i&&r>0&&(i=n[r-1].previousEntry(t,e)),i},e.prototype.updated=function(t,e,r){var n=this.lookup(t,r);n>=0?n+=1:n=-(n+1);var i=this._pages[n],o=i.updated(t,e,r);return i!==o?i.size!==o.size&&r.pageShouldSplit(o)?this.updatedPageSplit(n,o,i):this.updatedPage(n,o,i):this},e.prototype.updatedPage=function(t,e,r){var n=this._pages.slice(0);n[t]=e;var i,o=this._knots;o.length>0?(i=o.slice(0),t>0&&(i[t-1]=e.minKey())):i=[];var s=this._size-r.size+e.size;return this.newNode(n,i,void 0,s)},e.prototype.updatedPageSplit=function(t,e,r){for(var n=this._pages,i=new Array(n.length+1),o=0;o<t;o+=1)i[o]=n[o];var s=e.splitLeft(e.arity>>>1),u=e.splitRight(e.arity>>>1);i[t]=s,i[t+1]=u;for(o=t+1;o<n.length;o+=1)i[o+1]=n[o];var a=this._knots,p=new Array(n.length);if(t>0){for(o=0;o<t-1;o+=1)p[o]=a[o];p[t-1]=s.minKey(),p[t]=u.minKey();for(o=t;o<a.length;o+=1)p[o+1]=a[o]}else{p[0]=u.minKey();for(o=0;o<a.length;o+=1)p[o+1]=a[o]}var h=this._size-r.size+e.size;return this.newNode(i,p,void 0,h)},e.prototype.updatedPageMerge=function(t,e,r){for(var n=this._pages,i=e._pages,o=new Array(n.length+i.length-1),s=0;s<t;s+=1)o[s]=n[s];for(s=0;s<i.length;s+=1)o[s+t]=i[s];for(s=t+1;s<n.length;s+=1)o[s+i.length-1]=n[s];var u=this._knots,a=e._knots,p=new Array(o.length-1);if(t>0){for(s=0;s<t-1;s+=1)p[s]=u[s];p[t-1]=i[0].minKey();for(s=0;s<a.length;s+=1)p[s+t]=a[s];for(s=t;s<u.length;s+=1)p[s+a.length]=u[s]}else{for(s=0;s<a.length;s+=1)p[s]=a[s];p[a.length]=n[1].minKey();for(s=1;s<u.length;s+=1)p[s+a.length]=u[s]}var h=this._size-r.size+e.size;return this.newNode(o,p,void 0,h)},e.prototype.removed=function(t,e){var r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);var n=this._pages[r],i=n.removed(t,e);return n!==i?this.replacedPage(r,i,n,e):this},e.prototype.replacedPage=function(t,r,n,i){return r.isEmpty()?this._pages.length>2?this.removedPage(t,r,n):this._pages.length>1?0===t?this._pages[1]:this._pages[0]:Lt.empty():r instanceof e&&i.pageShouldMerge(r)?this.updatedPageMerge(t,r,n):this.updatedPage(t,r,n)},e.prototype.removedPage=function(t,e,r){for(var n=this._pages,i=new Array(n.length-1),o=0;o<t;o+=1)i[o]=n[o];for(o=t+1;o<n.length;o+=1)i[o-1]=n[o];var s=this._knots,u=new Array(s.length-1);if(t>0){for(o=0;o<t-1;o+=1)u[o]=s[o];for(o=t;o<s.length;o+=1)u[o-1]=s[o]}else for(o=1;o<s.length;o+=1)u[o-1]=s[o];var a=this._size-r.size;return this.newNode(i,u,void 0,a)},e.prototype.drop=function(t,e){if(t>0){var r=this._size;if(t<r){for(var n=this._pages,i=0;i<n.length;){var o=n[i].size;if(!(o<=t))break;r-=o,t-=o,i+=1}var s=n.length-i;if(s>1){var u=void 0;if(i>0){for(var a=new Array(s),p=0;p<s;p+=1)a[p]=n[p+i];var h=new Array(s-1);for(p=0;p<h.length;p+=1)h[p]=this._knots[p+i];u=this.newNode(a,h,void 0,r)}else u=this;if(t>0){var f=n[i],c=f.drop(t,e);return u.replacedPage(0,c,f,e)}return u}return n[i].drop(t,e)}return Lt.empty()}return this},e.prototype.take=function(t,e){if(t<this._size){if(t>0){for(var r=this._pages,n=0,i=0;n<r.length&&t>0;){var o=r[n].size;if(i+=o,n+=1,!(o<=t))break;t-=o}var s=0===t?n:n+1;if(s>1){var u=void 0;if(n<r.length){for(var a=new Array(s),p=0;p<s;p+=1)a[p]=r[p];var h=new Array(s-1);for(p=0;p<h.length;p+=1)h[p]=this._knots[p];u=this.newNode(a,h,void 0,i)}else u=this;if(t>0){var f=r[n-1],c=f.take(t,e);return u.replacedPage(n-1,c,f,e)}return u}return t>0?r[0].take(t,e):r[0]}return Lt.empty()}return this},e.prototype.balanced=function(t){if(this._pages.length>1&&t.pageShouldSplit(this)){var e=this._knots.length>>>1;return this.split(e)}return this},e.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),n=this.splitRight(t);e[0]=r,e[1]=n;var i=new Array(1);return i[0]=n.minKey(),this.newNode(e,i,void 0,this._size)},e.prototype.splitLeft=function(t){for(var e=this._pages,r=new Array(t+1),n=0;n<t+1;n+=1)r[n]=e[n];var i=this._knots,o=new Array(t);for(n=0;n<t;n+=1)o[n]=i[n];var s=0;for(n=0;n<=t;n+=1)s+=r[n].size;return this.newNode(r,o,void 0,s)},e.prototype.splitRight=function(t){for(var e=this._pages,r=e.length-(t+1),n=new Array(r),i=0;i<r;i+=1)n[i]=e[i+(t+1)];var o=this._knots,s=new Array(r-1);for(i=0;i<s.length;i+=1)s[i]=o[i+(t+1)];var u=0;for(i=0;i<r;i+=1)u+=n[i].size;return this.newNode(n,s,void 0,u)},e.prototype.reduced=function(t,e,r){if(void 0===this._fold){for(var n=this._pages,i=n.length,o=new Array(i),s=0;s<i;s+=1)o[s]=n[s].reduced(t,e,r);var u=o[0].fold();for(s=1;s<i;s+=1)u=r(u,o[s].fold());return this.newNode(o,this._knots,u,this._size)}return this},e.prototype.forEach=function(t,e,r){for(var n=this._pages,i=0,o=n.length;i<o;i+=1){var s=n[i].forEach(t,e,r);if(void 0!==s)return s}},e.prototype.entries=function(){return new zt.NodeCursor(this._pages)},e.prototype.reverseEntries=function(){return new zt.NodeCursor(this._pages,this._size,this._pages.length)},e.prototype.lookup=function(t,e){for(var r=0,n=this._knots.length-1;r<=n;){var i=r+n>>>1,o=e.compare(t,this._knots[i]);if(o>0)r=i+1;else{if(!(o<0))return i;n=i-1}}return-(r+1)},e.prototype.newNode=function(t,r,n,i){return new e(t,r,n,i)},e}(Lt);zt.Node=Bt;var Nt=function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}return y(e,t),e.prototype.pageSize=function(t){return t.size},e.prototype.pageCursor=function(t){return t.entries()},e.prototype.reversePageCursor=function(t){return t.reverseEntries()},e}(Rt);zt.NodeCursor=Nt;var Kt=function(){function t(){}return t.prototype.identify=function(t){var e=new Uint8Array(6);return s.fillBytes(e),e},t.prototype.compare=function(t,e){return c.compare(t,e)},t.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},t.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},t}();Kt.prototype.pageSplitSize=32;var Wt=function(t){function e(r){void 0===r&&(r=e.Page.empty());var n=t.call(this)||this;return n.root=r,n}return y(e,t),Object.defineProperty(e.prototype,"length",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this.root.isEmpty()},e.prototype.get=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.get(t)},e.prototype.getEntry=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.getEntry(t)},e.prototype.set=function(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);var n=this.root;if(t<0||t>=n.size)throw new RangeError(""+t);return this.root=n.updated(t,e,this),this},e.prototype.insert=function(t,e,r){var n=this.root;if(t<0||t>n.size)throw new RangeError(""+t);return this.root=n.inserted(t,e,r,this).balanced(this),this},e.prototype.remove=function(t,e){if(void 0!==e&&(t=this.lookup(e,t))<0)throw new RangeError(""+e);var r=this.root;if(t<0||t>r.size)throw new RangeError(""+t);return this.root=r.removed(t,this),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.root,n=0;n<t.length;n+=1)r=r.inserted(r.size,t[n],void 0,this).balanced(this);return this.root=r,r.size},e.prototype.pop=function(){var t=this.root,e=t.size-1;if(e>=0){var r=t.get(e);return this.root=t.removed(e,this),r}},e.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.root,n=t.length-1;n>=0;n-=1)r=r.inserted(0,t[n],void 0,this).balanced(this);return this.root=r,r.size},e.prototype.shift=function(){var t=this.root;if(t.size>0){var e=t.get(0);return this.root=t.removed(0,this),e}},e.prototype.move=function(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);var n=this.root;if(t<0||t>=n.size)throw new RangeError(""+t);if(e<0||e>=n.size)throw new RangeError(""+e);if(t!==e){var i=n.getEntry(t);this.root=n.removed(t,this).inserted(e,i[1],i[0],this).balanced(this)}return this},e.prototype.splice=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=this.root;t<0&&(t=i.size+t),t=Math.min(Math.max(0,t),i.size),void 0===e&&(e=i.size-t);for(var o=[],s=t,u=t+e;s<u;s+=1)o.push(i.get(t)),i=i.removed(t,this);for(s=0;s<r.length;s+=1)i=i.inserted(t+s,r[s],void 0,this).balanced(this);return this.root=i,o},e.prototype.drop=function(t){var r=this.root;return t>0&&r.size>0&&(t<r.size?this.root=r.drop(t,this):this.root=e.Page.empty()),this},e.prototype.take=function(t){var r=this.root;return t<r.size&&r.size>0&&(this.root=t>0?r.take(t,this):e.Page.empty()),this},e.prototype.clear=function(){this.root=e.Page.empty()},e.prototype.forEach=function(t,e){return this.root.forEach(t,e,0,this)},e.prototype.keys=function(){return this.root.keys()},e.prototype.values=function(){return this.root.values()},e.prototype.entries=function(){return this.root.entries()},e.prototype.reverseKeys=function(){return this.root.reverseKeys()},e.prototype.reverseValues=function(){return this.root.reverseValues()},e.prototype.reverseEntries=function(){return this.root.reverseEntries()},e.prototype.clone=function(){return this.copy(this.root)},e.prototype.copy=function(t){var r=new e(t);return r.identify!==this.identify&&(r.identify=this.identify),r.compare!==this.compare&&(r.compare=this.compare),r.pageSplitSize!==this.pageSplitSize&&(r.pageSplitSize=this.pageSplitSize),r},e.prototype.lookup=function(t,e){void 0===e&&(e=0);var r=this.root,n=e=Math.min(Math.max(0,e),r.size-1);do{var i=r.getEntry(n);if(i&&0===this.compare(i[0],t))return n;n=(n+1)%r.size}while(isFinite(n)&&n!==e);return-1},e}(Kt);Wt.prototype.pageSplitSize=32;var jt=function(){function t(){}return t.prototype.keys=function(){return new Vt(this.entries())},t.prototype.values=function(){return new Ut(this.entries())},t.prototype.reverseKeys=function(){return new Vt(this.reverseEntries())},t.prototype.reverseValues=function(){return new Ut(this.reverseEntries())},t.empty=function(){return t._empty||(t._empty=new Wt.Leaf([])),t._empty},t}();Wt.Page=jt;var Ht=function(t){function e(e){var r=t.call(this)||this;return r._slots=e,r}return y(e,t),Object.defineProperty(e.prototype,"arity",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._slots.length},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._slots.length},e.prototype.get=function(t){var e=this._slots[t];return e?e[1]:void 0},e.prototype.getEntry=function(t){return this._slots[t]},e.prototype.updated=function(t,e,r){if(t<0||t>=this._slots.length)throw new RangeError(""+t);return this.updatedItem(t,e)},e.prototype.updatedItem=function(t,r){var n=this._slots,i=n[t];if(r!==i[1]){var o=n.slice(0);return o[t]=[i[0],r],new e(o)}return this},e.prototype.inserted=function(t,e,r,n){if(t<0||t>this._slots.length)throw new RangeError(""+t);return this.insertedItem(t,e,r,n)},e.prototype.insertedItem=function(t,r,n,i){void 0===n&&(n=i.identify(r));for(var o=this._slots,s=new Array(o.length+1),u=0;u<t;u+=1)s[u]=o[u];s[t]=[n,r];for(u=t;u<o.length;u+=1)s[u+1]=o[u];return new e(s)},e.prototype.removed=function(t,e){if(t<0||t>=this._slots.length)throw new RangeError(""+t);return this._slots.length>1?this.removedSlot(t):jt.empty()},e.prototype.removedSlot=function(t){for(var r=this._slots,n=new Array(r.length-1),i=0;i<t;i+=1)n[i]=r[i];for(i=t;i<n.length;i+=1)n[i]=r[i+1];return new e(n)},e.prototype.drop=function(t,r){var n=this._slots;if(t>0&&n.length>0){if(t<n.length){for(var i=n.length-t,o=new Array(i),s=0;s<i;s+=1)o[s]=n[s+t];return new e(o)}return jt.empty()}return this},e.prototype.take=function(t,r){var n=this._slots;if(t<n.length&&n.length>0){if(t>0){for(var i=new Array(t),o=0;o<t;o+=1)i[o]=n[o];return new e(i)}return jt.empty()}return this},e.prototype.balanced=function(t){var e=this._slots.length;return e>1&&t.pageShouldSplit(this)?this.split(e>>>1):this},e.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),n=this.splitRight(t);e[0]=r,e[1]=n;var i=new Array(1);return i[0]=t,new Wt.Node(e,i,this._slots.length)},e.prototype.splitLeft=function(t){for(var r=this._slots,n=new Array(t),i=0;i<t;i+=1)n[i]=r[i];return new e(n)},e.prototype.splitRight=function(t){for(var r=this._slots,n=r.length-t,i=new Array(n),o=0;o<n;o+=1)i[o]=r[o+t];return new e(i)},e.prototype.forEach=function(t,e,r,n){for(var i=0;i<this._slots.length;i+=1){var o=this._slots[i],s=t.call(e,o[1],r+i,n,o[0]);if(void 0!==s)return s}},e.prototype.entries=function(){return l.array(this._slots)},e.prototype.reverseEntries=function(){return l.array(this._slots,this._slots.length)},e}(jt);Wt.Leaf=Ht;var Gt=function(t){function e(e,r,n){var i=t.call(this)||this;if(i._pages=e,void 0===r||void 0===n){n=0;for(var o=0,s=(r=new Array(e.length-1)).length;o<s;o+=1)n+=e[o].size,r[o]=n;n+=e[r.length].size}return i._knots=r,i._size=n,i}return y(e,t),Object.defineProperty(e.prototype,"arity",{get:function(){return this._pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._size},e.prototype.get=function(t){var e=this.lookup(t);e>=0?e+=1:e=-(e+1);var r=0===e?t:t-this._knots[e-1];return this._pages[e].get(r)},e.prototype.getEntry=function(t){var e=this.lookup(t);e>=0?e+=1:e=-(e+1);var r=0===e?t:t-this._knots[e-1];return this._pages[e].getEntry(r)},e.prototype.updated=function(t,e,r){var n=this.lookup(t);n>=0?n+=1:n=-(n+1);var i=0===n?t:t-this._knots[n-1],o=this._pages[n],s=o.updated(i,e,r);return o!==s?o.size!==s.size&&r.pageShouldSplit(s)?this.updatedPageSplit(n,s,o):this.updatedPage(n,s,o):this},e.prototype.updatedPage=function(t,r,n){var i=this._pages,o=i.slice(0);o[t]=r;var s,u,a=this._knots;if(i.length-1>0){s=a.slice(0),u=t>0?a[t-1]:0;for(var p=t;p<s.length;p+=1)u+=o[p].size,s[p]=u;u+=o[s.length].size}else s=[],u=0;return new e(o,s,u)},e.prototype.updatedPageSplit=function(t,r,n){for(var i=this._pages,o=new Array(i.length+1),s=0;s<t;s+=1)o[s]=i[s];var u=r.splitLeft(r.arity>>>1),a=r.splitRight(r.arity>>>1);o[t]=u,o[t+1]=a;for(s=t+1;s<i.length;s+=1)o[s+1]=i[s];return new e(o)},e.prototype.updatedPageMerge=function(t,r,n){for(var i=this._pages,o=r._pages,s=new Array(i.length+o.length-1),u=0;u<t;u+=1)s[u]=i[u];for(u=0;u<o.length;u+=1)s[u+t]=o[u];for(u=t+1;u<i.length;u+=1)s[u+o.length-1]=i[u];return new e(s)},e.prototype.inserted=function(t,e,r,n){var i=this.lookup(t);i>=0?i+=1:i=-(i+1);var o=0===i?t:t-this._knots[i-1],s=this._pages[i],u=s.inserted(o,e,r,n);return s!==u?n.pageShouldSplit(u)?this.updatedPageSplit(i,u,s):this.updatedPage(i,u,s):this},e.prototype.removed=function(t,e){var r=this.lookup(t);r>=0?r+=1:r=-(r+1);var n=0===r?t:t-this._knots[r-1],i=this._pages[r],o=i.removed(n,e);return i!==o?this.replacedPage(r,o,i,e):this},e.prototype.replacedPage=function(t,r,n,i){return r.isEmpty()?this._pages.length>2?this.removedPage(t,r,n):this._pages.length>1?0===t?this._pages[1]:this._pages[0]:jt.empty():r instanceof e&&i.pageShouldMerge(r)?this.updatedPageMerge(t,r,n):this.updatedPage(t,r,n)},e.prototype.removedPage=function(t,r,n){for(var i=this._pages,o=new Array(i.length-1),s=0;s<t;s+=1)o[s]=i[s];for(s=t+1;s<i.length;s+=1)o[s-1]=i[s];var u,a=this._knots,p=new Array(a.length-1);if(t>0){for(s=0;s<t;s+=1)p[s]=a[s];u=a[t-1]}else u=0;for(s=t;s<p.length;s+=1)u+=o[s].size,p[s]=u;return new e(o,p,u+=o[p.length].size)},e.prototype.drop=function(t,r){if(t>0){if(t<this._size){var n=this.lookup(t);n>=0?n+=1:n=-(n+1),t=0===n?t:t-this._knots[n-1];var i=this._pages,o=i.length-n;if(o>1){var s=void 0;if(n>0){for(var u=new Array(o),a=0;a<o;a+=1)u[a]=i[a+n];s=new e(u)}else s=this;if(t>0){var p=i[n],h=p.drop(t,r);return s.replacedPage(0,h,p,r)}return s}return i[n].drop(t,r)}return jt.empty()}return this},e.prototype.take=function(t,r){if(t<this._size){if(t>0){var n=this.lookup(t);n>=0?n+=1:n=-(n+1),t=0===n?t:t-this._knots[n-1];var i=this._pages,o=0===t?n:n+1;if(o>1){var s=void 0;if(n<i.length){for(var u=new Array(o),a=0;a<o;a+=1)u[a]=i[a];var p=new Array(o-1);for(a=0;a<p.length;a+=1)p[a]=this._knots[a];s=new e(u,p,p[o-2]+u[o-1].size)}else s=this;if(t>0){var h=i[n],f=h.take(t,r);return s.replacedPage(n,f,h,r)}return s}return t>0?i[0].take(t,r):i[0]}return jt.empty()}return this},e.prototype.balanced=function(t){if(this._pages.length>1&&t.pageShouldSplit(this)){var e=this._knots.length>>>1;return this.split(e)}return this},e.prototype.split=function(t){var r=new Array(2),n=this.splitLeft(t),i=this.splitRight(t);r[0]=n,r[1]=i;var o=new Array(1);return o[0]=n._size,new e(r,o,this._size)},e.prototype.splitLeft=function(t){for(var r=this._pages,n=new Array(t+1),i=0;i<t+1;i+=1)n[i]=r[i];var o=this._knots,s=new Array(t);for(i=0;i<t;i+=1)s[i]=o[i];var u=0;for(i=0;i<=t;i+=1)u+=n[i].size;return new e(n,s,u)},e.prototype.splitRight=function(t){for(var r=this._pages,n=r.length-(t+1),i=new Array(n),o=0;o<n;o+=1)i[o]=r[o+(t+1)];var s,u=new Array(n-1);if(n>0){s=i[0].size;for(o=1;o<n;o+=1)u[o-1]=s,s+=i[o].size}else s=0;return new e(i,u,s)},e.prototype.forEach=function(t,e,r,n){for(var i=0;i<this._pages.length;i+=1){var o=this._pages[i],s=o.forEach(t,e,r,n);if(void 0!==s)return s;r+=o.size}},e.prototype.entries=function(){return new Wt.NodeCursor(this._pages)},e.prototype.reverseEntries=function(){return new Wt.NodeCursor(this._pages,this._size,this._pages.length)},e.prototype.lookup=function(t){for(var e=0,r=this._knots.length-1;e<=r;){var n=e+r>>>1;if(t>this._knots[n])e=n+1;else{if(!(t<this._knots[n]))return n;r=n-1}}return-(e+1)},e}(jt);Wt.Node=Gt;var Qt=function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}return y(e,t),e.prototype.pageSize=function(t){return t.size},e.prototype.pageCursor=function(t){return t.entries()},e.prototype.reversePageCursor=function(t){return t.reverseEntries()},e}(Rt);Wt.NodeCursor=Qt;var Xt=function(){function t(){}return t.prototype.updated=function(e,r){var n=t.Record.create(2);return n.push(this),n.set(e,r),n},t.prototype.updatedAttr=function(e,r){var n=t.Record.create(2);return n.push(this),n.setAttr(e,r),n},t.prototype.updatedSlot=function(e,r){var n=t.Record.create(2);return n.push(this),n.setSlot(e,r),n},t.prototype.appended=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=t.Record.create(1+arguments.length);return n.push(this),n.push.apply(n,arguments),n},t.prototype.prepended=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=t.Record.create(arguments.length+1);return n.push.apply(n,arguments),n.push(this),n},t.prototype.concat=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=t.Record.create();n.push(this);for(var i=0,o=arguments.length;i<o;i+=1)t.fromAny(arguments[i]).forEach(function(t){n.push(t)});return n},t.prototype.lt=function(e){return e=t.fromAny(e),this.compareTo(e)<0?t.Bool.from(!0):t.absent()},t.prototype.le=function(e){return e=t.fromAny(e),this.compareTo(e)<=0?t.Bool.from(!0):t.absent()},t.prototype.eq=function(e){return e=t.fromAny(e),this.equals(e)?t.Bool.from(!0):t.absent()},t.prototype.ne=function(e){return e=t.fromAny(e),this.equals(e)?t.absent():t.Bool.from(!0)},t.prototype.ge=function(e){return e=t.fromAny(e),this.compareTo(e)>=0?t.Bool.from(!0):t.absent()},t.prototype.gt=function(e){return e=t.fromAny(e),this.compareTo(e)>0?t.Bool.from(!0):t.absent()},t.prototype.invoke=function(e){return t.absent()},t.prototype.filter=function(e){var r=t.Selector.literal(this);return r.filter.apply(r,arguments)},t.prototype.max=function(t){return this.compareTo(t)>=0?this:t},t.prototype.min=function(t){return this.compareTo(t)<=0?this:t},t.prototype.evaluate=function(t){return this},t.prototype.substitute=function(t){return this},t.prototype.cast=function(t,e){var r=t.cast(this);return void 0===r&&(r=e),r},t.prototype.coerce=function(t,e){var r=t.cast(this);return void 0===r&&(r=t.unit()),void 0===r&&(r=e),r},t.prototype.precedence=function(){return 11},t.prototype.forEach=function(t,e){return t.call(e,this,0)},t.prototype.iterator=function(){return l.unary(this)},t.prototype.display=function(t){this.debug(t)},t.prototype.toString=function(){return Z.debug(this)},t.empty=function(){return t.Record.empty()},t.extant=function(){return t.Extant.extant()},t.absent=function(){return t.Absent.absent()},t.fromAny=function(e){return e instanceof t?e:t.Value.fromAny(e)},t.globalScope=function(){return t._globalScope||(t._globalScope=t.Record.create(1).slot("math",t.MathModule.scope()).commit()),t._globalScope},t}(),Zt=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isDefined=function(){return!0},e.prototype.isDistinct=function(){return!0},e.prototype.toValue=function(){return this.value},e.prototype.tag=function(){},e.prototype.target=function(){return this.value},e.prototype.flattened=function(){return Xt.Value.absent()},e.prototype.unflattened=function(){return Xt.Record.of(this)},e.prototype.header=function(t){return Xt.Value.absent()},e.prototype.headers=function(t){},e.prototype.head=function(){return Xt.absent()},e.prototype.tail=function(){return Xt.Record.empty()},e.prototype.body=function(){return Xt.Value.absent()},Object.defineProperty(e.prototype,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return!1},e.prototype.get=function(t){return Xt.Value.absent()},e.prototype.getAttr=function(t){return Xt.Value.absent()},e.prototype.getSlot=function(t){return Xt.Value.absent()},e.prototype.getField=function(t){},e.prototype.getItem=function(t){return Xt.absent()},e.prototype.deleted=function(t){return this},e.prototype.conditional=function(t,e){return t=Xt.fromAny(t)},e.prototype.or=function(t){return this},e.prototype.and=function(t){return t=Xt.fromAny(t)},e.prototype.lambda=function(t){return Xt.Value.absent()},e.prototype.stringValue=function(t){return this.value.stringValue(t)},e.prototype.numberValue=function(t){return this.value.numberValue(t)},e.prototype.booleanValue=function(t){return this.value.booleanValue(t)},e.of=function(t,e){var r;return"string"==typeof t?r=t:t instanceof Xt.Text&&(r=t.value),void 0!==r&&64===r.charCodeAt(0)?(arguments[0]=r.slice(1),Xt.Attr.of.apply(void 0,arguments)):Xt.Slot.of.apply(void 0,arguments)},e.fromAny=function(t){if(t instanceof e)return t;if(t&&"object"==typeof t){if(void 0!==t.$key)return e.of(t.$key,t.$value);for(var r in t)return e.of(r,t[r])}throw new TypeError(""+t)},e.IMMUTABLE=1,e}(Xt);Xt.Field=Zt;var Yt=function(t){function e(r){var n=t.call(this,r)||this;return n.__proto__=e.prototype,n}return y(e,t),e}(Error),$t=function(){function t(t){this._maxScopeDepth=t}return t.prototype.maxScopeDepth=function(t){return void 0===t?this._maxScopeDepth:this.copy(t)},t.prototype.copy=function(e){return new t(e)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this._maxScopeDepth===e._maxScopeDepth)},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(t._hashSeed,this._maxScopeDepth))},t.prototype.debug=function(t){t=t.write("new").write(32).write("InterpreterSettings").write(40).debug(this._maxScopeDepth).write(41)},t.prototype.toString=function(){return Z.debug(this)},t.standard=function(){if(!t._standard){t._standard=new t(1024)}return t._standard},t}(),Jt=function(){function t(t,e,r){void 0===t&&(t=$t.standard()),void 0===e&&(e=null),void 0===r&&(r=0),this._settings=t,this._scopeStack=e,this._scopeDepth=r}return t.prototype.settings=function(t){return void 0===t?this._settings:(this._settings=t,this)},t.prototype.scopeDepth=function(){return this._scopeDepth},t.prototype.peekScope=function(){var t=this._scopeDepth;if(t<=0)throw new Yt("scope stack empty");return this._scopeStack[t-1]},t.prototype.getScope=function(t){if(t<0||t>=this._scopeDepth)throw new RangeError(""+t);return this._scopeStack[t]},t.prototype.pushScope=function(e){var r=this._scopeDepth;if(r>=this._settings._maxScopeDepth)throw new Yt("scope stack overflow");var n,i=this._scopeStack;if(null===i||r+1>i.length){if(n=new Array(t.expand(r+1)),null!=i)for(var o=0;o<r;o+=1)n[o]=i[o];this._scopeStack=n}else n=i;n[r]=e,this._scopeDepth=r+1},t.prototype.popScope=function(){var t=this._scopeDepth;if(t<=0)throw new Yt("scope stack empty");var e=this._scopeStack,r=e[t-1];return e[t-1]=void 0,this._scopeDepth=t-1,r},t.prototype.swapScope=function(t){var e=this._scopeDepth;if(e<=0)throw new Yt("scope stack empty");var r=this._scopeStack,n=r[e-1];return r[e-1]=t,n},t.prototype.willOperate=function(t){},t.prototype.didOperate=function(t,e){},t.prototype.willSelect=function(t){},t.prototype.didSelect=function(t,e){},t.prototype.willTransform=function(t){},t.prototype.didTransform=function(t,e){},t.of=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var n=arguments.length,i=new Array(t.expand(n)),o=0;o<n;o+=1){var s=Xt.fromAny(arguments[o]);i[o]=s}return new t($t.standard(),i,n)},t.fromAny=function(e,r){if(void 0===r&&(r=Xt.globalScope()),!(e instanceof t)){var n=e;e=new t,r&&e.pushScope(r),void 0!==n&&e.pushScope(Xt.fromAny(n))}return e},t.expand=function(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},t}(),te=function(t){function e(e,r,n){void 0===r&&(r=Xt.Value.extant()),void 0===n&&(n=0);var i=t.call(this)||this;return i._key=e,i._value=r,i._flags=n,i}return y(e,t),e.prototype.isConstant=function(){return this._key.isConstant()&&this._value.isConstant()},Object.defineProperty(e.prototype,"name",{get:function(){return this._key.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.setValue=function(t){if(0!=(this._flags&Zt.IMMUTABLE))throw new Error("immutable");var e=this._value;return this._value=t,e},e.prototype.updatedValue=function(t){return new e(this._key,t)},e.prototype.bitwiseOr=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.BitwiseOrOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.bitwiseOr(t._value):t instanceof Xt.Value?this._value.bitwiseOr(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.bitwiseXor=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.BitwiseXorOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.bitwiseXor(t._value):t instanceof Xt.Value?this._value.bitwiseXor(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.bitwiseAnd=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.BitwiseAndOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.bitwiseAnd(t._value):t instanceof Xt.Value?this._value.bitwiseAnd(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.plus=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.PlusOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.plus(t._value):t instanceof Xt.Value?this._value.plus(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.minus=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.MinusOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.minus(t._value):t instanceof Xt.Value?this._value.minus(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.times=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.TimesOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.times(t._value):t instanceof Xt.Value?this._value.times(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.divide=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.DivideOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.divide(t._value):t instanceof Xt.Value?this._value.divide(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.modulo=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.ModuloOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.modulo(t._value):t instanceof Xt.Value?this._value.modulo(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.not=function(){var t=this._value.not();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.bitwiseNot=function(){var t=this._value.bitwiseNot();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.negative=function(){var t=this._value.negative();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.positive=function(){var t=this._value.positive();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.inverse=function(){var t=this._value.inverse();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.evaluate=function(t){t=Jt.fromAny(t);var r=this._key.evaluate(t).toValue(),n=this._value.evaluate(t).toValue();return r===this._key&&n===this._value?this:r.isDefined()&&n.isDefined()?r instanceof Xt.Text?new e(r,n):new Xt.Slot(r,n):Xt.absent()},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._key.substitute(t).toValue(),n=this._value.substitute(t).toValue();return r===this._key&&n===this._value?this:r.isDefined()&&n.isDefined()?r instanceof Xt.Text?new e(r,n):new Xt.Slot(r,n):Xt.absent()},e.prototype.toAny=function(){var t={};return t["@"+this._key.value]=this._value.toAny(),t},e.prototype.isAliased=function(){return!1},e.prototype.isMutable=function(){return 0==(this._flags&Zt.IMMUTABLE)},e.prototype.alias=function(){this._flags|=Zt.IMMUTABLE},e.prototype.branch=function(){return 0!=(this._flags&Zt.IMMUTABLE)?new e(this._key,this._value,this._flags&~Zt.IMMUTABLE):this},e.prototype.clone=function(){return new e(this._key.clone(),this._value.clone())},e.prototype.commit=function(){return 0==(this._flags&Zt.IMMUTABLE)&&(this._flags|=Zt.IMMUTABLE,this._value.commit()),this},e.prototype.typeOrder=function(){return 1},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._key.compareTo(t._key);return 0===r&&(r=this._value.compareTo(t._value)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.keyEquals=function(t){return"string"==typeof t?this._key.value===t:t instanceof Zt?this._key.equals(t.key):this._key.equals(t)},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._key.equals(t._key)&&this._value.equals(t._value))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._key.hashCode()),this._value.hashCode()))},e.prototype.debug=function(t){t=t.write("Attr").write(46).write("of").write(40).display(this.key),this.value instanceof Xt.Extant||(t=t.write(44).write(32).display(this.value)),t=t.write(41)},e.prototype.display=function(t){this.debug(t)},e.of=function(t,r){return new e(t=Xt.Text.fromAny(t),r=arguments.length>=2?Xt.Value.fromAny(r):Xt.Value.extant())},e}(Zt);Xt.Attr=te;var ee=function(t){function e(e,r,n){void 0===r&&(r=Xt.Value.extant()),void 0===n&&(n=0);var i=t.call(this)||this;return i._key=e.commit(),i._value=r,i._flags=n,i}return y(e,t),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.isConstant=function(){return this._key.isConstant()&&this._value.isConstant()},e.prototype.setValue=function(t){if(0!=(this._flags&Zt.IMMUTABLE))throw new Error("immutable");var e=this._value;return this._value=t,e},e.prototype.updatedValue=function(t){return new e(this._key,t)},e.prototype.bitwiseOr=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.BitwiseOrOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.bitwiseOr(t._value):t instanceof Xt.Value?this._value.bitwiseOr(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.bitwiseXor=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.BitwiseXorOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.bitwiseXor(t._value):t instanceof Xt.Value?this._value.bitwiseXor(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.bitwiseAnd=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.BitwiseAndOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.bitwiseAnd(t._value):t instanceof Xt.Value?this._value.bitwiseAnd(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.plus=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.PlusOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.plus(t._value):t instanceof Xt.Value?this._value.plus(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.minus=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.MinusOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.minus(t._value):t instanceof Xt.Value?this._value.minus(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.times=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.TimesOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.times(t._value):t instanceof Xt.Value?this._value.times(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.divide=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.DivideOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.divide(t._value):t instanceof Xt.Value?this._value.divide(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.modulo=function(t){return(t=Xt.fromAny(t))instanceof Xt.Expression?new Xt.ModuloOperator(this,t):(r=t instanceof e&&this._key.equals(t._key)?this._value.modulo(t._value):t instanceof Xt.Value?this._value.modulo(t):Xt.Value.absent()).isDefined()?new e(this._key,r):Xt.absent();var r},e.prototype.not=function(){var t=this._value.not();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.bitwiseNot=function(){var t=this._value.bitwiseNot();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.negative=function(){var t=this._value.negative();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.positive=function(){var t=this._value.positive();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.inverse=function(){var t=this._value.inverse();return t.isDefined()?new e(this._key,t):Xt.absent()},e.prototype.evaluate=function(t){t=Jt.fromAny(t);var r=this._key.evaluate(t).toValue(),n=this._value.evaluate(t).toValue();return r===this._key&&n===this._value?this:r.isDefined()&&n.isDefined()?new e(r,n):Xt.absent()},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._key.substitute(t).toValue(),n=this._value.substitute(t).toValue();return r===this._key&&n===this._value?this:r.isDefined()&&n.isDefined()?new e(r,n):Xt.absent()},e.prototype.toAny=function(){var t={};return this._key instanceof Xt.Text?t[this._key.value]=this._value.toAny():(t.$key=this._key.toAny(),t.$value=this._value.toAny()),t},e.prototype.isAliased=function(){return!1},e.prototype.isMutable=function(){return 0==(this._flags&Zt.IMMUTABLE)},e.prototype.alias=function(){this._flags|=Zt.IMMUTABLE},e.prototype.branch=function(){return 0!=(this._flags&Zt.IMMUTABLE)?new e(this._key,this._value,this._flags&~Zt.IMMUTABLE):this},e.prototype.clone=function(){return new e(this._key.clone(),this._value.clone())},e.prototype.commit=function(){return 0==(this._flags&Zt.IMMUTABLE)&&(this._flags|=Zt.IMMUTABLE,this._value.commit()),this},e.prototype.typeOrder=function(){return 2},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._key.compareTo(t._key);return 0===r&&(r=this._value.compareTo(t._value)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.keyEquals=function(t){return"string"==typeof t&&this._key instanceof Xt.Text?this._key.value===t:t instanceof Zt?this._key.equals(t.key):this._key.equals(t)},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._key.equals(t._key)&&this._value.equals(t._value))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._key.hashCode()),this._value.hashCode()))},e.prototype.debug=function(t){t=t.write("Slot").write(46).write("of").write(40).display(this.key),this.value instanceof Xt.Extant||(t=t.write(44).write(32).display(this.value)),t=t.write(41)},e.prototype.display=function(t){this.debug(t)},e.of=function(t,r){return new e(t=Xt.Value.fromAny(t),r=arguments.length>=2?Xt.Value.fromAny(r):Xt.Value.extant())},e}(Zt);Xt.Slot=ee;var re=function(){function t(){this._record=null,this._value=null}return t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0,n=arguments.length;r<n;r+=1){var i=arguments[r];if(i instanceof Zt)return this.pushField(i);if(i instanceof ne)return this.pushValue(i);throw new TypeError(""+i)}},t.prototype.pushField=function(t){null===this._record&&(this._record=Xt.Record.create(),null!==this._value&&(this._record.push(this._value),this._value=null)),this._record.push(t)},t.prototype.pushValue=function(t){null!=this._record?this._record.push(t):null==this._value?this._value=t:(this._record=Xt.Record.create(),this._record.push(this._value),this._value=null,this._record.push(t))},t.prototype.bind=function(){return null!==this._record?this._record:null!==this._value?this._value:ne.absent()},t}(),ne=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isDefined=function(){return!0},e.prototype.isDistinct=function(){return!0},Object.defineProperty(e.prototype,"key",{get:function(){return e.absent()},enumerable:!0,configurable:!0}),e.prototype.toValue=function(){return this},e.prototype.tag=function(){},e.prototype.target=function(){return this},e.prototype.flattened=function(){return this},e.prototype.unflattened=function(){return e.Record.of(this)},e.prototype.header=function(t){return e.absent()},e.prototype.headers=function(t){},e.prototype.head=function(){return Xt.absent()},e.prototype.tail=function(){return e.Record.empty()},e.prototype.body=function(){return e.extant()},Object.defineProperty(e.prototype,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return!1},e.prototype.get=function(t){return e.absent()},e.prototype.getAttr=function(t){return e.absent()},e.prototype.getSlot=function(t){return e.absent()},e.prototype.getField=function(t){},e.prototype.getItem=function(t){return Xt.absent()},e.prototype.deleted=function(t){return this},e.prototype.conditional=function(t,e){return t=Xt.fromAny(t)},e.prototype.or=function(t){return this},e.prototype.and=function(t){return t=Xt.fromAny(t)},e.prototype.bitwiseOr=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.BitwiseOrOperator(this,t);if(t instanceof Xt.Attr){if((e=this.bitwiseOr(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.bitwiseOr(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.bitwiseXor=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.BitwiseXorOperator(this,t);if(t instanceof Xt.Attr){if((e=this.bitwiseXor(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.bitwiseXor(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.bitwiseAnd=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.BitwiseAndOperator(this,t);if(t instanceof Xt.Attr){if((e=this.bitwiseAnd(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.bitwiseAnd(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.lt=function(e){return(e=Xt.fromAny(e))instanceof Xt.Expression?new Xt.LtOperator(this,e):t.prototype.lt.call(this,e)},e.prototype.le=function(e){return(e=Xt.fromAny(e))instanceof Xt.Expression?new Xt.LeOperator(this,e):t.prototype.le.call(this,e)},e.prototype.eq=function(e){return(e=Xt.fromAny(e))instanceof Xt.Expression?new Xt.EqOperator(this,e):t.prototype.eq.call(this,e)},e.prototype.ne=function(e){return(e=Xt.fromAny(e))instanceof Xt.Expression?new Xt.NeOperator(this,e):t.prototype.ne.call(this,e)},e.prototype.ge=function(e){return(e=Xt.fromAny(e))instanceof Xt.Expression?new Xt.GeOperator(this,e):t.prototype.ge.call(this,e)},e.prototype.gt=function(e){return(e=Xt.fromAny(e))instanceof Xt.Expression?new Xt.GtOperator(this,e):t.prototype.gt.call(this,e)},e.prototype.plus=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.PlusOperator(this,t);if(t instanceof Xt.Attr){if((e=this.plus(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.plus(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.minus=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.MinusOperator(this,t);if(t instanceof Xt.Attr){if((e=this.minus(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.minus(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.times=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.TimesOperator(this,t);if(t instanceof Xt.Attr){if((e=this.times(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.times(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.divide=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.DivideOperator(this,t);if(t instanceof Xt.Attr){if((e=this.divide(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.divide(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.modulo=function(t){if((t=Xt.fromAny(t))instanceof Xt.Expression)return new Xt.ModuloOperator(this,t);if(t instanceof Xt.Attr){if((e=this.modulo(t.value)).isDefined())return new Xt.Attr(t.key,e)}else if(t instanceof Xt.Slot){var e;if((e=this.modulo(t.value)).isDefined())return new Xt.Slot(t.key,e)}return Xt.absent()},e.prototype.not=function(){return e.absent()},e.prototype.bitwiseNot=function(){return e.absent()},e.prototype.negative=function(){return e.absent()},e.prototype.positive=function(){return e.absent()},e.prototype.inverse=function(){return e.absent()},e.prototype.lambda=function(t){return new Xt.LambdaFunc(this,t)},e.prototype.stringValue=function(t){return t},e.prototype.numberValue=function(t){return t},e.prototype.booleanValue=function(t){return t},e.prototype.isAliased=function(){return!1},e.prototype.isMutable=function(){return!1},e.prototype.alias=function(){},e.prototype.branch=function(){return this},e.prototype.clone=function(){return this},e.prototype.commit=function(){return this},e.prototype.keyEquals=function(t){return!1},e.builder=function(){return new re},e.empty=function(){return e.Record.empty()},e.extant=function(){return e.Extant.extant()},e.absent=function(){return e.Absent.absent()},e.fromAny=function(t){if(t instanceof e)return t;if(void 0===t)return e.Absent.absent();if(null===t)return e.Extant.extant();if("boolean"==typeof t)return e.Bool.from(t);if("number"==typeof t)return e.Num.from(t);if("string"==typeof t)return e.Text.from(t);if(t instanceof Uint8Array)return e.Data.wrap(t);if(Array.isArray(t))return e.Record.fromArray(t);if("object"==typeof t)return e.Record.fromObject(t);throw new TypeError(""+t)},e}(Xt);Xt.Value=ne;var ie=function(t){function e(e,r,n,i){void 0===r&&(r=0),void 0===n&&(n=e.length),void 0===i&&(i=r);var o=t.call(this)||this;return o._record=e,o._lower=r,o._upper=n,o._index=i,o._direction=0,o}return y(e,t),e.prototype.isEmpty=function(){return this._index>=this._upper},e.prototype.head=function(){if(this._direction=0,this._index<this._upper)return this._record.getItem(this._index);throw new Error("empty")},e.prototype.step=function(){if(this._direction=0,!(this._index<this._upper))throw new Error("empty");this._index+=1},e.prototype.skip=function(t){this._index=Math.min(Math.max(this._lower,this._index+t,this._upper))},e.prototype.hasNext=function(){return this._index<this._upper},e.prototype.nextIndex=function(){return this._index-this._lower},e.prototype.next=function(){this._direction=1;var t=this._index;return t<this._upper?(this._index=t+1,{value:this._record.getItem(t),done:this._index===this._upper}):(this._index=this._upper,{done:!0})},e.prototype.hasPrevious=function(){return this._index>this._lower},e.prototype.previousIndex=function(){return this._index-this._lower-1},e.prototype.previous=function(){this._direction=-1;var t=this._index-1;return t>=this._lower?(this._index=t,{value:this._record.getItem(t),done:t===this._lower}):(this._index=0,{done:!0})},e.prototype.set=function(t){this._direction>0?this._record.setItem(this._index-1,t):this._record.setItem(this._index,t)},e.prototype.delete=function(){this._direction>0&&(this._index-=1),this._record.splice(this._index,1),this._direction=0},e}(l),oe=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isArray=function(){return 0===this.fieldCount()},e.prototype.isObject=function(){return 0===this.valueCount()},e.prototype.fieldCount=function(){var t=0;return this.forEach(function(e){e instanceof Xt.Field&&(t+=1)},this),t},e.prototype.valueCount=function(){var t=0;return this.forEach(function(e){e instanceof ne&&(t+=1)},this),t},e.prototype.isConstant=function(){return void 0===this.forEach(function(t){return!!t.isConstant()&&void 0},this)},e.prototype.tag=function(){var t=this.head();if(t instanceof Xt.Attr)return t.key.value},e.prototype.target=function(){var t,r,n=!1;return this.forEach(function(i){i instanceof Xt.Attr?n=!0:void 0===t&&i instanceof ne?t=i:(void 0===r&&(r=e.create(),void 0!==t&&r.push(t)),r.push(i))},this),void 0===t?ne.extant():void 0===r?t:n?r:this},e.prototype.flattened=function(){if(this.isEmpty())return ne.extant();var t=this.iterator(),e=t.head();return t.step(),t.isEmpty()&&e instanceof ne?e:this.branch()},e.prototype.unflattened=function(){return this},e.prototype.header=function(t){var e=this.head();return e instanceof Xt.Attr&&e.key.value===t?e.value:ne.absent()},e.prototype.headers=function(t){var r=this.head();if(r instanceof Xt.Attr&&r.key.value===t){var n=r.value;return n instanceof e?n:e.of(n)}},e.prototype.head=function(){return this.forEach(function(t){return t},this)||Xt.absent()},e.prototype.tail=function(){var t=e.create();return this.forEach(function(e,r){r>0&&t.push(e)},this),t},e.prototype.body=function(){var t=this.tail();return t.isEmpty()?ne.absent():t.flattened()},e.prototype.has=function(t){return t=ne.fromAny(t),this.forEach(function(e){return!!(e instanceof Xt.Field&&e.key.equals(t))||void 0},this)||!1},e.prototype.indexOf=function(t,e){void 0===e&&(e=0),t=Xt.fromAny(t),e<0&&(e=Math.max(0,this.length+e));var r=this.forEach(function(r,n){return n>=e&&t.equals(r)?n:void 0},this);return void 0!==r?r:-1},e.prototype.lastIndexOf=function(t,e){t=Xt.fromAny(t);var r=this.length;for(void 0===e?e=r-1:e<0&&(e=r+e),e=Math.min(e,r-1);e>=0;){if(t.equals(this.getItem(e)))return e;e-=1}return-1},e.prototype.get=function(t){return t=ne.fromAny(t),this.forEach(function(e){return e instanceof Xt.Field&&e.key.equals(t)?e.value:void 0},this)||ne.absent()},e.prototype.getAttr=function(t){return t=ne.Text.fromAny(t),this.forEach(function(e){return e instanceof Xt.Attr&&e.key.equals(t)?e.value:void 0},this)||ne.absent()},e.prototype.getSlot=function(t){return t=ne.fromAny(t),this.forEach(function(e){return e instanceof Xt.Slot&&e.key.equals(t)?e.value:void 0},this)||ne.absent()},e.prototype.getField=function(t){return t=ne.fromAny(t),this.forEach(function(e){return e instanceof Xt.Field&&e.key.equals(t)?e:void 0},this)},e.prototype.set=function(t,e){t=ne.fromAny(t),e=ne.fromAny(e);for(var r=this.iterator();!r.isEmpty();){var n=r.head();if(n instanceof Xt.Field&&n.key.equals(t))return n.isMutable()?n.setValue(e):r.set(n.updatedValue(e)),this;r.step()}return this.push(new Xt.Slot(t,e)),this},e.prototype.setAttr=function(t,e){t=ne.Text.fromAny(t),e=ne.fromAny(e);for(var r=this.iterator();!r.isEmpty();){var n=r.head();if(n instanceof Xt.Field&&n.key.equals(t))return n instanceof Xt.Attr&&n.isMutable()?n.setValue(e):r.set(new Xt.Attr(t,e)),this;r.step()}return this.push(new Xt.Attr(t,e)),this},e.prototype.setSlot=function(t,e){t=ne.fromAny(t),e=ne.fromAny(e);for(var r=this.iterator();!r.isEmpty();){var n=r.head();if(n instanceof Xt.Field&&n.key.equals(t))return n instanceof Xt.Slot&&n.isMutable()?n.setValue(e):r.set(new Xt.Slot(t,e)),this;r.step()}return this.push(new Xt.Slot(t,e)),this},e.prototype.updated=function(t,e){t=ne.fromAny(t),e=ne.fromAny(e);for(var r=this.isMutable()?this:this.branch(),n=r.iterator();!n.isEmpty();){var i=n.head();if(i.key.equals(t))return i instanceof Xt.Field&&i.isMutable()?i.setValue(e):n.set(new Xt.Slot(t,e)),r;n.step()}return r.push(new Xt.Slot(t,e)),r},e.prototype.updatedAttr=function(t,e){t=ne.Text.fromAny(t),e=ne.fromAny(e);for(var r=this.isMutable()?this:this.branch(),n=r.iterator();!n.isEmpty();){var i=n.head();if(i.key.equals(t))return i instanceof Xt.Attr&&i.isMutable()?i.setValue(e):n.set(new Xt.Attr(t,e)),r;n.step()}return r.push(new Xt.Attr(t,e)),r},e.prototype.updatedSlot=function(t,e){t=ne.fromAny(t),e=ne.fromAny(e);for(var r=this.isMutable()?this:this.branch(),n=r.iterator();!n.isEmpty();){var i=n.head();if(i.key.equals(t))return i instanceof Xt.Slot&&i.isMutable()?i.setValue(e):n.set(new Xt.Slot(t,e)),r;n.step()}return r.push(new Xt.Slot(t,e)),r},e.prototype.appended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.isMutable()?this:this.branch();return r.push.apply(r,arguments),r},e.prototype.prepended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.isMutable()?this:this.branch();return r.splice.apply(r,Array.prototype.concat.apply([0,0],arguments)),r},e.prototype.deleted=function(t){var e=this.isMutable()?this:this.branch();return e.delete(t),e},e.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.isMutable()?this:this.branch(),n=0,i=arguments.length;n<i;n+=1)Xt.fromAny(arguments[n]).forEach(function(t){r.push(t)});return r},e.prototype.slice=function(t,e){return this.subRecord.apply(this,arguments).branch()},e.prototype.attr=function(t,e){return this.push(Xt.Attr.of.apply(void 0,arguments)),this},e.prototype.slot=function(t,e){return this.push(Xt.Slot.of.apply(void 0,arguments)),this},e.prototype.item=function(t){return this.push(t),this},e.prototype.items=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.push.apply(this,arguments),this},e.prototype.evaluate=function(t){t=Jt.fromAny(t);var r=e.create();t.pushScope(r);var n=!1;return this.forEach(function(e){var i=e.evaluate(t);i.isDefined()&&r.push(i),e!==i&&(n=!0)},this),t.popScope(),n?r:this},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=e.create();t.pushScope(r);var n=!1;return this.forEach(function(e){var i=e.substitute(t);i.isDefined()&&r.push(i),e!==i&&(n=!0)},this),t.popScope(),n?r:this},e.prototype.stringValue=function(t){var e="";return void 0===this.forEach(function(t){if(t instanceof ne){var r=t.stringValue();if(void 0!==r)return void(e+=r)}return null},this)?e:void 0},e.prototype.toAny=function(){return!this.isEmpty()&&this.isArray()?this.toArray():this.toObject()},e.prototype.toArray=function(){var t=new Array(this.length);return this.forEach(function(e,r){e instanceof ne?t[r]=e.toAny():e instanceof Xt.Field&&(t[r]={$key:e.key.toAny(),$value:e.value.toAny()})},this),t},e.prototype.toObject=function(){var t={};return this.forEach(function(e,r){e instanceof Xt.Attr?t["@"+e.key.value]=e.value.toAny():e instanceof Xt.Slot?e.key instanceof ne.Text?t[e.key.value]=e.value.toAny():t["$"+r]={$key:e.key.toAny(),$value:e.value.toAny()}:e instanceof ne&&(t["$"+r]=e.toAny())},this),t},e.prototype.isAliased=function(){return!1},e.prototype.isMutable=function(){return!0},e.prototype.alias=function(){},e.prototype.branch=function(){var t=e.create();return this.forEach(function(e){t.push(e)},this),t},e.prototype.clone=function(){var t=e.create();return this.forEach(function(e){t.push(e.clone())},this),t},e.prototype.commit=function(){return this},e.prototype.bind=function(){return this},e.prototype.subRecord=function(t,e){var r=this.length;void 0===t?t=0:t<0&&(t=r+t),t=Math.min(Math.max(0,t),r),void 0===e?e=r:e<0&&(e=r+e);var n=ne.Record.create();return this.forEach(function(r,i){return i<t?void 0:i<e?void n.push(r):null},this),n},e.prototype.iterator=function(){return new ie(this)},e.prototype.typeOrder=function(){return 3},e.prototype.compareTo=function(t){if(t instanceof e){var r=this.iterator(),n=t.iterator(),i=0;do{if(r.isEmpty()||n.isEmpty())break;i=r.head().compareTo(n.head()),r.step(),n.step()}while(0===i);return 0!==i?i:r.isEmpty()&&!n.isEmpty()?-1:!r.isEmpty()&&n.isEmpty()?1:0}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){if(this===t)return!0;if(t instanceof e){for(var r=this.iterator(),n=t.iterator();!r.isEmpty()&&!n.isEmpty();){if(!r.head().equals(n.head()))return!1;r.step(),n.step()}return r.isEmpty()&&n.isEmpty()}return!1},e.prototype.hashCode=function(){if(void 0===this._hashCode){void 0===e._hashSeed&&(e._hashSeed=f.seed(e));var t=e._hashSeed;this.forEach(function(e){t=f.mix(t,e.hashCode())},this),this._hashCode=f.mash(t)}return this._hashCode},e.prototype.debug=function(t){t=t.write("Record").write(46),this.isEmpty()?t=t.write("empty").write(40).write(41):(t=t.write("of").write(40),this.forEach(function(e,r){0!==r&&(t=t.write(44).write(32)),t.display(e)},this),t=t.write(41))},e.prototype.display=function(t){this.debug(t)},e.empty=function(){return e.RecordMap.empty()},e.create=function(t){return e.RecordMap.create(t)},e.of=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.RecordMap.of.apply(void 0,arguments)},e.fromAny=function(t){if(t instanceof e)return t;if(Array.isArray(t))return e.fromArray(t);if(t&&"object"==typeof t)return e.fromObject(t);throw new TypeError(""+t)},e.fromArray=function(t){for(var r=t.length||0,n=e.create(r),i=0;i<r;i+=1)n.push(Xt.fromAny(t[i]));return n},e.fromObject=function(t){var r=e.create();for(var n in t){var i=t[n];36===n.charCodeAt(0)?i&&"object"==typeof i&&i.hasOwnProperty("$key")?r.push(Xt.Field.of(i.$key,i.$value)):r.push(ne.fromAny(i)):r.push(Xt.Field.of(n,i))}return r},e.expand=function(t){return t=Math.max(8,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},e.ALIASED=1,e.IMMUTABLE=2,e}(ne);Xt.Record=oe;var se=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._array=e,s._table=r,s._itemCount=n,s._fieldCount=i,s._flags=o,s}return y(e,t),e.prototype.isEmpty=function(){return 0===this._itemCount},Object.defineProperty(e.prototype,"length",{get:function(){return this._itemCount},enumerable:!0,configurable:!0}),e.prototype.fieldCount=function(){return this._fieldCount},e.prototype.valueCount=function(){return this._itemCount-this._fieldCount},e.prototype.isConstant=function(){for(var t=this._array,e=0,r=this._itemCount;e<r;e+=1)if(!t[e].isConstant())return!1;return!0},e.prototype.tag=function(){if(this._fieldCount>0){var t=this._array[0];if(t instanceof Xt.Attr)return t.key.value}},e.prototype.target=function(){for(var t,e,r=!1,n=this._array,i=0,o=this._itemCount;i<o;i+=1){var s=n[i];s instanceof Xt.Attr?r=!0:void 0===t&&s instanceof ne?t=s:(void 0===e&&(e=oe.create(),void 0!==t&&e.push(t)),e.push(s))}return void 0===t?ne.extant():void 0===e?t:r?e:this},e.prototype.head=function(){return this._itemCount>0?this._array[0]:Xt.absent()},e.prototype.tail=function(){var t=this._itemCount;return t>0?new oe.RecordMapView(this,1,t):oe.empty()},e.prototype.body=function(){var t=this._itemCount;if(t>2)return new oe.RecordMapView(this,1,t).branch();if(2===t){var e=this._array[1];return e instanceof ne?e:oe.of(e)}return ne.absent()},e.prototype.has=function(t){if(0!==this._fieldCount){t=ne.fromAny(t);var e=this.hashTable(),r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o.key.equals(t))return!0;i=(i+1)%r}while(i!==n)}return!1},e.prototype.indexOf=function(t,e){void 0===e&&(e=0),t=Xt.fromAny(t);var r=this._array,n=this._itemCount;for(e<0&&(e=Math.max(0,n+e));e<n;){if(t.equals(r[e]))return e;e+=1}return-1},e.prototype.lastIndexOf=function(t,e){t=Xt.fromAny(t);var r=this._array,n=this._itemCount;for(void 0===e?e=n-1:e<0&&(e=n+e),e=Math.min(e,n-1);e>=0;){if(t.equals(r[e]))return e;e-=1}return-1},e.prototype.get=function(t){if(this._fieldCount>0){t=ne.fromAny(t);var e=this.hashTable(),r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o.key.equals(t))return o.value;i=(i+1)%r}while(i!==n)}return ne.absent()},e.prototype.getAttr=function(t){if(this._fieldCount>0){t=ne.Text.fromAny(t);var e=this.hashTable(),r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o instanceof Xt.Attr&&o.key.equals(t))return o.value;i=(i+1)%r}while(i!==n)}return ne.absent()},e.prototype.getSlot=function(t){if(this._fieldCount>0){t=ne.fromAny(t);var e=this.hashTable(),r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o instanceof Xt.Slot&&o.key.equals(t))return o.value;i=(i+1)%r}while(i!==n)}return ne.absent()},e.prototype.getField=function(t){if(this._fieldCount>0){t=ne.fromAny(t);var e=this.hashTable(),r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o.key.equals(t))return o;i=(i+1)%r}while(i!==n)}},e.prototype.getItem=function(t){t instanceof Xt.Num&&(t=t.value);var e=this._itemCount;return t<0&&(t=e+t),t>=0&&t<e?this._array[t]:Xt.absent()},e.prototype.set=function(t,e){if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");return t=ne.fromAny(t),e=ne.fromAny(e),0!=(this._flags&oe.ALIASED)?this._fieldCount>0?this.setAliased(t,e):this.pushAliased(new Xt.Slot(t,e)):this._fieldCount>0?null!==this._table?this.setMutable(t,e):this.updateMutable(t,e):this.pushMutable(new Xt.Slot(t,e)),this},e.prototype.setAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(oe.expand(r+1)),o=0;o<r;o+=1){var s=n[o];if(s instanceof Xt.Field&&s.key.equals(t)){for(i[o]=s.updatedValue(e),o+=1;o<r;)i[o]=n[o],o+=1;return this._array=i,this._table=null,void(this._flags&=~oe.ALIASED)}i[o]=s}i[r]=new Xt.Slot(t,e),this._array=i,this._table=null,this._itemCount=r+1,this._fieldCount+=1,this._flags&=~oe.ALIASED},e.prototype.setMutable=function(t,r){var n=this._table,i=n.length,o=Math.abs(t.hashCode()%i),s=o;do{var u=n[s];if(void 0===u)break;if(u.key.equals(t))return u.isMutable()?void u.setValue(r):void this.updateMutable(t,r);s=(s+1)%i}while(s!==o);var a=new Xt.Slot(t,r);this.pushMutable(a),e.put(n,a)},e.prototype.updateMutable=function(t,r){for(var n=this._array,i=0,o=this._itemCount;i<o;i+=1){var s=n[i];if(s instanceof Xt.Field&&s.key.equals(t))return n[i]=s.updatedValue(r),void(this._table=null)}var u=new Xt.Slot(t,r);this.pushMutable(u),e.put(this._table,u)},e.prototype.setAttr=function(t,e){if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");return t=ne.Text.fromAny(t),e=ne.fromAny(e),0!=(this._flags&oe.ALIASED)?this._fieldCount>0?this.setAttrAliased(t,e):this.pushAliased(new Xt.Attr(t,e)):this._fieldCount>0?null!==this._table?this.setAttrMutable(t,e):this.updateAttrMutable(t,e):this.pushMutable(new Xt.Attr(t,e)),this},e.prototype.setAttrAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(oe.expand(r+1)),o=0;o<r;o+=1){var s=n[o];if(s instanceof Xt.Field&&s.key.equals(t)){for(i[o]=new Xt.Attr(t,e),o+=1;o<r;)i[o]=n[o],o+=1;return this._array=i,this._table=null,void(this._flags&=~oe.ALIASED)}i[o]=s}i[r]=new Xt.Attr(t,e),this._array=i,this._table=null,this._itemCount=r+1,this._fieldCount+=1,this._flags&=~oe.ALIASED},e.prototype.setAttrMutable=function(t,r){var n=this._table,i=n.length,o=Math.abs(t.hashCode()%i),s=o;do{var u=n[s];if(void 0===u)break;if(u.key.equals(t))return void(u instanceof Xt.Attr&&u.isMutable()?u.setValue(r):this.updateAttrMutable(t,r));s=(s+1)%i}while(s!==o);var a=new Xt.Attr(t,r);this.push(a),e.put(n,a)},e.prototype.updateAttrMutable=function(t,r){for(var n=this._array,i=0,o=this._itemCount;i<o;i+=1){var s=n[i];if(s instanceof Xt.Field&&s.key.equals(t))return n[i]=new Xt.Attr(t,r),void(this._table=null)}var u=new Xt.Attr(t,r);this.push(u),e.put(this._table,u)},e.prototype.setSlot=function(t,e){if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");return t=ne.fromAny(t),e=ne.fromAny(e),0!=(this._flags&oe.ALIASED)?this._fieldCount>0?this.setSlotAliased(t,e):this.pushAliased(new Xt.Slot(t,e)):this._fieldCount>0?null!==this._table?this.setSlotMutable(t,e):this.updateSlotMutable(t,e):this.pushMutable(new Xt.Slot(t,e)),this},e.prototype.setSlotAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(oe.expand(r+1)),o=0;o<r;o+=1){var s=n[o];if(s instanceof Xt.Field&&s.key.equals(t)){for(i[o]=new Xt.Slot(t,e),o+=1;o<r;)i[o]=n[o],o+=1;return this._array=i,this._table=null,void(this._flags&=~oe.ALIASED)}i[o]=s}i[r]=new Xt.Slot(t,e),this._array=i,this._table=null,this._itemCount=r+1,this._fieldCount+=1,this._flags&=~oe.ALIASED},e.prototype.setSlotMutable=function(t,r){var n=this._table,i=n.length,o=Math.abs(t.hashCode()%i),s=o;do{var u=n[s];if(void 0===u)break;if(u.key.equals(t))return void(u instanceof Xt.Slot&&u.isMutable()?u.setValue(r):this.updateSlotMutable(t,r));s=(s+1)%i}while(s!==o);var a=new Xt.Slot(t,r);this.push(a),e.put(n,a)},e.prototype.updateSlotMutable=function(t,r){for(var n=this._array,i=0,o=this._itemCount;i<o;i+=1){var s=n[i];if(s instanceof Xt.Field&&s.key.equals(t))return n[i]=new Xt.Slot(t,r),void(this._table=null)}var u=new Xt.Slot(t,r);this.push(u),e.put(this._table,u)},e.prototype.setItem=function(t,e){if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");e=Xt.fromAny(e);var r=this._itemCount;if(t<0&&(t=r+t),t<0||t>r)throw new RangeError(""+t);return 0!=(this._flags&oe.ALIASED)?this.setItemAliased(t,e):this.setItemMutable(t,e),this},e.prototype.setItemAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(oe.expand(r)),o=0;o<r;o+=1)i[o]=n[o];var s=n[t];i[t]=e,this._array=i,this._table=null,e instanceof Xt.Field?s instanceof Xt.Field||(this._fieldCount+=1):s instanceof Xt.Field&&(this._fieldCount-=1),this._flags&=~oe.ALIASED},e.prototype.setItemMutable=function(t,e){var r=this._array,n=r[t];r[t]=e,e instanceof Xt.Field?(this._table=null,n instanceof Xt.Field||(this._fieldCount+=1)):n instanceof Xt.Field&&(this._table=null,this._fieldCount-=1)},e.prototype.updated=function(t,e){t=ne.fromAny(t),e=ne.fromAny(e);var r=0==(this._flags&oe.IMMUTABLE)?this:this.branch();return 0!=(r._flags&oe.ALIASED)?r._fieldCount>0?r.setAliased(t,e):r.pushAliased(new Xt.Slot(t,e)):r._fieldCount>0?null!==r._table?r.setMutable(t,e):r.updateMutable(t,e):r.pushMutable(new Xt.Slot(t,e)),r},e.prototype.updatedAttr=function(t,e){t=ne.Text.fromAny(t),e=ne.fromAny(e);var r=0==(this._flags&oe.IMMUTABLE)?this:this.branch();return 0!=(r._flags&oe.ALIASED)?r._fieldCount>0?r.setAttrAliased(t,e):r.pushAliased(new Xt.Attr(t,e)):r._fieldCount>0?null!==r._table?r.setAttrMutable(t,e):r.updateAttrMutable(t,e):r.pushMutable(new Xt.Attr(t,e)),r},e.prototype.updatedSlot=function(t,e){t=ne.fromAny(t),e=ne.fromAny(e);var r=0==(this._flags&oe.IMMUTABLE)?this:this.branch();return 0!=(r._flags&oe.ALIASED)?r._fieldCount>0?r.setSlotAliased(t,e):r.pushAliased(new Xt.Slot(t,e)):r._fieldCount>0?null!==r._table?r.setSlotMutable(t,e):r.updateSlotMutable(t,e):r.pushMutable(new Xt.Slot(t,e)),r},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");return 0!=(this._flags&oe.ALIASED)?this.pushAliased.apply(this,arguments):this.pushMutable.apply(this,arguments),this._itemCount},e.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=arguments.length,n=this._itemCount,i=this._fieldCount,o=this._array,s=new Array(oe.expand(n+r));if(null!==o)for(var u=0;u<n;u+=1)s[u]=o[u];for(u=0;u<r;u+=1){var a=Xt.fromAny(arguments[u]);s[n]=a,n+=1,a instanceof Xt.Field&&(i+=1)}this._array=s,this._table=null,this._itemCount=n,this._fieldCount=i,this._flags&=~oe.ALIASED},e.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,n=arguments.length,i=this._itemCount,o=this._fieldCount,s=this._array;if(null===s||i+n>s.length){if(r=new Array(oe.expand(i+n)),null!==s)for(var u=0;u<i;u+=1)r[u]=s[u]}else r=s;for(u=0;u<n;u+=1){var a=Xt.fromAny(arguments[u]);r[i]=a,i+=1,a instanceof Xt.Field&&(o+=1,this._table=null)}this._array=r,this._itemCount=i,this._fieldCount=o},e.prototype.splice=function(t,e){void 0===e&&(e=0);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");var i=this._itemCount;return t<0&&(t=i+t),t=Math.min(Math.max(0,t),i),e=Math.min(Math.max(0,e),i-t),0!=(this._flags&oe.ALIASED)?this.spliceAliased.apply(this,arguments):this.spliceMutable.apply(this,arguments)},e.prototype.spliceAliased=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var i=r.length,o=this._itemCount,s=this._fieldCount,u=this._array,a=new Array(oe.expand(o-e+i)),p=0;p<t;p+=1)a[p]=u[p];var h=[];for(p=t;p<t+e;p+=1){var f=u[p];h.push(f),o-=1,f instanceof Xt.Field&&(s-=1)}for(p=t;p<o;p+=1)a[p+i]=u[p+e];for(p=0;p<i;p+=1){var c=Xt.fromAny(r[p]);a[p+t]=c,o+=1,c instanceof Xt.Field&&(s+=1)}return this._array=a,this._table=null,this._itemCount=o,this._fieldCount=s,this._flags&=~oe.ALIASED,h},e.prototype.spliceMutable=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i,o=r.length,s=this._itemCount,u=this._fieldCount,a=this._array;if(null===a||s-e+o>a.length){if(i=new Array(oe.expand(s-e+o)),null!==a)for(var p=0;p<t;p+=1)i[p]=a[p]}else i=a;var h=[];for(p=t;p<t+e;p+=1){var f=a[p];h.push(f),s-=1,f instanceof Xt.Field&&(u-=1)}if(o>e)for(p=s-1;p>=t;p-=1)i[p+o]=a[p+e];else for(p=t;p<s;p+=1)i[p+o]=a[p+e];for(p=0;p<o;p+=1){var c=Xt.fromAny(r[p]);i[p+t]=c,s+=1,c instanceof Xt.Field&&(u+=1)}return this._array=i,this._itemCount=s,this._fieldCount=u,h},e.prototype.delete=function(t){if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");return t=ne.fromAny(t),0!=(this._flags&oe.ALIASED)?this.deleteAliased(t):this.deleteMutable(t)},e.prototype.deleteAliased=function(t){for(var e=this._itemCount,r=this._array,n=new Array(oe.expand(e)),i=0;i<e;i+=1){var o=r[i];if(o instanceof Xt.Field&&o.key.equals(t)){for(var s=i+1;s<e;s+=1,i+=1)n[i]=r[s];return this._array=n,this._table=null,this._itemCount=e-1,this._fieldCount-=1,this._flags&=~oe.ALIASED,o}n[i]=o}return Xt.absent()},e.prototype.deleteMutable=function(t){for(var e=this._itemCount,r=this._array,n=0;n<e;n+=1){var i=r[n];if(i instanceof Xt.Field&&i.key.equals(t)){for(var o=n+1;o<e;o+=1,n+=1)r[n]=r[o];return r[e-1]=void 0,this._table=null,this._itemCount=e-1,this._fieldCount-=1,i}}return Xt.absent()},e.prototype.clear=function(){if(0!=(this._flags&oe.IMMUTABLE))throw new Error("immutable");this._array=null,this._table=null,this._itemCount=0,this._fieldCount=0,this._flags=0},e.prototype.isAliased=function(){return 0!=(this._flags&oe.ALIASED)},e.prototype.isMutable=function(){return 0==(this._flags&oe.IMMUTABLE)},e.prototype.alias=function(){this._flags|=oe.ALIASED},e.prototype.branch=function(){if(0==(this._flags&(oe.ALIASED|oe.IMMUTABLE)))for(var t=this._array,r=0,n=this._itemCount;r<n;r+=1)t[r].alias();return this._flags|=oe.ALIASED,new e(this._array,this._table,this._itemCount,this._fieldCount,oe.ALIASED)},e.prototype.clone=function(){for(var t=this._itemCount,r=this._array,n=new Array(t),i=0;i<t;i+=1)n[i]=r[i].clone();return new e(n,null,t,this._fieldCount,0)},e.prototype.commit=function(){if(0==(this._flags&oe.IMMUTABLE)){this._flags|=oe.IMMUTABLE;for(var t=this._array,e=0,r=this._itemCount;e<r;e+=1)t[e].commit()}return this},e.prototype.hashTable=function(){var t=this._fieldCount,r=this._table;if(0!==t&&null===this._table){r=new Array(oe.expand(Math.max(t,10*t/7)));for(var n=this._array,i=0,o=this._itemCount;i<o;i+=1){var s=n[i];s instanceof Xt.Field&&e.put(r,s)}this._table=r}return r},e.put=function(t,e){if(null!==t){var r=t.length,n=Math.abs(e.key.hashCode()%r),i=n;do{var o=t[i];if(void 0===o)return void(t[i]=e);if(e.key.equals(o.key))return void(t[i]=e);i=(i+1)%r}while(i!==n);throw new Error}},e.prototype.evaluate=function(t){t=Jt.fromAny(t);var e=this._array,r=this._itemCount,n=oe.create(r);t.pushScope(n);for(var i=!1,o=0;o<r;o+=1){var s=e[o],u=s.evaluate(t);u.isDefined()&&n.push(u),s!==u&&(i=!0)}return t.popScope(),i?n:this},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._array,r=this._itemCount,n=oe.create(r);t.pushScope(n);for(var i=!1,o=0;o<r;o+=1){var s=e[o],u=s.substitute(t);u.isDefined()&&n.push(u),s!==u&&(i=!0)}return t.popScope(),i?n:this},e.prototype.subRecord=function(t,e){var r=this._itemCount;if(void 0===t?t=0:t<0&&(t=r+t),void 0===e?e=r:e<0&&(e=r+e),t<0||e>r||t>e)throw new RangeError(t+", "+e);return new oe.RecordMapView(this,t,e)},e.prototype.forEach=function(t,e){for(var r=this._array,n=0,i=this._itemCount;n<i;n+=1){var o=t.call(e,r[n],n);if(void 0!==o)return o}},e.empty=function(){return e._empty||(e._empty=new e(null,null,0,0,oe.ALIASED|oe.IMMUTABLE)),e._empty},e.create=function(t){return void 0===t?new e(null,null,0,0,oe.ALIASED):new e(new Array(t),null,0,0,0)},e.of=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=arguments.length;if(0===n)return new e(null,null,0,0,oe.ALIASED);for(var i=new Array(n),o=0,s=0,u=0;u<n;u+=1){var a=Xt.fromAny(arguments[u]);i[u]=a,o+=1,a instanceof Xt.Field&&(s+=1)}return new e(i,null,o,s,0)},e}(oe);Xt.RecordMap=se;var ue=function(t){function e(e,r,n){var i=t.call(this)||this;return i._record=e,i._lower=r,i._upper=n,i}return y(e,t),e.prototype.isEmpty=function(){return this._lower===this._upper},e.prototype.isArray=function(){for(var t=this._record._array,e=this._lower,r=this._upper;e<r;e+=1)if(t[e]instanceof Xt.Field)return!1;return!0},e.prototype.isObject=function(){for(var t=this._record._array,e=this._lower,r=this._upper;e<r;e+=1)if(t[e]instanceof ne)return!1;return!0},Object.defineProperty(e.prototype,"length",{get:function(){return this._upper-this._lower},enumerable:!0,configurable:!0}),e.prototype.fieldCount=function(){for(var t=this._record._array,e=0,r=this._lower,n=this._upper;r<n;r+=1)t[r]instanceof Xt.Field&&(e+=1);return e},e.prototype.valueCount=function(){for(var t=0,e=this._record._array,r=this._lower,n=this._upper;r<n;r+=1)e[r]instanceof ne&&(t+=1);return t},e.prototype.isConstant=function(){for(var t=this._record._array,e=this._lower,r=this._upper;e<r;e+=1)if(!t[e].isConstant())return!1;return!0},e.prototype.tag=function(){if(this.length>0){var t=this._record._array[this._lower];if(t instanceof Xt.Attr)return t.key.value}},e.prototype.target=function(){for(var t,e,r=!1,n=this._record._array,i=this._lower,o=this._upper;i<o;i+=1){var s=n[i];s instanceof Xt.Attr?r=!0:void 0===t&&s instanceof ne?t=s:(void 0===e&&(e=oe.create(),void 0!==t&&e.push(t)),e.push(s))}return void 0===t?ne.extant():void 0===e?t:r?e:this},e.prototype.head=function(){return this.length>0?this._record._array[this._lower]:Xt.absent()},e.prototype.tail=function(){return this.length>0?new e(this._record,this._lower+1,this._upper):oe.empty()},e.prototype.body=function(){var t=this.length;if(t>2)return new e(this._record,this._lower+1,this._upper).branch();if(2===t){var r=this._record._array[this._lower+1];return r instanceof ne?r:oe.of(r)}return ne.absent()},e.prototype.indexOf=function(t,e){void 0===e&&(e=0),t=Xt.fromAny(t);var r=this._record._array,n=this.length;for(e<0&&(e=Math.max(0,n+e)),e=this._lower+e;e<this._upper;){if(t.equals(r[e]))return e-this._lower;e+=1}return-1},e.prototype.lastIndexOf=function(t,e){t=Xt.fromAny(t);var r=this._record._array,n=this.length;for(void 0===e?e=n-1:e<0&&(e=n+e),e=this._lower+Math.min(e,n-1);e>=this._lower;){if(t.equals(r[e]))return e-this._lower;e-=1}return-1},e.prototype.getItem=function(t){t instanceof Xt.Num&&(t=t.value);var e=this.length;return t<0&&(t=e+t),t>=0&&t<e?this._record._array[this._lower+t]:Xt.absent()},e.prototype.setItem=function(t,e){if(0!=(this._record._flags&oe.IMMUTABLE))throw new Error("immutable");e=Xt.fromAny(e);var r=this.length;if(t<0&&(t=r+t),t<0||t>r)throw new RangeError(""+t);return 0!=(this._record._flags&oe.ALIASED)?this.setItemAliased(t,e):this.setItemMutable(t,e),this},e.prototype.setItemAliased=function(t,e){for(var r=this._record._itemCount,n=this._record._array,i=new Array(oe.expand(r)),o=0;o<r;o+=1)i[o]=n[o];var s=n[this._lower+t];i[this._lower+t]=e,this._record._array=i,this._record._table=null,e instanceof Xt.Field?s instanceof Xt.Field||(this._record._fieldCount+=1):s instanceof Xt.Field&&(this._record._fieldCount-=1),this._record._flags&=~oe.ALIASED},e.prototype.setItemMutable=function(t,e){var r=this._record._array,n=r[this._lower+t];r[this._lower+t]=e,e instanceof Xt.Field?(this._record._table=null,n instanceof Xt.Field||(this._record._fieldCount+=1)):n instanceof Xt.Field&&(this._record._table=null,this._record._fieldCount-=1)},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._record._flags&oe.IMMUTABLE))throw new Error("immutable");return 0!=(this._record._flags&oe.ALIASED)?this.pushAliased.apply(this,arguments):this.pushMutable.apply(this,arguments),this.length},e.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.length,n=this._record._itemCount,i=this._record._fieldCount,o=this._record._array,s=new Array(oe.expand(n+r));if(null!==o){for(var u=0;u<this._upper;u+=1)s[u]=o[u];for(u=this._upper;u<n;u+=1)s[u+r]=o[u]}for(u=0;u<r;u+=1){var a=Xt.fromAny(t[u]);s[u+this._upper]=a,n+=1,a instanceof Xt.Field&&(i+=1)}this._record._array=s,this._record._table=null,this._record._itemCount=n,this._record._fieldCount=i,this._record._flags&=~oe.ALIASED,this._upper+=r},e.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,n=t.length,i=this._record._itemCount,o=this._record._fieldCount,s=this._record._array;if(null===s||i+n>s.length){if(r=new Array(oe.expand(i+n)),null!==s)for(var u=0;u<this._upper;u+=1)r[u]=s[u]}else r=s;for(u=i-1;u>=this._upper;u-=1)r[u+n]=s[u];for(u=0;u<n;u+=1){var a=Xt.fromAny(t[u]);r[u+this._upper]=a,i+=1,a instanceof Xt.Field&&(o+=1,this._record._table=null)}this._record._array=r,this._record._itemCount=i,this._record._fieldCount=o,this._upper+=n},e.prototype.splice=function(t,e){void 0===e&&(e=0);for(var r,n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(0!=(this._record._flags&oe.IMMUTABLE))throw new Error("immutable");var s,u=this.length;return t<0&&(t=u+t),t=Math.min(Math.max(0,t),u),e=Math.min(Math.max(0,e),u-t),s=0!=(this._record._flags&oe.ALIASED)?(r=this._record).spliceAliased.apply(r,[this._lower+t,e].concat(i)):(n=this._record).spliceMutable.apply(n,[this._lower+t,e].concat(i)),this._upper+=i.length-s.length,s},e.prototype.delete=function(t){if(0!=(this._record._flags&oe.IMMUTABLE))throw new Error("immutable");return t=ne.fromAny(t),0!=(this._record._flags&oe.ALIASED)?this.deleteAliased(t):this.deleteMutable(t)},e.prototype.deleteAliased=function(t){for(var e=this._record._itemCount,r=this._record._array,n=new Array(oe.expand(e)),i=this._lower;i<this._upper;i+=1){var o=r[i];if(o instanceof Xt.Field&&o.key.equals(t)){for(var s=i+1;s<e;s+=1,i+=1)n[i]=r[s];return this._record._array=n,this._record._table=null,this._record._itemCount=e-1,this._record._fieldCount-=1,this._record._flags&=~oe.ALIASED,this._upper-=1,o}n[i]=o}return Xt.absent()},e.prototype.deleteMutable=function(t){for(var e=this._record._itemCount,r=this._record._array,n=this._lower;n<this._upper;n+=1){var i=r[n];if(i instanceof Xt.Field&&i.key.equals(t)){for(var o=n+1;o<e;o+=1,n+=1)r[n]=r[o];return r[e-1]=void 0,this._record._table=null,this._record._itemCount-=1,this._record._fieldCount-=1,this._upper-=1,i}}return Xt.absent()},e.prototype.clear=function(){if(0!=(this._record._flags&oe.IMMUTABLE))throw new Error("immutable");0!=(this._record._flags&oe.ALIASED)?this.clearAliased():this.clearMutable()},e.prototype.clearAliased=function(){for(var t=this._record._itemCount,e=this._record._fieldCount,r=t-this.length,n=this._record._array,i=new Array(oe.expand(r)),o=0;o<this._lower;)i[o]=n[o],o+=1;for(;o<this._upper;)n[o]instanceof Xt.Field&&(e-=1),o+=1;o=this._lower;for(var s=this._upper;s<t;)i[o]=n[s],o+=1,s+=1;this._record._array=i,this._record._table=null,this._record._itemCount=r,this._record._fieldCount=e,this._record._flags&=~oe.ALIASED,this._upper=this._lower},e.prototype.clearMutable=function(){for(var t=this._record._itemCount,e=this._record._fieldCount,r=this._record._array,n=this._lower;n<this._upper;)r[n]instanceof Xt.Field&&(e-=1),n+=1;n=this._lower;for(var i=this._upper;i<t;){var o=r[i];o instanceof Xt.Field&&(this._record._table=null),r[n]=o,n+=1,i+=1}for(this._record._itemCount=n,this._record._fieldCount=e;n<t;)r[n]=void 0,n+=1;this._upper=this._lower},e.prototype.isAliased=function(){return 0!=(this._record._flags&oe.ALIASED)},e.prototype.isMutable=function(){return 0==(this._record._flags&oe.IMMUTABLE)},e.prototype.alias=function(){this._record._flags|=oe.ALIASED},e.prototype.branch=function(){for(var t=this.length,e=0,r=this._record._array,n=new Array(oe.expand(t)),i=this._lower,o=0;o<t;){var s=r[i];n[o]=s,s instanceof Xt.Field&&(e+=1),i+=1,o+=1}return new se(n,null,t,e,0)},e.prototype.clone=function(){for(var t=this.length,e=0,r=this._record._array,n=new Array(oe.expand(t)),i=this._lower,o=0;o<t;){var s=r[i];n[o]=s.clone(),s instanceof Xt.Field&&(e+=1),i+=1,o+=1}return new se(n,null,t,e,0)},e.prototype.commit=function(){return this._record.commit(),this},e.prototype.subRecord=function(t,r){var n=this.length;if(void 0===t?t=0:t<0&&(t=n+t),void 0===r?r=n:r<0&&(r=n+r),t<0||r>n||t>r)throw new RangeError(t+", "+r);return new e(this._record,this._lower+t,this._upper+r)},e.prototype.forEach=function(t,e){for(var r=this._record._array,n=this._lower,i=this._upper;n<i;n+=1){var o=t.call(e,r[n],n);if(void 0!==o)return o}},e}(oe);Xt.RecordMapView=ue;var ae=function(t){function e(e,r){var n=t.call(this)||this;return n._data=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!0},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.write=function(t){if("number"==typeof t)return this._data.addByte(t),this;throw new TypeError(""+t)},e.prototype.writeln=function(t){throw new TypeError(""+t)},e.prototype.settings=function(t){return void 0===t?this._settings:(this._settings=M.fromAny(t),this)},e.prototype.bind=function(){return this._data},e.prototype.clone=function(){return new e(this._data.branch(),this._settings)},e}(P),pe=function(t){function e(e,r,n){var i=t.call(this)||this;return i._array=e,i._size=r,i._flags=n,i}return y(e,t),e.prototype.isConstant=function(){return!0},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.getByte=function(t){if(t<0||t>=this.size)throw new RangeError(""+t);return this._array[t]},e.prototype.setByte=function(t,r){var n=this._flags;if(0!=(n&e.IMMUTABLE))throw new Error("immutable");if(t<0||t>=this._size)throw new RangeError(""+t);return 0!=(n&e.ALIASED)?this.setByteAliased(t,r):this.setByteMutable(t,r)},e.prototype.setByteAliased=function(t,r){var n=this.size,i=this._array,o=new Uint8Array(e.expand(n));return o.set(i,0),o[t]=r,this._array=o,this._flags&=~e.ALIASED,this},e.prototype.setByteMutable=function(t,e){return this._array[t]=e,this},e.prototype.addByte=function(t){var r=this._flags;if(0!=(r&e.IMMUTABLE))throw new Error("immutable");return 0!=(r&e.ALIASED)?this.addByteAliased(t):this.addByteMutable(t)},e.prototype.addByteAliased=function(t){var r=this.size,n=this._array,i=new Uint8Array(e.expand(r+1));return null!=n&&i.set(n,0),i[r]=t,this._array=i,this._size=r+1,this._flags&=~e.ALIASED,this},e.prototype.addByteMutable=function(t){var r,n=this.size,i=this._array;return null===i||n+1>i.length?(r=new Uint8Array(e.expand(n+1)),null!==i&&r.set(i,0),this._array=r):r=i,r[n]=t,this._size=n+1,this},e.prototype.addData=function(t){var e=t._array;if(null!==e){var r=t._size;return e.length>r&&(e=e.slice(0,r)),this.addUint8Array(e)}return this},e.prototype.addUint8Array=function(t){var r=this._flags;if(0!=(r&e.IMMUTABLE))throw new Error("immutable");return 0!=(r&e.ALIASED)?this.addUint8ArrayAliased(t):this.addUint8ArrayMutable(t)},e.prototype.addUint8ArrayAliased=function(t){var r=t.length;if(0===r)return this;var n=this.size,i=this._array,o=new Uint8Array(e.expand(n+r));return null!==i&&o.set(i,0),o.set(t,n),this._array=o,this._size=n+r,this._flags&=~e.ALIASED,this},e.prototype.addUint8ArrayMutable=function(t){var r=t.length;if(0===r)return this;var n,i=this.size,o=this._array;return null===o||i+r>o.length?(n=new Uint8Array(e.expand(i+r)),null!==o&&n.set(o,0),this._array=n):n=o,n.set(t,i),this._size=i+r,this},e.prototype.clear=function(){if(0!=(this._flags&e.IMMUTABLE))throw new Error("immutable");this._array=null,this._size=0,this._flags=e.ALIASED},e.prototype.toUint8Array=function(){var t=this._array,r=this._flags;if(0!=(r&e.IMMUTABLE))return null!==t?t.slice(0):new Uint8Array(0);if(0!=(r&e.ALIASED)||this._size!==t.length){var n=null!==t?t.slice(0):new Uint8Array(0);return this._array=n,this._flags&=~e.ALIASED,n}return t},e.prototype.asUint8Array=function(){var t;return this._array&&this._size>0?(t=this._array).length!==this._size&&(t=new Uint8Array(t.buffer,t.byteOffset,this._size)):t=void 0,t},e.prototype.toAny=function(){return this.toUint8Array()},e.prototype.isAliased=function(){return 0!=(this._flags&e.ALIASED)},e.prototype.isMutable=function(){return 0==(this._flags&e.IMMUTABLE)},e.prototype.branch=function(){return this._flags|=e.ALIASED,new e(this._array,this._size,e.ALIASED)},e.prototype.clone=function(){return this.branch()},e.prototype.commit=function(){return this._flags|=e.IMMUTABLE,this},e.prototype.writeBase16=function(t,e){void 0===e&&(e=wt.uppercase());var r=this._array,n=this._size;return null!==r&&0!==n?(r.length!==n&&(r=r.slice(0,n)),e.writeUint8Array(r,t)):W.done()},e.prototype.toBase16=function(t){void 0===t&&(t=wt.uppercase());var e=X.stringOutput();return this.writeBase16(e,t),e.bind()},e.prototype.writeBase64=function(t,e){void 0===e&&(e=It.standard());var r=this._array,n=this._size;return null!==r&&0!==n?(r.length!==n&&(r=r.slice(0,n)),e.writeUint8Array(r,t)):W.done()},e.prototype.toBase64=function(t){void 0===t&&(t=It.standard());var e=X.stringOutput();return this.writeBase64(e,t),e.bind()},e.prototype.typeOrder=function(){return 4},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._array,n=t._array,i=this._size,o=t._size,s=0,u=0;do{if(!(u<i&&u<o))break;s=r[u]-n[u],u+=1}while(0===s);return s>0?1:s<0?-1:i>o?1:i<o?-1:0}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){if(this===t)return!0;if(t instanceof e){var r=this._array,n=t._array,i=this._size;if(i!==t._size)return!1;for(var o=0;o<i;o+=1)if(r[o]!==n[o])return!1;return!0}return!1},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._array||new Uint8Array(0)))},e.prototype.debug=function(t){t=t.write("Data").write(46),0===this._size?t=t.write("empty").write(40).write(41):(t=t.write("base16").write(40).write(34),this.writeBase16(t),t=t.write(34).write(41))},e.prototype.display=function(t){this.debug(t)},e.output=function(t){return t instanceof e||(t=e.create(t)),new ae(t,M.standard())},e.empty=function(){return null==e._empty&&(e._empty=new e(null,0,e.ALIASED|e.IMMUTABLE)),e._empty},e.create=function(t){return void 0===t?new e(null,0,e.ALIASED):new e(new Uint8Array(t),0,0)},e.wrap=function(t){return new e(t,t.length,e.ALIASED)},e.fromBase16=function(t){return"string"==typeof t&&(t=X.stringInput(t)),wt.parse(t,e.output()).bind()},e.fromBase64=function(t,r){return void 0===r&&(r=It.standard()),"string"==typeof t&&(t=X.stringInput(t)),r.parse(t,e.output()).bind()},e.fromAny=function(t){if(t instanceof e)return t;if(t instanceof Uint8Array)return e.wrap(t);throw new TypeError(""+t)},e.random=function(t){var r=new Uint8Array(t);return s.fillBytes(r),e.wrap(r)},e.expand=function(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},e.ALIASED=1,e.IMMUTABLE=2,e}(ne);Xt.Data=pe;var he=function(t){function e(e,r){var n=t.call(this)||this;return n._string=e,n._settings=r,n}return y(e,t),e.prototype.isCont=function(){return!0},e.prototype.isFull=function(){return!1},e.prototype.isDone=function(){return!1},e.prototype.isError=function(){return!1},e.prototype.isPart=function(t){return void 0!==t&&this},e.prototype.write=function(t){if("number"==typeof t)if(t>=0&&t<=55295||t>=57344&&t<=65535)t=String.fromCharCode(t);else if(t>=65536&&t<=1114111){var e=t-65536;t=String.fromCharCode(55296|e>>>10,56320|1023&e)}else t="ï¿½";return this._string+=t,this},e.prototype.settings=function(t){return void 0===t?this._settings:(this._settings=M.fromAny(t),this)},e.prototype.bind=function(){return fe.from(this._string)},e.prototype.clone=function(){return new e(this._string,this._settings)},e.prototype.toString=function(){return this._string},e}(P),fe=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return y(e,t),e.prototype.isConstant=function(){return!0},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._value.length},enumerable:!0,configurable:!0}),e.prototype.stringValue=function(t){return this._value},e.prototype.numberValue=function(t){try{return Xt.Num.from(this._value).numberValue()}catch(e){return t}},e.prototype.booleanValue=function(t){return"true"===this._value||"false"!==this._value&&t},e.prototype.toAny=function(){return this._value},e.prototype.valueOf=function(){return this._value},e.prototype.plus=function(r){return(r=Xt.fromAny(r))instanceof e?e.from(this._value+r._value):t.prototype.plus.call(this,r)},e.prototype.branch=function(){return this},e.prototype.clone=function(){return this},e.prototype.commit=function(){return this},e.prototype.typeOrder=function(){return 5},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._value.localeCompare(t._value);return r<0?-1:r>0?1:0}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._value===t._value},e.prototype.hashCode=function(){return void 0===this._hashCode&&(this._hashCode=f.hash(this._value)),this._hashCode},e.prototype.debug=function(t){t=t.write("Text").write(46),t=0===this._value.length?t.write("empty").write(40).write(41):t.write("from").write(40).debug(this._value).write(41)},e.prototype.display=function(t){Z.debug(this._value,t)},e.prototype.toString=function(){return this._value},e.output=function(t){return void 0===t&&(t=M.standard()),new he("",t)},e.empty=function(){return e._empty||(e._empty=new e("")),e._empty},e.from=function(t){var r=t.length;if(0===r)return e.empty();var n=new e(t);return r<=64&&(n=e.cache().put(n)),n},e.fromAny=function(t){if(t instanceof e)return t;if("string"==typeof t)return e.from(t);throw new TypeError(""+t)},e.cache=function(){if(null==e._cache){e._cache=new k(128)}return e._cache},e}(ne);Xt.Text=fe;var ce=function(t){function e(e,r){void 0===r&&(r=0);var n=t.call(this)||this;return n._value=e,n._flags=r,n}return y(e,t),e.prototype.isConstant=function(){return!0},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.isNaN=function(){return isNaN(this._value)},e.prototype.isInfinite=function(){return!isNaN(this._value)&&!isFinite(this._value)},e.prototype.isUint32=function(){return 0!=(this._flags&e.UINT32)},e.prototype.isUint64=function(){return 0!=(this._flags&e.UINT64)},e.prototype.stringValue=function(t){return""+this._value},e.prototype.numberValue=function(t){return this._value},e.prototype.booleanValue=function(t){return!!this._value},e.prototype.toAny=function(){return this._value},e.prototype.valueOf=function(){return this._value},e.prototype.bitwiseOr=function(r){return(r=Xt.fromAny(r))instanceof e?e.from((this._value|r._value)>>>0):t.prototype.bitwiseOr.call(this,r)},e.prototype.bitwiseXor=function(r){return(r=Xt.fromAny(r))instanceof e?e.from((this._value^r._value)>>>0):t.prototype.bitwiseXor.call(this,r)},e.prototype.bitwiseAnd=function(r){return(r=Xt.fromAny(r))instanceof e?e.from((this._value&r._value)>>>0):t.prototype.bitwiseAnd.call(this,r)},e.prototype.plus=function(r){return(r=Xt.fromAny(r))instanceof e?e.from(this._value+r._value):t.prototype.plus.call(this,r)},e.prototype.minus=function(r){return(r=Xt.fromAny(r))instanceof e?e.from(this._value-r._value):t.prototype.minus.call(this,r)},e.prototype.times=function(r){return(r=Xt.fromAny(r))instanceof e?e.from(this._value*r._value):t.prototype.times.call(this,r)},e.prototype.divide=function(r){return(r=Xt.fromAny(r))instanceof e?e.from(this._value/r._value):t.prototype.divide.call(this,r)},e.prototype.modulo=function(r){return(r=Xt.fromAny(r))instanceof e?e.from(this._value%r._value):t.prototype.modulo.call(this,r)},e.prototype.bitwiseNot=function(){return e.from(~this._value>>>0)},e.prototype.negative=function(){return e.from(-this._value)},e.prototype.positive=function(){return this},e.prototype.inverse=function(){return e.from(1/this._value)},e.prototype.abs=function(){return e.from(Math.abs(this._value))},e.prototype.ceil=function(){return e.from(Math.ceil(this._value))},e.prototype.floor=function(){return e.from(Math.floor(this._value))},e.prototype.round=function(){return e.from(Math.round(this._value))},e.prototype.sqrt=function(){return e.from(Math.sqrt(this._value))},e.prototype.pow=function(t){return t=e.fromAny(t),e.from(Math.pow(this._value,t._value))},e.prototype.max=function(t){return this.compareTo(t)>=0?this:t},e.prototype.min=function(t){return this.compareTo(t)<=0?this:t},e.prototype.typeOrder=function(){return 6},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._value,n=t._value;return r<n?-1:r>n?1:isNaN(n)?isNaN(r)?0:-1:isNaN(r)?1:0}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){if(this===t)return!0;if(t instanceof e){var r=this._value,n=t._value;return r===n||isNaN(r)&&isNaN(n)}return!1},e.prototype.hashCode=function(){return f.hash(this._value)},e.prototype.debug=function(t){t=t.write("Num").write(46).write("from").write(40).display(this).write(41)},e.prototype.display=function(t){Z.displayNumber(this._value,t)},e.positiveZero=function(){return void 0===e._positiveZero&&(e._positiveZero=new e(0)),e._positiveZero},e.negativeZero=function(){return void 0===e._negativeZero&&(e._negativeZero=new e(-0)),e._negativeZero},e.positiveOne=function(){return void 0===e._positiveOne&&(e._positiveOne=new e(1)),e._positiveOne},e.negativeOne=function(){return void 0===e._negativeOne&&(e._negativeOne=new e(-1)),e._negativeOne},e.nan=function(){return void 0===e._nan&&(e._nan=new e(NaN)),e._nan},e.uint32=function(t){return new e(t,e.UINT32)},e.uint64=function(t){return new e(t,e.UINT64)},e.from=function(t){if("number"==typeof t)return 0===t?1/t==-1/0?e.negativeZero():e.positiveZero():1===t?e.positiveOne():-1===t?e.negativeOne():isNaN(t)?e.nan():e.cache().put(new e(t));if("string"==typeof t){if("NaN"===t)return e.nan();var r=+t;if(isFinite(r))return e.from(r);throw new Error(t)}throw new TypeError(""+t)},e.fromAny=function(t){if(t instanceof e)return t;if("number"==typeof t)return e.from(t);throw new TypeError(""+t)},e.cache=function(){if(null==e._cache){e._cache=new k(16)}return e._cache},e.TYPE_MASK=3,e.UINT32=1,e.UINT64=2,e}(ne);Xt.Num=ce;var le=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return y(e,t),e.prototype.isConstant=function(){return!0},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.stringValue=function(t){return this._value?"true":"false"},e.prototype.booleanValue=function(t){return this._value},e.prototype.toAny=function(){return this._value},e.prototype.valueOf=function(){return this._value},e.prototype.conditional=function(t,e){return this._value?Xt.fromAny(t):Xt.fromAny(e)},e.prototype.or=function(t){return this._value?this:Xt.fromAny(t)},e.prototype.and=function(t){return this._value?Xt.fromAny(t):this},e.prototype.not=function(){return e.from(!this._value)},e.prototype.typeOrder=function(){return 7},e.prototype.compareTo=function(t){return t instanceof e?this._value&&!t._value?-1:!this._value&&t._value?1:0:c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._value===t._value},e.prototype.hashCode=function(){return void 0===this._hashCode&&(this._hashCode=f.hash(this._value?"true":"false")),this._hashCode},e.prototype.debug=function(t){t=t.write("Bool").write(46).write("from").write(40).write(this._value?"true":"false").write(41)},e.prototype.display=function(t){t=t.write(this._value?"true":"false")},e.from=function(t){return t?e.True:e.False},e.fromAny=function(t){if(t instanceof e)return t;if("boolean"==typeof t)return e.from(t);throw new TypeError(""+t)},e.True=new e(!0),e.False=new e(!1),e}(ne);Xt.Bool=le;var de=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.conditional=function(t,e){return t=Xt.fromAny(t),e=Xt.fromAny(e),new Xt.ConditionalOperator(this,t,e)},e.prototype.or=function(t){return t=Xt.fromAny(t),new Xt.OrOperator(this,t)},e.prototype.and=function(t){return t=Xt.fromAny(t),new Xt.AndOperator(this,t)},e.prototype.bitwiseOr=function(t){return t=Xt.fromAny(t),new Xt.BitwiseOrOperator(this,t)},e.prototype.bitwiseXor=function(t){return t=Xt.fromAny(t),new Xt.BitwiseXorOperator(this,t)},e.prototype.bitwiseAnd=function(t){return t=Xt.fromAny(t),new Xt.BitwiseAndOperator(this,t)},e.prototype.lt=function(t){return t=Xt.fromAny(t),new Xt.LtOperator(this,t)},e.prototype.le=function(t){return t=Xt.fromAny(t),new Xt.LeOperator(this,t)},e.prototype.eq=function(t){return t=Xt.fromAny(t),new Xt.EqOperator(this,t)},e.prototype.ne=function(t){return t=Xt.fromAny(t),new Xt.NeOperator(this,t)},e.prototype.ge=function(t){return t=Xt.fromAny(t),new Xt.GeOperator(this,t)},e.prototype.gt=function(t){return t=Xt.fromAny(t),new Xt.GtOperator(this,t)},e.prototype.plus=function(t){return t=Xt.fromAny(t),new Xt.PlusOperator(this,t)},e.prototype.minus=function(t){return t=Xt.fromAny(t),new Xt.MinusOperator(this,t)},e.prototype.times=function(t){return t=Xt.fromAny(t),new Xt.TimesOperator(this,t)},e.prototype.divide=function(t){return t=Xt.fromAny(t),new Xt.DivideOperator(this,t)},e.prototype.modulo=function(t){return t=Xt.fromAny(t),new Xt.ModuloOperator(this,t)},e.prototype.not=function(){return new Xt.NotOperator(this)},e.prototype.bitwiseNot=function(){return new Xt.BitwiseNotOperator(this)},e.prototype.negative=function(){return new Xt.NegativeOperator(this)},e.prototype.positive=function(){return new Xt.PositiveOperator(this)},e.prototype.inverse=function(){return new Xt.DivideOperator(Xt.Num.positiveOne(),this)},e.prototype.toAny=function(){return this},e}(ne);Xt.Expression=de;var ye=function(t){function e(){return t.call(this)||this}return y(e,t),e}(de);Xt.Operator=ye;var _e=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isConstant=function(){return!1},e.prototype.evaluate=function(t){t=Jt.fromAny(t);var e=Xt.Record.create();return this.forSelected(t,function(t){var r=t.peekScope();r&&e.push(r)},this),e.isEmpty()?Xt.absent():e.flattened()},e.prototype.get=function(t){return t=ne.fromAny(t),this.andThen(new Xt.GetSelector(t,e.identity()))},e.prototype.getAttr=function(t){return t=Xt.Text.fromAny(t),this.andThen(new Xt.GetAttrSelector(t,e.identity()))},e.prototype.getItem=function(t){return t=Xt.Num.fromAny(t),this.andThen(new Xt.GetItemSelector(t,e.identity()))},e.prototype.keys=function(){return this.andThen(e.keys())},e.prototype.values=function(){return this.andThen(e.values())},e.prototype.children=function(){return this.andThen(e.children())},e.prototype.descendants=function(){return this.andThen(e.descendants())},e.prototype.filter=function(t){return 0===arguments.length?new Xt.FilterSelector(this,e.identity()):(t=Xt.fromAny(t),this.andThen(t.filter()))},e.prototype.invoke=function(t){return new Xt.InvokeOperator(this,t)},e.prototype.precedence=function(){return 11},e.prototype.debug=function(t){t=t.write("Selector").write(46).write("identity").write(40).write(41),this.debugThen(t)},e.identity=function(){return e._identity},e.get=function(t){return t=ne.fromAny(t),new Xt.GetSelector(t,e.identity())},e.getAttr=function(t){return t=Xt.Text.fromAny(t),new Xt.GetAttrSelector(t,e.identity())},e.getItem=function(t){return t=Xt.Num.fromAny(t),new Xt.GetItemSelector(t,e.identity())},e.keys=function(){return e._keys||(e._keys=new Xt.KeysSelector(e.identity())),e._keys},e.values=function(){return e._values||(e._values=new Xt.ValuesSelector(e.identity())),e._values},e.children=function(){return e._children||(e._children=new Xt.ChildrenSelector(e.identity())),e._children},e.descendants=function(){return e._descendants||(e._descendants=new Xt.DescendantsSelector(e.identity())),e._descendants},e.literal=function(t){return(t=Xt.fromAny(t))instanceof e||(t=new Xt.LiteralSelector(t,e.identity())),t},e}(de);Xt.Selector=_e;var ve=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.expand=function(t,e,r){},e.prototype.isConstant=function(){return!1},e}(de);Xt.Func=ve;var me=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isDefined=function(){return!0},e.prototype.isDistinct=function(){return!1},e.prototype.isConstant=function(){return!0},e.prototype.unflattened=function(){return ne.Record.empty()},e.prototype.not=function(){return ne.absent()},e.prototype.stringValue=function(t){return""},e.prototype.booleanValue=function(t){return!0},e.prototype.toAny=function(){return null},e.prototype.typeOrder=function(){return 98},e.prototype.compareTo=function(t){return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),e._hashSeed},e.prototype.debug=function(t){t=t.write("Value").write(46).write("extant").write(40).write(41)},e.prototype.display=function(t){t=t.write("null")},e.extant=function(){return e._extant},e.fromAny=function(t){if(t instanceof e)return t;if(null===t)return e.extant();throw new TypeError(""+t)},e._extant=new e,e}(ne);Xt.Extant=me;var we=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isDistinct=function(){return!1},e.prototype.isConstant=function(){return!0},e.prototype.unflattened=function(){return ne.Record.empty()},e.prototype.updated=function(t,e){return ne.Record.of(Xt.Slot.of(t,e))},e.prototype.updatedAttr=function(t,e){return ne.Record.of(Xt.Attr.of(t,e))},e.prototype.updatedSlot=function(t,e){return ne.Record.of(Xt.Slot.of(t,e))},e.prototype.appended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ne.Record.of(t)},e.prototype.prepended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ne.Record.of(t)},e.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=ne.Record.create(),n=0,i=arguments.length;n<i;n+=1)Xt.fromAny(arguments[n]).forEach(function(t){r.push(t)});return r},e.prototype.cond=function(t,e){return Xt.fromAny(e)},e.prototype.or=function(t){return Xt.fromAny(t)},e.prototype.and=function(t){return this},e.prototype.not=function(){return ne.extant()},e.prototype.booleanValue=function(t){return!1},e.prototype.toAny=function(){},e.prototype.forEach=function(t,e){},e.prototype.iterator=function(){return l.empty()},e.prototype.typeOrder=function(){return 99},e.prototype.compareTo=function(t){return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),e._hashSeed},e.prototype.debug=function(t){t=t.write("Value").write(46).write("absent").write(40).write(41)},e.prototype.display=function(t){t=t.write("undefined")},e.absent=function(){return e._absent},e.fromAny=function(t){if(t instanceof e)return t;if(void 0===t)return e.absent();throw new TypeError(""+t)},e._absent=new e,e}(ne);Xt.Absent=we;var ge=function(t){function e(r){var n=t.call(this,r)||this;return n.__proto__=e.prototype,n}return y(e,t),e}(Error),be=function(){function t(){}return t.prototype.tag=function(e){return 0===arguments.length?void 0:void 0!==e?new t.TagForm(e,this):this},t.prototype.unit=function(e){return 0===arguments.length?void 0:void 0!==e?new t.UnitForm(e,this):this},t.forString=function(){return t._stringForm||(t._stringForm=new t.StringForm("")),t._stringForm},t.forNumber=function(){return t._numberForm||(t._numberForm=new t.NumberForm(0)),t._numberForm},t.forBoolean=function(){return t._booleanForm||(t._booleanForm=new t.BooleanForm(!1)),t._booleanForm},t.forAny=function(){return t._anyForm||(t._anyForm=new t.AnyForm(void 0)),t._anyForm},t.forItem=function(){return t._itemForm||(t._itemForm=new t.ItemForm(Xt.absent())),t._itemForm},t.forValue=function(){return t._valueForm||(t._valueForm=new t.ValueForm(ne.absent())),t._valueForm},t}(),Se=function(t){function e(e,r){var n=t.call(this)||this;return n._operand1=e,n._operand2=r,n}return y(e,t),e.prototype.operand1=function(){return this._operand1},e.prototype.operand2=function(){return this._operand2},e.prototype.isConstant=function(){return this._operand1.isConstant()&&this._operand2.isConstant()},e}(ye);Xt.BinaryOperator=Se;var xe=function(t){function e(e){var r=t.call(this)||this;return r._operand=e,r}return y(e,t),e.prototype.operand=function(){return this._operand},e.prototype.isConstant=function(){return this._operand.isConstant()},e}(ye);Xt.UnaryOperator=xe;var Ee=function(t){function e(e,r,n){var i=t.call(this)||this;return i._ifTerm=e.commit(),i._thenTerm=r.commit(),i._elseTerm=n.commit(),i}return y(e,t),e.prototype.ifTerm=function(){return this._ifTerm},e.prototype.thenTerm=function(){return this._thenTerm},e.prototype.elseTerm=function(){return this._elseTerm},e.prototype.isConstant=function(){return this._ifTerm.isConstant()&&this._thenTerm.isConstant()&&this._elseTerm.isConstant()},e.prototype.precedence=function(){return 2},e.prototype.evaluate=function(t){var e;((t=Jt.fromAny(t)).willOperate(this),this._ifTerm.evaluate(t).booleanValue(!1))?e=this._thenTerm.evaluate(t):e=this._elseTerm.evaluate(t);return t.didOperate(this,e),e},e.prototype.substitute=function(t){return t=Jt.fromAny(t),new e(this._ifTerm.substitute(t),this._thenTerm.substitute(t),this._elseTerm.substitute(t))},e.prototype.typeOrder=function(){return 20},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._ifTerm.compareTo(t._ifTerm);return 0===r&&0===(r=this._thenTerm.compareTo(t._thenTerm))&&(r=this._elseTerm.compareTo(t._elseTerm)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._ifTerm.equals(t._ifTerm)&&this._thenTerm.equals(t._thenTerm)&&this._elseTerm.equals(t._elseTerm))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(f.mix(e._hashSeed,this._ifTerm.hashCode()),this._thenTerm.hashCode()),this._elseTerm.hashCode()))},e.prototype.debug=function(t){t.debug(this._ifTerm).write(46).write("conditional").write(40).debug(this._thenTerm).write(44).write(32).debug(this._elseTerm).write(41)},e.prototype.clone=function(){return new e(this._ifTerm.clone(),this._thenTerm.clone(),this._elseTerm.clone())},e}(ye);Xt.ConditionalOperator=Ee;var ke=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"||"},e.prototype.precedence=function(){return 3},e.prototype.evaluate=function(t){var e;(t=Jt.fromAny(t)).willOperate(this);var r=this._operand1.evaluate(t);r.booleanValue(!1)?e=r:e=this._operand2.evaluate(t);return t.didOperate(this,e),e},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.or(r)},e.prototype.typeOrder=function(){return 21},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("or").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.OrOperator=ke;var Ce=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"&&"},e.prototype.precedence=function(){return 4},e.prototype.evaluate=function(t){var e;(t=Jt.fromAny(t)).willOperate(this);var r=this._operand1.evaluate(t);r.booleanValue(!1)?e=this._operand2.evaluate(t):e=r;return t.didOperate(this,e),e},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.and(r)},e.prototype.typeOrder=function(){return 22},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("and").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.AndOperator=Ce;var Oe=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"|"},e.prototype.precedence=function(){return 5},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.bitwiseOr(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.bitwiseOr(r)},e.prototype.typeOrder=function(){return 23},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("bitwiseOr").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.BitwiseOrOperator=Oe;var Ae=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"^"},e.prototype.precedence=function(){return 6},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.bitwiseXor(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.bitwiseXor(r)},e.prototype.typeOrder=function(){return 24},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("bitwiseXor").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.BitwiseXorOperator=Ae;var Ie=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"&"},e.prototype.precedence=function(){return 7},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.bitwiseAnd(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.bitwiseAnd(r)},e.prototype.typeOrder=function(){return 25},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("bitwiseAnd").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.BitwiseAndOperator=Ie;var De=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"<"},e.prototype.precedence=function(){return 0},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.lt(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.lt(r)},e.prototype.typeOrder=function(){return 26},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("lt").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.LtOperator=De;var Me=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"<="},e.prototype.precedence=function(){return 0},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.le(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.le(r)},e.prototype.typeOrder=function(){return 27},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("le").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.LeOperator=Me;var Te=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"=="},e.prototype.precedence=function(){return 0},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.eq(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.eq(r)},e.prototype.typeOrder=function(){return 28},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("eq").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.EqOperator=Te;var Pe=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"!="},e.prototype.precedence=function(){return 0},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.ne(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.ne(r)},e.prototype.typeOrder=function(){return 29},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("ne").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.NeOperator=Pe;var Ve=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return">="},e.prototype.precedence=function(){return 0},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.ge(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.ge(r)},e.prototype.typeOrder=function(){return 30},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("ge").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.GeOperator=Ve;var Ue=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return">"},e.prototype.precedence=function(){return 0},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.gt(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.gt(r)},e.prototype.typeOrder=function(){return 31},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("gt").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.GtOperator=Ue;var Re=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"+"},e.prototype.precedence=function(){return 8},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.plus(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.plus(r)},e.prototype.typeOrder=function(){return 32},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("plus").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.PlusOperator=Re;var Fe=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"-"},e.prototype.precedence=function(){return 8},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.minus(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.minus(r)},e.prototype.typeOrder=function(){return 33},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("minus").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.MinusOperator=Fe;var ze=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"*"},e.prototype.precedence=function(){return 9},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.times(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.times(r)},e.prototype.typeOrder=function(){return 34},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("times").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.TimesOperator=ze;var Le=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"/"},e.prototype.precedence=function(){return 9},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.divide(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.divide(r)},e.prototype.typeOrder=function(){return 35},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("divide").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.DivideOperator=Le;var qe=function(t){function e(e,r){return t.call(this,e,r)||this}return y(e,t),e.prototype.operator=function(){return"%"},e.prototype.precedence=function(){return 9},e.prototype.evaluate=function(t){(t=Jt.fromAny(t)).willOperate(this);var e=this._operand1.evaluate(t),r=this._operand2.evaluate(t),n=e.modulo(r);return t.didOperate(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var e=this._operand1.substitute(t),r=this._operand2.substitute(t);return e.modulo(r)},e.prototype.typeOrder=function(){return 36},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._operand1.compareTo(t._operand1);return 0===r&&(r=this._operand2.compareTo(t._operand2)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._operand1.equals(t._operand1)&&this._operand2.equals(t._operand2))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._operand1.hashCode()),this._operand2.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand1).write(46).write("modulo").write(40).debug(this._operand2).write(41)},e.prototype.clone=function(){return new e(this._operand1.clone(),this._operand2.clone())},e}(Se);Xt.ModuloOperator=qe;var Be=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.operator=function(){return"!"},e.prototype.precedence=function(){return 10},e.prototype.evaluate=function(t){return t=Jt.fromAny(t),this._operand.evaluate(t).not()},e.prototype.substitute=function(t){return t=Jt.fromAny(t),this._operand.substitute(t).not()},e.prototype.typeOrder=function(){return 37},e.prototype.compareTo=function(t){return t instanceof e?this._operand.compareTo(t._operand):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._operand.equals(t._operand)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._operand.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand).write(46).write("not").write(40).write(41)},e.prototype.clone=function(){return new e(this._operand.clone())},e}(xe);Xt.NotOperator=Be;var Ne=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.operator=function(){return"~"},e.prototype.precedence=function(){return 10},e.prototype.evaluate=function(t){return t=Jt.fromAny(t),this._operand.evaluate(t).bitwiseNot()},e.prototype.substitute=function(t){return t=Jt.fromAny(t),this._operand.substitute(t).bitwiseNot()},e.prototype.typeOrder=function(){return 38},e.prototype.compareTo=function(t){return t instanceof e?this._operand.compareTo(t._operand):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._operand.equals(t._operand)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._operand.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand).write(46).write("bitwiseNot").write(40).write(41)},e.prototype.clone=function(){return new e(this._operand.clone())},e}(xe);Xt.BitwiseNotOperator=Ne;var Ke=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.operator=function(){return"-"},e.prototype.precedence=function(){return 10},e.prototype.evaluate=function(t){return t=Jt.fromAny(t),this._operand.evaluate(t).negative()},e.prototype.substitute=function(t){return t=Jt.fromAny(t),this._operand.substitute(t).negative()},e.prototype.typeOrder=function(){return 39},e.prototype.compareTo=function(t){return t instanceof e?this._operand.compareTo(t._operand):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._operand.equals(t._operand)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._operand.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand).write(46).write("negative").write(40).write(41)},e.prototype.clone=function(){return new e(this._operand.clone())},e}(xe);Xt.NegativeOperator=Ke;var We=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.operator=function(){return"+"},e.prototype.precedence=function(){return 10},e.prototype.evaluate=function(t){return t=Jt.fromAny(t),this._operand.evaluate(t).positive()},e.prototype.substitute=function(t){return t=Jt.fromAny(t),this._operand.substitute(t).positive()},e.prototype.typeOrder=function(){return 40},e.prototype.compareTo=function(t){return t instanceof e?this._operand.compareTo(t._operand):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._operand.equals(t._operand)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._operand.hashCode()))},e.prototype.debug=function(t){t.debug(this._operand).write(46).write("positive").write(40).write(41)},e.prototype.clone=function(){return new e(this._operand.clone())},e}(xe);Xt.PositiveOperator=We;var je=function(t){function e(e,r){var n=t.call(this)||this;return n._func=e,n._args=r.commit(),n}return y(e,t),e.prototype.func=function(){return this._func},e.prototype.args=function(){return this._args},e.prototype.state=function(){return this._state},e.prototype.setState=function(t){this._state=t},e.prototype.isConstant=function(){return this._func.isConstant()&&this._args.isConstant()},e.prototype.precedence=function(){return 11},e.prototype.evaluate=function(t){t=Jt.fromAny(t);var e=this._func.evaluate(t);return e instanceof Xt.Func?e.invoke(this._args,t,this):Xt.absent()},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._func.evaluate(t);if(r instanceof Xt.Func){var n=r.expand(this._args,t,this);if(n)return n}var i=this._args.substitute(t).toValue();return new e(this._func,i)},e.prototype.typeOrder=function(){return 41},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._func.compareTo(t._func);return 0===r&&(r=this._args.compareTo(t._args)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._func.equals(t._func)&&this._args.equals(t._args))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._func.hashCode()),this._args.hashCode()))},e.prototype.debug=function(t){t.debug(this._func).write(46).write("invoke").write(40).debug(this._args).write(41)},e.prototype.clone=function(){return new e(this._func.clone(),this._args.clone())},e}(ye);Xt.InvokeOperator=je;var He=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.then=function(){return this},e.prototype.forSelected=function(t,e,r){var n;if(t.willSelect(this),0!==t.scopeDepth()){var i=t.popScope(),o=i.evaluate(t);t.pushScope(o),n=e.call(r,t),t.swapScope(i)}return t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){return e.call(r,t)},e.prototype.substitute=function(t){return(t=Jt.fromAny(t)).peekScope().substitute(t)},e.prototype.get=function(t){return t=ne.fromAny(t),new Xt.GetSelector(t,this)},e.prototype.getAttr=function(t){return t=Xt.Text.fromAny(t),new Xt.GetAttrSelector(t,this)},e.prototype.getItem=function(t){return t=Xt.Num.fromAny(t),new Xt.GetItemSelector(t,this)},e.prototype.andThen=function(t){return t},e.prototype.keys=function(){return _e.keys()},e.prototype.values=function(){return _e.values()},e.prototype.children=function(){return _e.children()},e.prototype.descendants=function(){return _e.descendants()},e.prototype.filter=function(t){return 0===arguments.length?new Xt.FilterSelector(this,this):(t=Xt.fromAny(t)).filter()},e.prototype.typeOrder=function(){return 10},e.prototype.compareTo=function(t){return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),e._hashSeed},e.prototype.debugThen=function(t){},e.prototype.clone=function(){return this},e}(_e);Xt.IdentitySelector=He,_e._identity=new He;var Ge=function(t){function e(e,r){var n=t.call(this)||this;return n._key=e.commit(),n._then=r,n}return y(e,t),e.prototype.accessor=function(){return this._key},e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,r,n){t.willSelect(this);var i=this._key.evaluate(t).toValue(),o=e.forSelected(i,this._then,t,r,n);return t.didSelect(this,o),o},e.forSelected=function(t,r,n,i,o){var s;if(0!==n.scopeDepth()){var u=n.popScope().toValue(),a=void 0;u instanceof Xt.Record&&(a=u.getField(t))&&(n.pushScope(a.toValue()),s=r.forSelected(n,i,o),n.popScope()),void 0===a&&void 0===s&&e.forSelected(t,r,n,i,o),n.pushScope(u)}return s},e.prototype.mapSelected=function(t,e,r){var n;t.willTransform(this);var i=this._key.evaluate(t).toValue();if(0!==t.scopeDepth()){var o=t.popScope().toValue();if(o instanceof Xt.Record){var s=o.getField(i);if(s){t.pushScope(s.toValue());var u=this._then.mapSelected(t,e,r);t.popScope(),u instanceof Xt.Field?i.equals(u.key)?o.set(i,u.toValue()):(o.delete(i),o.push(u)):u.isDefined()?o.set(i,u.toValue()):o.delete(i)}}t.pushScope(o),n=o}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._key.evaluate(t).toValue(),n=e.substitute(r,this._then,t);if(n)return n;var i=this._then.substitute(t);return i instanceof _e||(i=this._then),new e(this._key,i)},e.substitute=function(t,r,n){var i;if(0!==n.scopeDepth()){var o=n.popScope().toValue(),s=void 0;o instanceof Xt.Record&&(s=o.getField(t))&&(i=s.toValue().substitute(n)),void 0===s&&void 0===i&&e.substitute(t,r,n),n.pushScope(o)}return i},e.prototype.andThen=function(t){return new e(this._key,this._then.andThen(t))},e.prototype.typeOrder=function(){return 12},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._key.compareTo(t._key);return 0===r&&(r=this._then.compareTo(t._then)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._key.equals(t._key)&&this._then.equals(t._then))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._key.hashCode()),this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("get").write(40).debug(this._key).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._key.clone(),this._then.clone())},e}(_e);Xt.GetSelector=Ge;var Qe=function(t){function e(e,r){var n=t.call(this)||this;return n._key=e,n._then=r,n}return y(e,t),e.prototype.accessor=function(){return this._key},e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,r,n){t.willSelect(this);var i=this._key,o=e.forSelected(i,this._then,t,r);return t.didSelect(this,o),o},e.forSelected=function(t,r,n,i,o){var s;if(0!==n.scopeDepth()){var u=n.popScope().toValue(),a=void 0;u instanceof Xt.Record&&(a=u.getField(t))instanceof te&&(n.pushScope(a.toValue()),s=r.forSelected(n,i,o),n.popScope()),void 0===a&&void 0===s&&e.forSelected(t,r,n,i,o),n.pushScope(u)}return s},e.prototype.mapSelected=function(t,e,r){var n;t.willTransform(this);var i=this._key;if(0!==t.scopeDepth()){var o=t.popScope().toValue();if(o instanceof Xt.Record){var s=o.getField(i);if(s instanceof Xt.Attr){t.pushScope(s.toValue());var u=this._then.mapSelected(t,e,r);t.popScope(),u instanceof Xt.Field?i.equals(u.key)?o.setAttr(i,u.toValue()):(o.delete(i),o.push(u)):u.isDefined()?o.setAttr(i,u.toValue()):o.delete(i)}}t.pushScope(o),n=o}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._key,n=e.substitute(r,this._then,t);if(n)return n;var i=this._then.substitute(t);return i instanceof _e||(i=this._then),new e(this._key,i)},e.substitute=function(t,r,n){var i;if(0!==n.scopeDepth()){var o=n.popScope().toValue(),s=void 0;o instanceof Xt.Record&&(s=o.getField(t))instanceof Xt.Attr&&(i=s.toValue().substitute(n)),void 0===s&&void 0===i&&e.substitute(t,r,n),n.pushScope(o)}return i},e.prototype.andThen=function(t){return new e(this._key,this._then.andThen(t))},e.prototype.typeOrder=function(){return 13},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._key.compareTo(t._key);return 0===r&&(r=this._then.compareTo(t._then)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._key.equals(t._key)&&this._then.equals(t._then))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._key.hashCode()),this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("getAttr").write(40).debug(this._key).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._key.clone(),this._then.clone())},e}(_e);Xt.GetAttrSelector=Qe;var Xe=function(t){function e(e,r){var n=t.call(this)||this;return n._index=e,n._then=r,n}return y(e,t),e.prototype.accessor=function(){return this._index},e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,e,r){var n;t.willSelect(this);var i=this._index.numberValue();if(0!==t.scopeDepth()){var o=t.popScope().toValue();if(o instanceof Xt.Record&&i<o.length){var s=o.getItem(i);t.pushScope(s),n=this._then.forSelected(t,e,r),t.popScope()}t.pushScope(o)}return t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){var n;if(t.willTransform(this),0!==t.scopeDepth()){var i=t.popScope().toValue(),o=this._index.numberValue();if(i instanceof Xt.Record&&o<i.length){var s=i.getItem(o);t.pushScope(s);var u=this._then.mapSelected(t,e,r);t.popScope(),u.isDefined()?i.setItem(o,u):i.splice(o,1)}t.pushScope(i),n=i}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._index.numberValue();if(0!==t.scopeDepth()){var n=t.popScope().toValue(),i=void 0;if(n instanceof Xt.Record&&r<n.length)i=n.getItem(r).substitute(t);if(t.pushScope(n),i)return i}var o=this._then.substitute(t);return o instanceof _e||(o=this._then),new e(this._index,o)},e.prototype.andThen=function(t){return new e(this._index,this._then.andThen(t))},e.prototype.typeOrder=function(){return 14},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._index.compareTo(t._index);return 0===r&&(r=this._then.compareTo(t._then)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._index.equals(t._index)&&this._then.equals(t._then))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._index.hashCode()),this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("getItem").write(40).debug(this._index).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._index,this._then.clone())},e}(_e);Xt.GetItemSelector=Xe;var Ze=function(t){function e(e){var r=t.call(this)||this;return r._then=e,r}return y(e,t),e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,e,r){var n;if(t.willSelect(this),0!==t.scopeDepth()){var i=t.popScope();if(i instanceof Xt.Record)for(var o=i.iterator();void 0===n&&o.hasNext();){var s=o.next().value;s instanceof Xt.Field&&(t.pushScope(s.key),n=this._then.forSelected(t,e,r),t.popScope())}else i instanceof Xt.Field&&(t.pushScope(i.key),n=this._then.forSelected(t,e,r),t.popScope());t.pushScope(i)}return t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){var n;if(t.willTransform(this),0!==t.scopeDepth()){var i=t.popScope();if(i instanceof Xt.Record)for(var o=i.iterator();o.hasNext();){var s=o.next().value;if(s instanceof Xt.Field){var u=s.key;t.pushScope(u);var a=this._then.mapSelected(t,e,r).toValue();t.popScope(),a.isDefined()?u!==a&&(i instanceof Xt.Attr&&a instanceof Xt.Text?o.set(Xt.Attr.of(a,i.toValue())):o.set(Xt.Slot.of(a,i.toValue()))):o.delete()}}else if(i instanceof Xt.Field){u=i.key;t.pushScope(u);a=this._then.mapSelected(t,e,r).toValue();t.popScope(),a.isDefined()?u!==a&&(i=i instanceof Xt.Attr&&a instanceof Xt.Text?Xt.Attr.of(a,i.toValue()):Xt.Slot.of(a,i.toValue())):i=Xt.absent()}t.pushScope(i),n=i}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._then.substitute(t);return r instanceof _e||(r=this._then),new e(r)},e.prototype.andThen=function(t){return new e(this._then.andThen(t))},e.prototype.typeOrder=function(){return 15},e.prototype.compareTo=function(t){return t instanceof e?this._then.compareTo(t._then):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._then.equals(t._then)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("keys").write(40).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._then.clone())},e}(_e);Xt.KeysSelector=Ze;var Ye=function(t){function e(e){var r=t.call(this)||this;return r._then=e,r}return y(e,t),e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,e,r){var n;if(t.willSelect(this),0!==t.scopeDepth()){var i=t.popScope();if(i instanceof Xt.Record)for(var o=i.iterator();void 0===n&&o.hasNext();){var s=o.next().value;t.pushScope(s.toValue()),n=this._then.forSelected(t,e,r),t.popScope()}else t.pushScope(i.toValue()),n=this._then.forSelected(t,e,r),t.popScope();t.pushScope(i)}return t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){var n;if(t.willTransform(this),0!==t.scopeDepth()){var i=t.popScope();if(i instanceof Xt.Record)for(var o=i.iterator();o.hasNext();){var s=o.next().value;if(s instanceof Xt.Field){var u=s.toValue();t.pushScope(u);var a=this._then.mapSelected(t,e,r);t.popScope(),a.isDefined()?a instanceof Xt.Field?o.set(a):a!==u&&o.set(s.updatedValue(a.toValue())):o.delete()}else{t.pushScope(s.toValue());a=this._then.mapSelected(t,e,r);t.popScope(),a.isDefined()?s!==a&&o.set(a):o.delete()}}else if(i instanceof Xt.Field){u=i.toValue();t.pushScope(u);a=this._then.mapSelected(t,e,r);t.popScope(),a.isDefined()?a instanceof Xt.Field?i=a:a!==u&&(i=i.updatedValue(a.toValue())):i=Xt.absent()}else t.pushScope(i),i=this._then.mapSelected(t,e,r),t.popScope();t.pushScope(i),n=i}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._then.substitute(t);return r instanceof _e||(r=this._then),new e(r)},e.prototype.andThen=function(t){return new e(this._then.andThen(t))},e.prototype.typeOrder=function(){return 16},e.prototype.compareTo=function(t){return t instanceof e?this._then.compareTo(t._then):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._then.equals(t._then)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("values").write(40).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._then.clone())},e}(_e);Xt.ValuesSelector=Ye;var $e=function(t){function e(e){var r=t.call(this)||this;return r._then=e,r}return y(e,t),e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,e,r){var n;if(t.willSelect(this),0!==t.scopeDepth()){var i=t.popScope().toValue();if(i instanceof Xt.Record)for(var o=i.iterator();void 0===n&&o.hasNext();){var s=o.next().value;t.pushScope(s),n=this._then.forSelected(t,e,r),t.popScope()}t.pushScope(i)}return t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){var n;if(t.willTransform(this),0!==t.scopeDepth()){var i=t.popScope().toValue();if(i instanceof Xt.Record)for(var o=i.iterator();o.hasNext();){var s=o.next().value;t.pushScope(s);var u=this._then.mapSelected(t,e);t.popScope(),u.isDefined()?u!==s&&o.set(u):o.delete()}t.pushScope(i),n=i}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._then.substitute(t);return r instanceof _e||(r=this._then),new e(r)},e.prototype.andThen=function(t){return new e(this._then.andThen(t))},e.prototype.typeOrder=function(){return 17},e.prototype.compareTo=function(t){return t instanceof e?this._then.compareTo(t._then):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._then.equals(t._then)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("children").write(40).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._then.clone())},e}(_e);Xt.ChildrenSelector=$e;var Je=function(t){function e(e){var r=t.call(this)||this;return r._then=e,r}return y(e,t),e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,e,r){var n;if(t.willSelect(this),0!==t.scopeDepth()){var i=t.popScope().toValue();if(i instanceof Xt.Record)for(var o=i.iterator();void 0===n&&o.hasNext();){var s=o.next().value;t.pushScope(s),void 0===(n=this._then.forSelected(t,e,r))&&this.forSelected(t,e,r),t.popScope()}t.pushScope(i)}return t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){var n;if(t.willTransform(this),0!==t.scopeDepth()){var i=t.popScope().toValue();if(i instanceof Xt.Record)for(var o=i.iterator();o.hasNext();){var s=o.next().value;t.pushScope(s);var u=this._then.mapSelected(t,e,r);u.isDefined()&&(u=this.mapSelected(t,e,r)),t.popScope(),u.isDefined()?u!==s&&o.set(u):o.delete()}t.pushScope(i),n=i}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._then.substitute(t);return r instanceof _e||(r=this._then),new e(r)},e.prototype.andThen=function(t){return new e(this._then.andThen(t))},e.prototype.typeOrder=function(){return 18},e.prototype.compareTo=function(t){return t instanceof e?this._then.compareTo(t._then):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&this._then.equals(t._then)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(e._hashSeed,this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("descendants").write(40).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._then.clone())},e}(_e);Xt.DescendantsSelector=Je;var tr=function(t){function e(e,r){var n=t.call(this)||this;return n._predicate=e,n._then=r,n}return y(e,t),e.prototype.predicate=function(){return this._predicate},e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,e,r){var n;return t.willSelect(this),0!==t.scopeDepth()&&this.filterSelected(t)&&(n=this._then.forSelected(t,e,r)),t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){var n;return t.willTransform(this),n=0!==t.scopeDepth()?this.filterSelected(t)?this._then.mapSelected(t,e,r):t.peekScope().toValue():Xt.absent(),t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._predicate.substitute(t);r instanceof _e||(r=this._predicate);var n=this._then.substitute(t);return n instanceof _e||(n=this._then),new e(r,n)},e.prototype.filterSelected=function(t){return void 0!==this._predicate.forSelected(t,this.selected,this)},e.prototype.selected=function(t){return null},e.prototype.andThen=function(t){return new e(this._predicate,this._then.andThen(t))},e.prototype.filter=function(t){return 0===arguments.length?this:(t=Xt.fromAny(t),this.andThen(t.filter()))},e.prototype.typeOrder=function(){return 19},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._predicate.compareTo(t._predicate);return 0===r&&(r=this._then.compareTo(t._then)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._predicate.equals(t._predicate)&&this._then.equals(t._then))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._predicate.hashCode()),this._then.hashCode()))},e.prototype.debugThen=function(t){t=t.write(46).write("filter").write(40).debug(this._predicate).write(41),this._then.debugThen(t)},e.prototype.clone=function(){return new e(this._predicate.clone(),this._then.clone())},e}(_e);Xt.FilterSelector=tr;var er=function(t){function e(e,r){var n=t.call(this)||this;return n._item=e.commit(),n._then=r,n}return y(e,t),e.prototype.item=function(){return this._item},e.prototype.then=function(){return this._then},e.prototype.forSelected=function(t,e,r){var n;if(t.willSelect(this),0!==t.scopeDepth()){var i=this._item.evaluate(t);i.isDefined()&&(t.pushScope(i),n=this._then.forSelected(t,e,r),t.popScope())}return t.didSelect(this,n),n},e.prototype.mapSelected=function(t,e,r){var n;if(t.willTransform(this),0!==t.scopeDepth()){var i=this._item.evaluate(t);i.isDefined()&&(t.pushScope(i),i=this._then.mapSelected(t,e,r),t.popScope()),n=i}else n=Xt.absent();return t.didTransform(this,n),n},e.prototype.substitute=function(t){t=Jt.fromAny(t);var r=this._item.substitute(t),n=this._then.substitute(t);return n instanceof _e||(n=this._then),new e(r,n)},e.prototype.andThen=function(t){return new e(this._item,this._then.andThen(t))},e.prototype.precedence=function(){return this._item.precedence()},e.prototype.typeOrder=function(){return 11},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._item.compareTo(t._item);return 0===r&&(r=this._then.compareTo(t._then)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._item.equals(t._item)&&this._then.equals(t._then))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._item.hashCode()),this._then.hashCode()))},e.prototype.debug=function(t){t=t.write("Selector").write(46).write("literal").write(40).debug(this._item).write(41),this._then.debugThen(t)},e.prototype.debugThen=function(t){},e.prototype.clone=function(){return new e(this._item.clone(),this._then.clone())},e}(_e);Xt.LiteralSelector=er;var rr=function(t){function e(e,r){var n=t.call(this)||this;return n._bindings=e,n._template=r,n}return y(e,t),e.prototype.bindings=function(){return this._bindings},e.prototype.template=function(){return this._template},e.prototype.precedence=function(){return 1},e.prototype.invoke=function(t,e,r){e=Jt.fromAny(e);for(var n=this._bindings,i=Math.max(1,n.length),o=Xt.Record.create(i),s=0,u=0;s<i;){var a=n instanceof Xt.Record?n.getItem(s):0===s?n:Xt.absent(),p=t instanceof Xt.Record?t.getItem(u).toValue():0===u?t:Xt.Value.absent();a instanceof Xt.Text&&p.isDistinct()?(o.push(Xt.Slot.of(a,p)),u+=1):a instanceof Xt.Slot&&(p.isDistinct()?o.push(a.updatedValue(p)):o.push(a),u+=1),s+=1}e.pushScope(o);var h=this._template.evaluate(e);return e.popScope(),h},e.prototype.typeOrder=function(){return 50},e.prototype.compareTo=function(t){if(t instanceof e){var r=this._bindings.compareTo(t._bindings);return 0===r&&(r=this._template.compareTo(t._template)),r}return c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this._bindings.equals(t._bindings)&&this._template.equals(t._template))},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,this._bindings.hashCode()),this._template.hashCode()))},e.prototype.debug=function(t){t.debug(this.bindings).write(46).write("lambda").write(40).debug(this.template).write(41)},e}(ve);Xt.LambdaFunc=rr;var nr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.typeOrder=function(){return 51},e.prototype.compareTo=function(t){return t instanceof e?c.compare(this.__proto__.constructor.name,t.__proto__.constructor.name):c.compare(this.typeOrder(),t.typeOrder())},e.prototype.equals=function(t){return this===t},e.prototype.hashCode=function(){return f.seed(this.__proto__.constructor)},e.prototype.debug=function(t){t=t.write(this.__proto__.constructor.name)},e}(ve);Xt.BridgeFunc=nr;var ir=function(){function t(){}return t.max=function(){return t._max||(t._max=new or),t._max},t.min=function(){return t._min||(t._min=new sr),t._min},t.abs=function(){return t._abs||(t._abs=new ur),t._abs},t.ceil=function(){return t._ceil||(t._ceil=new ar),t._ceil},t.floor=function(){return t._floor||(t._floor=new pr),t._floor},t.round=function(){return t._round||(t._round=new hr),t._round},t.sqrt=function(){return t._sqrt||(t._sqrt=new fr),t._sqrt},t.pow=function(){return t._pow||(t._pow=new cr),t._pow},t.rate=function(){return t._rate||(t._rate=new lr),t._rate},t.random=function(){return t._random||(t._random=new dr),t._random},t.scope=function(){return t._scope||(t._scope=Xt.Record.create(10).slot("max",t.max()).slot("min",t.min()).slot("abs",t.abs()).slot("ceil",t.ceil()).slot("floor",t.floor()).slot("round",t.round()).slot("pow",t.pow()).slot("sqrt",t.sqrt()).slot("rate",t.rate()).slot("random",t.random()).commit()),t._scope},t}();Xt.MathModule=ir;var or=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){var n,i;if(e=Jt.fromAny(e),t.length>=2?(n=t.getItem(0).evaluate(e),i=t.getItem(1).evaluate(e)):n=t.evaluate(e),void 0!==i)return n.max(i);if(r){var o=void 0!==(i=r.state())?n.max(i):n;return r.setState(o),o}return Xt.absent()},e.prototype.expand=function(t,e,r){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,r)},e}(nr),sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){var n,i;if(e=Jt.fromAny(e),t.length>=2?(n=t.getItem(0).evaluate(e),i=t.getItem(1).evaluate(e)):n=t.evaluate(e),void 0!==i)return n.min(i);if(r){var o=void 0!==(i=r.state())?n.min(i):n;return r.setState(o),o}return Xt.absent()},e.prototype.expand=function(t,e,r){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,r)},e}(nr),ur=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){return(t=t.evaluate(e).toValue())instanceof Xt.Num?t.abs():Xt.absent()},e}(nr),ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){return(t=t.evaluate(e).toValue())instanceof Xt.Num?t.ceil():Xt.absent()},e}(nr),pr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){return(t=t.evaluate(e).toValue())instanceof Xt.Num?t.floor():Xt.absent()},e}(nr),hr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){return(t=t.evaluate(e).toValue())instanceof Xt.Num?t.round():Xt.absent()},e}(nr),fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){return(t=t.evaluate(e).toValue())instanceof Xt.Num?t.sqrt():Xt.absent()},e}(nr),cr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){e=Jt.fromAny(e);var n=t.getItem(0).evaluate(e),i=t.getItem(1).evaluate(e);return n instanceof Xt.Num&&i instanceof Xt.Num?n.pow(i):Xt.absent()},e}(nr),lr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){var n,i;if(e=Jt.fromAny(e),t.length>=2?(n=t.getItem(0).evaluate(e).numberValue(NaN),i=t.getItem(1).evaluate(e).numberValue(1e3)):(n=t.evaluate(e).numberValue(NaN),i=1e3),isFinite(n)&&r){var o=r.state();if(void 0===o)o={v0:n,t0:Date.now(),dv:0,dt:0},r.setState(o);else{var s=Date.now(),u=s-o.t0;if(u>i&&s>o.t0||u>2*i){var a=n-o.v0;o.v0=n,o.t0=s,o.dv=a,o.dt=u}if(r.setState(o),0!==o.dt){var p=i*o.dv/o.dt;return Xt.Num.from(p)}}}return Xt.absent()},e.prototype.expand=function(t,e,r){return t=t.evaluate(e).toValue(),this.invoke(t,e,r)},e}(nr),dr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.invoke=function(t,e,r){var n=(t=t.evaluate(e).toValue()).length>=1?t.getItem(0).numberValue(0):0,i=t.length>=2?t.getItem(1).numberValue(n+1):n+1,o=n+Math.random()*(i-n);return Xt.Num.from(o)},e}(nr),yr=function(t){function e(e,r){var n=t.call(this)||this;return n._tag=e,n._form=r,n}return y(e,t),e.prototype.tag=function(t){return 0===arguments.length?this._tag:void 0!==t?new e(t,this._form):this._form},e.prototype.unit=function(t){return 0===arguments.length?this._form.unit():new e(this._tag,this._form.unit(t))},e.prototype.mold=function(t,e){return(e=this._form.mold(t,e)).header(this._tag).isDefined()||(e=e.prepended(te.of(this._tag))),e},e.prototype.cast=function(t,e){return t.header(this._tag).isDefined()?this._form.cast(t,e):t.keyEquals(this._tag)?this._form.cast(t.toValue(),e):void 0},e}(be);be.TagForm=yr;var _r=function(t){function e(e,r){var n=t.call(this)||this;return n._unit=e,n._form=r,n}return y(e,t),e.prototype.tag=function(t){return 0===arguments.length?this._form.tag():new e(this._unit,this._form.tag(t))},e.prototype.unit=function(t){return 0===arguments.length?this._form.unit():void 0!==t?new e(t,this._form):this._form},e.prototype.mold=function(t,e){return this._form.mold.apply(this._form,arguments)},e.prototype.cast=function(t,e){return this._form.cast.apply(this._form,arguments)},e}(be);be.UnitForm=_r;var vr=function(t){function e(e){var r=t.call(this)||this;return r._unit=e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t,e){return void 0===e?fe.from(t):e.concat(fe.from(t))},e.prototype.cast=function(t,e){var r=t.target();try{return r.stringValue()}catch(t){return}},e}(be);be.StringForm=vr;var mr=function(t){function e(e){var r=t.call(this)||this;return r._unit=e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t,e){return void 0===e?ce.from(t):e.concat(ce.from(t))},e.prototype.cast=function(t,e){var r=t.target();try{return r.numberValue()}catch(t){return}},e}(be);be.NumberForm=mr;var wr=function(t){function e(e){var r=t.call(this)||this;return r._unit=e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t,e){return void 0===e?le.from(t):e.concat(le.from(t))},e.prototype.cast=function(t,e){var r=t.target();try{return r.booleanValue()}catch(t){return}},e}(be);be.BooleanForm=wr;var gr=function(t){function e(e){var r=t.call(this)||this;return r._unit=e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t,e){return t=Xt.fromAny(t),void 0!==e&&(t=e.concat(t)),t},e.prototype.cast=function(t,e){return t.toAny()},e}(be);be.AnyForm=gr;var br=function(t){function e(e){var r=t.call(this)||this;return r._unit=e?e.commit():e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t,e){return t=Xt.fromAny(t),void 0!==e&&(t=e.concat(t)),t},e.prototype.cast=function(t,e){return t},e}(be);be.ItemForm=br;var Sr=function(t){function e(e){var r=t.call(this)||this;return r._unit=e?e.commit():e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t,e){return t=ne.fromAny(t),void 0!==e&&(t=e.concat(t)),t},e.prototype.cast=function(t,e){return t.toValue()},e}(be);be.ValueForm=Sr;var xr,Er=function(t){function e(e,r){var n=t.call(this)||this;return n._cursor=e,n._form=r,n}return y(e,t),e.prototype.isEmpty=function(){return this._cursor.isEmpty()},e.prototype.head=function(){return this._cursor.head().coerce(this._form)},e.prototype.step=function(){this._cursor.step()},e.prototype.skip=function(t){this._cursor.skip(t)},e.prototype.hasNext=function(){return this._cursor.hasNext()},e.prototype.nextIndex=function(){return this._cursor.nextIndex()},e.prototype.next=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&e.coerce(this._form),done:r}},e.prototype.hasPrevious=function(){return this._cursor.hasPrevious()},e.prototype.previousIndex=function(){return this._cursor.previousIndex()},e.prototype.previous=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&e.coerce(this._form),done:r}},e.prototype.delete=function(){this._cursor.delete()},e}(l),kr=function(t){function e(e,r,n){var i=t.call(this)||this;return i._cursor=e,i._keyForm=r,i._valueForm=n,i}return y(e,t),e.prototype.isEmpty=function(){return this._cursor.isEmpty()},e.prototype.head=function(){var t=this._cursor.head();return[t[0].coerce(this._keyForm),t[1].coerce(this._valueForm)]},e.prototype.step=function(){this._cursor.step()},e.prototype.skip=function(t){this._cursor.skip(t)},e.prototype.hasNext=function(){return this._cursor.hasNext()},e.prototype.nextIndex=function(){return this._cursor.nextIndex()},e.prototype.next=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&[e[0].coerce(this._keyForm),e[1].coerce(this._valueForm)],done:r}},e.prototype.hasPrevious=function(){return this._cursor.hasPrevious()},e.prototype.previousIndex=function(){return this._cursor.previousIndex()},e.prototype.previous=function(){var t=this._cursor.next(),e=t.value,r=t.done;return{value:e&&[e[0].coerce(this._keyForm),e[1].coerce(this._valueForm)],done:r}},e.prototype.delete=function(){this._cursor.delete()},e}(l),Cr={is:function(t){if("object"==typeof t&&t){var e=t;return"function"==typeof e.input&&"function"==typeof e.bindInput&&"function"==typeof e.unbindInput}return!1}},Or={is:function(t){if("object"==typeof t&&t){var e=t;return"function"==typeof e.outputIterator&&"function"==typeof e.bindOutput&&"function"==typeof e.unbindOutput}return!1},MemoizeValueCombinator:void 0,MapValueCombinator:void 0,WatchValueCombinator:void 0};(xr=t.KeyEffect||(t.KeyEffect={}))[xr.Update=0]="Update",xr[xr.Remove=1]="Remove";var Ar={is:function(t){if("object"==typeof t&&t){var e=t;return Cr.is(e)&&"function"==typeof e.invalidateOutputKey&&"function"==typeof e.reconcileOutputKey}return!1}},Ir={is:function(t){if("object"==typeof t&&t){var e=t;return Or.is(e)&&"function"==typeof e.keyIterator&&"function"==typeof e.outlet}return!1},MemoizeMapCombinator:void 0,FilterFieldsCombinator:void 0,MapFieldValuesCombinator:void 0,ReduceFieldsCombinator:void 0,WatchFieldsCombinator:void 0},Dr=function(t){function e(r){var n=t.call(this,r)||this;return n.__proto__=e.prototype,n}return y(e,t),e}(Error),Mr={is:function(t){if("object"==typeof t&&t){var e=t;return"function"==typeof e.streamletScope&&"function"==typeof e.streamletContext&&"function"==typeof e.outlet}return!1}},Tr=function(){function t(){this._input=null,this._version=-1}return t.prototype.input=function(){return this._input},t.prototype.bindInput=function(t){null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},t.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},t.prototype.disconnectInputs=function(){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())},t.prototype.disconnectOutputs=function(){},t.prototype.invalidateOutput=function(){this._version>=0&&(this.willInvalidateOutput(),this._version=-1,this.onInvalidateOutput(),this.didInvalidateOutput())},t.prototype.reconcileOutput=function(t){this._version<0&&(this.willReconcileOutput(t),this._version=t,null!==this._input&&this._input.reconcileInput(t),this.onReconcileOutput(t),this.didReconcileOutput(t))},t.prototype.willInvalidateOutput=function(){},t.prototype.onInvalidateOutput=function(){},t.prototype.didInvalidateOutput=function(){},t.prototype.willReconcileOutput=function(t){},t.prototype.onReconcileOutput=function(t){},t.prototype.didReconcileOutput=function(t){},t}(),Pr=function(){function t(){this._outputs=null,this._version=-1}return t.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},t.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},t.prototype.unbindOutput=function(t){for(var e=this._outputs,r=0,n=null!==e?e.length:0;r<n;r+=1)if(e[r]===t){if(n>1){for(var i=new Array(n-1),o=0;o<r;o+=1)i[o]=e[o];for(o=r;o<n-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},t.prototype.unbindOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}},t.prototype.disconnectOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1){var n=t[e];n.unbindInput(),n.disconnectOutputs()}}},t.prototype.disconnectInputs=function(){},t.prototype.invalidateInput=function(){if(this._version>=0){this.willInvalidateInput(),this._version=-1,this.onInvalidateInput();for(var t=0,e=null!==this._outputs?this._outputs.length:0;t<e;t+=1)this._outputs[t].invalidateOutput();this.didInvalidateInput()}},t.prototype.reconcileInput=function(t){if(this._version<0){this.willReconcileInput(t),this._version=t,this.onReconcileInput(t);for(var e=0,r=null!==this._outputs?this._outputs.length:0;e<r;e+=1)this._outputs[e].reconcileOutput(t);this.didReconcileInput(t)}},t.prototype.willInvalidateInput=function(){},t.prototype.onInvalidateInput=function(){},t.prototype.didInvalidateInput=function(){},t.prototype.willReconcileInput=function(t){},t.prototype.onReconcileInput=function(t){},t.prototype.didReconcileInput=function(t){},t.prototype.memoize=function(){var t=new Or.MemoizeValueCombinator;return t.bindInput(this),t},t.prototype.map=function(t){var e=new Or.MapValueCombinator(t);return e.bindInput(this),e},t.prototype.watch=function(t){return new Or.WatchValueCombinator(t).bindInput(this),this},t}(),Vr=function(){function t(){this._input=null,this._outputs=null,this._version=-1}return t.prototype.input=function(){return this._input},t.prototype.bindInput=function(t){null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},t.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},t.prototype.disconnectInputs=function(){if(null===this._outputs){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())}},t.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},t.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},t.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},t.prototype.unbindOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}},t.prototype.disconnectOutputs=function(){if(null===this._input){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1){var n=t[e];n.unbindInput(),n.disconnectOutputs()}}}},t.prototype.invalidateOutput=function(){this.invalidate()},t.prototype.invalidateInput=function(){this.invalidate()},t.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this.didInvalidate()}},t.prototype.reconcileOutput=function(t){this.reconcile(t)},t.prototype.reconcileInput=function(t){this.reconcile(t)},t.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._version=t,null!==this._input&&this._input.reconcileInput(t),this.onReconcile(t);for(var e=null!==this._outputs?this._outputs.length:0,r=0;r<e;r+=1)this._outputs[r].reconcileOutput(t);this.didReconcile(t)}},t.prototype.willInvalidate=function(){},t.prototype.onInvalidate=function(){},t.prototype.didInvalidate=function(){},t.prototype.willReconcile=function(t){},t.prototype.onReconcile=function(t){},t.prototype.didReconcile=function(t){},t.prototype.memoize=function(){var t=new Or.MemoizeValueCombinator;return t.bindInput(this),t},t.prototype.map=function(t){var e=new Or.MapValueCombinator(t);return e.bindInput(this),e},t.prototype.watch=function(t){return new Or.WatchValueCombinator(t).bindInput(this),this},t}(),Ur=function(t){function e(e,r){var n=t.call(this)||this;return n._input=e,n._key=r,n}return y(e,t),e.prototype.input=function(){return this._input},e.prototype.key=function(){return this._key},e.prototype.get=function(){return this._input.get(this._key)},e}(Pr),Rr=function(){function t(){this._input=null,this._effects=new zt,this._version=-1}return t.prototype.input=function(){return this._input},t.prototype.bindInput=function(t){if(!Ir.is(t))throw new TypeError(""+t);null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},t.prototype.unbindInput=function(){null!=this._input&&this._input.unbindOutput(this),this._input=null},t.prototype.disconnectInputs=function(){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())},t.prototype.disconnectOutputs=function(){},t.prototype.invalidateOutputKey=function(t,e){var r=this._effects;r.get(t)!==e&&(this.willInvalidateOutputKey(t,e),this._effects=r.updated(t,e),this._version=-1,this.onInvalidateOutputKey(t,e),this.didInvalidateOutputKey(t,e))},t.prototype.invalidateOutput=function(){this._version>=0&&(this.willInvalidateOutput(),this._version=-1,this.onInvalidateOutput(),this.didInvalidateOutput())},t.prototype.reconcileOutputKey=function(t,e){if(this._version<0){var r=this._effects,n=r.get(t);void 0!==n&&(this.willReconcileOutputKey(t,n,e),this._effects=r.removed(t),null!==this._input&&this._input.reconcileInputKey(t,e),this.onReconcileOutputKey(t,n,e),this.didReconcileOutputKey(t,n,e))}},t.prototype.reconcileOutput=function(t){this._version<0&&(this.willReconcileOutput(t),this._effects.forEach(function(e){this.reconcileOutputKey(e,t)},this),this._version=t,this.onReconcileOutput(t),this.didReconcileOutput(t))},t.prototype.willInvalidateOutputKey=function(t,e){},t.prototype.onInvalidateOutputKey=function(t,e){},t.prototype.didInvalidateOutputKey=function(t,e){},t.prototype.willInvalidateOutput=function(){},t.prototype.onInvalidateOutput=function(){},t.prototype.didInvalidateOutput=function(){},t.prototype.willReconcileOutputKey=function(t,e,r){},t.prototype.onReconcileOutputKey=function(t,e,r){},t.prototype.didReconcileOutputKey=function(t,e,r){},t.prototype.willReconcileOutput=function(t){},t.prototype.onReconcileOutput=function(t){},t.prototype.didReconcileOutput=function(t){},t}(),Fr=function(){function t(){this._effects=new zt,this._outlets=new zt,this._outputs=null,this._version=-1}return t.prototype.outlet=function(t){var e=this._outlets.get(t);return void 0===e&&(e=new Ur(this,t),this._outlets=this._outlets.updated(t,e)),e},t.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},t.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},t.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},t.prototype.unbindOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.unbindOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1){e[r].unbindInput()}}},t.prototype.disconnectOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.disconnectOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1){var i=e[r];i.unbindInput(),i.disconnectOutputs()}}},t.prototype.disconnectInputs=function(){},t.prototype.invalidateInputKey=function(t,e){var r=this._effects;if(r.get(t)!==e){this.willInvalidateInputKey(t,e),this._effects=r.updated(t,e),this._version=-1,this.onInvalidateInputKey(t,e);for(var n=null!==this._outputs?this._outputs.length:0,i=0;i<n;i+=1){var o=this._outputs[i];Ar.is(o)?o.invalidateOutputKey(t,e):o.invalidateOutput()}var s=this._outlets.get(t);void 0!==s&&s.invalidateInput(),this.didInvalidateInputKey(t,e)}},t.prototype.invalidateInput=function(){if(this._version>=0){this.willInvalidateInput(),this._version=-1,this.onInvalidateInput();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this._outlets.forEach(function(t,e){e.invalidateInput()},this),this.didInvalidateInput()}},t.prototype.reconcileInputKey=function(t,e){if(this._version<0){var r=this._effects,n=r.get(t);if(void 0!==n){this.willReconcileInputKey(t,n,e),this._effects=r.removed(t),this.onReconcileInputKey(t,n,e);for(var i=0,o=null!==this._outputs?this._outputs.length:0;i<o;i+=1){var s=this._outputs[i];Ar.is(s)&&s.reconcileOutputKey(t,e)}var u=this._outlets.get(t);void 0!==u&&u.reconcileInput(e),this.didReconcileInputKey(t,n,e)}}},t.prototype.reconcileInput=function(t){if(this._version<0){this.willReconcileInput(t),this._effects.forEach(function(e){this.reconcileInputKey(e,t)},this),this._version=t,this.onReconcileInput(t);for(var e=0,r=null!==this._outputs?this._outputs.length:0;e<r;e+=1)this._outputs[e].reconcileOutput(t);this.didReconcileInput(t)}},t.prototype.willInvalidateInputKey=function(t,e){},t.prototype.onInvalidateInputKey=function(t,e){},t.prototype.didInvalidateInputKey=function(t,e){},t.prototype.willInvalidateInput=function(){},t.prototype.onInvalidateInput=function(){},t.prototype.didInvalidateInput=function(){},t.prototype.willReconcileInputKey=function(t,e,r){},t.prototype.onReconcileInputKey=function(t,e,r){},t.prototype.didReconcileInputKey=function(t,e,r){},t.prototype.willReconcileInput=function(t){},t.prototype.onReconcileInput=function(t){},t.prototype.didReconcileInput=function(t){},t.prototype.memoize=function(){var t=new Ir.MemoizeMapCombinator;return t.bindInput(this),t},t.prototype.filter=function(t){var e=new Ir.FilterFieldsCombinator(t);return e.bindInput(this),e},t.prototype.map=function(t){var e;return 1===t.length?((e=new Or.MapValueCombinator(t)).bindInput(this),e):((e=new Ir.MapFieldValuesCombinator(t)).bindInput(this),e)},t.prototype.reduce=function(t,e,r){var n=new Ir.ReduceFieldsCombinator(t,e,r);return n.bindInput(this),n},t.prototype.watch=function(t){return 1===t.length?(new Or.WatchValueCombinator(t).bindInput(this),this):(new Ir.WatchFieldsCombinator(t).bindInput(this),this)},t}(),zr=function(){function t(){this._input=null,this._effects=new zt,this._outlets=new zt,this._outputs=null,this._version=-1}return t.prototype.input=function(){return this._input},t.prototype.bindInput=function(t){if(!Ir.is(t))throw new TypeError(""+t);null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},t.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},t.prototype.disconnectInputs=function(){if(null===this._outputs&&this._outlets.isEmpty()){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())}},t.prototype.outlet=function(t){var e=this._outlets.get(t);return void 0===e&&(e=new Ur(this,t),this._outlets=this._outlets.updated(t,e)),e},t.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},t.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},t.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},t.prototype.unbindOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.unbindOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1){e[r].unbindInput()}}},t.prototype.disconnectOutputs=function(){if(null===this._input){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.disconnectOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1){var i=e[r];i.unbindInput(),i.disconnectOutputs()}}}},t.prototype.invalidateOutputKey=function(t,e){this.invalidateKey(t,e)},t.prototype.invalidateInputKey=function(t,e){this.invalidateKey(t,e)},t.prototype.invalidateKey=function(t,e){var r=this._effects;if(r.get(t)!==e){this.willInvalidateKey(t,e),this._effects=r.updated(t,e),this._version=-1,this.onInvalidateKey(t,e);for(var n=null!==this._outputs?this._outputs.length:0,i=0;i<n;i+=1){var o=this._outputs[i];Ar.is(o)?o.invalidateOutputKey(t,e):o.invalidateOutput()}var s=this._outlets.get(t);void 0!==s&&s.invalidateInput(),this.didInvalidateKey(t,e)}},t.prototype.invalidateOutput=function(){this.invalidate()},t.prototype.invalidateInput=function(){this.invalidate()},t.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this._outlets.forEach(function(t,e){e.invalidateInput()},this),this.didInvalidate()}},t.prototype.reconcileOutputKey=function(t,e){this.reconcileKey(t,e)},t.prototype.reconcileInputKey=function(t,e){this.reconcileKey(t,e)},t.prototype.reconcileKey=function(t,e){if(this._version<0){var r=this._effects,n=r.get(t);if(void 0!==n){this.willReconcileKey(t,n,e),this._effects=r.removed(t),null!==this._input&&this._input.reconcileInputKey(t,e),this.onReconcileKey(t,n,e);for(var i=0,o=null!==this._outputs?this._outputs.length:0;i<o;i+=1){var s=this._outputs[i];Ar.is(s)&&s.reconcileOutputKey(t,e)}var u=this._outlets.get(t);void 0!==u&&u.reconcileInput(e),this.didReconcileKey(t,n,e)}}},t.prototype.reconcileOutput=function(t){this.reconcile(t)},t.prototype.reconcileInput=function(t){this.reconcile(t)},t.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._effects.forEach(function(e){this.reconcileKey(e,t)},this),this._version=t,this.onReconcile(t);for(var e=0,r=null!==this._outputs?this._outputs.length:0;e<r;e+=1)this._outputs[e].reconcileOutput(t);this.didReconcile(t)}},t.prototype.willInvalidateKey=function(t,e){},t.prototype.onInvalidateKey=function(t,e){},t.prototype.didInvalidateKey=function(t,e){},t.prototype.willInvalidate=function(){},t.prototype.onInvalidate=function(){},t.prototype.didInvalidate=function(){},t.prototype.willReconcileKey=function(t,e,r){},t.prototype.onReconcileKey=function(t,e,r){},t.prototype.didReconcileKey=function(t,e,r){},t.prototype.willReconcile=function(t){},t.prototype.onReconcile=function(t){},t.prototype.didReconcile=function(t){},t.prototype.memoize=function(){var t=new Ir.MemoizeMapCombinator;return t.bindInput(this),t},t.prototype.filter=function(t){var e=new Ir.FilterFieldsCombinator(t);return e.bindInput(this),e},t.prototype.map=function(t){var e;return 1===t.length?((e=new Or.MapValueCombinator(t)).bindInput(this),e):((e=new Ir.MapFieldValuesCombinator(t)).bindInput(this),e)},t.prototype.reduce=function(t,e,r){var n=new Ir.ReduceFieldsCombinator(t,e,r);return n.bindInput(this),n},t.prototype.watch=function(t){return 1===t.length?(new Or.WatchValueCombinator(t).bindInput(this),this):(new Ir.WatchFieldsCombinator(t).bindInput(this),this)},t}(),Lr=function(){function t(){this._input=null,this._effects=new zt,this._outputs=null,this._version=-1}return t.prototype.input=function(){return this._input},t.prototype.bindInput=function(t){if(!Ir.is(t))throw new TypeError(""+t);null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},t.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},t.prototype.disconnectInputs=function(){if(null===this._outputs){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())}},t.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},t.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},t.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},t.prototype.unbindOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}},t.prototype.disconnectOutputs=function(){if(null===this._input){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1){var n=t[e];n.unbindInput(),n.disconnectOutputs()}}}},t.prototype.invalidateOutputKey=function(t,e){var r=this._effects;if(r.get(t)!==e){this.willInvalidateOutputKey(t,e),this._effects=r.updated(t,e),this._version=-1,this.onInvalidateOutputKey(t,e);for(var n=null!==this._outputs?this._outputs.length:0,i=0;i<n;i+=1){this._outputs[i].invalidateOutput()}this.didInvalidateOutputKey(t,e)}},t.prototype.invalidateOutput=function(){this.invalidate()},t.prototype.invalidateInput=function(){this.invalidate()},t.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this.didInvalidate()}},t.prototype.reconcileOutputKey=function(t,e){if(this._version<0){var r=this._effects,n=r.get(t);void 0!==n&&(this.willReconcileOutputKey(t,n,e),this._effects=r.removed(t),null!==this._input&&this._input.reconcileInputKey(t,e),this.onReconcileOutputKey(t,n,e),this.didReconcileOutputKey(t,n,e))}},t.prototype.reconcileOutput=function(t){this.reconcile(t)},t.prototype.reconcileInput=function(t){this.reconcile(t)},t.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._effects.forEach(function(e){this.reconcileOutputKey(e,t)},this),this._version=t,this.onReconcile(t);for(var e=0,r=null!==this._outputs?this._outputs.length:0;e<r;e+=1)this._outputs[e].reconcileOutput(t);this.didReconcile(t)}},t.prototype.willInvalidateOutputKey=function(t,e){},t.prototype.onInvalidateOutputKey=function(t,e){},t.prototype.didInvalidateOutputKey=function(t,e){},t.prototype.willInvalidate=function(){},t.prototype.onInvalidate=function(){},t.prototype.didInvalidate=function(){},t.prototype.willReconcileOutputKey=function(t,e,r){},t.prototype.onReconcileOutputKey=function(t,e,r){},t.prototype.didReconcileOutputKey=function(t,e,r){},t.prototype.willReconcile=function(t){},t.prototype.onReconcile=function(t){},t.prototype.didReconcile=function(t){},t.prototype.memoize=function(){var t=new Or.MemoizeValueCombinator;return t.bindInput(this),t},t.prototype.map=function(t){var e=new Or.MapValueCombinator(t);return e.bindInput(this),e},t.prototype.watch=function(t){return new Or.WatchValueCombinator(t).bindInput(this),this},t}(),qr=function(){function t(){this._input=null,this._outputEffects=new zt,this._inputEffects=new zt,this._outlets=new zt,this._outputs=null,this._version=-1}return t.prototype.input=function(){return this._input},t.prototype.bindInput=function(t){if(!Ir.is(t))throw new TypeError(""+t);null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},t.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},t.prototype.disconnectInputs=function(){if(null===this._outputs&&this._outlets.isEmpty()){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())}},t.prototype.outlet=function(t){var e=this._outlets.get(t);return void 0===e&&(e=new Ur(this,t),this._outlets=this._outlets.updated(t,e)),e},t.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},t.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},t.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},t.prototype.unbindOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.unbindOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1){e[r].unbindInput()}}},t.prototype.disconnectOutputs=function(){if(null===this._input){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.disconnectOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1){var i=e[r];i.unbindInput(),i.disconnectOutputs()}}}},t.prototype.invalidateOutputKey=function(t,e){var r=this._outputEffects;r.get(t)!==e&&(this.willInvalidateOutputKey(t,e),this._outputEffects=r.updated(t,e),this._version=-1,this.onInvalidateOutputKey(t,e),this.didInvalidateOutputKey(t,e))},t.prototype.invalidateInputKey=function(t,e){var r=this._inputEffects;if(r.get(t)!==e){this.willInvalidateInputKey(t,e),this._inputEffects=r.updated(t,e),this._version=-1,this.onInvalidateInputKey(t,e);for(var n=null!==this._outputs?this._outputs.length:0,i=0;i<n;i+=1){var o=this._outputs[i];Ar.is(o)?o.invalidateOutputKey(t,e):o.invalidateOutput()}var s=this._outlets.get(t);void 0!==s&&s.invalidateInput(),this.didInvalidateInputKey(t,e)}},t.prototype.invalidateOutput=function(){this.invalidate()},t.prototype.invalidateInput=function(){this.invalidate()},t.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this._outlets.forEach(function(t,e){e.invalidateInput()},this),this.didInvalidate()}},t.prototype.reconcileOutputKey=function(t,e){if(this._version<0){var r=this._outputEffects,n=r.get(t);void 0!==n&&(this.willReconcileOutputKey(t,n,e),this._outputEffects=r.removed(t),null!==this._input&&this._input.reconcileInputKey(t,e),this.onReconcileOutputKey(t,n,e),this.didReconcileOutputKey(t,n,e))}},t.prototype.reconcileInputKey=function(t,e){if(this._version<0){var r=this._inputEffects,n=r.get(t);if(void 0!==n){var i=this.willReconcileInputKey(t,n,e);n!==i&&this.invalidateInputKey(t,i),this._inputEffects=r.removed(t),this.onReconcileInputKey(t,i,e);for(var o=0,s=null!==this._outputs?this._outputs.length:0;o<s;o+=1){var u=this._outputs[o];Ar.is(u)&&u.reconcileOutputKey(t,e)}var a=this._outlets.get(t);void 0!==a&&a.reconcileInput(e),this.didReconcileInputKey(t,i,e)}}},t.prototype.reconcileOutput=function(t){this.reconcile(t)},t.prototype.reconcileInput=function(t){this.reconcile(t)},t.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._outputEffects.forEach(function(e){this.reconcileOutputKey(e,t)},this),this._inputEffects.forEach(function(e){this.reconcileInputKey(e,t)},this),this._version=t,this.onReconcile(t);for(var e=0,r=null!==this._outputs?this._outputs.length:0;e<r;e+=1)this._outputs[e].reconcileOutput(t);this.didReconcile(t)}},t.prototype.willInvalidateOutputKey=function(t,e){},t.prototype.onInvalidateOutputKey=function(t,e){},t.prototype.didInvalidateOutputKey=function(t,e){},t.prototype.willInvalidateInputKey=function(t,e){},t.prototype.onInvalidateInputKey=function(t,e){},t.prototype.didInvalidateInputKey=function(t,e){},t.prototype.willInvalidate=function(){},t.prototype.onInvalidate=function(){},t.prototype.didInvalidate=function(){},t.prototype.willReconcileOutputKey=function(t,e,r){},t.prototype.onReconcileOutputKey=function(t,e,r){},t.prototype.didReconcileOutputKey=function(t,e,r){},t.prototype.willReconcileInputKey=function(t,e,r){return e},t.prototype.onReconcileInputKey=function(t,e,r){},t.prototype.didReconcileInputKey=function(t,e,r){},t.prototype.willReconcile=function(t){},t.prototype.onReconcile=function(t){},t.prototype.didReconcile=function(t){},t.prototype.memoize=function(){var t=new Ir.MemoizeMapCombinator;return t.bindInput(this),t},t.prototype.filter=function(t){var e=new Ir.FilterFieldsCombinator(t);return e.bindInput(this),e},t.prototype.map=function(t){var e;return 1===t.length?((e=new Or.MapValueCombinator(t)).bindInput(this),e):((e=new Ir.MapFieldValuesCombinator(t)).bindInput(this),e)},t.prototype.reduce=function(t,e,r){var n=new Ir.ReduceFieldsCombinator(t,e,r);return n.bindInput(this),n},t.prototype.watch=function(t){return 1===t.length?(new Or.WatchValueCombinator(t).bindInput(this),this):(new Ir.WatchFieldsCombinator(t).bindInput(this),this)},t}(),Br=function(t){function e(e){var r=t.call(this)||this;return r._outlet=e,r}return y(e,t),e.prototype.outlet=function(){return this._outlet},e.prototype.onInvalidateOutput=function(){this._outlet.invalidateInput()},e.prototype.onReconcileOutput=function(t){this._outlet.reconcileInput(t)},e}(Tr),Nr=function(t){function e(e){var r=t.call(this)||this;return r._outlet=e,r}return y(e,t),e.prototype.outlet=function(){return this._outlet},e.prototype.onInvalidateOutputKey=function(t,e){this._outlet.invalidateInput()},e.prototype.onInvalidateOutput=function(){this._outlet.invalidateInput()},e.prototype.onReconcileOutputKey=function(t,e,r){this._outlet.reconcileInput(r)},e.prototype.onReconcileOutput=function(t){this._outlet.reconcileInput(t)},e}(Rr),Kr=function(t){function e(e){var r=t.call(this)||this;return r._state=e,r}return y(e,t),e.prototype.get=function(){return this._state},e.prototype.set=function(t){var e=this._state;return this._state=t,this.invalidateInput(),e},e}(Pr),Wr=function(t){function e(e){var r=t.call(this)||this;return r._state=e,r}return y(e,t),e.prototype.get=function(){return this._state},e.prototype.onReconcileOutput=function(t){null!==this._input&&(this._state=this._input.get())},e}(Tr),jr=function(t){function e(e){void 0===e&&(e=new zt);var r=t.call(this)||this;return r._state=e,e.forEach(function(t){this._effects=this._effects.updated(t,0)},r),r}return y(e,t),e.prototype.has=function(t){return this._state.has(t)},e.prototype.get=function(t){return void 0===t?this._state:this._state.get(t)},e.prototype.set=function(t,e){var r=this._state.get(t);return this._state=this._state.updated(t,e),this.invalidateInputKey(t,0),r},e.prototype.delete=function(t){var e=this._state,r=e.removed(t);return e!==r&&(this._state=r,this.invalidateInputKey(t,1)),this},e.prototype.keyIterator=function(){return this._state.keys()},e}(Fr),Hr=function(t){function e(){var e=t.call(this)||this;return e._state=new zt,e}return y(e,t),e.prototype.get=function(){return this._state},e.prototype.onReconcileOutputKey=function(t,e,r){if(0===e){if(null!==this._input){var n=this._input.get(t);this._state=void 0!==n?this._state.updated(t,n):this._state.removed(t)}}else 1===e&&(this._state=this._state.removed(t))},e}(Rr),Gr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.get=function(){return this._state},e.prototype.onReconcile=function(t){null!==this._input&&(this._state=this._input.get())},e.prototype.memoize=function(){return this},e}(Vr);Or.MemoizeValueCombinator=Gr;var Qr=function(t){function e(){var e=t.call(this)||this;return e._cache=new zt,e}return y(e,t),e.prototype.has=function(t){return this._cache.has(t)},e.prototype.get=function(t){return void 0===t?(void 0===this._state&&null!=this._input&&(this._state=this._input.get()),this._state):this._cache.get(t)},e.prototype.keyIterator=function(){return this._cache.keys()},e.prototype.onReconcileKey=function(t,e,r){if(0===e){if(null!==this._input){var n=this._input.get(t);this._cache=void 0!==n?this._cache.updated(t,n):this._cache.removed(t)}}else 1===e&&(this._cache=this._cache.removed(t))},e.prototype.onReconcile=function(t){this._state=void 0},e.prototype.memoize=function(){return this},e}(zr);Ir.MemoizeMapCombinator=Qr;var Xr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.has=function(t){if(null!==this._input){var e=this._input.get(t);return void 0!==e&&this.evaluate(t,e)}return!1},e.prototype.get=function(t){if(void 0===t){for(var e=new zt,r=this.keyIterator();;){var n=r.next();if(n.done)break;var i=n.value;void 0!==(o=this._input.get(i))&&this.evaluate(i,o)&&e.set(i,o)}return e}var o;if(null!==this._input&&void 0!==(o=this._input.get(t))&&this.evaluate(t,o))return o},e.prototype.keyIterator=function(){return null!==this._input?this._input.keyIterator():l.empty()},e.prototype.onInvalidateOutputKey=function(t,e){this.invalidateInputKey(t,e)},e.prototype.onReconcileOutputKey=function(t,e,r){this.reconcileInputKey(t,r)},e.prototype.willReconcileInputKey=function(t,e,r){if(0===e&&null!==this._input){var n=this._input.get(t);if(void 0===n||!this.evaluate(t,n))return 1}return e},e}(qr),Zr=function(t){function e(e){var r=t.call(this)||this;return r._func=e,r}return y(e,t),e.prototype.evaluate=function(t,e){return this._func(t,e)},e}(Xr);Ir.FilterFieldsCombinator=Zr;var Yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.get=function(){return null!==this._input?this.evaluate(this._input.get()):void 0},e}(Vr),$r=function(t){function e(e){var r=t.call(this)||this;return r._func=e,r}return y(e,t),e.prototype.evaluate=function(t){return void 0!==t?this._func(t):void 0},e}(Yr);Or.MapValueCombinator=$r;var Jr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.has=function(t){return null!==this._input&&this._input.has(t)},e.prototype.get=function(t){if(void 0===t){for(var e=new zt,r=this.keyIterator();;){var n=r.next();if(n.done)break;var i=n.value,o=this.evaluate(i,this._input.get(i));void 0!==o&&e.set(i,o)}return e}return null!==this._input?this.evaluate(t,this._input.get(t)):void 0},e.prototype.keyIterator=function(){return null!==this._input?this._input.keyIterator():l.empty()},e}(zr),tn=function(t){function e(e){var r=t.call(this)||this;return r._func=e,r}return y(e,t),e.prototype.evaluate=function(t,e){return void 0!==e?this._func(t,e):void 0},e}(Jr);Ir.MapFieldValuesCombinator=tn;var en=function(t){function e(){var e=t.call(this)||this;return e._state=new zt,e}return y(e,t),e.prototype.get=function(){return this._state.reduced(this.identity(),this.accumulate.bind(this),this.combine.bind(this))},e.prototype.onReconcileOutputKey=function(t,e,r){if(0===e){if(null!==this._input){var n=this._input.get(t);void 0!==n?this._state.set(t,n):this._state.delete(t)}}else 1===e&&this._state.delete(t)},e}(Lr),rn=function(t){function e(e,r,n){var i=t.call(this)||this;return i._identity=e,i._accumulator=r,i._combiner=n,i}return y(e,t),e.prototype.get=function(){return this._state.reduced(this._identity,this._accumulator,this._combiner)},e.prototype.identity=function(){return this._identity},e.prototype.accumulate=function(t,e){return this._accumulator(t,e)},e.prototype.combine=function(t,e){return this._combiner(t,e)},e}(en);Ir.ReduceFieldsCombinator=rn;var nn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.onReconcileOutput=function(t){null!==this._input&&this.evaluate(this._input.get())},e}(Tr),on=function(t){function e(e){var r=t.call(this)||this;return r._func=e,r}return y(e,t),e.prototype.evaluate=function(t){if(void 0!==t)return this._func(t)},e}(nn);Or.WatchValueCombinator=on;var sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.onReconcileOutputKey=function(t,e,r){0===e?null!==this._input?this.evaluate(t,this._input.get(t)):this.evaluate(t,void 0):1===e&&this.evaluate(t,void 0)},e}(Rr),un=function(t){function e(e){var r=t.call(this)||this;return r._func=e,r}return y(e,t),e.prototype.evaluate=function(t,e){if(void 0!==e)return this._func(t,e)},e}(sn);Ir.WatchFieldsCombinator=un;var an=function(t){function e(e){var r=t.call(this)||this;return r._streamlet=e,r}return y(e,t),e.prototype.streamlet=function(){return this._streamlet},e.prototype.willInvalidateOutput=function(){var t=this._streamlet;t.willInvalidateInlet&&t.willInvalidateInlet(this)},e.prototype.didInvalidateOutput=function(){var t=this._streamlet;t.didInvalidateInlet?t.didInvalidateInlet(this):t.invalidate()},e.prototype.willReconcileOutput=function(t){var e=this._streamlet;e.willReconcileInlet&&e.willReconcileInlet(this,t)},e.prototype.didReconcileOutput=function(t){var e=this._streamlet;e.didReconcileInlet?e.didReconcileInlet(this,t):e.reconcile(t)},e}(Tr),pn=function(t){function e(e){var r=t.call(this)||this;return r._streamlet=e,r}return y(e,t),e.prototype.streamlet=function(){return this._streamlet},e.prototype.get=function(){var t=this._streamlet;if(t.getOutput)return t.getOutput(this)},e.prototype.willInvalidateInput=function(){var t=this._streamlet;t.willInvalidateOutlet&&t.willInvalidateOutlet(this)},e.prototype.didInvalidateInput=function(){var t=this._streamlet;t.didInvalidateOutlet?t.didInvalidateOutlet(this):t.invalidate()},e.prototype.willReconcileInput=function(t){var e=this._streamlet;e.willReconcileOutlet&&e.willReconcileOutlet(this,t)},e.prototype.didReconcileInput=function(t){var e=this._streamlet;e.didReconcileOutlet&&e.didReconcileOutlet(this,t)},e}(Pr),hn=function(t){function e(e){var r=t.call(this)||this;return r._streamlet=e,r}return y(e,t),e.prototype.streamlet=function(){return this._streamlet},e.prototype.get=function(){var t=this._streamlet;if(t.getOutput){var e=t.getOutput(this);if(void 0!==e)return e}if(null!==this._input)return this._input.get()},e.prototype.willInvalidate=function(){var t=this._streamlet;t.willInvalidateOutlet&&t.willInvalidateOutlet(this)},e.prototype.didInvalidate=function(){var t=this._streamlet;t.didInvalidateOutlet?t.didInvalidateOutlet(this):t.invalidate()},e.prototype.willUpdate=function(t){var e=this._streamlet;e.willReconcileOutlet&&e.willReconcileOutlet(this,t)},e.prototype.didUpdate=function(t){var e=this._streamlet;e.didReconcileOutlet&&e.didReconcileOutlet(this,t)},e}(Vr),fn=function(){return function(t,e,r){this.key=t,this.name=e,this.type=r}}(),cn=function(){return function(t,e,r){this.key=t,this.name=e,this.type=r}}(),ln=function(){return function(t,e,r){this.key=t,this.name=e,this.type=r}}(),dn=function(){function t(t){void 0===t&&(t=null),this.scope=t,this._version=-1}return t.prototype.streamletClass=function(){return this.__proto__},t.prototype.streamletScope=function(){return this.scope},t.prototype.setStreamletScope=function(t){this.scope=t},t.prototype.streamletContext=function(){if(this.context)return this.context;var t=this.streamletScope();return null!==t?t.streamletContext():null},t.prototype.setStreamletContext=function(t){this.context=t},t.prototype.inlet=function(e){return void 0===e?new an(this):t.reflectInletKey(e,this,this.streamletClass())},t.prototype.bindInput=function(t,e){var r=this.inlet(t);if(null===r)throw new Error(""+t);r.bindInput(e)},t.prototype.unbindInput=function(t){var e=this.inlet(t);if(null===e)throw new Error(""+t);e.unbindInput()},t.prototype.outlet=function(e){return void 0===e?new pn(this):"string"==typeof e?t.reflectOutletKey(e,this,this.streamletClass()):e},t.prototype.inoutlet=function(){return new hn(this)},t.prototype.invalidate=function(){this._version>=0&&(this.willInvalidate(),this._version=-1,this.onInvalidate(),this.onInvalidateOutlets(),this.didInvalidate())},t.prototype.reconcile=function(t){this._version<0&&(this.willReconcile(t),this._version=t,this.onReconcileInlets(t),this.onReconcile(t),this.onReconcileOutlets(t),this.didReconcile(t))},t.prototype.getInput=function(t,e){var r;if("string"==typeof t&&(t=this.inlet(t)),null!==t){var n=t.input();null!==n&&(r=n.get())}return void 0===r&&(r=e),r},t.prototype.getOutput=function(t){},t.prototype.disconnectInputs=function(){t.disconnectInputs(this,this.streamletClass())},t.disconnectInputs=function(e,r){for(;r;){if(r.hasOwnProperty("_inlets"))for(var n in r._inlets){var i=r._inlets[n];if(i instanceof fn)t.reflectInletField(e,i).disconnectInputs();else if(i instanceof ln){t.reflectInoutletField(e,i).disconnectInputs()}}r=r.__proto__}},t.prototype.disconnectOutputs=function(){t.disconnectOutputs(this,this.streamletClass())},t.disconnectOutputs=function(e,r){for(;r;){if(r.hasOwnProperty("_outlets"))for(var n in r._outlets){var i=r._outlets[n];if(i instanceof cn)t.reflectOutletField(e,i).disconnectOutputs();else if(i instanceof ln){t.reflectInoutletField(e,i).disconnectOutputs()}}r=r.__proto__}},t.prototype.willInvalidateInlet=function(t){},t.prototype.didInvalidateInlet=function(t){this.invalidate()},t.prototype.willReconcileInlet=function(t,e){},t.prototype.didReconcileInlet=function(t,e){this.reconcile(e)},t.prototype.willInvalidateOutlet=function(t){},t.prototype.didInvalidateOutlet=function(t){},t.prototype.willReconcileOutlet=function(t,e){},t.prototype.didReconcileOutlet=function(t,e){},t.prototype.willInvalidate=function(){},t.prototype.onInvalidate=function(){},t.prototype.onInvalidateOutlets=function(){t.invalidateOutlets(this,this.streamletClass())},t.invalidateOutlets=function(e,r){for(;r;){if(r.hasOwnProperty("_outlets"))for(var n in r._outlets){var i=r._outlets[n];if(i instanceof cn)t.reflectOutletField(e,i).invalidateInput();else if(i instanceof ln){t.reflectInoutletField(e,i).invalidateInput()}}r=r.__proto__}},t.prototype.didInvalidate=function(){},t.prototype.willReconcile=function(t){},t.prototype.onReconcileInlets=function(e){t.reconcileInlets(e,this,this.streamletClass())},t.reconcileInlets=function(e,r,n){for(;n;){if(n.hasOwnProperty("_inlets"))for(var i in n._inlets){var o=n._inlets[i];if(o instanceof fn)t.reflectInletField(r,o).reconcileOutput(e);else if(o instanceof ln){t.reflectInoutletField(r,o).reconcileOutput(e)}}n=n.__proto__}},t.prototype.onReconcile=function(t){},t.prototype.onReconcileOutlets=function(e){t.reconcileOutlets(e,this,this.streamletClass())},t.reconcileOutlets=function(e,r,n){for(;n;){if(n.hasOwnProperty("_outlets"))for(var i in n._outlets){var o=n._outlets[i];if(o instanceof cn)t.reflectOutletField(r,o).reconcileInput(e);else if(o instanceof ln){t.reflectInoutletField(r,o).reconcileInput(e)}}n=n.__proto__}},t.prototype.didReconcile=function(t){},t.reflectEachInlet=function(e,r,n,i){for(var o=0;r;){if(r.hasOwnProperty("_inlets"))for(var s in r._inlets){var u=r._inlets[s],a=void 0;a=u instanceof fn?t.reflectInletField(e,u):u instanceof ln?t.reflectInoutletField(e,u):null;var p=n.call(i,a,u.name,o);if(void 0!==p)return p;o+=1}r=r.__proto__}},t.reflectEachOutlet=function(e,r,n,i){for(var o=0;r;){if(r.hasOwnProperty("_outlets"))for(var s in r._outlets){var u=r._outlets[s],a=void 0;a=u instanceof cn?t.reflectOutletField(e,u):u instanceof ln?t.reflectInoutletField(e,u):null;var p=n.call(i,a,u.name,o);if(void 0!==p)return p;o+=1}r=r.__proto__}},t.reflectInletCount=function(t){for(var e=0;t;){if(t.hasOwnProperty("_inlets"))for(var r in t._inlets)e+=1;t=t.__proto__}return e},t.reflectOutletCount=function(t){for(var e=0;t;){if(t.hasOwnProperty("_outlets"))for(var r in t._outlets)e+=1;t=t.__proto__}return e},t.reflectInletIndex=function(e,r,n){for(;n;){if(n.hasOwnProperty("_inlets"))for(var i in n._inlets){if(0===e){var o=n._inlets[i];return o instanceof fn?[o.name,t.reflectInletField(r,o)]:o instanceof ln?[o.name,t.reflectInoutletField(r,o)]:null}e-=1}n=n.__proto__}return null},t.reflectOutletIndex=function(e,r,n){for(;n;){if(n.hasOwnProperty("_outlets"))for(var i in n._outlets){if(0===e){var o=n._outlets[i];return o instanceof cn?[o.name,t.reflectOutletField(r,o)]:o instanceof ln?[o.name,t.reflectInoutletField(r,o)]:null}e-=1}n=n.__proto__}return null},t.reflectInletKey=function(e,r,n){for(;n;){if(n.hasOwnProperty("_inlets")){var i=n._inlets[e];if(void 0!==i)return i instanceof fn?t.reflectInletField(r,i):i instanceof ln?t.reflectInoutletField(r,i):null}n=n.__proto__}return null},t.reflectOutletKey=function(e,r,n){for(;n;){if(n.hasOwnProperty("_outlets")){var i=n._outlets[e];if(void 0!==i)return i instanceof cn?t.reflectOutletField(r,i):i instanceof ln?t.reflectInoutletField(r,i):null}n=n.__proto__}return null},t.reflectInletField=function(e,r){if("value"===r.type)return t.reflectValueInletField(e,r.key);if("map"===r.type)return t.reflectMapInletField(e,r.key);throw new TypeError(r.type)},t.reflectValueInletField=function(e,r){var n=e[r];return n||(n=e instanceof t?e.inlet():new an(e),e[r]=n),n},t.reflectMapInletField=function(t,e){return null},t.reflectOutletField=function(e,r){if("value"===r.type)return t.reflectValueOutletField(e,r.key);if("map"===r.type)return t.reflectMapOutletField(e,r.key);throw new TypeError(r.type)},t.reflectValueOutletField=function(e,r){var n=e[r];return n||(n=e instanceof t?e.outlet():new pn(e),e[r]=n),n},t.reflectMapOutletField=function(t,e){return null},t.reflectInoutletField=function(e,r){if("value"===r.type)return t.reflectValueInoutletField(e,r.key);if("map"===r.type)return t.reflectMapInoutletField(e,r.key);throw new TypeError(r.type)},t.reflectValueInoutletField=function(e,r){var n=e[r];return n||(n=e instanceof t?e.inoutlet():new hn(e),e[r]=n),n},t.reflectMapInoutletField=function(t,e){return null},t.init=function(t){t.hasOwnProperty("_inlets")||(t._inlets={}),t.hasOwnProperty("_outlets")||(t._outlets={}),t.hasOwnProperty("_inoutlets")||(t._inoutlets={})},t.decorateInlet=function(e,r,n){t.init(r);var i=void 0!==e.name?e.name:n,o=void 0!==e.type?e.type:"value",s=new fn(n,i,o);r._inlets[i]=s},t.decorateOutlet=function(e,r,n){t.init(r);var i=void 0!==e.name?e.name:n,o=void 0!==e.type?e.type:"value",s=new cn(n,i,o);r._outlets[i]=s},t.decorateInoutlet=function(e,r,n){t.init(r);var i=void 0!==e.name?e.name:n,o=void 0!==e.type?e.type:"value",s=new ln(n,i,o);r._inlets[i]=s,r._outlets[i]=s,r._inoutlets[i]=s},t}();function yn(t,e){if(1===arguments.length)return"string"==typeof t&&(t={name:t}),dn.decorateOutlet.bind(void 0,t);dn.decorateOutlet({},t,e)}function _n(t,e){if(1===arguments.length)return"string"==typeof t&&(t={name:t}),dn.decorateInoutlet.bind(void 0,t);dn.decorateInoutlet({},t,e)}var vn={is:function(t){if("object"==typeof t&&t){var e=t;return Ir.is(e)&&Mr.is(e)}return!1},Streamlet:void 0,Model:void 0,Scope:void 0,Dataflow:void 0},mn=function(t){function e(){var e=t.call(this)||this;return e._effects=new zt,e._outlets=new zt,e._outputs=null,e._version=-1,e}return y(e,t),e.prototype.streamletScope=function(){return null},e.prototype.streamletContext=function(){var t=this.streamletScope();return null!==t?t.streamletContext():null},e.prototype.hasOwn=function(t){return this.has(t)},e.prototype.get=function(e){return void 0===e?this:t.prototype.get.call(this,e)},e.prototype.outlet=function(t){if("string"==typeof t&&(t=fe.from(t)),!this.hasOwn(t)){var e=this.streamletScope();if(vn.is(e)&&e.has(t))return e.outlet(t)}var r=this._outlets.get(t);return void 0===r&&(r=new Ur(this,t),this._outlets=this._outlets.updated(t,r),this.invalidateInputKey(t,0)),r},e.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},e.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},e.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},e.prototype.unbindOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.unbindOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1)e[r].unbindInput()}},e.prototype.disconnectOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.disconnectOutputs()},this));var r=this._outputs;if(null!==r){this._outputs=null;for(var n=0,i=r.length;n<i;n+=1){var o=r[n];o.unbindInput(),o.disconnectOutputs()}}this.forEach(function(t){t instanceof Zt&&(t=t.toValue()),t instanceof e?t.disconnectOutputs():t instanceof vn.Streamlet?t.disconnectOutputs():vn.is(t)&&t.disconnectOutputs()},this)},e.prototype.disconnectInputs=function(){},e.prototype.invalidateInputKey=function(t,e){var r=this._effects;if(r.get(t)!==e){this.willInvalidateInputKey(t,e),this._effects=r.updated(t,e),this._version=-1,this.onInvalidateInputKey(t,e);for(var n=null!==this._outputs?this._outputs.length:0,i=0;i<n;i+=1){var o=this._outputs[i];Ar.is(o)?o.invalidateOutputKey(t,e):o.invalidateOutput()}var s=this._outlets.get(t);void 0!==s&&s.invalidateInput(),this.didInvalidateInputKey(t,e)}},e.prototype.invalidateInput=function(){if(this._version>=0){this.willInvalidateInput(),this._version=-1,this.onInvalidateInput();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this._outlets.forEach(function(t,e){e.invalidateInput()},this),this.didInvalidateInput()}},e.prototype.reconcileInputKey=function(t,e){if(this._version<0){var r=this._effects,n=r.get(t);if(void 0!==n){this.willReconcileInputKey(t,n,e),this._effects=r.removed(t),this.onReconcileInputKey(t,n,e);for(var i=0,o=null!==this._outputs?this._outputs.length:0;i<o;i+=1){var s=this._outputs[i];Ar.is(s)&&s.reconcileOutputKey(t,e)}var u=this._outlets.get(t);void 0!==u&&u.reconcileInput(e),this.didReconcileInputKey(t,n,e)}}},e.prototype.reconcileInput=function(t){if(this._version<0){this.willReconcileInput(t),this._effects.forEach(function(e){this.reconcileInputKey(e,t)},this),this._version=t,this.onReconcileInput(t);for(var r=0,n=null!==this._outputs?this._outputs.length:0;r<n;r+=1)this._outputs[r].reconcileOutput(t);this.forEach(function(r){r instanceof Zt&&(r=r.toValue()),r instanceof e?r.reconcileInput(t):r instanceof vn.Streamlet?r.reconcile(t):vn.is(r)&&r.reconcileInput(t)},this),this.didReconcileInput(t)}},e.prototype.willInvalidateInputKey=function(t,e){},e.prototype.onInvalidateInputKey=function(t,e){},e.prototype.didInvalidateInputKey=function(t,e){},e.prototype.willInvalidateInput=function(){},e.prototype.onInvalidateInput=function(){},e.prototype.didInvalidateInput=function(){},e.prototype.willReconcileInputKey=function(t,e,r){},e.prototype.onReconcileInputKey=function(t,e,r){},e.prototype.didReconcileInputKey=function(t,e,r){},e.prototype.willReconcileInput=function(t){},e.prototype.onReconcileInput=function(t){},e.prototype.didReconcileInput=function(t){},e.prototype.memoize=function(){var t=new Qr;return t.bindInput(this),t},e.prototype.filter=function(e){if("function"!=typeof e)return t.prototype.filter.call(this,e);var r=new Zr(e);return r.bindInput(this),r},e.prototype.map=function(t){var e;return 1===t.length?((e=new $r(t)).bindInput(this),e):((e=new tn(t)).bindInput(this),e)},e.prototype.reduce=function(t,e,r){var n=new rn(t,e,r);return n.bindInput(this),n},e.prototype.watch=function(t){return 1===t.length?(new on(t).bindInput(this),this):(new un(t).bindInput(this),this)},e}(oe),wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.isConstant=function(){return!1},e.prototype.streamletClass=function(){return this.__proto__},e.prototype.compile=function(){dn.reflectEachInlet(this,this.streamletClass(),function(t,e){null===t.input()&&this.compileInlet(t,e)},this)},e.prototype.compileInlet=function(t,e){var r=this.streamletScope();if(null!==r){var n=r.outlet(e);null!==n&&t.bindInput(n)}},e}(oe);vn.Streamlet=wn;var gn=function(t){function e(e){void 0===e&&(e=null);var r=t.call(this)||this;return r.scope=e,r.context=null,r._version=-1,r}return y(e,t),e.prototype.streamletScope=function(){return this.scope},e.prototype.setStreamletScope=function(t){this.scope=t},e.prototype.streamletContext=function(){if(this.context)return this.context;var t=this.streamletScope();return null!==t?t.streamletContext():null},e.prototype.setStreamletContext=function(t){this.context=t},e.prototype.isEmpty=function(){return 0!==this.length},Object.defineProperty(e.prototype,"length",{get:function(){return dn.reflectOutletCount(this.streamletClass())},enumerable:!0,configurable:!0}),e.prototype.has=function(t){if(t instanceof fe)t=t.value;else if("string"!=typeof t)return!1;return null!==this.outlet(t)},e.prototype.get=function(t){if(t instanceof fe)t=t.value;else if("string"!=typeof t)return ne.absent();var e=this.outlet(t);if(null!==e){var r=e.get();if(void 0!==r)return r}return ne.absent()},e.prototype.getAttr=function(t){return ne.absent()},e.prototype.getSlot=function(t){return this.get(t)},e.prototype.getField=function(t){if("string"==typeof t)t=fe.from(t);else if(!(t instanceof fe))return;var e=this.get(t);if(e.isDefined())return ee.of(t,e)},e.prototype.getItem=function(t){t instanceof ce&&(t=t.value);var e=dn.reflectOutletIndex(t,this,this.streamletClass());if(null!==e){var r=e[0],n=e[1].get();return void 0===n&&(n=ne.extant()),ee.of(r,n)}return Xt.absent()},e.prototype.set=function(t,e){throw new Error("unsupported")},e.prototype.setAttr=function(t,e){throw new Error("unsupported")},e.prototype.setSlot=function(t,e){throw new Error("unsupported")},e.prototype.setItem=function(t,e){throw new Error("unsupported")},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];throw new Error("unsupported")},e.prototype.splice=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];throw new Error("unsupported")},e.prototype.delete=function(t){throw new Error("unsupported")},e.prototype.clear=function(){throw new Error("unsupported")},e.prototype.forEach=function(t,e){return dn.reflectEachOutlet(this,this.streamletClass(),function(r,n,i){var o=r.get();if(void 0!==o){var s=t.call(e,o,i);if(void 0!==s)return s}},this)},e.prototype.inlet=function(t){return void 0===t?new an(this):dn.reflectInletKey(t,this,this.streamletClass())},e.prototype.bindInput=function(t,e){var r=this.inlet(t);if(null===r)throw new Error(""+t);r.bindInput(e)},e.prototype.unbindInput=function(t){var e=this.inlet(t);if(null===e)throw new Error(""+t);e.unbindInput()},e.prototype.outlet=function(t){return void 0===t?new pn(this):"string"==typeof t?dn.reflectOutletKey(t,this,this.streamletClass()):t},e.prototype.inoutlet=function(){return new hn(this)},e.prototype.invalidate=function(){this._version>=0&&(this.willInvalidate(),this._version=-1,this.onInvalidate(),this.onInvalidateOutlets(),this.didInvalidate())},e.prototype.reconcile=function(t){this._version<0&&(this.willReconcile(t),this._version=t,this.onReconcileInlets(t),this.onReconcile(t),this.onReconcileOutlets(t),this.didReconcile(t))},e.prototype.getInput=function(t,e){var r;if("string"==typeof t&&(t=this.inlet(t)),null!==t){var n=t.input();null!==n&&(r=n.get())}return void 0===r&&(r=e),r},e.prototype.castInput=function(t,e,r){var n,i=this.getInput(t);return void 0!==i&&(n=e.cast(i)),void 0===n&&(n=r),n},e.prototype.coerceInput=function(t,e,r){var n,i=this.getInput(t);return void 0!==i&&(n=e.cast(i)),void 0===n&&(n=e.unit()),void 0===n&&(n=r),n},e.prototype.getOutput=function(t){},e.prototype.disconnectInputs=function(){dn.disconnectInputs(this,this.streamletClass())},e.prototype.disconnectOutputs=function(){dn.disconnectOutputs(this,this.streamletClass())},e.prototype.willInvalidateInlet=function(t){},e.prototype.didInvalidateInlet=function(t){this.invalidate()},e.prototype.willReconcileInlet=function(t,e){},e.prototype.didReconcileInlet=function(t,e){this.reconcile(e)},e.prototype.willInvalidateOutlet=function(t){},e.prototype.didInvalidateOutlet=function(t){},e.prototype.willReconcileOutlet=function(t,e){},e.prototype.didReconcileOutlet=function(t,e){},e.prototype.willInvalidate=function(){},e.prototype.onInvalidate=function(){},e.prototype.didInvalidate=function(){},e.prototype.onInvalidateOutlets=function(){dn.invalidateOutlets(this,this.streamletClass())},e.prototype.willReconcile=function(t){},e.prototype.onReconcileInlets=function(t){dn.reconcileInlets(t,this,this.streamletClass())},e.prototype.onReconcile=function(t){},e.prototype.onReconcileOutlets=function(t){dn.reconcileOutlets(t,this,this.streamletClass())},e.prototype.didReconcile=function(t){},e}(wn),bn=function(t){function e(e,r){var n=t.call(this)||this;return n._record=e,n._key=r,n}return y(e,t),e.prototype.onInvalidateOutput=function(){vn.is(this._record)&&this._record.invalidateInputKey(this._key,0)},e.prototype.onReconcileOutput=function(t){if(null!==this._input){var e=this._input.get();void 0!==e?this._record.set(this._key,e):this._record.delete(this._key)}},e}(Tr),Sn=function(){function t(){}return t.system=function(){return null},t}(),xn=function(t){function e(e){void 0===e&&(e=oe.create());var r=t.call(this)||this;return r._state=e,r._fieldUpdaters=new zt,r}return y(e,t),e.prototype.isEmpty=function(){return this._state.isEmpty()},e.prototype.isArray=function(){return this._state.isArray()},e.prototype.isObject=function(){return this._state.isObject()},Object.defineProperty(e.prototype,"length",{get:function(){return this._state.length},enumerable:!0,configurable:!0}),e.prototype.fieldCount=function(){return this._state.fieldCount()},e.prototype.valueCount=function(){return this._state.valueCount()},e.prototype.has=function(t){if(this._state.has(t))return!0;var e=this.streamletScope();return e instanceof oe&&e.has(t)},e.prototype.hasOwn=function(t){return this._state.has(t)},e.prototype.indexOf=function(t,e){return this._state.indexOf(t,e)},e.prototype.lastIndexOf=function(t,e){return void 0===e&&(e=0),this._state.lastIndexOf(t,e)},e.prototype.get=function(t){if(void 0===t)return this;t=ne.fromAny(t);var e=this._state.get(t);if(!e.isDefined()){var r=this.streamletScope();r instanceof oe&&(e=r.get(t))}return e},e.prototype.getAttr=function(t){t=fe.fromAny(t);var e=this._state.getAttr(t);if(!e.isDefined()){var r=this.streamletScope();r instanceof oe&&(e=r.getAttr(t))}return e},e.prototype.getSlot=function(t){t=ne.fromAny(t);var e=this._state.getSlot(t);if(!e.isDefined()){var r=this.streamletScope();r instanceof oe&&(e=r.getSlot(t))}return e},e.prototype.getField=function(t){t=ne.fromAny(t);var e=this._state.getField(t);if(void 0===e){var r=this.streamletScope();r instanceof oe&&(e=r.getField(t))}return e},e.prototype.getItem=function(t){return this._state.getItem(t)},e.prototype.bindValue=function(t,e){var r=new bn(this,t),n=vn.Dataflow.compile(e,this);r.bindInput(n),this._fieldUpdaters=this._fieldUpdaters.updated(t,r)},e.prototype.set=function(t,e){if(t=ne.fromAny(t),this._state.has(t))this._state.set(t,e);else{var r=this.streamletScope();r instanceof oe&&r.has(t)?r.set(t,e):this._state.set(t,e)}return this.invalidateInputKey(t,0),this},e.prototype.setAttr=function(t,e){if(t=fe.fromAny(t),this._state.has(t))this._state.setAttr(t,e);else{var r=this.streamletScope();r instanceof oe&&r.has(t)?r.setAttr(t,e):this._state.setAttr(t,e)}return this.invalidateInputKey(t,0),this},e.prototype.setSlot=function(t,e){if(t=ne.fromAny(t),this._state.has(t))this._state.setSlot(t,e);else{var r=this.streamletScope();r instanceof oe&&r.has(t)?r.setSlot(t,e):this._state.setSlot(t,e)}return this.invalidateInputKey(t,0),this},e.prototype.setItem=function(t,e){var r=this._state.getItem(t);return e=Xt.fromAny(e),this._state.setItem(t,e),r instanceof Zt&&e instanceof Zt?r.key.equals(e.key)?this.invalidateInputKey(r.key,0):(this.invalidateInputKey(r.key,1),this.invalidateInputKey(e.key,0)):r instanceof Zt?this.invalidateInputKey(r.key,1):e instanceof Zt?this.invalidateInputKey(e.key,0):this.invalidateInput(),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this._state.length,n=this._state.push.apply(this._state,arguments);r<n;){var i=this._state.get(r);i instanceof Zt&&this.invalidateInputKey(i.key,0),r+=1}return n},e.prototype.splice=function(t,e){void 0===e&&(e=0);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=this._state.length;t<0&&(t=i+t),t=Math.max(0,t),e=Math.max(0,e);for(var o=this._state.splice.apply(this._state,arguments),s=0;s<o.length;s+=1){var u=o[s];u instanceof Zt&&this.invalidateInputKey(u.key,1)}for(s=t;s<t+r.length;s+=1){var a=this._state.get(s);a instanceof Zt&&this.invalidateInputKey(a.key,0)}return o},e.prototype.delete=function(t){var e=this._state.delete(t);return e instanceof Zt&&this.invalidateInputKey(e.key,1),e},e.prototype.clear=function(){var t=this._state.branch();this._state.clear(),t.forEach(function(t){t instanceof Zt&&this.invalidateInputKey(t.key,1)},this)},e.prototype.forEach=function(t,e){return this._state.forEach(t,e)},e.prototype.keyIterator=function(){throw new Error},e.prototype.disconnectInputs=function(){var t=this._fieldUpdaters;t.isEmpty()||(this._fieldUpdaters=new zt,t.forEach(function(t,e){e.disconnectInputs()},this))},e.prototype.memoize=function(){return this},e.prototype.materialize=function(t){t.forEach(function(t){this.materializeItem(t)},this)},e.prototype.materializeItem=function(t){t instanceof Zt?this.materializeField(t):this.materializeValue(t)},e.prototype.materializeField=function(t){var e=t.value;if(e instanceof wn)e.setStreamletScope(this),this._state.push(t);else if(e instanceof oe){var r=new vn.Scope(this);r.materialize(e),this._state.push(t.updatedValue(r))}else this._state.push(t)},e.prototype.materializeValue=function(t){if(t instanceof wn)t.setStreamletScope(this),this._state.push(t);else if(t instanceof oe){var e=new vn.Scope(this);e.materialize(t),this._state.push(e)}else this._state.push(t)},e.prototype.compile=function(t){t.forEach(function(t,e){this.compileItem(t,e)},this)},e.prototype.compileItem=function(t,e){t instanceof Zt?this.compileField(t,e):this.compileValue(t,e)},e.prototype.compileField=function(t,e){var r=t.key,n=t.value;r.isConstant()&&(n.isConstant()?this.invalidateInputKey(r,0):n instanceof wn?(n.compile(),this.invalidateInputKey(r,0)):n instanceof oe?(this._state.getItem(e).toValue().compile(n),this.invalidateInputKey(r,0)):(t.setValue(ne.extant()),this.bindValue(r,n)))},e.prototype.compileValue=function(t,e){t instanceof wn?t.compile():t instanceof oe?this._state.getItem(e).compile(t):t.isConstant()},e.prototype.transmute=function(t){void 0===t&&(t=Sn.system()),this.forEach(function(e,r){var n=this.transmuteItem(e,t);e!==n&&this.setItem(r,n)},this)},e.prototype.transmuteItem=function(t,e){return t instanceof Zt?this.transmuteField(t,e):this.transmuteValue(t,e)},e.prototype.transmuteField=function(t,e){var r=t.value,n=this.transmuteValue(r,e);return r!==n?t.updatedValue(n):t},e.prototype.transmuteValue=function(t,r){if(t instanceof e){var n=this.transmuteModel(t);return t===n&&r&&(n=r.transmute(t)),n}return t},e.prototype.transmuteModel=function(t){var r=this.streamletScope();return r instanceof e?r.transmuteModel(t):t},e.from=function(t){var r=new e;return r.materialize(t),r.compile(t),r},e.of=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.from(oe.of.apply(void 0,arguments))},e.globalScope=function(){var t=new e;return t.materializeField(ee.of("math",ir.scope().branch())),t},e}(mn);vn.Model=xn;var En=function(t){function e(e,r){var n=t.call(this,r)||this;return n.scope=e,n}return y(e,t),e.prototype.streamletScope=function(){return this.scope},e.from=function(t){var r=new e(e.globalScope());return r.materialize(t),r.compile(t),r},e.of=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.from(oe.of.apply(void 0,arguments))},e}(xn);vn.Scope=En;var kn=function(t){function e(){var e=t.call(this)||this;return e._keyInlet=new Br(e),e._mapInlet=new Nr(e),e}return y(e,t),e.prototype.keyInlet=function(){return this._keyInlet},e.prototype.mapInlet=function(){return this._mapInlet},e.prototype.get=function(){var t=this._keyInlet.input();if(null!==t){var e=t.get();if(void 0!==e){var r=this._mapInlet.input();if(null!==r){var n=r.get(e);if(void 0!==n)return n}}}return ne.absent()},e}(Pr),Cn=function(t){function e(){var e=t.call(this)||this;return e._operand1Inlet=new Br(e),e._operand2Inlet=new Br(e),e}return y(e,t),e.prototype.operand1Inlet=function(){return this._operand1Inlet},e.prototype.operand2Inlet=function(){return this._operand2Inlet},e.prototype.get=function(){var t=this._operand1Inlet.input(),e=this._operand2Inlet.input();if(null!==t&&null!==e){var r=t.get(),n=e.get();if(void 0!==r&&void 0!==n)return this.evaluate(r,n).toValue()}return ne.absent()},e}(Pr),On=function(t){function e(){var e=t.call(this)||this;return e._operandInlet=new Br(e),e}return y(e,t),e.prototype.operandInlet=function(){return this._operandInlet},e.prototype.get=function(){var t=this._operandInlet.input();if(null!==t){var e=t.get();if(void 0!==e)return this.evaluate(e).toValue()}return ne.absent()},e}(Pr),An=function(t){function e(){var e=t.call(this)||this;return e._ifInlet=new Br(e),e._thenInlet=new Br(e),e._elseInlet=new Br(e),e}return y(e,t),e.prototype.ifInlet=function(){return this._ifInlet},e.prototype.thenInlet=function(){return this._thenInlet},e.prototype.elseInlet=function(){return this._elseInlet},e.prototype.get=function(){var t=this._ifInlet.input();if(null!==t){var e=t.get();if(void 0!==e)if(e.booleanValue(!1)){var r=this._thenInlet.input();if(null!==r){var n=r.get();if(void 0!==n)return n}}else{var i=this._elseInlet.input();if(null!==i){var o=i.get();if(void 0!==o)return o}}}return ne.absent()},e}(Pr),In=function(t){function e(){var e=t.call(this)||this;return e._operand1Inlet=new Br(e),e._operand2Inlet=new Br(e),e}return y(e,t),e.prototype.operand1Inlet=function(){return this._operand1Inlet},e.prototype.operand2Inlet=function(){return this._operand2Inlet},e.prototype.get=function(){var t=this._operand1Inlet.input(),e=null!==t?t.get():void 0;if(void 0!==e&&e.booleanValue(!1))return e;var r=this._operand2Inlet.input(),n=null!==r?r.get():void 0;return void 0!==n?n:ne.absent()},e}(Pr),Dn=function(t){function e(){var e=t.call(this)||this;return e._operand1Inlet=new Br(e),e._operand2Inlet=new Br(e),e}return y(e,t),e.prototype.operand1Inlet=function(){return this._operand1Inlet},e.prototype.operand2Inlet=function(){return this._operand2Inlet},e.prototype.get=function(){var t=this._operand1Inlet.input(),e=null!==t?t.get():void 0;if(void 0!==e){if(e.booleanValue(!1)){var r=this._operand2Inlet.input(),n=null!==r?r.get():void 0;if(void 0!==n)return n}return e}return ne.absent()},e}(Pr),Mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.bitwiseOr(e)},e}(Cn),Tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.bitwiseXor(e)},e}(Cn),Pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.bitwiseAnd(e)},e}(Cn),Vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.lt(e)},e}(Cn),Un=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.le(e)},e}(Cn),Rn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.eq(e)},e}(Cn),Fn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.ne(e)},e}(Cn),zn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.ge(e)},e}(Cn),Ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.gt(e)},e}(Cn),qn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.plus(e)},e}(Cn),Bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.minus(e)},e}(Cn),Nn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.times(e)},e}(Cn),Kn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.divide(e)},e}(Cn),Wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t,e){return t.modulo(e)},e}(Cn),jn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t){return t.not()},e}(On),Hn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t){return t.bitwiseNot()},e}(On),Gn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t){return t.negative()},e}(On),Qn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.evaluate=function(t){return t.positive()},e}(On),Xn=function(t){function e(e){var r=t.call(this)||this;return r._scope=e,r._funcInlet=new Br(r),r._argsInlet=new Br(r),r}return y(e,t),e.prototype.funcInlet=function(){return this._funcInlet},e.prototype.argsInlet=function(){return this._argsInlet},e.prototype.get=function(){var t=this._funcInlet.input(),e=this._argsInlet.input();if(null!==t&&null!==e){var r=t.get();if(r instanceof ve){var n=e.get();if(void 0!==n){var i=new Jt;return i.pushScope(this._scope),r.invoke(n,i,void 0).toValue()}}}return ne.absent()},e}(Pr),Zn=function(){function t(){}return t.compile=function(e,r){if(r instanceof Ur){var n=r.get();Or.is(n)&&(r=n)}if(e.isConstant())return new Kr(e);if(e instanceof _e)return t.compileSelector(e,r);if(e instanceof ye)return t.compileOperator(e,r);throw new TypeError(""+e)},t.compileSelector=function(e,r){if(e instanceof He)return t.compileIdentitySelector(r);if(e instanceof Ge)return t.compileGetSelector(e,r);if(e instanceof Qe)return t.compileGetAttrSelector(e,r);if(e instanceof Xe)return t.compileGetItemSelector(e,r);if(e instanceof Ze)return t.compileKeysSelector(r);if(e instanceof Ye)return t.compileValuesSelector(r);if(e instanceof $e)return t.compileChildrenSelector(r);if(e instanceof Je)return t.compileDescendantsSelector(r);if(e instanceof tr)return t.compileFilterSelector(e,r);throw new TypeError(""+e)},t.compileIdentitySelector=function(t){return t},t.compileGetSelector=function(e,r){var n=e.accessor();if(!n.isConstant()){var i=new kn;o=t.compile(n,r);return i.keyInlet().bindInput(o),i.mapInlet().bindInput(r),i}if(vn.is(r)){if(null!==(o=r.outlet(n)))return t.compile(e.then(),o)}else if(Mr.is(r)){var o,s=n.stringValue(void 0);if(void 0!==s)if(null!==(o=r.outlet(s)))return t.compile(e.then(),o)}return null},t.compileGetAttrSelector=function(t,e){throw new Error},t.compileGetItemSelector=function(t,e){throw new Error},t.compileKeysSelector=function(t){throw new Error},t.compileValuesSelector=function(t){throw new Error},t.compileChildrenSelector=function(t){throw new Error},t.compileDescendantsSelector=function(t){throw new Error},t.compileFilterSelector=function(t,e){throw new Error},t.compileOperator=function(e,r){if(e instanceof Ee)return t.compileConditionalOperator(e,r);if(e instanceof Se)return t.compileBinaryOperator(e,r);if(e instanceof xe)return t.compileUnaryOperator(e,r);if(e instanceof je)return t.compileInvokeOperator(e,r);throw new TypeError(""+e)},t.compileConditionalOperator=function(e,r){var n=new An,i=e.ifTerm().toValue(),o=e.thenTerm().toValue(),s=e.elseTerm().toValue(),u=t.compile(i,r),a=t.compile(o,r),p=t.compile(s,r);return n.ifInlet().bindInput(u),n.thenInlet().bindInput(a),n.elseInlet().bindInput(p),n},t.compileBinaryOperator=function(e,r){if(e instanceof ke)return t.compileOrOperator(e,r);if(e instanceof Ce)return t.compileAndOperator(e,r);if(e instanceof Oe)return t.compileBitwiseOrOperator(e,r);if(e instanceof Ae)return t.compileBitwiseXorOperator(e,r);if(e instanceof Ie)return t.compileBitwiseAndOperator(e,r);if(e instanceof De)return t.compileLtOperator(e,r);if(e instanceof Me)return t.compileLeOperator(e,r);if(e instanceof Te)return t.compileEqOperator(e,r);if(e instanceof Pe)return t.compileNeOperator(e,r);if(e instanceof Ve)return t.compileGeOperator(e,r);if(e instanceof Ue)return t.compileGtOperator(e,r);if(e instanceof Re)return t.compilePlusOperator(e,r);if(e instanceof Fe)return t.compileMinusOperator(e,r);if(e instanceof ze)return t.compileTimesOperator(e,r);if(e instanceof Le)return t.compileDivideOperator(e,r);if(e instanceof qe)return t.compileModuloOperator(e,r);throw new TypeError(""+e)},t.compileBinaryOutlet=function(e,r,n){var i=e.operand1().toValue(),o=e.operand2().toValue(),s=t.compile(i,n),u=t.compile(o,n);return r.operand1Inlet().bindInput(s),r.operand2Inlet().bindInput(u),r},t.compileOrOperator=function(e,r){var n=new In,i=e.operand1().toValue(),o=e.operand2().toValue(),s=t.compile(i,r),u=t.compile(o,r);return n.operand1Inlet().bindInput(s),n.operand2Inlet().bindInput(u),n},t.compileAndOperator=function(e,r){var n=new Dn,i=e.operand1().toValue(),o=e.operand2().toValue(),s=t.compile(i,r),u=t.compile(o,r);return n.operand1Inlet().bindInput(s),n.operand2Inlet().bindInput(u),n},t.compileBitwiseOrOperator=function(e,r){return t.compileBinaryOutlet(e,new Mn,r)},t.compileBitwiseXorOperator=function(e,r){return t.compileBinaryOutlet(e,new Tn,r)},t.compileBitwiseAndOperator=function(e,r){return t.compileBinaryOutlet(e,new Pn,r)},t.compileLtOperator=function(e,r){return t.compileBinaryOutlet(e,new Vn,r)},t.compileLeOperator=function(e,r){return t.compileBinaryOutlet(e,new Un,r)},t.compileEqOperator=function(e,r){return t.compileBinaryOutlet(e,new Rn,r)},t.compileNeOperator=function(e,r){return t.compileBinaryOutlet(e,new Fn,r)},t.compileGeOperator=function(e,r){return t.compileBinaryOutlet(e,new zn,r)},t.compileGtOperator=function(e,r){return t.compileBinaryOutlet(e,new Ln,r)},t.compilePlusOperator=function(e,r){return t.compileBinaryOutlet(e,new qn,r)},t.compileMinusOperator=function(e,r){return t.compileBinaryOutlet(e,new Bn,r)},t.compileTimesOperator=function(e,r){return t.compileBinaryOutlet(e,new Nn,r)},t.compileDivideOperator=function(e,r){return t.compileBinaryOutlet(e,new Kn,r)},t.compileModuloOperator=function(e,r){return t.compileBinaryOutlet(e,new Wn,r)},t.compileUnaryOperator=function(e,r){if(e instanceof Be)return t.compileNotOperator(e,r);if(e instanceof Ne)return t.compileBitwiseNotOperator(e,r);if(e instanceof Ke)return t.compileNegativeOperator(e,r);if(e instanceof We)return t.compilePositiveOperator(e,r);throw new TypeError(""+e)},t.compileUnaryOutlet=function(e,r,n){var i=e.operand().toValue(),o=t.compile(i,n);return r.operandInlet().bindInput(o),r},t.compileNotOperator=function(e,r){return t.compileUnaryOutlet(e,new jn,r)},t.compileBitwiseNotOperator=function(e,r){return t.compileUnaryOutlet(e,new Hn,r)},t.compileNegativeOperator=function(e,r){return t.compileUnaryOutlet(e,new Gn,r)},t.compilePositiveOperator=function(e,r){return t.compileUnaryOutlet(e,new Qn,r)},t.compileInvokeOperator=function(e,r){var n=e.func(),i=e.args(),o=new Xn(r),s=t.compile(n,r),u=t.compile(i,r);return o.funcInlet().bindInput(s),o.argsInlet().bindInput(u),o},t}();vn.Dataflow=Zn;var Yn=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._keyParser=n,s._valueParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._keyParser,this._valueParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;t:for(;;){if(1===s){for(;t.isCont()&&(u=t.head(),Yi.isWhitespace(u));)t=t.step();if(t.isCont())if(33===u||34===u||36===u||37===u||39===u||40===u||43===u||45===u||u>=48&&u<=57||64===u||91===u||123===u||126===u||Yi.isIdentStartChar(u))n=n||r.valueBuilder(),s=2;else{if(35!==u)return n?ht.done(n.bind()):ht.done(r.absent());t=t.step(),s=7}else if(t.isDone())return n?ht.done(n.bind()):ht.done(r.absent())}if(2===s){for(i||(i=r.parseBlockExpression(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=3;else if(i.isError())return i}if(3===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont())58===u?(t=t.step(),s=4):(n.push(r.item(i.bind())),i=void 0,s=6);else if(t.isDone())return n.push(r.item(i.bind())),ht.done(n.bind())}if(4===s){for(;t.isCont()&&Yi.isSpace(t.head());)t=t.step();if(t.isCont())s=5;else if(t.isDone())return n.push(r.slot(i.bind())),ht.done(n.bind())}if(5===s){for(o||(o=r.parseBlockExpression(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())n.push(r.slot(i.bind(),o.bind())),i=void 0,o=void 0,s=6;else if(o.isError())return o}if(6===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(44===u||59===u||Yi.isNewline(u)){t=t.step(),s=1;continue}if(35!==u)return ht.done(n.bind());t=t.step(),s=7}else if(t.isDone())return ht.done(n.bind())}if(7===s){for(;t.isCont();){if(u=t.head(),Yi.isNewline(u)){s=1;continue t}t=t.step()}if(t.isDone()){s=1;continue}}break}return new e(r,n,i,o,s)},e}(ht),$n=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._recon=e,o._keyParser=r,o._valueParser=n,o._step=i,o}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._keyParser,this._valueParser,this._step)},e.parse=function(t,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o)if(t.isCont()){if(64!==(s=t.head()))return ht.error(at.expected(64,t));t=t.step(),o=2}else if(t.isDone())return ht.error(at.expected(64,t));if(2===o){if(n)n=n.feed(t);else if(t.isCont())if(34===(s=t.head())||39===s)n=r.parseString(t);else{if(!Yi.isIdentStartChar(s))return ht.error(at.expected("attribute name",t));n=r.parseIdent(t)}else if(t.isDone())return ht.error(at.expected("attribute name",t));if(n)if(n.isDone())o=3;else if(n.isError())return n.asError()}if(3===o)if(t.isCont()&&40===t.head())t=t.step(),o=4;else if(!t.isEmpty())return ht.done(r.attr(n.bind()));if(4===o){for(;t.isCont()&&(s=t.head(),Yi.isWhitespace(s));)t=t.step();if(t.isCont()){if(41===s)return t=t.step(),ht.done(r.attr(n.bind()));o=5}else if(t.isDone())return ht.error(at.expected(")",t))}if(5===o){for(i||(i=r.parseBlock(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())o=6;else if(i.isError())return i.asError()}if(6===o){for(;t.isCont()&&(s=t.head(),Yi.isWhitespace(s));)t=t.step();if(t.isCont())return 41===s?(t=t.step(),ht.done(r.attr(n.bind(),i.bind()))):ht.error(at.expected(")",t));if(t.isDone())return ht.error(at.expected(")",t))}return new e(r,n,i,o)},e}(ht),Jn=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._fieldParser=n,s._valueParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._fieldParser,this._valueParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);for(var u=0;;){if(1===s)if(t.isCont())if(64===(u=t.head()))i=r.parseAttr(t),s=2;else if(123===u)n=n||r.recordBuilder(),o=r.parseRecord(t,n),s=5;else if(91===u)n=n||r.recordBuilder(),o=r.parseMarkup(t,n),s=5;else if(Yi.isIdentStartChar(u))o=r.parseIdent(t),s=4;else if(34===u||39===u)o=r.parseString(t),s=4;else if(45===u||u>=48&&u<=57)o=r.parseNumber(t),s=4;else if(37===u)o=r.parseData(t),s=4;else{if(36!==u)return n?ht.done(n.bind()):ht.done(r.extant());o=r.parseSelector(t),s=4}else if(t.isDone())return n?ht.done(n.bind()):ht.done(r.extant());if(2===s){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())(n=n||r.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s){for(;t.isCont()&&Yi.isSpace(t.head());)t=t.step();if(t.isCont()){s=1;continue}if(t.isDone())return ht.done(n.bind())}if(4===s){for(;o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())(n=n||r.valueBuilder()).push(r.item(o.bind())),o=void 0,s=6;else if(o.isError())return o}if(5===s){for(;o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())o=void 0,s=6;else if(o.isError())return o}if(6===s){for(;t.isCont()&&Yi.isSpace(t.head());)t=t.step();if(t.isCont()){if(64!==t.head())return ht.done(n.bind());s=1}else if(t.isDone())return ht.done(n.bind())}break}return new e(r,n,i,o,s)},e}(ht),ti=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._fieldParser=n,s._valueParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._fieldParser,this._valueParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s)if(t.isCont())if(64===(u=t.head()))i=r.parseAttr(t),s=2;else if(123===u)n?(o=r.parseRecord(t,n),s=5):(o=r.parseRecord(t),s=4);else{if(91!==u)return n?ht.done(n.bind()):ht.done(r.extant());n?(o=r.parseMarkup(t,n),s=5):(o=r.parseMarkup(t),s=4)}else if(t.isDone())return n?ht.done(n.bind()):ht.done(r.extant());if(2===s){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())(n=n||r.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s)if(t.isCont())if(123===(u=t.head()))o=r.parseRecord(t,n),s=5;else{if(91!==u)return ht.done(n.bind());o=r.parseMarkup(t,n),s=5}else if(t.isDone())return ht.done(n.bind());if(4===s){for(;o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())return(n=n||r.valueBuilder()).push(r.item(o.bind())),ht.done(n.bind());if(o.isError())return o}if(5===s){for(;o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())return ht.done(n.bind());if(o.isError())return o}return new e(r,n,i,o,s)},e}(ht),ei=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._keyParser=n,s._valueParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._keyParser,this._valueParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s)if(t.isCont()){if(123!==(u=t.head()))return ht.error(at.expected(123,t));t=t.step(),s=2}else if(t.isDone())return ht.error(at.expected(123,t));t:for(;;){if(2===s){for(;t.isCont()&&(u=t.head(),Yi.isWhitespace(u));)t=t.step();if(t.isCont()){if(n=n||r.recordBuilder(),125===u)return t=t.step(),ht.done(n.bind());35===u?(t=t.step(),s=8):s=3}else if(t.isDone())return ht.error(at.expected(125,t))}if(3===s){for(i||(i=r.parseBlockExpression(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=4;else if(i.isError())return i}if(4===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont())58===u?(t=t.step(),s=5):(n.push(r.item(i.bind())),i=void 0,s=7);else if(t.isDone())return ht.error(at.expected(125,t))}if(5===s){for(;t.isCont()&&Yi.isSpace(t.head());)t=t.step();if(t.isCont())s=6;else if(t.isDone())return n.push(r.slot(i.bind())),ht.done(n.bind())}if(6===s){for(o||(o=r.parseBlockExpression(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())n.push(r.slot(i.bind(),o.bind())),i=void 0,o=void 0,s=7;else if(o.isError())return o}if(7===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(44===u||59===u||Yi.isNewline(u)){t=t.step(),s=2;continue}if(35!==u)return 125===u?(t=t.step(),ht.done(n.bind())):ht.error(at.expected("'}', ';', ',', or newline",t));t=t.step(),s=8}else if(t.isDone())return ht.error(at.expected(125,t))}if(8===s){for(;t.isCont();){if(u=t.head(),Yi.isNewline(u)){s=2;continue t}t=t.step()}if(t.isDone()){s=2;continue}}break}return new e(r,n,i,o,s)},e}(ht),ri=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._textOutput=n,s._valueParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._textOutput,this._valueParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s)if(t.isCont()){if(91!==(u=t.head()))return ht.error(at.expected(91,t));t=t.step(),s=2}else if(t.isDone())return ht.error(at.expected(91,t));for(;;){if(2===s){for(;t.isCont()&&64!==(u=t.head())&&91!==u&&92!==u&&93!==u&&123!==u&&125!==u;)t=t.step(),(i=i||r.textOutput()).write(u);if(t.isCont()){if(93===u)return t=t.step(),n=n||r.recordBuilder(),i&&n.push(r.item(i.bind())),ht.done(n.bind());if(64===u)n=n||r.recordBuilder(),i&&(n.push(r.item(i.bind())),i=void 0),o=r.parseInlineItem(t),s=3;else if(123===u)n=n||r.recordBuilder(),i&&(n.push(r.item(i.bind())),i=void 0),o=r.parseRecord(t,n),s=4;else if(91===u)n=n||r.recordBuilder(),i&&(n.push(r.item(i.bind())),i=void 0),o=r.parseMarkup(t,n),s=4;else{if(92!==u)return ht.error(at.unexpected(t));t=t.step(),s=5}}else if(t.isDone())return ht.error(at.unexpected(t))}if(3===s){for(;o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){n.push(r.item(o.bind())),o=void 0,s=2;continue}if(o.isError())return o}if(4===s){for(;o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){o=void 0,s=2;continue}if(o.isError())return o}if(5===s){if(t.isCont()){if(u=t.head(),i=i||r.textOutput(),34===u||36===u||39===u||47===u||64===u||91===u||92===u||93===u||123===u||125===u)t=t.step(),i.write(u),s=2;else if(98===u)t=t.step(),i.write(8),s=2;else if(102===u)t=t.step(),i.write(12),s=2;else if(110===u)t=t.step(),i.write(10),s=2;else if(114===u)t=t.step(),i.write(13),s=2;else{if(116!==u)return ht.error(at.expected("escape character",t));t=t.step(),i.write(9),s=2}continue}if(t.isDone())return ht.error(at.expected("escape character",t))}break}return new e(r,n,i,o,s)},e}(ht),ni=function(t){function e(e,r,n){var i=t.call(this)||this;return i._recon=e,i._base64Parser=r,i._step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._base64Parser,this._step)},e.parse=function(t,r,n,i){void 0===i&&(i=1);if(1===i)if(t.isCont()){if(37!==t.head())return ht.error(at.expected(37,t));t=t.step(),i=2}else if(t.isDone())return ht.error(at.expected(37,t));if(2===i){for(n||(n=It.standard().parse(t,r.dataOutput()));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())return n;if(n.isError())return n}return new e(r,n,i)},e}(ht),ii=function(t){function e(e,r,n){var i=t.call(this)||this;return i._recon=e,i._output=r,i._step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._output,this._step)},e.parse=function(t,r,n,i){void 0===i&&(i=1);var o=0;if(1===i)if(t.isCont()){if(o=t.head(),!Yi.isIdentStartChar(o))return ht.error(at.expected("identifier",t));t=t.step(),n=(n=n||r.textOutput()).write(o),i=2}else if(t.isDone())return ht.error(at.expected("identifier",t));if(2===i){for(;t.isCont()&&(o=t.head(),Yi.isIdentChar(o));)t=t.step(),n.write(o);if(!t.isEmpty())return ht.done(r.ident(n.bind()))}return new e(r,n,i)},e}(ht),oi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._output=r,s._quote=n,s._code=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._output,this._quote,this._code,this._step)},e.parse=function(t,r,n,i,o,s){void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=1);var u=0;if(1===s){for(;t.isCont()&&(u=t.head(),Yi.isWhitespace(u));)t=t.step();if(t.isCont()){if(34!==u&&(39!==u||i!==u&&0!==i))return ht.error(at.expected("string",t));t=t.step(),n=n||r.textOutput(),i=u,s=2}else if(t.isDone())return ht.error(at.expected("string",t))}t:for(;;){if(2===s){for(;t.isCont()&&(u=t.head())>=32&&u!==i&&92!==u;)t=t.step(),n.write(u);if(t.isCont()){if(u===i)return t=t.step(),ht.done(n.bind());if(92!==u)return ht.error(at.expected(i,t));t=t.step(),s=3}else if(t.isDone())return ht.error(at.expected(i,t))}if(3===s)if(t.isCont()){if(34===(u=t.head())||36===u||39===u||47===u||64===u||91===u||92===u||93===u||123===u||125===u){t=t.step(),n.write(u),s=2;continue}if(98===u){t=t.step(),n.write(8),s=2;continue}if(102===u){t=t.step(),n.write(12),s=2;continue}if(110===u){t=t.step(),n.write(10),s=2;continue}if(114===u){t=t.step(),n.write(13),s=2;continue}if(116===u){t=t.step(),n.write(9),s=2;continue}if(117!==u)return ht.error(at.expected("escape character",t));t=t.step(),s=4}else if(t.isDone())return ht.error(at.expected("escape character",t));if(s>=4)for(;;){if(t.isCont()){if(u=t.head(),wt.isDigit(u)){if(t=t.step(),o=16*o+wt.decodeDigit(u),s<=6){s+=1;continue}n.write(o),o=0,s=2;continue t}return ht.error(at.expected("hex digit",t))}if(t.isDone())return ht.error(at.expected("hex digit",t));break}break}return new e(r,n,i,o,s)},e}(ht),si=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._sign=r,s._value=n,s._mode=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._sign,this._value,this._mode,this._step)},e.parse=function(t,r,n,i,o,s){void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=2),void 0===s&&(s=1);var u=0;if(1===s){for(;t.isCont()&&(u=t.head(),Yi.isWhitespace(u));)t=t.step();if(t.isCont())45===u&&(t=t.step(),n=-1),s=2;else if(t.isDone())return ht.error(at.expected("number",t))}if(2===s)if(t.isCont())if(48===(u=t.head()))t=t.step(),s=4;else{if(!(u>=49&&u<=57))return ht.error(at.expected("digit",t));t=t.step(),i=n*(u-48),s=3}else if(t.isDone())return ht.error(at.expected("digit",t));if(3===s){for(;t.isCont()&&(u=t.head())>=48&&u<=57;){var a=10*i+n*(u-48);if(!(-9007199254740991<=a&&a<=9007199254740992))return ht.error(at.message("integer overflow",t));i=a,t=t.step()}if(t.isCont())s=4;else if(t.isDone())return ht.done(r.num(i))}if(4===s){if(t.isCont()){if(u=t.head(),o>0&&46===u||o>1&&(69===u||101===u)){var p=X.stringOutput();return p=n<0&&0===i?p.write(45).write(48):p.write(""+i),ui.parse(t,r,p,o)}return 120===u&&n>0&&0===i?(t=t.step(),ai.parse(t,r)):ht.done(r.num(i))}if(t.isDone())return ht.done(r.num(i))}return new e(r,n,i,o,s)},e.parseInteger=function(t,r){return e.parse(t,r,void 0,void 0,0)},e.parseDecimal=function(t,r){return e.parse(t,r,void 0,void 0,1)},e}(ht),ui=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._recon=e,o._output=r,o._mode=n,o._step=i,o}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._output,this._mode,this._step)},e.parse=function(t,r,n,i,o){void 0===i&&(i=2),void 0===o&&(o=1);var s=0;if(1===o)if(t.isCont())if(46===(s=t.head()))t=t.step(),n=n.write(s),o=2;else{if(!(i>1)||69!==s&&101!==s)return ht.error(at.expected("decimal or exponent",t));t=t.step(),n=n.write(s),o=5}else if(t.isDone())return ht.error(at.expected("decimal or exponent",t));if(2===o)if(t.isCont()){if(!((s=t.head())>=48&&s<=57))return ht.error(at.expected("digit",t));t=t.step(),n=n.write(s),o=3}else if(t.isDone())return ht.error(at.expected("digit",t));if(3===o){for(;t.isCont()&&(s=t.head())>=48&&s<=57;)t=t.step(),n=n.write(s);if(t.isCont()){if(!(i>1))return ht.done(r.num(n.bind()));o=4}else if(t.isDone())return ht.done(r.num(n.bind()))}if(4===o){if(69!==(s=t.head())&&101!==s)return ht.done(r.num(n.bind()));t=t.step(),n=n.write(s),o=5}if(5===o)if(t.isCont())43!==(s=t.head())&&45!==s||(t=t.step(),n=n.write(s)),o=6;else if(t.isDone())return ht.error(at.unexpected(t));if(6===o)if(t.isCont()){if(!((s=t.head())>=48&&s<=57))return ht.error(at.expected("digit",t));t=t.step(),n=n.write(s),o=7}else if(t.isDone())return ht.error(at.expected("digit",t));if(7===o){for(;t.isCont()&&(s=t.head())>=48&&s<=57;)t=t.step(),n=n.write(s);if(!t.isEmpty())return ht.done(r.num(n.bind()))}return new e(r,n,i,o)},e}(ht),ai=function(t){function e(e,r,n){var i=t.call(this)||this;return i._recon=e,i._value=r,i._size=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._value,this._size)},e.parse=function(t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=0);for(var o=0;t.isCont()&&(o=t.head(),wt.isDigit(o));)t=t.step(),n=16*n+wt.decodeDigit(o),i+=1;return t.isEmpty()?new e(r,n,i):i>0?i<=8?ht.done(r.uint32(n)):ht.done(r.uint64(n)):ht.error(at.expected("hex digit",t))},e}(ht),pi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._bindingsParser=n,s._templateParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._bindingsParser,this._templateParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);if(1===s){for(i||(i=r.parseConditionalOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(t.isCont()){if(62!==t.head())return i;t=t.step(),s=3}else if(t.isDone())return i;if(3===s){for(o||(o=r.parseConditionalOperator(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){var u=i.bind(),a=o.bind();return ht.done(r.lambda(u,a))}if(o.isError())return o.asError()}return new e(r,n,i,o,s)},e}(ht),hi=function(t){function e(e,r,n,i,o,s){var u=t.call(this)||this;return u._recon=e,u._builder=r,u._ifParser=n,u._thenParser=i,u._elseParser=o,u._step=s,u}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._ifParser,this._thenParser,this._elseParser,this._step)},e.parse=function(t,r,n,i,o,s,u){void 0===u&&(u=1);var a=0;if(1===u){for(i||(i=r.parseOrOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())u=2;else if(i.isError())return i.asError()}if(2===u){for(;t.isCont()&&(a=t.head(),Yi.isSpace(a));)t=t.step();if(t.isCont()){if(63!==a)return i;t=t.step(),u=3}else if(t.isDone())return i}if(3===u){for(o||(o=r.parseConditionalOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())u=4;else if(o.isError())return o.asError()}if(4===u){for(;t.isCont()&&(a=t.head(),Yi.isSpace(a));)t=t.step();if(t.isCont()){if(58!==a)return ht.error(at.expected(58,t));t=t.step(),u=5}else if(t.isDone())return ht.error(at.expected(58,t))}if(5===u){for(s||(s=r.parseConditionalOperator(t,n));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){var p=i.bind(),h=o.bind(),f=s.bind();return ht.done(r.conditional(p,h,f))}if(s.isError())return s.asError()}return new e(r,n,i,o,s,u)},e}(ht),fi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._lhsParser=n,s._rhsParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);for(;;){if(1===s){for(i||(i=r.parseAndOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(t.isCont()){if(124!==t.head())return i;t=t.step(),s=3}else if(t.isDone())return i;if(3===s){for(o||(o=r.parseAndOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){var u=i.bind(),a=o.bind();i=ht.done(r.or(u,a)),o=void 0,s=2;continue}if(o.isError())return o.asError()}break}return new e(r,n,i,o,s)},e}(ht),ci=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._lhsParser=n,s._rhsParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);for(;;){if(1===s){for(i||(i=r.parseBitwiseOrOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(t.isCont()){if(38!==t.head())return i;t=t.step(),s=3}else if(t.isDone())return i;if(3===s){for(o||(o=r.parseBitwiseOrOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){var u=i.bind(),a=o.bind();i=ht.done(r.and(u,a)),o=void 0,s=2;continue}if(o.isError())return o.asError()}break}return new e(r,n,i,o,s)},e}(ht),li=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._lhsParser=n,s._rhsParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);for(var u=0;;){if(1===s){for(i||(i=r.parseBitwiseXorOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(124!==u)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s)if(t.isCont()){if(124===(u=t.head()))return i;s=4}else if(t.isDone())return ht.error(at.unexpected(t));if(4===s){for(o||(o=r.parseBitwiseXorOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){var a=i.bind(),p=o.bind();i=ht.done(r.bitwiseOr(a,p)),o=void 0,s=2;continue}if(o.isError())return o.asError()}break}return new e(r,n,i,o,s)},e}(ht),di=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._lhsParser=n,s._rhsParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);for(var u=0;;){if(1===s){for(i||(i=r.parseBitwiseAndOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(94!==u)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s){for(o||(o=r.parseBitwiseAndOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){var a=i.bind(),p=o.bind();i=ht.done(r.bitwiseXor(a,p)),o=void 0,s=2;continue}if(o.isError())return o.asError()}break}return new e(r,n,i,o,s)},e}(ht),yi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._lhsParser=n,s._rhsParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);for(var u=0;;){if(1===s){for(i||(i=r.parseComparisonOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(38!==u)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s)if(t.isCont()){if(38===(u=t.head()))return i;s=4}else if(t.isDone())return ht.error(at.unexpected(t));if(4===s){for(o||(o=r.parseComparisonOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){var a=i.bind(),p=o.bind();i=ht.done(r.bitwiseAnd(a,p)),o=void 0,s=2;continue}if(o.isError())return o.asError()}break}return new e(r,n,i,o,s)},e}(ht),_i=function(t){function e(e,r,n,i,o,s){var u=t.call(this)||this;return u._recon=e,u._builder=r,u._lhsParser=n,u._operator=i,u._rhsParser=o,u._step=s,u}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._operator,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s,u){void 0===u&&(u=1);var a=0;if(1===u){for(i||(i=r.parseAttrExpression(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())u=2;else if(i.isError())return i.asError()}if(2===u){for(;t.isCont()&&(a=t.head(),Yi.isSpace(a));)t=t.step();if(t.isCont())if(33===a)t=t.step(),u=3;else if(60===a)t=t.step(),u=4;else if(62===a)t=t.step(),u=5;else{if(61!==a)return i;t=t.step(),u=6}else if(t.isDone())return i}if(3===u)if(t.isCont())61===(a=t.head())?(t=t.step(),o="!=",u=7):(o="!",u=7);else if(t.isDone())return ht.error(at.unexpected(t));if(4===u)if(t.isCont())61===(a=t.head())?(t=t.step(),o="<=",u=7):(o="<",u=7);else if(t.isDone())return ht.error(at.unexpected(t));if(5===u)if(t.isCont())61===(a=t.head())?(t=t.step(),o=">=",u=7):(o=">",u=7);else if(t.isDone())return ht.error(at.unexpected(t));if(6===u)if(t.isCont())if(61===(a=t.head()))t=t.step(),o="==",u=7;else{if(62===a)return i;o="=",u=7}else if(t.isDone())return ht.error(at.unexpected(t));if(7===u){for(s||(s=r.parseAttrExpression(t,n));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){var p=i.bind(),h=s.bind();return"<"===o?ht.done(r.lt(p,h)):"<="===o?ht.done(r.le(p,h)):"=="===o?ht.done(r.eq(p,h)):"!="===o?ht.done(r.ne(p,h)):">="===o?ht.done(r.ge(p,h)):">"===o?ht.done(r.gt(p,h)):ht.error(at.message(o,t))}if(s.isError())return s.asError()}return new e(r,n,i,o,s,u)},e}(ht),vi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._fieldParser=n,s._valueParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._fieldParser,this._valueParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);for(var u=0;;){if(1===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont())if(64===u)s=2;else if(123===u||91===u)n=n||r.recordBuilder(),s=5;else if(40===u)s=4;else{if(!(33===u||34===u||36===u||37===u||39===u||43===u||45===u||u>=48&&u<=57||126===u||Yi.isIdentStartChar(u)))return n?ht.done(n.bind()):ht.done(r.extant());s=3}else if(t.isDone())return n?ht.done(n.bind()):ht.done(r.extant())}if(2===s){for(i||(i=r.parseAttr(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone()){(n=n||r.recordBuilder()).push(i.bind()),i=void 0,s=1;continue}if(i.isError())return i.asError()}if(3===s){for(o||(o=r.parseAdditiveOperator(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())(n=n||r.valueBuilder()).push(r.item(o.bind())),o=void 0,s=6;else if(o.isError())return o.asError()}if(4===s){for(o||(o=r.parseAdditiveOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())n||(n=r.valueBuilder()).push(r.item(o.bind())),o=void 0,s=6;else if(o.isError())return o.asError()}if(5===s){for(o||(o=r.parseAdditiveOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())o=void 0,s=6;else if(o.isError())return o.asError()}if(6===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(64===u){s=1;continue}return ht.done(n.bind())}if(t.isDone())return ht.done(n.bind())}break}return new e(r,n,i,o,s)},e}(ht),mi=function(t){function e(e,r,n,i,o,s){var u=t.call(this)||this;return u._recon=e,u._builder=r,u._lhsParser=n,u._operator=i,u._rhsParser=o,u._step=s,u}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._operator,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s,u){void 0===u&&(u=1);for(var a=0;;){if(1===u){for(i||(i=r.parseMultiplicativeOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())u=2;else if(i.isError())return i.asError()}if(2===u){for(;t.isCont()&&(a=t.head(),Yi.isSpace(a));)t=t.step();if(t.isCont())if(43===a)t=t.step(),o="+",u=3;else{if(45!==a)return i;t=t.step(),o="-",u=3}else if(t.isDone())return i}if(3===u){for(s||(s=r.parseMultiplicativeOperator(t,n));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){var p=i.bind(),h=s.bind();if("+"===o)i=ht.done(r.plus(p,h));else{if("-"!==o)return ht.error(at.message(o,t));i=ht.done(r.minus(p,h))}s=void 0,o=void 0,u=2;continue}if(s.isError())return s.asError()}break}return new e(r,n,i,o,s,u)},e}(ht),wi=function(t){function e(e,r,n,i,o,s){var u=t.call(this)||this;return u._recon=e,u._builder=r,u._lhsParser=n,u._operator=i,u._rhsParser=o,u._step=s,u}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._lhsParser,this._operator,this._rhsParser,this._step)},e.parse=function(t,r,n,i,o,s,u){void 0===u&&(u=1);for(var a=0;;){if(1===u){for(i||(i=r.parsePrefixOperator(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())u=2;else if(i.isError())return i.asError()}if(2===u){for(;t.isCont()&&(a=t.head(),Yi.isSpace(a));)t=t.step();if(t.isCont())if(42===a)t=t.step(),o="*",u=3;else if(47===a)t=t.step(),o="/",u=3;else{if(37!==a)return i;t=t.step(),o="%",u=3}else if(t.isDone())return i}if(3===u){for(s||(s=r.parsePrefixOperator(t,n));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){var p=i.bind(),h=s.bind();if("*"===o)i=ht.done(r.times(p,h));else if("/"===o)i=ht.done(r.divide(p,h));else{if("%"!==o)return ht.error(at.message(o,t));i=ht.done(r.modulo(p,h))}s=void 0,o=void 0,u=2;continue}if(s.isError())return s.asError()}break}return new e(r,n,i,o,s,u)},e}(ht),gi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._operator=n,s._operandParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._operator,this._operandParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(33===u)t=t.step(),i="!";else if(126===u)t=t.step(),i="~";else if(45===u)t=t.step(),i="-";else{if(43!==u)return r.parseInvokeOperator(t,n);t=t.step(),i="+"}s=2}else if(t.isDone())return r.parseInvokeOperator(t,n)}if(2===s){for(o||(o=r.parsePrefixOperator(t,n));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone()){var a=o.bind();return r.isDistinct(a)?"!"===i?ht.done(r.not(a)):"~"===i?ht.done(r.bitwiseNot(a)):"-"===i?ht.done(r.negative(a)):"+"===i?ht.done(r.positive(a)):ht.error(at.message(i,t)):ht.error(at.expected("value",t))}if(o.isError())return o.asError()}return new e(r,n,i,o,s)},e}(ht),bi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._exprParser=n,s._argsParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._exprParser,this._argsParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s){for(i||(i=r.parsePrimary(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}for(;;){if(2===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(40!==u)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s){for(;t.isCont()&&(u=t.head(),Yi.isWhitespace(u));)t=t.step();if(t.isCont()){if(41===u){t=t.step();var a=i.bind();i=ht.done(r.invoke(a,r.extant())),s=2;continue}s=4}else if(t.isDone())return ht.error(at.expected(41,t))}if(4===s){for(o||(o=r.parseBlock(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())s=5;else if(o.isError())return o.asError()}if(5===s){for(;t.isCont()&&(u=t.head(),Yi.isWhitespace(u));)t=t.step();if(t.isCont()){if(41===u){t=t.step();a=i.bind();var p=o.bind();i=ht.done(r.invoke(a,p)),o=void 0,s=2;continue}return ht.error(at.expected(41,t))}if(t.isDone())return ht.error(at.expected(41,t))}break}return new e(r,n,i,o,s)},e}(ht),Si=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._recon=e,o._builder=r,o._exprParser=n,o._step=i,o}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._exprParser,this._step)},e.parse=function(t,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o){for(;t.isCont()&&(s=t.head(),Yi.isSpace(s));)t=t.step();t.isCont()?40===s?(t=t.step(),o=3):o=2:t.isDone()&&(o=2)}if(2===o){for(i||(i=r.parseLiteral(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())return i;if(i.isError())return i.asError()}if(3===o){for(i||(i=r.parseBlockExpression(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())o=4;else if(i.isError())return i.asError()}for(;;){if(4===o){for(;t.isCont()&&(s=t.head(),Yi.isSpace(s));)t=t.step();if(t.isCont()){if(44!==s)return 41===s?(t=t.step(),i||ht.done(n.bind())):ht.error(at.expected(41,t));t=t.step(),i&&(n||(n=r.recordBuilder()).push(r.item(i.bind())),i=void 0),o=5}else if(t.isDone())return ht.error(at.expected(41,t))}if(5===o){for(i||(i=r.parseBlockExpression(t,n));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone()){i=void 0,o=4;continue}if(i.isError())return i.asError()}break}return new e(r,n,i,o)},e}(ht),xi=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._recon=e,o._builder=r,o._valueParser=n,o._step=i,o}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._valueParser,this._step)},e.parse=function(t,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o){for(;t.isCont()&&(s=t.head(),Yi.isSpace(s));)t=t.step();if(t.isCont())if(40===s)t=t.step(),o=4;else if(123===s)n=n||r.recordBuilder(),i=r.parseRecord(t,n),o=3;else if(91===s)n=n||r.recordBuilder(),i=r.parseMarkup(t,n),o=3;else if(Yi.isIdentStartChar(s))i=r.parseIdent(t),o=2;else if(34===s||39===s)i=r.parseString(t),o=2;else if(45===s||s>=48&&s<=57)i=r.parseNumber(t),o=2;else if(37===s)i=r.parseData(t),o=2;else{if(36!==s)return n?ht.done(n.bind()):ht.done(r.extant());i=r.parseSelector(t),o=2}else if(t.isDone())return n?ht.done(n.bind()):ht.done(r.extant())}if(2===o){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())return(n=n||r.valueBuilder()).push(r.item(i.bind())),ht.done(n.bind());if(i.isError())return i.asError()}if(3===o){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())return ht.done(n.bind());if(i.isError())return i.asError()}if(4===o){for(i||(i=r.parseBlockExpression(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())o=5;else if(i.isError())return i.asError()}if(5===o){for(;t.isCont()&&(s=t.head(),Yi.isWhitespace(s));)t=t.step();if(t.isCont())return 41===s?(t=t.step(),(n=n||r.valueBuilder()).push(r.item(i.bind())),ht.done(n.bind())):ht.error(at.expected(41,t));if(t.isDone())return ht.error(at.expected(41,t))}return new e(r,n,i,o)},e}(ht),Ei=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._builder=r,s._selector=n,s._valueParser=i,s._step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this._recon,this._builder,this._selector,this._valueParser,this._step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()&&36===u)t=t.step(),i=i||r.selector(),s=2;else if(t.isDone())return ht.error(at.expected(36,t))}if(2===s)if(t.isCont())91===(u=t.head())?(t=t.step(),s=8):64===u?(t=t.step(),s=7):58===u?(t=t.step(),s=6):42===u?(t=t.step(),s=5):35===u?(t=t.step(),s=4):s=3;else if(t.isDone())return ht.error(at.unexpected(t));for(;;){if(3===s){for(o||(o=r.parseLiteral(t,r.valueBuilder()));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())i=r.get(i,o.bind()),o=void 0,s=10;else if(o.isError())return o.asError()}if(4===s){for(o||(o=r.parseInteger(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())i=r.value(r.getItem(i,o.bind())),o=void 0,s=10;else if(o.isError())return o.asError()}if(5===s&&(t.isCont()?58===(u=t.head())?(t=t.step(),i=r.keys(i),s=10):42===u?(t=t.step(),i=r.descendants(i),s=10):(i=r.children(i),s=10):t.isDone()&&(i=r.children(i),s=10)),6===s)if(t.isCont()){if(42!==(u=t.head()))return ht.error(at.expected(42,t));t=t.step(),i=r.values(i),s=10}else if(t.isDone())return ht.error(at.expected(42,t));if(7===s){for(o||(o=r.parseIdent(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())i=r.getAttr(i,o.bind()),o=void 0,s=10;else if(o.isError())return o.asError()}if(8===s){for(o||(o=r.parseBlockExpression(t));o.isCont()&&!t.isEmpty();)o=o.feed(t);if(o.isDone())s=9;else if(o.isError())return o.asError()}if(9===s){for(;t.isCont()&&(u=t.head(),Yi.isSpace(u));)t=t.step();if(t.isCont()){if(93!==u)return ht.error(at.expected(93,t));t=t.step(),i=r.filter(i,o.bind()),o=void 0,s=10}else if(t.isDone())return ht.error(at.expected(93,t))}if(10===s)if(t.isCont()){if(91===(u=t.head())){t=t.step(),s=8;continue}if(35===u){t=t.step(),s=4;continue}if(46!==u)return n?(n.push(r.item(i)),ht.done(n.bind())):ht.done(i);t=t.step(),s=11}else if(t.isDone())return n?(n.push(r.item(i)),ht.done(n.bind())):ht.done(i);if(11===s){if(t.isCont()){if(64===(u=t.head())){t=t.step(),s=7;continue}if(58===u){t=t.step(),s=6;continue}if(42===u){t=t.step(),s=5;continue}s=3;continue}if(t.isDone())return ht.error(at.unexpected(t))}break}return new e(r,n,i,o,s)},e}(ht),ki=function(){function t(){}return t.prototype.parseBlock=function(t){return Yn.parse(t,this)},t.prototype.parseAttr=function(t){return $n.parse(t,this)},t.prototype.parseBlockItem=function(t){return Jn.parse(t,this)},t.prototype.parseInlineItem=function(t){return ti.parse(t,this)},t.prototype.parseRecord=function(t,e){return ei.parse(t,this,e)},t.prototype.parseMarkup=function(t,e){return ri.parse(t,this,e)},t.prototype.parseData=function(t){return ni.parse(t,this)},t.prototype.parseIdent=function(t){return ii.parse(t,this)},t.prototype.parseString=function(t){return oi.parse(t,this)},t.prototype.parseNumber=function(t){return si.parse(t,this)},t.prototype.parseInteger=function(t){return si.parseInteger(t,this)},t.prototype.parseBlockExpression=function(t,e){return this.parseLambdaFunc(t,e)},t.prototype.parseLambdaFunc=function(t,e){return pi.parse(t,this,e)},t.prototype.parseConditionalOperator=function(t,e){return hi.parse(t,this,e)},t.prototype.parseOrOperator=function(t,e){return fi.parse(t,this,e)},t.prototype.parseAndOperator=function(t,e){return ci.parse(t,this,e)},t.prototype.parseBitwiseOrOperator=function(t,e){return li.parse(t,this,e)},t.prototype.parseBitwiseXorOperator=function(t,e){return di.parse(t,this,e)},t.prototype.parseBitwiseAndOperator=function(t,e){return yi.parse(t,this,e)},t.prototype.parseComparisonOperator=function(t,e){return _i.parse(t,this,e)},t.prototype.parseAttrExpression=function(t,e){return vi.parse(t,this,e)},t.prototype.parseAdditiveOperator=function(t,e){return mi.parse(t,this,e)},t.prototype.parseMultiplicativeOperator=function(t,e){return wi.parse(t,this,e)},t.prototype.parsePrefixOperator=function(t,e){return gi.parse(t,this,e)},t.prototype.parseInvokeOperator=function(t,e){return bi.parse(t,this,e)},t.prototype.parsePrimary=function(t,e){return Si.parse(t,this,e)},t.prototype.parseLiteral=function(t,e){return xi.parse(t,this,e)},t.prototype.parseSelector=function(t,e){return Ei.parse(t,this,e)},t.prototype.blockParser=function(){return new Yn(this)},t.prototype.parseBlockString=function(t){for(var e=X.stringInput(t);e.isCont()&&Yi.isWhitespace(e.head());)e=e.step();var r=this.parseBlock(e);if(r.isDone())for(;e.isCont()&&Yi.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.parseNumberString=function(t){for(var e=X.stringInput(t);e.isCont()&&Yi.isWhitespace(e.head());)e=e.step();var r=this.parseNumber(e);if(r.isDone())for(;e.isCont()&&Yi.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t}(),Ci=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.isDistinct=function(t){return t.isDistinct()},e.prototype.item=function(t){return t},e.prototype.value=function(t){return t.toValue()},e.prototype.attr=function(t,e){return te.of.apply(te,arguments)},e.prototype.slot=function(t,e){return ee.of.apply(ee,arguments)},e.prototype.valueBuilder=function(){return ne.builder()},e.prototype.recordBuilder=function(){return oe.create()},e.prototype.dataOutput=function(){return pe.output()},e.prototype.textOutput=function(){return fe.output()},e.prototype.ident=function(t){if(t instanceof fe){var e=t.stringValue();if("true"===e)return le.from(!0);if("false"===e)return le.from(!1)}return t},e.prototype.num=function(t){if("number"==typeof t)return ce.from(t);if("string"==typeof t)return ce.from(+t);throw new TypeError(""+t)},e.prototype.uint32=function(t){return ce.uint32(t)},e.prototype.uint64=function(t){return ce.uint64(t)},e.prototype.bool=function(t){return le.from(t)},e.prototype.selector=function(){return _e.identity()},e.prototype.extant=function(){return ne.extant()},e.prototype.absent=function(){return ne.absent()},e.prototype.conditional=function(t,e,r){return t.conditional(e,r)},e.prototype.or=function(t,e){return t.or(e)},e.prototype.and=function(t,e){return t.and(e)},e.prototype.bitwiseOr=function(t,e){return t.bitwiseOr(e)},e.prototype.bitwiseXor=function(t,e){return t.bitwiseXor(e)},e.prototype.bitwiseAnd=function(t,e){return t.bitwiseAnd(e)},e.prototype.lt=function(t,e){return t.lt(e)},e.prototype.le=function(t,e){return t.le(e)},e.prototype.eq=function(t,e){return t.eq(e)},e.prototype.ne=function(t,e){return t.ne(e)},e.prototype.ge=function(t,e){return t.ge(e)},e.prototype.gt=function(t,e){return t.gt(e)},e.prototype.plus=function(t,e){return t.plus(e)},e.prototype.minus=function(t,e){return t.minus(e)},e.prototype.times=function(t,e){return t.times(e)},e.prototype.divide=function(t,e){return t.divide(e)},e.prototype.modulo=function(t,e){return t.modulo(e)},e.prototype.not=function(t){return t.not()},e.prototype.bitwiseNot=function(t){return t.bitwiseNot()},e.prototype.negative=function(t){return t.negative()},e.prototype.positive=function(t){return t.positive()},e.prototype.invoke=function(t,e){return t.invoke(e).toValue()},e.prototype.lambda=function(t,e){return t.lambda(e)},e.prototype.get=function(t,e){return t.get(e)},e.prototype.getAttr=function(t,e){return t.getAttr(e)},e.prototype.getItem=function(t,e){return t.getItem(e)},e.prototype.children=function(t){return _e.literal(t).children()},e.prototype.descendants=function(t){return _e.literal(t).descendants()},e.prototype.keys=function(t){return _e.literal(t).keys()},e.prototype.values=function(t){return _e.literal(t).values()},e.prototype.filter=function(t,e){return t.filter(e)},e}(ki),Oi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._key=r,s._value=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._key,this._value,this._part,this._step)},e.sizeOf=function(t,e,r){var n=0;return n+=1,n+=t.sizeOfValue(e),t.isExtant(t.item(r))||(n+=1,n+=t.sizeOfBlockValue(r),n+=1),n},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s&&t.isCont()&&(t=t.write(64),s=2),2===s)if((o=o?o.pull(t):r.writeValue(n,t)).isDone()){if(o=void 0,r.isExtant(r.item(i)))return W.done();s=3}else if(o.isError())return o.asError();if(3===s&&t.isCont()&&(t=t.write(40),s=4),4===s)if((o=o?o.pull(t):r.writeBlockValue(i,t)).isDone())o=void 0,s=5;else if(o.isError())return o.asError();return 5===s&&t.isCont()?(t=t.write(41),W.done()):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e}(W),Ai=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._key=r,s._value=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._key,this._value,this._part,this._step)},e.sizeOf=function(t,e,r){var n=0;return n+=t.sizeOfValue(e),n+=1,t.isExtant(t.item(r))||(n+=t.sizeOfValue(r)),n},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s)if((o=o?o.pull(t):r.writeValue(n,t)).isDone())o=void 0,s=2;else if(o.isError())return o.asError();if(2===s&&t.isCont()){if(t=t.write(58),r.isExtant(r.item(i)))return W.done();s=3}if(3===s){if((o=o?o.pull(t):r.writeValue(i,t)).isDone())return W.done();if(o.isError())return o.asError()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e}(W),Ii=function(t){function e(e,r,n,i,o,s,u,a,p,h,f,c){var l=t.call(this)||this;return l._recon=e,l._items=r,l._inBlock=n,l._inMarkup=i,l._inBraces=o,l._inBrackets=s,l._first=u,l._markupSafe=a,l._item=p,l._next=h,l._part=f,l._step=c,l}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._items,this._inBlock,this._inMarkup,this._inBraces,this._inBrackets,this._first,this._markupSafe,this._item,this._next,this._part,this._step)},e.sizeOf=function(t,r,n,i){for(var o,s=0,u=!1,a=!1,p=!0,h=!0;o||r.hasNext();){var f=void 0;o?(f=o,o=void 0):f=r.next().value,r.hasNext()&&(o=r.next().value),t.isExpression(f)&&(h=!1),a&&t.isAttr(f)&&(u&&(s+=1,u=!1),s+=1,a=!1),t.isAttr(f)?(u?(s+=1,u=!1):a&&(s+=1,a=!1),s+=t.sizeOfItem(f),p=!1):a&&t.isText(f)?(u&&(s+=1,u=!1),s+=t.sizeOfMarkupText(f)):u?(p?p=!1:s+=1,s+=e.sizeOfBlockItem(t,f)):a?t.isRecord(f)&&t.isMarkupSafe(t.items(f))?(s+=t.sizeOfBlock(t.items(f),!1,!0),o&&t.isText(o)?(s+=t.sizeOfMarkupText(o),o=void 0):o&&!t.isAttr(o)?(s+=1,u=!0,p=!0):(s+=1,a=!1)):(s+=1,s+=t.sizeOfItem(f),u=!0,p=!1):h&&t.isText(f)&&o&&!t.isField(o)&&!t.isText(o)&&!t.isBool(o)?(s+=1,s+=t.sizeOfMarkupText(f),a=!0):n&&!u?(p?p=!1:s+=1,s+=e.sizeOfBlockItem(t,f)):i&&t.isText(f)&&!o?(s+=1,s+=t.sizeOfMarkupText(f),s+=1):!i&&t.isValue(f)&&!t.isRecord(f)&&(!p&&!o||o&&t.isAttr(o))?(!p&&(t.isText(f)&&t.isIdent(f)||t.isNum(f)||t.isBool(f))&&(s+=1),s+=t.sizeOfItem(f)):(s+=1,s+=t.sizeOfItem(f),u=!0,p=!1)}return u&&(s+=1),a&&(s+=1),s},e.sizeOfBlockItem=function(t,e){var r=0;return t.isField(e)?r+=t.sizeOfSlot(t.key(e),t.value(e)):r+=t.sizeOfItem(e),r},e.write=function(t,r,n,i,o,s,u,a,p,h,f,c,l){for(void 0===s&&(s=!1),void 0===u&&(u=!1),void 0===a&&(a=!0),void 0===p&&(p=!0),void 0===l&&(l=1);;){if(1===l){if(!f&&!n.hasNext()){l=10;break}f?(h=f,f=void 0):h=n.next().value,n.hasNext()&&(f=n.next().value),r.isExpression(h)&&(p=!1),l=2}if(2===l&&t.isCont()&&(u&&r.isAttr(h)?(s&&(t=t.write(125),s=!1),l=3):l=4),3===l&&t.isCont()&&(t=t.write(93),u=!1,l=4),4===l&&t.isCont()&&(r.isAttr(h)?(s?(t=t.write(125),s=!1):u&&(t=t.write(93),u=!1),c=r.writeItem(h,t),a=!1,l=7):u&&r.isText(h)?(s&&(t=t.write(125),s=!1),c=r.writeMarkupText(h,t),l=7):s?(a?a=!1:t=t.write(44),c=e.writeBlockItem(t,r,h),l=7):u?r.isRecord(h)&&r.isMarkupSafe(r.items(h))?(c=r.writeBlock(r.items(h),t,!1,!0),l=5):(t=t.write(123),c=r.writeItem(h,t),s=!0,a=!1,l=7):p&&r.isText(h)&&f&&!r.isField(f)&&!r.isText(f)&&!r.isBool(f)?(t=t.write(91),c=r.writeMarkupText(h,t),u=!0,l=7):i&&!s?(a?a=!1:t=t.write(44),c=e.writeBlockItem(t,r,h),l=7):o&&r.isText(h)&&!f?(t=t.write(91),c=r.writeMarkupText(h,t),l=8):!o&&r.isValue(h)&&!r.isRecord(h)&&(!a&&!f||f&&r.isAttr(f))?(!a&&(r.isText(h)&&r.isIdent(h)||r.isNum(h)||r.isBool(h))&&(t=t.write(32)),c=r.writeItem(h,t),l=7):(t=t.write(123),c=r.writeItem(h,t),s=!0,a=!1,l=7)),5===l)if((c=c.pull(t)).isDone())c=void 0,l=6;else if(c.isError())return c.asError();if(6===l&&t.isCont()){if(!f||!r.isText(f)){if(f&&!r.isAttr(f)){t=t.write(123),s=!0,a=!0,l=1;continue}t=t.write(93),u=!1,l=1;continue}c=r.writeMarkupText(f,t),f=void 0,l=7}if(7===l){if((c=c.pull(t)).isDone()){c=void 0,l=1;continue}if(c.isError())return c.asError()}if(8===l)if((c=c.pull(t)).isDone())c=void 0,l=9;else if(c.isError())return c.asError();if(9!==l||!t.isCont())break;t=t.write(93),l=1}if(10===l&&(s?t.isCont()&&(t=t.write(125),l=11):l=11),11===l){if(!u)return W.done();if(t.isCont())return t=t.write(93),W.done()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s,u,a,p,h,f,c,l)},e.writeBlockItem=function(t,e,r){return e.isField(r)?e.writeSlot(e.key(r),e.value(r),t):e.writeItem(r,t)},e}(W),Di=function(t){function e(e,r,n,i,o,s,u,a){var p=t.call(this)||this;return p._recon=e,p._items=r,p._inParens=n,p._first=i,p._item=o,p._next=s,p._part=u,p._step=a,p}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._items,this._inParens,this._first,this._item,this._next,this._part,this._step)},e.sizeOf=function(t,e){for(var r,n=0,i=!1,o=!0;r||e.hasNext();){var s=void 0;r?(s=r,r=void 0):s=e.next().value,e.hasNext()&&(r=e.next().value),i||o||(n+=1),t.isAttr(s)?(i&&(n+=1,i=!1),n+=t.sizeOfItem(s),o=!1):i?(o?o=!1:n+=1,n+=t.sizeOfBlockItem(s)):t.isValue(s)&&!t.isRecord(s)&&(!o&&!r||r&&t.isAttr(r))?n+=t.sizeOfItem(s):(n+=1,n+=t.sizeOfItem(s),i=!0,o=!1)}return i&&(n+=1),n},e.write=function(t,r,n,i,o,s,u,a,p){for(void 0===i&&(i=!1),void 0===o&&(o=!0),void 0===p&&(p=1);;){if(1===p){if(!u&&!n.hasNext()){p=5;break}u?(s=u,u=void 0):s=n.next().value,n.hasNext()&&(u=n.next().value),p=2}if(2===p&&t.isCont()&&(i||o||(t=t.write(32)),p=3),3===p&&t.isCont()&&(r.isAttr(s)?(i&&(t=t.write(41),i=!1),a=r.writeItem(s,t),o=!1,p=4):i?(o?o=!1:t=t.write(44),a=r.writeBlockItem(s,t),p=4):r.isValue(s)&&!r.isRecord(s)&&(!o&&!u||u&&r.isAttr(u))?(a=r.writeItem(s,t),p=4):(t=t.write(40),a=r.writeItem(s,t),i=!0,o=!1,p=4)),4===p){if((a=a.pull(t)).isDone()){a=void 0,p=1;continue}if(a.isError())return a.asError()}break}if(5===p){if(!i)return W.done();if(t.isCont())return t=t.write(41),W.done()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s,u,a,p)},e}(W),Mi=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._text=e,o._index=r,o._escape=n,o._step=i,o}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._text,this._index,this._escape,this._step)},e.sizeOf=function(t){for(var e=0,r=0,n=t.length;r<n;r=t.offsetByCodePoints(r,1)){var i=t.codePointAt(r);void 0===i&&(i=t.charCodeAt(r)),e+=36===i||64===i||91===i||92===i||93===i||123===i||125===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:St.sizeOf(i)}return e},e.write=function(t,r,n,i,o){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=1);for(var s=r.length;t.isCont();)if(1===o){if(!(n<s))return W.done();var u=r.codePointAt(n);void 0===u&&(u=r.charCodeAt(n)),n=r.offsetByCodePoints(n,1),36===u||64===u||91===u||92===u||93===u||123===u||125===u?(t=t.write(92),i=u,o=2):8===u?(t=t.write(92),i=98,o=2):12===u?(t=t.write(92),i=102,o=2):10===u?(t=t.write(92),i=110,o=2):13===u?(t=t.write(92),i=114,o=2):9===u?(t=t.write(92),i=116,o=2):u<32?(t=t.write(92),i=u,o=3):t=t.write(u)}else 2===o?(t=t.write(i),i=0,o=1):3===o?(t=t.write(117),o=4):4===o?(t=t.write(wt.uppercase().encodeDigit(i>>>12&15)),o=5):5===o?(t=t.write(wt.uppercase().encodeDigit(i>>>8&15)),o=6):6===o?(t=t.write(wt.uppercase().encodeDigit(i>>>4&15)),o=7):7===o&&(t=t.write(wt.uppercase().encodeDigit(15&i)),i=0,o=1);return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o)},e}(W),Ti=function(t){function e(e,r,n){var i=t.call(this)||this;return i._array=e,i._part=r,i._step=n,i}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._array,this._part,this._step)},e.sizeOf=function(t){return 1+(Math.floor(4*t/3)+3&-4)},e.write=function(t,r,n,i){if(void 0===i&&(i=1),1===i&&t.isCont()&&(t=t.write(37),i=2),2===i){if((n=n?n.pull(t):It.standard().writeUint8Array(r,t)).isDone())return n=void 0,W.done();if(n.isError())return n.asError()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i)},e}(W),Pi=function(t){function e(e,r){var n=t.call(this)||this;return n._ident=e,n._index=r,n}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._ident,this._index)},e.sizeOf=function(t){return St.sizeOf(t)},e.write=function(t,r,n){var i;void 0===n&&(n=0);var o=r.length;if(0===o)return W.error(new K("empty identifier"));for(0===n&&t.isCont()&&(void 0===(i=r.codePointAt(0))&&(i=r.charCodeAt(0)),Yi.isIdentStartChar(i)&&(t=t.write(i),n=r.offsetByCodePoints(0,1)));n<o&&t.isCont();){if(void 0===(i=r.codePointAt(n))&&(i=r.charCodeAt(n)),!Yi.isIdentChar(i))return W.error(new K("invalid identifier"));t=t.write(i),n=r.offsetByCodePoints(n,1)}return n>=o?W.done():t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n)},e}(W),Vi=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._string=e,o._index=r,o._escape=n,o._step=i,o}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._string,this._index,this._escape,this._step)},e.sizeOf=function(t){var e=0;e+=1;for(var r=0,n=t.length;r<n;r=t.offsetByCodePoints(r,1)){var i=t.codePointAt(r);void 0===i&&(i=t.charCodeAt(r)),e+=34===i||92===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:St.sizeOf(i)}return e+=1},e.write=function(t,r,n,i,o){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=1),1===o&&t.isCont()&&(t=t.write(34),o=2);for(var s=r.length;o>=2&&o<=8&&t.isCont();)if(2===o){if(!(n<s)){o=9;break}var u=r.codePointAt(n);void 0===u&&(u=r.charCodeAt(n)),n=r.offsetByCodePoints(n,1),34===u||92===u?(t=t.write(92),i=u,o=3):8===u?(t=t.write(92),i=98,o=3):12===u?(t=t.write(92),i=102,o=3):10===u?(t=t.write(92),i=110,o=3):13===u?(t=t.write(92),i=114,o=3):9===u?(t=t.write(92),i=116,o=3):u<32?(t=t.write("\\"),i=u,o=4):t=t.write(u)}else 3===o?(t=t.write(i),i=0,o=2):4===o?(t=t.write(117),o=5):5===o?(t=t.write(wt.uppercase().encodeDigit(i>>>12&15)),o=6):6===o?(t=t.write(wt.uppercase().encodeDigit(i>>>8&15)),o=7):7===o?(t=t.write(wt.uppercase().encodeDigit(i>>>4&15)),o=8):8===o&&(t=t.write(wt.uppercase().encodeDigit(15&i)),i=0,o=2);return 9===o&&t.isCont()?(t=t.write(34),W.done()):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o)},e}(W),Ui=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._bindings=r,s._template=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._bindings,this._template,this._part,this._step)},e.sizeOf=function(t,e,r){var n=0;return n+=t.sizeOfPrimary(e),n+=4,n+=t.sizeOfValue(r)},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s)if((o=o?o.pull(t):r.writePrimary(n,t)).isDone())o=void 0,s=2;else if(o.isError())return o.asError();if(2===s&&t.isCont()&&(t=t.write(32),s=3),3===s&&t.isCont()&&(t=t.write(61),s=4),4===s&&t.isCont()&&(t=t.write(62),s=5),5===s&&t.isCont()&&(t=t.write(32),s=6),6===s){if((o=null==o?r.writeValue(i,t):o.pull(t)).isDone())return W.done();if(o.isError())return o.asError()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e}(W),Ri=function(t){function e(e,r,n,i,o,s,u){var a=t.call(this)||this;return a._recon=e,a._ifTerm=r,a._thenTerm=n,a._elseTerm=i,a._precedence=o,a._part=s,a._step=u,a}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._ifTerm,this._thenTerm,this._elseTerm,this._precedence,this._part,this._step)},e.sizeOf=function(t,e,r,n,i){var o=0;return t.precedence(e)>0&&t.precedence(e)<=i?(o+=1,o+=t.sizeOfItem(e),o+=1):o+=t.sizeOfItem(e),o+=3,o+=t.sizeOfItem(r),o+=3,o+=t.sizeOfItem(n)},e.write=function(t,r,n,i,o,s,u,a){if(void 0===a&&(a=1),1===a&&(r.precedence(n)>0&&r.precedence(n)<=s?t.isCont()&&(t=t.write(40),a=2):a=2),2===a)if((u=u?u.pull(t):r.writeItem(n,t)).isDone())u=void 0,a=3;else if(u.isError())return u.asError();if(3===a&&(r.precedence(n)>0&&r.precedence(n)<=s?t.isCont()&&(t=t.write(41),a=4):a=4),4===a&&t.isCont()&&(t=t.write(32),a=5),5===a&&t.isCont()&&(t=t.write(63),a=6),6===a&&t.isCont()&&(t=t.write(32),a=7),7===a)if((u=u?u.pull(t):r.writeItem(i,t)).isDone())u=void 0,a=8;else if(u.isError())return u.asError();if(8===a&&t.isCont()&&(t=t.write(32),a=9),9===a&&t.isCont()&&(t=t.write(58),a=10),10===a&&t.isCont()&&(t=t.write(32),a=11),11===a){if((u=u?u.pull(t):r.writeItem(o,t)).isDone())return W.done();if(u.isError())return u.asError()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s,u,a)},e}(W),Fi=function(t){function e(e,r,n,i,o,s,u){var a=t.call(this)||this;return a._recon=e,a._lhs=r,a._operator=n,a._rhs=i,a._precedence=o,a._part=s,a._step=u,a}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._lhs,this._operator,this._rhs,this._precedence,this._part,this._step)},e.sizeOf=function(t,e,r,n,i){var o=0;return t.precedence(e)<i?(o+=1,o+=t.sizeOfItem(e),o+=1):o+=t.sizeOfItem(e),o+=1,o+=St.sizeOf(r),o+=1,t.precedence(n)<i?(o+=1,o+=t.sizeOfItem(n),o+=1):o+=t.sizeOfItem(n),o},e.write=function(t,r,n,i,o,s,u,a){if(void 0===a&&(a=1),1===a&&(r.precedence(n)<s?t.isCont()&&(t=t.write(40),a=2):a=2),2===a)if((u=u?u.pull(t):r.writeItem(n,t)).isDone())u=void 0,a=3;else if(u.isError())return u.asError();if(3===a&&(r.precedence(n)<s?t.isCont()&&(t=t.write(41),a=4):a=4),4===a&&t.isCont()&&(t=t.write(32),a=5),5===a)if((u=u?u.pull(t):X.writeString(i,t)).isDone())u=void 0,a=6;else if(u.isError())return u.asError();if(6===a&&t.isCont()&&(t=t.write(32),a=7),7===a&&(r.precedence(o)<s?t.isCont()&&(t=t.write(40),a=8):a=8),8===a)if((u=u?u.pull(t):r.writeItem(o,t)).isDone())u=void 0,a=9;else if(u.isError())return u.asError();if(9===a){if(!(r.precedence(o)<s))return W.done();if(t.isCont())return t=t.write(41),W.done()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s,u,a)},e}(W),zi=function(t){function e(e,r,n,i,o,s){var u=t.call(this)||this;return u._recon=e,u._operator=r,u._rhs=n,u._precedence=i,u._part=o,u._step=s,u}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._operator,this._rhs,this._precedence,this._part,this._step)},e.sizeOf=function(t,e,r,n){var i=0;return i+=St.sizeOf(e),t.precedence(r)<n?(i+=1,i+=t.sizeOfItem(r),i+=1):i+=t.sizeOfItem(r),i},e.write=function(t,r,n,i,o,s,u){if(void 0===u&&(u=1),1===u)if((s=s?s.pull(t):X.writeString(n,t)).isDone())s=void 0,u=2;else if(s.isError())return s.asError();if(2===u&&(r.precedence(i)<o?t.isCont()&&(t=t.write(40),u=3):u=3),3===u)if((s=s?s.pull(t):r.writeItem(i,t)).isDone())s=void 0,u=4;else if(s.isError())return s.asError();if(4===u){if(!(r.precedence(i)<o))return W.done();if(t.isCont())return t=t.write(41),W.done()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s,u)},e}(W),Li=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._func=r,s._args=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._func,this._args,this._part,this._step)},e.sizeOf=function(t,e,r){var n=0;return n+=t.sizeOfValue(e),n+=1,n+=t.sizeOfBlockValue(r),n+=1},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s)if((o=o?o.pull(t):r.writeValue(n,t)).isDone())o=void 0,s=2;else if(o.isError())return o.asError();if(2===s&&t.isCont()&&(t=t.write(40),s=3),3===s)if((o=o?o.pull(t):r.writeBlockValue(i,t)).isDone())o=void 0,s=4;else if(o.isError())return o.asError();return 4===s&&t.isCont()?(t=t.write(41),W.done()):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e}(W),qi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._item=r,s._then=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._item,this._then,this._part,this._step)},e.sizeOf=function(t,e,r){var n=0;return t.precedence(e)<t.precedence(t.item(r))?(n+=1,n+=t.sizeOfItem(e),n+=1):n+=t.sizeOfItem(e),n+=t.sizeOfThen(r)},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s&&(r.precedence(n)<r.precedence(r.item(i))?t.isCont()&&(t=t.write(40),s=2):s=2),2===s)if((o=o?o.pull(t):r.writeItem(n,t)).isDone())o=void 0,s=3;else if(o.isError())return o.asError();return 3===s&&(r.precedence(n)<r.precedence(r.item(i))?t.isCont()&&(t=t.write(41),s=4):s=4),4===s?r.writeThen(i,t):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e}(W),Bi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._key=r,s._then=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._key,this._then,this._part,this._step)},e.sizeOf=function(t,e,r){var n=1;return t.isRecord(t.item(e))?(n+=1,n+=t.sizeOfBlockValue(e),n+=1):n+=t.sizeOfValue(e),n+=t.sizeOfThen(r)},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s&&t.isCont()?(t=t.write(36),s=3):2===s&&t.isCont()&&(t=t.write(46),s=3),3===s&&(r.isRecord(r.item(n))?t.isCont()&&(t=t.write(123),s=4):s=4),4===s)if((o=o?o.pull(t):r.isRecord(r.item(n))?r.writeBlockValue(n,t):r.writeValue(n,t)).isDone())o=void 0,s=5;else if(o.isError())return o.asError();return 5===s&&(r.isRecord(r.item(n))?t.isCont()&&(t=t.write(125),s=6):s=6),6===s?r.writeThen(i,t):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e.writeThen=function(t,r,n,i){return e.write(t,r,n,i,void 0,2)},e}(W),Ni=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._key=r,s._then=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._key,this._then,this._part,this._step)},e.sizeOf=function(t,e,r){var n=2;return n+=t.sizeOfValue(e),n+=t.sizeOfThen(r)},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s&&t.isCont()?(t=t.write(36),s=3):2===s&&t.isCont()&&(t=t.write(46),s=3),3===s&&t.isCont()&&(t=t.write(64),s=4),4===s){if((o=o?o.pull(t):r.writeValue(n,t)).isDone())return r.writeThen(i,t);if(o.isError())return o.asError()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e.writeThen=function(t,r,n,i){return e.write(t,r,n,i,void 0,2)},e}(W),Ki=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._index=r,s._then=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._index,this._then,this._part,this._step)},e.sizeOf=function(t,e,r){var n=2;return n+=t.sizeOfValue(e),n+=t.sizeOfThen(r)},e.sizeOfThen=function(t,e,r){var n=1;return n+=t.sizeOfValue(e),n+=t.sizeOfThen(r)},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s&&t.isCont()&&(t=t.write(36),s=2),2===s&&t.isCont()&&(t=t.write(35),s=3),3===s){if((o=o?o.pull(t):r.writeValue(n,t)).isDone())return r.writeThen(i,t);if(o.isError())return o.asError()}return t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e.writeThen=function(t,r,n,i){return e.write(t,r,n,i,void 0,2)},e}(W),Wi=function(t){function e(e,r,n){var i=t.call(this)||this;return i._recon=e,i._then=r,i._step=n,i}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._then,this._step)},e.sizeOf=function(t,e){var r=3;return r+=t.sizeOfThen(e)},e.write=function(t,r,n,i){return void 0===i&&(i=1),1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()&&(t=t.write(42),i=4),4===i&&t.isCont()?(t=t.write(58),r.writeThen(n,t)):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i)},e.writeThen=function(t,r,n){return e.write(t,r,n,2)},e}(W),ji=function(t){function e(e,r,n){var i=t.call(this)||this;return i._recon=e,i._then=r,i._step=n,i}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._then,this._step)},e.sizeOf=function(t,e){var r=3;return r+=t.sizeOfThen(e)},e.write=function(t,r,n,i){return void 0===i&&(i=1),1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()&&(t=t.write(58),i=4),4===i&&t.isCont()?(t=t.write(42),r.writeThen(n,t)):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i)},e.writeThen=function(t,r,n){return e.write(t,r,n,2)},e}(W),Hi=function(t){function e(e,r,n){var i=t.call(this)||this;return i._recon=e,i._then=r,i._step=n,i}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._then,this._step)},e.sizeOf=function(t,e){var r=2;return r+=t.sizeOfThen(e)},e.write=function(t,r,n,i){return void 0===i&&(i=1),1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()?(t=t.write(42),r.writeThen(n,t)):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i)},e.writeThen=function(t,r,n){return e.write(t,r,n,2)},e}(W),Gi=function(t){function e(e,r,n){var i=t.call(this)||this;return i._recon=e,i._then=r,i._step=n,i}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._then,this._step)},e.sizeOf=function(t,e){var r=3;return r+=t.sizeOfThen(e)},e.write=function(t,r,n,i){return void 0===i&&(i=1),1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()&&(t=t.write(42),i=4),4===i&&t.isCont()?(t=t.write(42),r.writeThen(n,t)):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i)},e.writeThen=function(t,r,n){return e.write(t,r,n,2)},e}(W),Qi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._recon=e,s._predicate=r,s._then=n,s._part=i,s._step=o,s}return y(e,t),e.prototype.pull=function(t){return e.write(t,this._recon,this._predicate,this._then,this._part,this._step)},e.sizeOf=function(t,e,r){var n=2;return n+=t.sizeOfValue(e),n+=1,n+=t.sizeOfThen(r)},e.sizeOfThen=function(t,e,r){var n=1;return n+=t.sizeOfValue(e),n+=1,n+=t.sizeOfThen(r)},e.write=function(t,r,n,i,o,s){if(void 0===s&&(s=1),1===s&&t.isCont()&&(t=t.write(36),s=2),2===s&&t.isCont()&&(t=t.write(91),s=3),3===s)if((o=o?o.pull(t):r.writeValue(n,t)).isDone())o=void 0,s=4;else if(o.isError())return o.asError();return 4===s&&t.isCont()?(t=t.write(93),r.writeThen(i,t)):t.isDone()?W.error(new K("truncated")):t.isError()?W.error(t.trap()):new e(r,n,i,o,s)},e.writeThen=function(t,r,n,i){return e.write(t,r,n,i,void 0,2)},e}(W),Xi=function(){function t(){}return t.prototype.sizeOfAttr=function(t,e){return Oi.sizeOf(this,t,e)},t.prototype.writeAttr=function(t,e,r){return Oi.write(r,this,t,e)},t.prototype.sizeOfSlot=function(t,e){return Ai.sizeOf(this,t,e)},t.prototype.writeSlot=function(t,e,r){return Ai.write(r,this,t,e)},t.prototype.sizeOfBlock=function(t,e,r){if(3===arguments.length)return Ii.sizeOf(this,t,e,r);var n=this.items(t);return n.hasNext()?Ii.sizeOf(this,n,this.isBlockSafe(this.items(t)),!1):2},t.prototype.writeBlock=function(t,e,r,n){if(4===arguments.length)return Ii.write(e,this,t,r,n);var i=this.items(t);return i.hasNext()?Ii.write(e,this,i,this.isBlockSafe(this.items(t)),!1):X.writeString("{}",e)},t.prototype.sizeOfRecord=function(t){var e=this.items(t);return e.hasNext()?Ii.sizeOf(this,e,!1,!1):2},t.prototype.writeRecord=function(t,e){var r=this.items(t);return r.hasNext()?Ii.write(e,this,r,!1,!1):X.writeString("{}",e)},t.prototype.sizeOfPrimary=function(t){if(this.isRecord(this.item(t))){var e=this.items(this.item(t));if(e.hasNext())return Di.sizeOf(this,e)}else if(!this.isExtant(this.item(t)))return this.sizeOfValue(t);return 2},t.prototype.writePrimary=function(t,e){if(this.isRecord(this.item(t))){var r=this.items(this.item(t));if(r.hasNext())return Di.write(e,this,r)}else if(!this.isExtant(this.item(t)))return this.writeValue(t,e);return X.writeString("()",e)},t.prototype.isBlockSafe=function(t){for(;t.hasNext();)if(this.isAttr(t.next().value))return!1;return!0},t.prototype.isMarkupSafe=function(t){if(!t.hasNext()||!this.isAttr(t.next().value))return!1;for(;t.hasNext();)if(this.isAttr(t.next().value))return!1;return!0},t.prototype.sizeOfMarkupText=function(t){return"string"!=typeof t&&(t=this.string(t)),Mi.sizeOf(t)},t.prototype.writeMarkupText=function(t,e){return"string"!=typeof t&&(t=this.string(t)),Mi.write(e,t)},t.prototype.sizeOfData=function(t){return Ti.sizeOf(t)},t.prototype.writeData=function(t,e){return t?Ti.write(e,t):X.writeString("%",e)},t.prototype.isIdent=function(t){"string"!=typeof t&&(t=this.string(t));var e,r=t.length;if(0===r||void 0!==(e=t.codePointAt(0))&&!Yi.isIdentStartChar(e))return!1;for(var n=t.offsetByCodePoints(0,1);n<r;n=t.offsetByCodePoints(n,1))if(void 0===(e=t.codePointAt(n))||!Yi.isIdentChar(e))return!1;return!0},t.prototype.sizeOfText=function(t){return this.isIdent(t)?Pi.sizeOf(t):Vi.sizeOf(t)},t.prototype.writeText=function(t,e){return this.isIdent(t)?Pi.write(e,t):Vi.write(e,t)},t.prototype.sizeOfNum=function(t){if(isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<2147483648){var e=ut.countDigits(t);return t<0&&(e+=1),e}return(""+t).length},t.prototype.writeNum=function(t,e){return isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<2147483648?ut.writeInteger(t,e):X.writeString(""+t,e)},t.prototype.sizeOfUint32=function(t){return 10},t.prototype.writeUint32=function(t,e){return wt.lowercase().writeIntegerLiteral(t,e,8)},t.prototype.sizeOfUint64=function(t){return 18},t.prototype.writeUint64=function(t,e){return wt.lowercase().writeIntegerLiteral(t,e,16)},t.prototype.sizeOfBool=function(t){return t?4:5},t.prototype.writeBool=function(t,e){return X.writeString(t?"true":"false",e)},t.prototype.sizeOfLambdaFunc=function(t,e){return Ui.sizeOf(this,t,e)},t.prototype.writeLambdaFunc=function(t,e,r){return Ui.write(r,this,t,e)},t.prototype.sizeOfConditionalOperator=function(t,e,r,n){return Ri.sizeOf(this,t,e,r,n)},t.prototype.writeConditionalOperator=function(t,e,r,n,i){return Ri.write(i,this,t,e,r,n)},t.prototype.sizeOfInfixOperator=function(t,e,r,n){return Fi.sizeOf(this,t,e,r,n)},t.prototype.writeInfixOperator=function(t,e,r,n,i){return Fi.write(i,this,t,e,r,n)},t.prototype.sizeOfPrefixOperator=function(t,e,r){return zi.sizeOf(this,t,e,r)},t.prototype.writePrefixOperator=function(t,e,r,n){return zi.write(n,this,t,e,r)},t.prototype.sizeOfInvokeOperator=function(t,e){return Li.sizeOf(this,t,e)},t.prototype.writeInvokeOperator=function(t,e,r){return Li.write(r,this,t,e)},t.prototype.sizeOfIdentitySelector=function(){return 0},t.prototype.writeIdentitySelector=function(t){return W.done()},t.prototype.sizeOfThenIdentitySelector=function(){return 0},t.prototype.writeThenIdentitySelector=function(t){return W.done()},t.prototype.sizeOfLiteralSelector=function(t,e){return qi.sizeOf(this,t,e)},t.prototype.writeLiteralSelector=function(t,e,r){return qi.write(r,this,t,e)},t.prototype.sizeOfThenLiteralSelector=function(t,e){return 0},t.prototype.writeThenLiteralSelector=function(t,e,r){return W.done()},t.prototype.sizeOfGetSelector=function(t,e){return Bi.sizeOf(this,t,e)},t.prototype.writeGetSelector=function(t,e,r){return Bi.write(r,this,t,e)},t.prototype.sizeOfThenGetSelector=function(t,e){return Bi.sizeOf(this,t,e)},t.prototype.writeThenGetSelector=function(t,e,r){return Bi.writeThen(r,this,t,e)},t.prototype.sizeOfGetAttrSelector=function(t,e){return Ni.sizeOf(this,t,e)},t.prototype.writeGetAttrSelector=function(t,e,r){return Ni.write(r,this,t,e)},t.prototype.sizeOfThenGetAttrSelector=function(t,e){return Ni.sizeOf(this,t,e)},t.prototype.writeThenGetAttrSelector=function(t,e,r){return Ni.writeThen(r,this,t,e)},t.prototype.sizeOfGetItemSelector=function(t,e){return Ki.sizeOf(this,t,e)},t.prototype.writeGetItemSelector=function(t,e,r){return Ki.write(r,this,t,e)},t.prototype.sizeOfThenGetItemSelector=function(t,e){return Ki.sizeOfThen(this,t,e)},t.prototype.writeThenGetItemSelector=function(t,e,r){return Ki.writeThen(r,this,t,e)},t.prototype.sizeOfKeysSelector=function(t){return Wi.sizeOf(this,t)},t.prototype.writeKeysSelector=function(t,e){return Wi.write(e,this,t)},t.prototype.sizeOfThenKeysSelector=function(t){return Wi.sizeOf(this,t)},t.prototype.writeThenKeysSelector=function(t,e){return Wi.writeThen(e,this,t)},t.prototype.sizeOfValuesSelector=function(t){return ji.sizeOf(this,t)},t.prototype.writeValuesSelector=function(t,e){return ji.write(e,this,t)},t.prototype.sizeOfThenValuesSelector=function(t){return ji.sizeOf(this,t)},t.prototype.writeThenValuesSelector=function(t,e){return ji.writeThen(e,this,t)},t.prototype.sizeOfChildrenSelector=function(t){return Hi.sizeOf(this,t)},t.prototype.writeChildrenSelector=function(t,e){return Hi.write(e,this,t)},t.prototype.sizeOfThenChildrenSelector=function(t){return Hi.sizeOf(this,t)},t.prototype.writeThenChildrenSelector=function(t,e){return Hi.writeThen(e,this,t)},t.prototype.sizeOfDescendantsSelector=function(t){return Gi.sizeOf(this,t)},t.prototype.writeDescendantsSelector=function(t,e){return Gi.write(e,this,t)},t.prototype.sizeOfThenDescendantsSelector=function(t){return Gi.sizeOf(this,t)},t.prototype.writeThenDescendantsSelector=function(t,e){return Gi.writeThen(e,this,t)},t.prototype.sizeOfFilterSelector=function(t,e){return Qi.sizeOf(this,t,e)},t.prototype.writeFilterSelector=function(t,e,r){return Qi.write(r,this,t,e)},t.prototype.sizeOfThenFilterSelector=function(t,e){return Qi.sizeOfThen(this,t,e)},t.prototype.writeThenFilterSelector=function(t,e,r){return Qi.writeThen(r,this,t,e)},t.prototype.sizeOfExtant=function(){return 0},t.prototype.writeExtant=function(t){return W.done()},t.prototype.sizeOfAbsent=function(){return 0},t.prototype.writeAbsent=function(t){return W.done()},t}(),Zi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.isField=function(t){return t instanceof Zt},e.prototype.isAttr=function(t){return t instanceof te},e.prototype.isSlot=function(t){return t instanceof ee},e.prototype.isValue=function(t){return t instanceof ne},e.prototype.isRecord=function(t){return t instanceof oe},e.prototype.isText=function(t){return t instanceof fe},e.prototype.isNum=function(t){return t instanceof ce},e.prototype.isBool=function(t){return t instanceof le},e.prototype.isExpression=function(t){return t instanceof de},e.prototype.isExtant=function(t){return t instanceof me},e.prototype.items=function(t){return t.iterator()},e.prototype.item=function(t){return t},e.prototype.key=function(t){return t.key},e.prototype.value=function(t){return t.toValue()},e.prototype.string=function(t){return t.stringValue("")},e.prototype.precedence=function(t){return t.precedence()},e.prototype.sizeOfItem=function(t){if(t instanceof Zt){if(t instanceof te)return this.sizeOfAttr(t.key,t.value);if(t instanceof ee)return this.sizeOfSlot(t.key,t.value)}else if(t instanceof ne)return this.sizeOfValue(t);throw new K("No Recon serialization for "+t)},e.prototype.writeItem=function(t,e){if(t instanceof Zt){if(t instanceof te)return this.writeAttr(t.key,t.value,e);if(t instanceof ee)return this.writeSlot(t.key,t.value,e)}else if(t instanceof ne)return this.writeValue(t,e);return W.error(new K("No Recon serialization for "+t))},e.prototype.sizeOfValue=function(t){if(t instanceof oe)return this.sizeOfRecord(t);if(t instanceof pe)return this.sizeOfData(t.size);if(t instanceof fe)return this.sizeOfText(t.value);if(t instanceof ce)return t.isUint32()?this.sizeOfUint32(t.value):t.isUint64()?this.sizeOfUint64(t.value):this.sizeOfNum(t.value);if(t instanceof le)return this.sizeOfBool(t.value);if(t instanceof _e)return this.sizeOfSelector(t);if(t instanceof ye)return this.sizeOfOperator(t);if(t instanceof ve)return this.sizeOfFunc(t);if(t instanceof me)return this.sizeOfExtant();if(t instanceof we)return this.sizeOfAbsent();throw new K("No Recon serialization for "+t)},e.prototype.writeValue=function(t,e){return t instanceof oe?this.writeRecord(t,e):t instanceof pe?this.writeData(t.asUint8Array(),e):t instanceof fe?this.writeText(t.value,e):t instanceof ce?t.isUint32()?this.writeUint32(t.value,e):t.isUint64()?this.writeUint64(t.value,e):this.writeNum(t.value,e):t instanceof le?this.writeBool(t.value,e):t instanceof _e?this.writeSelector(t,e):t instanceof ye?this.writeOperator(t,e):t instanceof ve?this.writeFunc(t,e):t instanceof me?this.writeExtant(e):t instanceof we?this.writeAbsent(e):W.error(new K("No Recon serialization for "+t))},e.prototype.sizeOfSelector=function(t){if(t instanceof He)return this.sizeOfIdentitySelector();if(t instanceof er)return this.sizeOfLiteralSelector(t.item(),t.then());if(t instanceof Ge)return this.sizeOfGetSelector(t.accessor(),t.then());if(t instanceof Qe)return this.sizeOfGetAttrSelector(t.accessor(),t.then());if(t instanceof Xe)return this.sizeOfGetItemSelector(t.accessor(),t.then());if(t instanceof Ze)return this.sizeOfKeysSelector(t.then());if(t instanceof Ye)return this.sizeOfValuesSelector(t.then());if(t instanceof $e)return this.sizeOfChildrenSelector(t.then());if(t instanceof Je)return this.sizeOfDescendantsSelector(t.then());if(t instanceof tr)return this.sizeOfFilterSelector(t.predicate(),t.then());throw new K("No Recon serialization for "+t)},e.prototype.writeSelector=function(t,e){return t instanceof He?this.writeIdentitySelector(e):t instanceof er?this.writeLiteralSelector(t.item(),t.then(),e):t instanceof Ge?this.writeGetSelector(t.accessor(),t.then(),e):t instanceof Qe?this.writeGetAttrSelector(t.accessor(),t.then(),e):t instanceof Xe?this.writeGetItemSelector(t.accessor(),t.then(),e):t instanceof Ze?this.writeKeysSelector(t.then(),e):t instanceof Ye?this.writeValuesSelector(t.then(),e):t instanceof $e?this.writeChildrenSelector(t.then(),e):t instanceof Je?this.writeDescendantsSelector(t.then(),e):t instanceof tr?this.writeFilterSelector(t.predicate(),t.then(),e):W.error(new K("No Recon serialization for "+t))},e.prototype.sizeOfOperator=function(t){if(t instanceof Se)return this.sizeOfInfixOperator(t.operand1(),t.operator(),t.operand2(),t.precedence());if(t instanceof xe)return this.sizeOfPrefixOperator(t.operator(),t.operand(),t.precedence());if(t instanceof je)return this.sizeOfInvokeOperator(t.func(),t.args());if(t instanceof Ee)return this.sizeOfConditionalOperator(t.ifTerm(),t.thenTerm(),t.elseTerm(),t.precedence());throw new K("No Recon serialization for "+t)},e.prototype.writeOperator=function(t,e){return t instanceof Se?this.writeInfixOperator(t.operand1(),t.operator(),t.operand2(),t.precedence(),e):t instanceof xe?this.writePrefixOperator(t.operator(),t.operand(),t.precedence(),e):t instanceof je?this.writeInvokeOperator(t.func(),t.args(),e):t instanceof Ee?this.writeConditionalOperator(t.ifTerm(),t.thenTerm(),t.elseTerm(),t.precedence(),e):W.error(new K("No Recon serialization for "+t))},e.prototype.sizeOfFunc=function(t){if(t instanceof rr)return this.sizeOfLambdaFunc(t.bindings(),t.template());if(t instanceof nr)return 0;throw new K("No Recon serialization for "+t)},e.prototype.writeFunc=function(t,e){return t instanceof rr?this.writeLambdaFunc(t.bindings(),t.template(),e):t instanceof nr?W.done():W.error(new K("No Recon serialization for "+t))},e.prototype.sizeOfBlockItem=function(t){if(t instanceof Zt)return this.sizeOfItem(t);if(t instanceof ne)return this.sizeOfBlockValue(t);throw new K("No Recon serialization for "+t)},e.prototype.writeBlockItem=function(t,e){return t instanceof Zt?this.writeItem(t,e):t instanceof ne?this.writeBlockValue(t,e):W.error(new K("No Recon serialization for "+t))},e.prototype.sizeOfBlockValue=function(t){return t instanceof oe?this.sizeOfBlock(t):this.sizeOfValue(t)},e.prototype.writeBlockValue=function(t,e){return t instanceof oe?this.writeBlock(t,e):this.writeValue(t,e)},e.prototype.sizeOfThen=function(t){if(t instanceof _e){if(t instanceof He)return this.sizeOfThenIdentitySelector();if(t instanceof er)return this.sizeOfThenLiteralSelector(t.item(),t.then());if(t instanceof Ge)return this.sizeOfThenGetSelector(t.accessor(),t.then());if(t instanceof Qe)return this.sizeOfThenGetAttrSelector(t.accessor(),t.then());if(t instanceof Xe)return this.sizeOfThenGetItemSelector(t.accessor(),t.then());if(t instanceof Ze)return this.sizeOfThenKeysSelector(t.then());if(t instanceof Ye)return this.sizeOfThenValuesSelector(t.then());if(t instanceof $e)return this.sizeOfThenChildrenSelector(t.then());if(t instanceof Je)return this.sizeOfThenDescendantsSelector(t.then());if(t instanceof tr)return this.sizeOfThenFilterSelector(t.predicate(),t.then())}throw new K("No Recon serialization for "+t)},e.prototype.writeThen=function(t,e){if(t instanceof _e){if(t instanceof He)return this.writeThenIdentitySelector(e);if(t instanceof er)return this.writeThenLiteralSelector(t.item(),t.then(),e);if(t instanceof Ge)return this.writeThenGetSelector(t.accessor(),t.then(),e);if(t instanceof Qe)return this.writeThenGetAttrSelector(t.accessor(),t.then(),e);if(t instanceof Xe)return this.writeThenGetItemSelector(t.accessor(),t.then(),e);if(t instanceof Ze)return this.writeThenKeysSelector(t.then(),e);if(t instanceof Ye)return this.writeThenValuesSelector(t.then(),e);if(t instanceof $e)return this.writeThenChildrenSelector(t.then(),e);if(t instanceof Je)return this.writeThenDescendantsSelector(t.then(),e);if(t instanceof tr)return this.writeThenFilterSelector(t.predicate(),t.then(),e)}return W.error(new K("No Recon serialization for "+t))},e}(Xi),Yi=function(){function t(){}return t.isSpace=function(t){return 32===t||9===t},t.isNewline=function(t){return 10===t||13===t},t.isWhitespace=function(e){return t.isSpace(e)||t.isNewline(e)},t.isIdentStartChar=function(t){return t>=65&&t<=90||95===t||t>=97&&t<=122||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039},t.isIdentChar=function(t){return 45===t||t>=48&&t<=57||t>=65&&t<=90||95===t||t>=97&&t<=122||183===t||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039},t.structureParser=function(){return t._structureParser||(t._structureParser=new Ci),t._structureParser},t.structureWriter=function(){return t._structureWriter||(t._structureWriter=new Zi),t._structureWriter},t.parse=function(e){return t.structureParser().parseBlockString(e)},t.parser=function(){return t.structureParser().blockParser()},t.sizeOf=function(e){return t.structureWriter().sizeOfItem(e)},t.sizeOfBlock=function(e){return t.structureWriter().sizeOfBlockItem(e)},t.write=function(e,r){return t.structureWriter().writeItem(e,r)},t.writeBlock=function(e,r){return t.structureWriter().writeBlockItem(e,r)},t.toString=function(e){var r=X.stringOutput();return t.write(e,r),r.bind()},t.toBlockString=function(e){var r=X.stringOutput();return t.writeBlock(e,r),r.bind()},t.toData=function(e){var r=St.encodedOutput(pe.output());return t.write(e,r),r.bind()},t.toBlockData=function(e){var r=St.encodedOutput(pe.output());return t.writeBlock(e,r),r.bind()},t}();Xt.prototype.toRecon=function(){return Yi.toString(this)},Xt.prototype.toReconBlock=function(){return Yi.toBlockString(this)},ne.parseRecon=function(t){return Yi.parse(t)};var $i={fromAny:function(t){if(t instanceof $i.R2)return t;if("object"==typeof t&&t){if(Array.isArray(t)){if(2===t.length)return new $i.R2.Point(t[0],t[1]);throw new TypeError(""+t)}var e=t;if("number"==typeof e.x&&"number"==typeof e.y)return new $i.R2.Point(e.x,e.y);var r=t;if("number"==typeof r.x0&&"number"==typeof r.y0&&"number"==typeof r.x1&&"number"==typeof r.y1)return new $i.R2.Segment(r.x0,r.y0,r.x1,r.y1);var n=t;if("number"==typeof n.xMin&&"number"==typeof n.yMin&&"number"==typeof n.xMax&&"number"==typeof n.yMax)return new $i.R2.Box(n.xMin,n.yMin,n.xMax,n.yMax);var i=t;if("number"==typeof i.cx&&"number"==typeof i.cy&&"number"==typeof i.r)return new $i.R2.Circle(i.cx,i.cy,i.r)}throw new TypeError(""+t)},is:function(t){if("object"==typeof t&&t){var e=t;return"function"==typeof e.contains&&"function"==typeof e.intersects}return!1},R2:void 0},Ji=function(){function t(){}return t.prototype.union=function(e){return e=t.fromAny(e),new t.Box(Math.min(this.xMin,e.xMin),Math.min(this.yMin,e.yMin),Math.max(this.xMax,e.xMax),Math.max(this.yMax,e.yMax))},t.fromAny=function(t){return $i.fromAny(t)},t}();$i.R2=Ji;var to=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.plus=function(e){return new t(this._x+e.x,this._y+e.y)},t.prototype.opposite=function(){return new t(-this._x,-this._y)},t.prototype.minus=function(e){return new t(this._x-e.x,this._y-e.y)},t.prototype.times=function(e){return new t(this._x*e,this._y*e)},t.prototype.toAny=function(){return{x:this._x,y:this._y}},t.prototype.canEqual=function(t){return!0},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this._x===e._x&&this._y===e._y)},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(f.mix(t._hashSeed,f.hash(this._x)),f.hash(this._y)))},t.prototype.debug=function(t){t.write("VectorR2").write(46).write("of").write(40).debug(this._x).write(", ").debug(this._y).write(41)},t.prototype.toString=function(){return Z.debug(this)},t.zero=function(){return void 0===t._zero&&(t._zero=new t(0,0)),t._zero},t.of=function(e,r){return new t(e,r)},t.fromAny=function(e){if(e instanceof t)return e;if("object"==typeof e&&e)return new t(e.x,e.y);throw new TypeError(""+e)},t}(),eo=function(t){function e(e,r){var n=t.call(this)||this;return n._x=e,n._y=r,n}return y(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xMin",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMin",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xMax",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMax",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.plus=function(t){return new e(this._x+t.x,this._y+t.y)},e.prototype.minus=function(t){var r=this._x-t._x,n=this._y-t._y;return t instanceof to?new e(r,n):new to(r,n)},e.prototype.contains=function(t,r){return"number"==typeof t?this._x===t&&this._y===r:(t=$i.fromAny(t))instanceof e?this._x===t._x&&this._y===t._y:t instanceof Ji&&(this._x<=t.xMin&&t.xMax<=this._x&&this._y<=t.yMin&&t.yMax<=this._y)},e.prototype.intersects=function(t){return(t=$i.fromAny(t)).intersects(this)},e.prototype.transform=function(t){return new e(t.transformX(this.x,this.y),t.transformY(this.x,this.y))},e.prototype.toAny=function(){return{x:this._x,y:this._y}},e.prototype.canEqual=function(t){return!0},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this._x===t._x&&this._y===t._y)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(e._hashSeed,f.hash(this._x)),f.hash(this._y)))},e.prototype.debug=function(t){t.write("PointR2").write(46).write("of").write(40).debug(this._x).write(", ").debug(this._y).write(41)},e.prototype.toString=function(){return Z.debug(this)},e.origin=function(){return void 0===e._origin&&(e._origin=new e(0,0)),e._origin},e.of=function(t,r){return new e(t,r)},e.fromAny=function(t){if(t instanceof e)return t;if("object"==typeof t&&t){var r=void 0,n=void 0;return Array.isArray(t)?(r=t[0],n=t[1]):(r=t.x,n=t.y),new e(r,n)}throw new TypeError(""+t)},e}(Ji);Ji.Point=eo;var ro=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._x0=e,o._y0=r,o._x1=n,o._y1=i,o}return y(e,t),Object.defineProperty(e.prototype,"x0",{get:function(){return this._x0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y0",{get:function(){return this._y0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xMin",{get:function(){return Math.min(this._x0,this._x1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMin",{get:function(){return Math.min(this._y0,this._y1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xMax",{get:function(){return Math.max(this._x0,this._x1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMax",{get:function(){return Math.max(this._y0,this._y1)},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,r){if("number"==typeof t)return e.contains(this._x0,this._y0,this._x1,this._y1,t,r);if((t=$i.fromAny(t))instanceof Ji){if(t instanceof eo)return this.containsPoint(t);if(t instanceof e)return this.containsSegment(t)}return!1},e.prototype.containsPoint=function(t){return e.contains(this._x0,this._y0,this._x1,this._y1,t._x,t._y)},e.prototype.containsSegment=function(t){return e.contains(this._x0,this._y0,this._x1,this._y1,t._x0,t._y0)&&e.contains(this._x0,this._y0,this._x1,this._y1,t._x1,t._y1)},e.prototype.intersects=function(t){return(t=$i.fromAny(t))instanceof Ji&&(t instanceof eo?this.intersectsPoint(t):t instanceof e?this.intersectsSegment(t):t.intersects(this))},e.prototype.intersectsPoint=function(t){return e.contains(this._x0,this._y0,this._x1,this._y1,t._x,t._y)},e.prototype.intersectsSegment=function(t){return e.intersects(this._x0,this._y0,this._x1-this._x0,this._y1-this._y0,t._x0,t._y0,t._x1-t._x0,t._y1-t._y0)},e.prototype.transform=function(t){return new e(t.transformX(this.x0,this.y0),t.transformY(this.x0,this.y0),t.transformX(this.x1,this.y1),t.transformY(this.x1,this.y1))},e.contains=function(t,e,r,n,i,o){return(t<=i&&i<=r||r<=i&&i<=t)&&(e<=o&&o<=n||n<=o&&o<=e)&&(r-t)*(o-e)==(i-t)*(n-e)},e.intersects=function(t,e,r,n,i,o,s,u){var a=i-t,p=o-e,h=a*n-p*r,f=r*u-n*s;if(0===h&&0===f){var c=r*r+n*n,l=s*r+u*n,d=(a*r+p*n)/c,y=d+l/c;return l>=0?0<y&&d<1:0<d&&y<1}if(0===f)return!1;var _=(a*u-p*s)/f,v=h/f;return 0<=_&&_<=1&&0<=v&&v<=1},e.prototype.toAny=function(){return{x0:this._x0,y0:this._y0,x1:this._x1,y1:this._y1}},e.prototype.canEqual=function(t){return!0},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this._x0===t._x0&&this._y0===t._y0&&this._x1===t._x1&&this._y1===t._y1)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(f.mix(f.mix(e._hashSeed,f.hash(this._x0)),f.hash(this._y0)),f.hash(this._x1)),f.hash(this._y1)))},e.prototype.debug=function(t){t.write("SegmentR2").write(46).write("of").write(40).debug(this._x0).write(", ").debug(this._y0).debug(this._x1).write(", ").debug(this._y1).write(41)},e.prototype.toString=function(){return Z.debug(this)},e.of=function(t,r,n,i){return new e(t,r,n,i)},e.fromAny=function(t){if(t instanceof e)return t;if("object"==typeof t&&t)return new e(t.x0,t.y0,t.x1,t.y1);throw new TypeError(""+t)},e}(Ji);Ji.Segment=ro;var no=function(t){function e(e,r,n){var i=t.call(this)||this;return i._cx=e,i._cy=r,i._r=n,i}return y(e,t),Object.defineProperty(e.prototype,"cx",{get:function(){return this._cx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cy",{get:function(){return this._cy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"r",{get:function(){return this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xMin",{get:function(){return this._cx-this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMin",{get:function(){return this._cy-this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xMax",{get:function(){return this._cx+this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMax",{get:function(){return this._cy+this._r},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,r){if("number"==typeof t){var n=t-this._cx,i=r-this._cy;return n*n+i*i<=this._r*this._r}if((t=$i.fromAny(t))instanceof Ji){if(t instanceof eo)return this.containsPoint(t);if(t instanceof ro)return this.containsSegment(t);if(t instanceof io)return this.containsBox(t);if(t instanceof e)return this.containsCircle(t)}return!1},e.prototype.containsPoint=function(t){var e=t._x-this._cx,r=t._y-this._cy;return e*e+r*r<=this._r*this._r},e.prototype.containsSegment=function(t){var e=t._x0-this._cx,r=t._y0-this._cy,n=t._x1-this._cx,i=t._y1-this._cy,o=this._r*this._r;return e*e+r*r<=o&&n*n+i*i<=o},e.prototype.containsBox=function(t){var e=t._xMin-this._cx,r=t._yMin-this._cy,n=t._xMax-this._cx,i=t._yMax-this._cy,o=this._r*this._r;return e*e+r*r<=o&&e*e+i*i<=o&&n*n+r*r<=o&&n*n+i*i<=o},e.prototype.containsCircle=function(t){var e=t._cx-this._cx,r=t._cy-this._cy;return e*e+r*r+t._r*t._r<=this._r*this._r},e.prototype.intersects=function(t){return(t=$i.fromAny(t))instanceof Ji&&(t instanceof eo?this.intersectsPoint(t):t instanceof ro?this.intersectsSegment(t):t instanceof io?this.intersectsBox(t):t instanceof e?this.intersectsCircle(t):t.intersects(this))},e.prototype.intersectsPoint=function(t){var e=t._x-this._cx,r=t._y-this._cy;return e*e+r*r<=this._r*this._r},e.prototype.intersectsSegment=function(t){var e=this._cx,r=this._cy,n=this._r,i=t._x0,o=t._y0,s=t._x1,u=t._y1,a=s-i,p=u-o,h=Math.sqrt(a*a+p*p),f=a/h,c=p/h,l=(e-i)*c-(r-o)*f;if(l<-n||n<l)return!1;var d=i-e,y=o-r,_=s-e,v=u-r,m=n*n;if(d*d+y*y<=m||_*_+v*v<=m)return!0;var w=f*e+c*r,g=f*i+c*o,b=f*s+c*u;return g<w&&w<=b||b<w&&w<=g},e.prototype.intersectsBox=function(t){var e=(this._cx<t._xMin?t._xMin:t._xMax<this._cx?t._xMax:this._cx)-this._cx,r=(this._cy<t._yMin?t._yMin:t._yMax<this._cy?t._yMax:this._cy)-this._cy;return e*e+r*r<=this._r*this._r},e.prototype.intersectsCircle=function(t){var e=t._cx-this._cx,r=t._cy-this._cy,n=this._r+t._r;return e*e+r*r<=n*n},e.prototype.transform=function(t){var r=t.transformX(this.cx,this.cy),n=t.transformY(this.cx,this.cy),i=t.transformX(this.cx+this.r,this.cy)-r,o=t.transformY(this.cx+this.r,this.cy)-n;return new e(r,n,Math.sqrt(i*i+o*o))},e.prototype.toAny=function(){return{cx:this._cx,cy:this._cy,r:this._r}},e.prototype.canEqual=function(t){return!0},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this._cx===t._cx&&this._cy===t._cy&&this._r===t._r)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(f.mix(e._hashSeed,f.hash(this._cx)),f.hash(this._cy)),f.hash(this._r)))},e.prototype.debug=function(t){t.write("CircleR2").write(46).write("of").write(40).debug(this._cx).write(", ").debug(this._cy).write(", ").debug(this._r).write(41)},e.prototype.toString=function(){return Z.debug(this)},e.of=function(t,r,n){return new e(t,r,n)},e.fromAny=function(t){if(t instanceof e)return t;if("object"==typeof t&&t)return new e(t.cx,t.cy,t.r);throw new TypeError(""+t)},e}(Ji);Ji.Circle=no;var io=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._xMin=e<=n?e:n,o._yMin=r<=i?r:i,o._xMax=e<=n?n:e,o._yMax=r<=i?i:r,o}return y(e,t),Object.defineProperty(e.prototype,"xMin",{get:function(){return this._xMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMin",{get:function(){return this._yMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xMax",{get:function(){return this._xMax},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMax",{get:function(){return this._yMax},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._xMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._yMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._xMax-this._xMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._yMax-this._yMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._yMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._xMax},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._yMax},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._xMin},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,r){return"number"==typeof t?this._xMin<=t&&t<=this._xMax&&this._yMin<=r&&r<=this._yMax:(t=$i.fromAny(t))instanceof Ji&&(t instanceof eo?this.containsPoint(t):t instanceof ro?this.containsSegment(t):t instanceof e?this.containsBox(t):t instanceof no?this.containsCircle(t):this._xMin<=t.xMin&&t.xMax<=this._xMax&&this._yMin<=t.yMin&&t.yMax<=this._yMax)},e.prototype.containsPoint=function(t){return this._xMin<=t._x&&t._x<=this._xMax&&this._yMin<=t._y&&t._y<=this._yMax},e.prototype.containsSegment=function(t){return this._xMin<=t._x0&&t._x0<=this._xMax&&this._yMin<=t._y0&&t._y0<=this._yMax&&this._xMin<=t._x1&&t._x1<=this._xMax&&this._yMin<=t._y1&&t._y1<=this._yMax},e.prototype.containsBox=function(t){return this._xMin<=t._xMin&&t._xMax<=this._xMax&&this._yMin<=t._yMin&&t._yMax<=this._yMax},e.prototype.containsCircle=function(t){return this._xMin<=t._cx-t._r&&t._cx+t._r<=this._xMax&&this._yMin<=t._cy-t._r&&t._cy+t._r<=this._yMax},e.prototype.intersects=function(t){return(t=$i.fromAny(t))instanceof Ji&&(t instanceof eo?this.intersectsPoint(t):t instanceof ro?this.intersectsSegment(t):t instanceof e?this.intersectsBox(t):t instanceof no?this.intersectsCircle(t):t.intersects(this))},e.prototype.intersectsPoint=function(t){return this._xMin<=t._x&&t._x<=this._xMax&&this._yMin<=t._y&&t._y<=this._yMax},e.prototype.intersectsSegment=function(t){var r=this._xMin,n=this._yMin,i=this._xMax,o=this._yMax,s=t._x0,u=t._y0,a=t._x1,p=t._y1;return!(s<r&&a<r||s>i&&a>i||u<n&&p<n||u>o&&p>o)&&(s>r&&s<i&&u>n&&u<o||!!(e.intersectsSegment(s-r,a-r,s,u,a,p)&&e._hitY>n&&e._hitY<o||e.intersectsSegment(u-n,p-n,s,u,a,p)&&e._hitX>r&&e._hitX<i||e.intersectsSegment(s-i,a-i,s,u,a,p)&&e._hitY>n&&e._hitY<o||e.intersectsSegment(u-o,p-o,s,u,a,p)&&e._hitX>r&&e._hitX<i))},e.intersectsSegment=function(t,r,n,i,o,s){if(t!==r||t*r<0){var u=-t/(r-t);return e._hitX=n+(o-n)*u,e._hitY=i+(s-i)*u,!0}return!1},e.prototype.intersectsBox=function(t){return this._xMin<=t._xMax&&t._xMin<=this._xMax&&this._yMin<=t._yMax&&t._yMin<=this._yMax},e.prototype.intersectsCircle=function(t){var e=(t._cx<this._xMin?this._xMin:this._xMax<t._cx?this._xMax:t._cx)-t._cx,r=(t._cy<this._yMin?this._yMin:this._yMax<t._cy?this._yMax:t._cy)-t._cy;return e*e+r*r<=t._r*t._r},e.prototype.union=function(e){return t.prototype.union.call(this,e)},e.prototype.transform=function(t){return new e(t.transformX(this.xMin,this.yMin),t.transformY(this.xMin,this.yMin),t.transformX(this.xMax,this.yMax),t.transformY(this.xMax,this.yMax))},e.prototype.toAny=function(){return{xMin:this._xMin,yMin:this._yMin,xMax:this._xMax,yMax:this._yMax}},e.prototype.canEqual=function(t){return!0},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this._xMin===t._xMin&&this._yMin===t._yMin&&this._xMax===t._xMax&&this._yMax===t._yMax)},e.prototype.hashCode=function(){return void 0===e._hashSeed&&(e._hashSeed=f.seed(e)),f.mash(f.mix(f.mix(f.mix(f.mix(e._hashSeed,f.hash(this.xMin)),f.hash(this.yMin)),f.hash(this.xMax)),f.hash(this.yMax)))},e.prototype.debug=function(t){t.write("BoxR2").write(46).write("of").write(40).debug(this.xMin).write(", ").debug(this.yMin).write(", ").debug(this.xMax).write(", ").debug(this.yMax).write(41)},e.prototype.toString=function(){return Z.debug(this)},e.empty=function(){return e._empty||(e._empty=new e(0,0,0,0)),e._empty},e.of=function(t,r,n,i){return new e(t,r,n,i)},e.fromAny=function(t){if(t instanceof e)return t;if("object"==typeof t&&t)return new e(t.xMin,t.yMin,t.xMax,t.yMax);throw new TypeError(""+t)},e._hitX=0,e._hitY=0,e}(Ji);Ji.Box=io;var oo=function(){function t(t,e){this._name=t,this._offset=e}return t.prototype.isUTC=function(){return 0===this._offset},t.prototype.isLocal=function(){return this._offset===-(new Date).getTimezoneOffset()},t.prototype.name=function(){return this._name},t.prototype.offset=function(){return this._offset},t.prototype.equals=function(e){return this===e||e instanceof t&&this._offset===e._offset},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(t._hashSeed,f.hash(this._offset)))},t.prototype.debug=function(t){t=t.write("TimeZone").write(46),t="UTC"===this._name&&0===this._offset?t.write("utc").write(40).write(41):void 0===this._name?t.write("forOffset").write(40).debug(this._offset).write(41):t.write("from").write(40).debug(this._name).write(", ").debug(this._offset).write(41)},t.prototype.toString=function(){return Z.debug(this)},t.utc=function(){return t._utc||(t._utc=new t("UTC",0)),t._utc},t.local=function(){return t._local||(t._local=t.forOffset(-(new Date).getTimezoneOffset())),t._local},t.forName=function(e){switch(e){case"UTC":return t.utc();default:return}},t.forOffset=function(e){switch(e){case 0:return t.utc();default:return new t(void 0,e)}},t.from=function(e,r){return"UTC"===e&&0===r?t.utc():new t(e,r)},t.fromAny=function(e){if(e instanceof t)return e;if("string"==typeof e){var r=t.forName(e);if(void 0!==r)return r}else if("number"==typeof e)return t.forOffset(e);throw new TypeError(""+e)},t.fromValue=function(e){var r=e.stringValue(void 0);if(void 0!==r)return t.forName(r);var n=e.numberValue(void 0);return void 0!==n?t.forOffset(n):void 0},t.form=function(e){return void 0!==e&&(e=t.fromAny(e)),e!==t.utc()?new t.Form(e):(t._form||(t._form=new t.Form(t.utc())),t._form)},t}(),so=function(t){function e(e){var r=t.call(this)||this;return r._unit=e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t){var e=(t=oo.fromAny(t)).name();return void 0!==e?fe.from(e):ce.from(t._offset)},e.prototype.cast=function(t){var e=t.toValue();return oo.fromValue(e)},e}(be);oo.Form=so;var uo=function(){function t(e,r,n,i,o){void 0===e&&(e=t.Periods),void 0===r&&(r=t.Weekdays),void 0===n&&(n=t.ShortWeekdays),void 0===i&&(i=t.Months),void 0===o&&(o=t.ShortMonths),this.periods=e,this.weekdays=r,this.shortWeekdays=n,this.months=i,this.shortMonths=o}return t.standard=function(){return t._standard||(t._standard=new t),t._standard},t.Periods=["AM","PM"],t.Weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t.ShortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],t.ShortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t}(),ao=function(){function t(t,e){void 0===e&&(e=oo.utc()),this._time=t,this._zone=e}return t.prototype.time=function(e){return void 0===e?this._time:new t(e,this._zone)},t.prototype.zone=function(e){return void 0===e?this._zone:new t(this._time,e)},t.prototype.year=function(e,r,n,i,o,s,u){var a=this.toUTCLocalDate();return void 0===e?a.getUTCFullYear():(a.setUTCFullYear(e),void 0!==r&&a.setUTCMonth(r),void 0!==n&&a.setUTCDate(n),void 0!==i&&a.setUTCHours(i),void 0!==o&&a.setUTCMinutes(o),void 0!==s&&a.setUTCSeconds(s),void 0!==u&&a.setUTCMilliseconds(u),t.fromUTCLocalDate(a,this._zone))},t.prototype.month=function(e,r,n,i,o,s){var u=this.toUTCLocalDate();return void 0===e?u.getUTCMonth():(u.setUTCMonth(e),void 0!==r&&u.setUTCDate(r),void 0!==n&&u.setUTCHours(n),void 0!==i&&u.setUTCMinutes(i),void 0!==o&&u.setUTCSeconds(o),void 0!==s&&u.setUTCMilliseconds(s),t.fromUTCLocalDate(u,this._zone))},t.prototype.day=function(e,r,n,i,o){var s=this.toUTCLocalDate();return void 0===e?s.getUTCDate():(s.setUTCDate(e),void 0!==r&&s.setUTCHours(r),void 0!==n&&s.setUTCMinutes(n),void 0!==i&&s.setUTCSeconds(i),void 0!==o&&s.setUTCMilliseconds(o),t.fromUTCLocalDate(s,this._zone))},t.prototype.hour=function(e,r,n,i){var o=this.toUTCLocalDate();return void 0===e?o.getUTCHours():(o.setUTCHours(e),void 0!==r&&o.setUTCMinutes(r),void 0!==n&&o.setUTCSeconds(n),void 0!==i&&o.setUTCMilliseconds(i),t.fromUTCLocalDate(o,this._zone))},t.prototype.minute=function(e,r,n){var i=this.toUTCLocalDate();return void 0===e?i.getUTCMinutes():(i.setUTCMinutes(e),void 0!==r&&i.setUTCSeconds(r),void 0!==n&&i.setUTCMilliseconds(n),t.fromUTCLocalDate(i,this._zone))},t.prototype.second=function(e,r){var n=this.toUTCLocalDate();return void 0===e?n.getUTCSeconds():(n.setUTCSeconds(e),void 0!==r&&n.setUTCMilliseconds(r),t.fromUTCLocalDate(n,this._zone))},t.prototype.millisecond=function(e){var r=this.toUTCLocalDate();return void 0===e?r.getUTCMilliseconds():(r.setUTCMilliseconds(e),t.fromUTCLocalDate(r,this._zone))},t.prototype.weekday=function(){return this.toUTCLocalDate().getUTCDay()},t.prototype.toUTCLocalDate=function(){return new Date(this._time+6e4*this._zone._offset)},t.prototype.toDate=function(){return new Date(this._time)},t.prototype.valueOf=function(){return this._time},t.prototype.compareTo=function(e){var r=this._time,n=t.time(e);return r<n?-1:r>n?1:r===n?0:NaN},t.prototype.equals=function(e){return this===e||e instanceof t&&(this._time===e._time&&this._zone.equals(e._zone))},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(f.mix(t._hashSeed,f.hash(this._time)),this._zone.hashCode()))},t.prototype.display=function(e,r){void 0===r&&(r=t.Format.iso8601()),r.writeDate(this,e)},t.prototype.toString=function(e){return void 0===e&&(e=t.Format.iso8601()),e.format(this)},t.current=function(e){return e=void 0!==e?oo.fromAny(e):oo.local(),new t(Date.now(),e)},t.fromUTCLocalDate=function(e,r){return new t(e.getTime()-6e4*r._offset,r)},t.from=function(e,r){var n=Date.UTC(void 0!==e.year?e.year:1970,void 0!==e.month?e.month:0,void 0!==e.day?e.day:1,void 0!==e.hour?e.hour:0,void 0!==e.minute?e.minute:0,void 0!==e.second?e.second:0,void 0!==e.millisecond?e.millisecond:0);return void 0!==e.zone&&(r=oo.fromAny(e.zone)),void 0!==r?n+=6e4*(r=oo.fromAny(r))._offset:r=oo.utc(),new t(n,r)},t.fromAny=function(e,r){if(e instanceof t)return e;if(e instanceof Date)return r=void 0!==r?oo.fromAny(r):oo.utc(),new t(e.getTime(),r);if("number"==typeof e)return new t(e,r=void 0!==r?oo.fromAny(r):oo.utc());if("string"==typeof e)return t.parse(e,r);if(e&&"object"==typeof e)return t.from(e,r);throw new TypeError(""+e)},t.fromValue=function(e){var r,n=e.header("date");n.isDefined()?(e=n,r=!0):r=!1;var i={};if(e.forEach(function(t,e){var n=t.key.stringValue(void 0);void 0!==n?"year"===n?i.year=t.toValue().numberValue(i.year):"month"===n?i.month=t.toValue().numberValue(i.month):"day"===n?i.day=t.toValue().numberValue(i.day):"hour"===n?i.hour=t.toValue().numberValue(i.hour):"minute"===n?i.minute=t.toValue().numberValue(i.minute):"second"===n?i.second=t.toValue().numberValue(i.second):"millisecond"===n?i.millisecond=t.toValue().numberValue(i.millisecond):"zone"===n&&(i.zone=t.toValue().cast(oo.form(),i.zone)):t instanceof ne&&r&&(0===e?i.year=t.numberValue(i.year):1===e?i.month=t.numberValue(i.month):2===e?i.day=t.numberValue(i.day):3===e?i.hour=t.numberValue(i.hour):4===e?i.minute=t.numberValue(i.minute):5===e?i.second=t.numberValue(i.second):6===e?i.millisecond=t.numberValue(i.millisecond):7===e&&(i.zone=t.cast(oo.form(),i.zone)))}),t.isInit(i))return t.from(i)},t.parse=function(e,r){return t.Format.iso8601().parse(e)},t.time=function(e){if(e instanceof t)return e._time;if(e instanceof Date)return e.getTime();if("number"==typeof e)return e;if("string"==typeof e)return t.parse(e).time();throw e&&"object"==typeof e&&t.from(e).time(),new TypeError(""+e)},t.isInit=function(t){if(t&&"object"==typeof t){var e=t;return void 0!==e.year||void 0!==e.month||void 0!==e.day||void 0!==e.hour||void 0!==e.minute||void 0!==e.second||void 0!==e.millisecond}return!1},t.form=function(e){return void 0!==e&&(e=t.fromAny(e)),void 0!==e?new t.Form(e):(t._form||(t._form=new t.Form),t._form)},t}(),po=function(t){function e(e){var r=t.call(this)||this;return r.dateParser=e,r}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.dateParser)},e.parse=function(t,r){return(r=r.feed(t)).isDone()?ht.done(ao.fromAny(r.bind())):r.isError()?r.asError():new e(r)},e}(ht);ao.Parser=po;var ho=function(t){function e(e){var r=t.call(this)||this;return r._unit=e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?void 0!==this._unit?this._unit:new ao(0):new e(t)},e.prototype.mold=function(t){return t=ao.fromAny(t),fe.from(t.toString())},e.prototype.cast=function(t){var e;try{if(!(e=ao.fromValue(t))){var r=t.numberValue(void 0);if(void 0!==r)e=new ao(r);else{var n=t.stringValue(void 0);void 0!==n&&(e=ao.parse(n))}}}catch(t){}return e},e}(be);ao.Form=ho;var fo={_standard:void 0,standard:function(t){var e;return void 0===t&&(t=uo.standard()),t===uo.standard()&&(e=fo._standard),e||(e={Y:co.year(),m:co.monthOfYear(),B:co.month(t),b:co.shortMonth(t),d:co.dayOfMonth(),A:co.weekday(t),a:co.shortWeekday(t),H:co.hour24(),I:co.hour12(),p:co.period(t),M:co.minute(),S:co.second(),L:co.millisecond()},t===uo.standard()&&(fo._standard=e)),e}},co=function(){function t(){}return t.prototype.format=function(t){t=ao.fromAny(t);var e=X.stringOutput();return this.writeDate(t,e),e.bind()},t.prototype.parse=function(t){for("string"==typeof t&&(t=X.stringInput(t));t.isCont()&&X.isSpace(t.head());)t=t.step();var e=this.parseDate(t,{});if(e.isDone())for(;t.isCont()&&X.isSpace(t.head());)t=t.step();return t.isCont()&&!e.isError()&&(e=ht.error(at.unexpected(t))),e.bind()},t.prototype.parseDate=function(t,e){var r=this.parseDateTime(t,e);return r.isDone()?ht.done(ao.fromAny(r.bind())):r.isError()?r.asError():new ao.Parser(r)},t.year=function(){return t._year||(t._year=new t.Year),t._year},t.monthOfYear=function(){return t._monthOfYear||(t._monthOfYear=new t.MonthOfYear),t._monthOfYear},t.month=function(e){return void 0===e&&(e=uo.standard()),e!==uo.standard()?new t.Month(e):(t._month||(t._month=new t.Month(e)),t._month)},t.shortMonth=function(e){return void 0===e&&(e=uo.standard()),e!==uo.standard()?new t.ShortMonth(e):(t._shortMonth||(t._shortMonth=new t.ShortMonth(e)),t._shortMonth)},t.dayOfMonth=function(){return t._dayOfMonth||(t._dayOfMonth=new t.DayOfMonth),t._dayOfMonth},t.weekday=function(e){return void 0===e&&(e=uo.standard()),e!==uo.standard()?new t.Weekday(e):(t._weekday||(t._weekday=new t.Weekday(e)),t._weekday)},t.shortWeekday=function(e){return void 0===e&&(e=uo.standard()),e!==uo.standard()?new t.ShortWeekday(e):(t._shortWeekday||(t._shortWeekday=new t.ShortWeekday(e)),t._shortWeekday)},t.hour24=function(){return t._hour24||(t._hour24=new t.Hour24),t._hour24},t.hour12=function(){return t._hour12||(t._hour12=new t.Hour12),t._hour12},t.period=function(e){return void 0===e&&(e=uo.standard()),e!==uo.standard()?new t.Period(e):(t._period||(t._period=new t.Period(e)),t._period)},t.minute=function(){return t._minute||(t._minute=new t.Minute),t._minute},t.second=function(){return t._second||(t._second=new t.Second),t._second},t.millisecond=function(){return t._millisecond||(t._millisecond=new t.Millisecond),t._millisecond},t.pattern=function(e,r){return(!r||r instanceof uo)&&(r=fo.standard(r)),new t.Pattern(e,r)},t.iso8601=function(){return t._iso8601||(t._iso8601=new t.Pattern("%Y-%m-%dT%H:%M:%S.%LZ",fo.standard())),t._iso8601},t.parseDateNumber=function(t,e,r,n,i,o,s,u){void 0===s&&(s=0),void 0===u&&(u=0);for(var a=0;u<i&&t.isCont()&&(a=t.head(),ut.isDigit(a));)t.step(),s=10*s+ut.decodeDigit(a),u+=1;return t.isEmpty()?e.cont(o||{},s,u,t):u>=n?e.bind(s,o||{},t):ht.error(at.expected(r,t))},t.parseDateString=function(t,e,r,n,i){var o=0;for(i=i||X.stringOutput();;){if(!t.isCont()||(o=t.head(),!X.isAlpha(o))){if(!t.isEmpty())return e.bind(r,i.bind(),n||{},t);break}t.step(),i.write(o)}return e.cont(r,n||{},i,t)},t.writeDateNumber2=function(t,e){var r=48+t%10,n=48+(t/=10)%10;e=e.write(n).write(r)},t.writeDateNumber3=function(t,e){var r=48+t%10,n=48+(t/=10)%10,i=48+(t/=10)%10;e=e.write(i).write(n).write(r)},t.writeDateNumber4=function(t,e){var r=48+t%10,n=48+(t/=10)%10,i=48+(t/=10)%10,o=48+(t/=10)%10;e=e.write(o).write(i).write(n).write(r)},t}();ao.Format=co;var lo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber4(t.year(),e)},e.prototype.parseDateTime=function(t,e){return co.YearParser.parse(t,e)},e}(co);co.Year=lo;var yo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber2(t.month()+1,e)},e.prototype.parseDateTime=function(t,e){return co.MonthOfYearParser.parse(t,e)},e}(co);co.MonthOfYear=yo;var _o=function(t){function e(e){var r=t.call(this)||this;return r.locale=e,r}return y(e,t),e.prototype.writeDate=function(t,e){e.write(this.locale.months[t.month()])},e.prototype.parseDateTime=function(t,e){return co.MonthParser.parse(t,this.locale,e)},e}(co);co.Month=_o;var vo=function(t){function e(e){var r=t.call(this)||this;return r.locale=e,r}return y(e,t),e.prototype.writeDate=function(t,e){e.write(this.locale.shortMonths[t.month()])},e.prototype.parseDateTime=function(t,e){return co.ShortMonthParser.parse(t,this.locale,e)},e}(co);co.ShortMonth=vo;var mo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber2(t.day(),e)},e.prototype.parseDateTime=function(t,e){return co.DayOfMonthParser.parse(t,e)},e}(co);co.DayOfMonth=mo;var wo=function(t){function e(e){var r=t.call(this)||this;return r.locale=e,r}return y(e,t),e.prototype.writeDate=function(t,e){e.write(this.locale.weekdays[t.weekday()])},e.prototype.parseDateTime=function(t,e){return co.WeekdayParser.parse(t,this.locale,e)},e}(co);co.Weekday=wo;var go=function(t){function e(e){var r=t.call(this)||this;return r.locale=e,r}return y(e,t),e.prototype.writeDate=function(t,e){e.write(this.locale.shortWeekdays[t.weekday()])},e.prototype.parseDateTime=function(t,e){return co.ShortWeekdayParser.parse(t,this.locale,e)},e}(co);co.ShortWeekday=go;var bo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber2(t.hour(),e)},e.prototype.parseDateTime=function(t,e){return co.Hour24Parser.parse(t,e)},e}(co);co.Hour24=bo;var So=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber2(t.hour()%12||12,e)},e.prototype.parseDateTime=function(t,e){return co.Hour12Parser.parse(t,e)},e}(co);co.Hour12=So;var xo=function(t){function e(e){var r=t.call(this)||this;return r.locale=e,r}return y(e,t),e.prototype.writeDate=function(t,e){e.write(this.locale.periods[+(t.hour()>=12)])},e.prototype.parseDateTime=function(t,e){return co.PeriodParser.parse(t,this.locale,e)},e}(co);co.Period=xo;var Eo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber2(t.minute(),e)},e.prototype.parseDateTime=function(t,e){return co.MinuteParser.parse(t,e)},e}(co);co.Minute=Eo;var ko=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber2(t.second(),e)},e.prototype.parseDateTime=function(t,e){return co.SecondParser.parse(t,e)},e}(co);co.Second=ko;var Co=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.writeDate=function(t,e){co.writeDateNumber3(t.millisecond(),e)},e.prototype.parseDateTime=function(t,e){return co.MillisecondParser.parse(t,e)},e}(co);co.Millisecond=Co;var Oo=function(t){function e(e,r){var n=t.call(this)||this;return n.pattern=e,n.specifiers=r,n}return y(e,t),e.prototype.writeDate=function(t,e){for(var r=this.pattern,n=this.specifiers,i=0,o=0,s=r.length;o<s;)if(37===r.charCodeAt(o)){i!==o&&e.write(r.slice(i,o));var u=n[r.charAt(o+1)];u&&u.writeDate(t,e),i=o+=2}else o+=1;i!==o&&e.write(r.slice(i,o))},e.prototype.parseDateTime=function(t,e){return co.PatternParser.parse(t,this.pattern,this.specifiers,e)},e}(co);co.Pattern=Oo;var Ao=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.year=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.year,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"full year",4,4,r,n,i)},e.bind=function(t,e){return e.year=t,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.YearParser=Ao;var Io=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.month=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.month,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"month number",2,2,r,n,i)},e.bind=function(t,e){return e.month=t-1,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.MonthOfYearParser=Io;var Do=function(t){function e(e,r,n){var i=t.call(this)||this;return i.locale=e,i.date=r,i.output=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.locale,this.date,this.output)},e.parse=function(t,r,n,i){return co.parseDateString(t,e,r,n,i)},e.bind=function(t,e,r,n){var i=t.months.indexOf(e);return i>=0?(r.month=i,ht.done(r)):ht.error(at.message("expected month, but found "+e,n))},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.MonthParser=Do;var Mo=function(t){function e(e,r,n){var i=t.call(this)||this;return i.locale=e,i.date=r,i.output=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.locale,this.date,this.output)},e.parse=function(t,r,n,i){return co.parseDateString(t,e,r,n,i)},e.bind=function(t,e,r,n){var i=t.shortMonths.indexOf(e);return i>=0?(r.month=i,ht.done(r)):ht.error(at.message("expected short month, but found "+e,n))},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.ShortMonthParser=Mo;var To=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.day=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.day,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"day of month",2,2,r,n,i)},e.bind=function(t,e){return e.day=t,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.DayOfMonthParser=To;var Po=function(t){function e(e,r,n){var i=t.call(this)||this;return i.locale=e,i.date=r,i.output=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.locale,this.date,this.output)},e.parse=function(t,r,n,i){return co.parseDateString(t,e,r,n,i)},e.bind=function(t,e,r,n){return t.weekdays.indexOf(e)>=0?ht.done(r):ht.error(at.message("expected weekday, but found "+e,n))},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.WeekdayParser=Po;var Vo=function(t){function e(e,r,n){var i=t.call(this)||this;return i.locale=e,i.date=r,i.output=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.locale,this.date,this.output)},e.parse=function(t,r,n,i){return co.parseDateString(t,e,r,n,i)},e.bind=function(t,e,r,n){return t.shortWeekdays.indexOf(e)>=0?ht.done(r):ht.error(at.message("expected short weekday, but found "+e,n))},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.ShortWeekdayParser=Vo;var Uo=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.hour=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.hour,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"hour (24)",2,2,r,n,i)},e.bind=function(t,e){return e.hour=t,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.Hour24Parser=Uo;var Ro=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.hour=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.hour,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"hour (12)",2,2,r,n,i)},e.bind=function(t,e){return e.hour=(e.hour||0)+t,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.Hour12Parser=Ro;var Fo=function(t){function e(e,r,n){var i=t.call(this)||this;return i.locale=e,i.date=r,i.output=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.locale,this.date,this.output)},e.parse=function(t,r,n,i){return co.parseDateString(t,e,r,n,i)},e.bind=function(t,e,r,n){var i=t.months.indexOf(e);return i>=0?(r.hour=(r.hour||0)+12*i,ht.done(r)):ht.error(at.message("expected period of day, but found "+e,n))},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.PeriodParser=Fo;var zo=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.minute=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.minute,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"minute",2,2,r,n,i)},e.bind=function(t,e){return e.minute=t,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.MinuteParser=zo;var Lo=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.second=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.second,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"second",2,2,r,n,i)},e.bind=function(t,e){return e.second=t,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.SecondParser=Lo;var qo=function(t){function e(e,r,n){var i=t.call(this)||this;return i.date=e,i.millisecond=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.date,this.millisecond,this.step)},e.parse=function(t,r,n,i){return co.parseDateNumber(t,e,"millisecond",1,3,r,n,i)},e.bind=function(t,e){return e.millisecond=t,ht.done(e)},e.cont=function(t,r,n){return new e(t,r,n)},e}(ht);co.MillisecondParser=qo;var Bo=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.pattern=e,s.specifiers=r,s.date=n,s.dateParser=i,s.step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.pattern,this.specifiers,this.date,this.dateParser,this.step)},e.parse=function(t,r,n,i,o,s){void 0===i&&(i={}),void 0===s&&(s=0);for(var u=r.length;s<u;){var a=r.charCodeAt(s);if(37===a){if(o)o=o.feed(t);else{var p=r.charAt(s+1),h=n[p];if(!h)return ht.error(at.message("unknown format specifier: "+p,t));o=h.parseDateTime(t,i)}if(o.isDone()){i=o.bind(),o=void 0,s+=2;continue}if(o.isError())return o.asError()}else{if(t.isCont()){if(t.head()===a){t.step(),s+=1;continue}return ht.error(at.expected(a,t))}if(!t.isEmpty())return ht.error(at.unexpected(t))}break}return s===u?ht.done(i):new e(r,n,i,o,s)},e}(ht);co.PatternParser=Bo;var No=function(){function t(){}return t.prototype.next=function(t,e){return this.floor(this.offset(t,e))},t.prototype.ceil=function(t){return t=t instanceof ao?t.time(t.time()-1):ao.time(t)-1,this.next(this.floor(t),1)},t.prototype.round=function(t){t=ao.fromAny(t);var e=this.floor(t),r=this.ceil(t);return t.time()-e.time()<r.time()-t.time()?e:r},t.prototype.range=function(t,e,r){t=this.ceil(t),e=ao.time(e);var n=[];if((r="number"==typeof r?Math.floor(r):1)>0)for(;t.time()<e;)n.push(t),t=this.next(t,r);return n},t.prototype.filter=function(e){return new t.Filter(this,e)},t.year=function(e){return t._year||(t._year=new t.Year),void 0===e?t._year:t._year.every(e)},t.month=function(e){return t._month||(t._month=new t.Month),void 0===e?t._month:t._month.every(e)},t.week=function(){return t._week||(t._week=new t.Week),t._week},t.day=function(e){return t._day||(t._day=new t.Day),void 0===e?t._day:t._day.every(e)},t.hour=function(e){return t._hour||(t._hour=new t.Hour),void 0===e?t._hour:t._hour.every(e)},t.minute=function(e){return t._minute||(t._minute=new t.Minute),void 0===e?t._minute:t._minute.every(e)},t.second=function(e){return t._second||(t._second=new t.Second),void 0===e?t._second:t._second.every(e)},t.millisecond=function(e){return t._millisecond||(t._millisecond=new t.Millisecond),void 0===e?t._millisecond:t._millisecond.every(e)},t.years=function(e,r,n){return t.year().range(e,r,n)},t.months=function(e,r,n){return t.month().range(e,r,n)},t.weeks=function(e,r,n){return t.week().range(e,r,n)},t.days=function(e,r,n){return t.day().range(e,r,n)},t.hours=function(e,r,n){return t.hour().range(e,r,n)},t.minutes=function(e,r,n){return t.minute().range(e,r,n)},t.seconds=function(e,r,n){return t.second().range(e,r,n)},t.milliseconds=function(e,r,n){return t.millisecond().range(e,r,n)},t}(),Ko=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e}(No),Wo=function(t){function e(e,r){var n=t.call(this)||this;return n.unit=e,n.predicate=r,n}return y(e,t),e.prototype.offset=function(t,e){for(t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1);e<0;){do{t=this.unit.offset(t,-1)}while(!this.predicate(t));e+=1}for(;e>0;){do{t=this.unit.offset(t,1)}while(!this.predicate(t));e-=1}return t},e.prototype.floor=function(t){for(t=ao.fromAny(t);t=this.unit.floor(t),!this.predicate(t);)t=t.time(t.time()-1);return t},e}(No);No.Filter=Wo;var jo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t=t.year(t.year()+e)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.year(t.year()+e).month(0,1).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=ao.fromAny(t)).month(0,1).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=ao.fromAny(t)).time(t.time()-1)).month(0,1).hour(0,0,0,0)).year(t.year()+1)).month(0,1).hour(0,0,0,0)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new No.Years(t);throw new Error(""+t)},e}(Ko);No.Year=jo;var Ho=function(t){function e(e){var r=t.call(this)||this;return r.stride=e||1,r}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.year(t.year()+e*this.stride)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=t.year(Math.floor((t.year()+e*this.stride)/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=(t=ao.fromAny(t)).year(Math.floor(t.year()/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=(t=ao.fromAny(t)).time(t.time()-1)).year(Math.floor(t.year()/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)).year(Math.floor((t.year()+this.stride)/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)},e}(No);No.Years=Ho;var Go=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.month(t.month()+e)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=t.month(t.month()+e)).day(1).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=ao.fromAny(t)).day(1).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=ao.fromAny(t)).time(t.time()-1)).day(1).hour(0,0,0,0)).month(t.month()+1)).day(1).hour(0,0,0,0)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new No.Filter(this,e.modulo.bind(void 0,t));throw new Error(""+t)},e.modulo=function(t,e){return e.month()%t==0},e}(Ko);No.Month=Go;var Qo=function(t){function e(e){void 0===e&&(e=0);var r=t.call(this)||this;return r.day=e,r}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.day(t.day()+7*e)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=(t=t.day(t.day()+7*e)).day(t.day()-(t.weekday()+7-this.day)%7)).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=(t=ao.fromAny(t)).day(t.day()-(t.weekday()+7-this.day)%7)).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=(t=ao.fromAny(t)).time(t.time()-1)).day(t.day()-(t.weekday()+7-this.day)%7)).hour(0,0,0,0)).day(t.day()+7)).hour(0,0,0,0)},e}(No);No.Week=Qo;var Xo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.day(t.day()+e)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=t.day(t.day()+e)).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=ao.fromAny(t)).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=ao.fromAny(t)).time(t.time()-1)).hour(0,0,0,0)).day(t.day()+1)).hour(0,0,0,0)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new No.Filter(this,e.modulo.bind(void 0,t));throw new Error(""+t)},e.modulo=function(t,e){return e.day()%t==0},e}(Ko);No.Day=Xo;var Zo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+36e5*e)},e.prototype.next=function(t,e){t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1);var r=6e4*(t=t.time(t.time()+36e5*e)).zone().offset()%36e5;return r<0&&(r+=36e5),t.time(36e5*Math.floor((t.time()-r)/36e5)+r)},e.prototype.floor=function(t){var e=6e4*(t=ao.fromAny(t)).zone().offset()%36e5;return e<0&&(e+=36e5),t.time(36e5*Math.floor((t.time()-e)/36e5)+e)},e.prototype.ceil=function(t){var e=6e4*(t=(t=ao.fromAny(t)).time(t.time()-1)).zone().offset()%36e5;return e<0&&(e+=36e5),(e=6e4*(t=t.time(36e5*Math.floor((t.time()-e)/36e5)+e+36e5)).zone().offset()%36e5)<0&&(e+=36e5),t.time(36e5*Math.floor((t.time()-e)/36e5)+e)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new No.Filter(this,e.modulo.bind(void 0,t));throw new Error(""+t)},e.modulo=function(t,e){return e.hour()%t==0},e}(Ko);No.Hour=Zo;var Yo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+6e4*e)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(6e4*Math.floor((t.time()+6e4*e)/6e4))},e.prototype.floor=function(t){return(t=ao.fromAny(t)).time(6e4*Math.floor(t.time()/6e4))},e.prototype.ceil=function(t){return(t=ao.fromAny(t)).time(6e4*Math.floor((6e4*Math.floor((t.time()-1)/6e4)+6e4)/6e4))},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new No.Filter(this,e.modulo.bind(void 0,t));throw new Error(""+t)},e.modulo=function(t,e){return e.minute()%t==0},e}(Ko);No.Minute=Yo;var $o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+1e3*e)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(1e3*Math.floor((t.time()+1e3*e)/1e3))},e.prototype.floor=function(t){return(t=ao.fromAny(t)).time(1e3*Math.floor(t.time()/1e3))},e.prototype.ceil=function(t){return(t=ao.fromAny(t)).time(1e3*Math.floor((1e3*Math.floor((t.time()-1)/1e3)+1e3)/1e3))},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new No.Filter(this,e.modulo.bind(void 0,t));throw new Error(""+t)},e.modulo=function(t,e){return e.second()%t==0},e}(Ko);No.Second=$o;var Jo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e)},e.prototype.next=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e)},e.prototype.floor=function(t){return ao.fromAny(t)},e.prototype.ceil=function(t){return ao.fromAny(t)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new No.Milliseconds(t);throw new Error(""+t)},e}(Ko);No.Millisecond=Jo;var ts=function(t){function e(e){var r=t.call(this)||this;return"number"==typeof e&&isFinite(e)&&!isNaN(e)||(e=1),r.stride=e,r}return y(e,t),e.prototype.offset=function(t,e){return t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e*this.stride)},e.prototype.next=function(t,e){t=ao.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1);var r=this.stride;return t.time(Math.floor((t.time()+e*r)/r)*r)},e.prototype.floor=function(t){t=ao.fromAny(t);var e=this.stride;return t.time(Math.floor(t.time()/e)*e)},e.prototype.ceil=function(t){t=ao.fromAny(t);var e=this.stride;return t.time(Math.floor((Math.floor((t.time()-1)/e)*e+e)/e)*e)},e}(No);No.Milliseconds=ts;var es=function(t){function e(r){var n=t.call(this,r instanceof at?r.message()||void 0:r)||this;return r instanceof at&&(n.diagnostic=r),n.__proto__=e.prototype,n}return y(e,t),e.prototype.toString=function(){return this.diagnostic?this.diagnostic.toString():t.prototype.toString.call(this)},e}(Error),rs=function(){function t(t,e,r,n,i){this._scheme=t,this._authority=e,this._path=r,this._query=n,this._fragment=i}return t.prototype.isDefined=function(){return this._scheme.isDefined()||this._authority.isDefined()||this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined()},t.prototype.isEmpty=function(){return!this._scheme.isDefined()&&!this._authority.isDefined()&&this._path.isEmpty()&&!this._query.isDefined()&&!this._fragment.isDefined()},t.prototype.scheme=function(e){return void 0===e?this._scheme:(e=t.Scheme.fromAny(e))!==this._scheme?this.copy(e,this._authority,this._path,this._query,this._fragment):this},t.prototype.schemePart=function(e){return void 0===e?this._scheme.toString():this.scheme(t.Scheme.parse(e))},t.prototype.schemeName=function(e){return void 0===e?this._scheme.name():this.scheme(t.Scheme.from(e))},t.prototype.authority=function(e){return void 0===e?this._authority:(e=t.Authority.fromAny(e))!==this._authority?this.copy(this._scheme,e,this._path,this._query,this._fragment):this},t.prototype.authorityPart=function(e){return void 0===e?this._authority.toString():this.authority(t.Authority.parse(e))},t.prototype.user=function(t){return void 0===t?this._authority.user():this.authority(this._authority.user(t))},t.prototype.userPart=function(t){return void 0===t?this._authority.userPart():this.authority(this._authority.userPart(t))},t.prototype.username=function(t,e){return void 0===t?this._authority.username():this.authority(this._authority.username(t,e))},t.prototype.password=function(t){return void 0===t?this._authority.password():this.authority(this._authority.password(t))},t.prototype.host=function(t){return void 0===t?this._authority.host():this.authority(this._authority.host(t))},t.prototype.hostPart=function(t){return void 0===t?this._authority.hostPart():this.authority(this._authority.hostPart(t))},t.prototype.hostAddress=function(){return this._authority.hostAddress()},t.prototype.hostName=function(t){return void 0===t?this._authority.hostName():this.authority(this._authority.hostName(t))},t.prototype.hostIPv4=function(t){return void 0===t?this._authority.hostIPv4():this.authority(this._authority.hostIPv4(t))},t.prototype.hostIPv6=function(t){return void 0===t?this._authority.hostIPv6():this.authority(this._authority.hostIPv6(t))},t.prototype.port=function(t){return void 0===t?this._authority.port():this.authority(this._authority.port(t))},t.prototype.portPart=function(t){return void 0===t?this._authority.portPart():this.authority(this._authority.portPart(t))},t.prototype.portNumber=function(t){return void 0===t?this._authority.portNumber():this.authority(this._authority.portNumber(t))},t.prototype.path=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(0===arguments.length)return this._path;var n=t.Path.from.apply(void 0,e);return n!==this._path?this.copy(this._scheme,this._authority,n,this._query,this._fragment):this},t.prototype.pathPart=function(e){return void 0===e?this._path.toString():this.path(t.Path.parse(e))},t.prototype.pathName=function(){return this._path.name()},t.prototype.appendedPath=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.path(this._path.appended.apply(this._path,arguments))},t.prototype.appendedSlash=function(){return this.path(this._path.appendedSlash())},t.prototype.appendedSegment=function(t){return this.path(this._path.appendedSegment(t))},t.prototype.prependedPath=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.path(this._path.prepended.apply(this._path,arguments))},t.prototype.prependedSlash=function(){return this.path(this._path.prependedSlash())},t.prototype.prependedSegment=function(t){return this.path(this._path.prependedSegment(t))},t.prototype.query=function(e){return void 0===e?this._query:(e=t.Query.fromAny(e))!==this._query?this.copy(this._scheme,this._authority,this._path,e,this._fragment):this},t.prototype.queryPart=function(e){return void 0===e?this._query.toString():this.query(t.Query.parse(e))},t.prototype.updatedQuery=function(t,e){return this.query(this._query.updated(t,e))},t.prototype.removedQuery=function(t){return this.query(this._query.removed(t))},t.prototype.appendedQuery=function(t,e){return this.query(this._query.appended(t,e))},t.prototype.prependedQuery=function(t,e){return this.query(this._query.prepended(t,e))},t.prototype.fragment=function(e){return void 0===e?this._fragment:(e=t.Fragment.fromAny(e))!==this._fragment?t.from(this._scheme,this._authority,this._path,this._query,e):this},t.prototype.fragmentPart=function(e){return void 0===e?this._fragment.toString():this.fragment(t.Fragment.parse(e))},t.prototype.fragmentIdentifier=function(e){return void 0===e?this._fragment.identifier():this.fragment(t.Fragment.from(e))},t.prototype.base=function(){return this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined()?t.from(this._scheme,this._authority):this},t.prototype.resolve=function(e){return(e=t.fromAny(e))._scheme.isDefined()?this.copy(e._scheme,e._authority,e._path.removeDotSegments(),e._query,e._fragment):e._authority.isDefined()?this.copy(this._scheme,e._authority,e._path.removeDotSegments(),e._query,e._fragment):e._path.isEmpty()?this.copy(this._scheme,this._authority,this._path,e._query.isDefined()?e._query:this._query,e._fragment):e._path.isAbsolute()?this.copy(this._scheme,this._authority,e._path.removeDotSegments(),e._query,e._fragment):this.copy(this._scheme,this._authority,this.merge(e._path).removeDotSegments(),e._query,e._fragment)},t.prototype.merge=function(t){return this._authority.isDefined()&&this._path.isEmpty()?t.prependedSlash():this._path.isEmpty()?t:this._path.merge(t)},t.prototype.unresolve=function(e){return e=t.fromAny(e),this._scheme.equals(e._scheme)&&this._authority.equals(e._authority)?t.from(t.Scheme.undefined(),t.Authority.undefined(),this._path.unmerge(e._path),e._query,e._fragment):e},t.prototype.copy=function(e,r,n,i,o){return t.from(e,r,n,i,o)},t.prototype.toAny=function(){var t={};return t.scheme=this._scheme.toAny(),this._authority.toAny(t),t.path=this._path.toAny(),t.query=this._query.toAny(),t.fragment=this._fragment.toAny(),t},t.prototype.compareTo=function(t){var e=this.toString().localeCompare(t.toString());return e<0?-1:e>0?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this.toString()===e.toString()},t.prototype.hashCode=function(){return void 0===this._hashCode&&(this._hashCode=f.hash(this.toString())),this._hashCode},t.prototype.debug=function(t){t=t.write("Uri").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("empty").write(40).write(41)},t.prototype.display=function(t){null!=this._string?t=t.write(this._string):(this._scheme.isDefined()&&t.display(this._scheme).write(58),this._authority.isDefined()&&(t=t.write(47).write(47).display(this._authority)),t.display(this._path),this._query.isDefined()&&(t=t.write(63).display(this._query)),this._fragment.isDefined()&&(t=t.write(35).display(this._fragment)))},t.prototype.toString=function(){return void 0===this._string&&(this._string=Z.display(this)),this._string},t.empty=function(){return void 0===t._empty&&(t._empty=new t(t.Scheme.undefined(),t.Authority.undefined(),t.Path.empty(),t.Query.undefined(),t.Fragment.undefined())),t._empty},t.from=function(e,r,n,i,o){return void 0===e&&(e=t.Scheme.undefined()),void 0===r&&(r=t.Authority.undefined()),void 0===n&&(n=t.Path.empty()),void 0===i&&(i=t.Query.undefined()),void 0===o&&(o=t.Fragment.undefined()),e.isDefined()||r.isDefined()||n.isDefined()||i.isDefined()||o.isDefined()?new t(e,r,n,i,o):t.empty()},t.fromAny=function(e){if(null==e)return t.empty();if(e instanceof t)return e;if("object"==typeof e){var r=t.Scheme.fromAny(e.scheme),n=t.Authority.fromAny(e.authority||e),i=t.Path.fromAny(e.path),o=t.Query.fromAny(e.query),s=t.Fragment.fromAny(e.fragment);return r.isDefined()||n.isDefined()||i.isDefined()||o.isDefined()||s.isDefined()?new t(r,n,i,o,s):t.empty()}if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.scheme=function(e){return e=t.Scheme.fromAny(e),t.from(e,void 0,void 0,void 0,void 0)},t.schemePart=function(e){var r=t.Scheme.parse(e);return t.from(r,void 0,void 0,void 0,void 0)},t.schemeName=function(e){var r=t.Scheme.from(e);return t.from(r,void 0,void 0,void 0,void 0)},t.authority=function(e){return e=t.Authority.fromAny(e),t.from(void 0,e,void 0,void 0,void 0)},t.authorityPart=function(e){var r=t.Authority.parse(e);return t.from(void 0,r,void 0,void 0,void 0)},t.user=function(e){var r=t.Authority.user(e);return t.from(void 0,r,void 0,void 0,void 0)},t.userPart=function(e){var r=t.Authority.userPart(e);return t.from(void 0,r,void 0,void 0,void 0)},t.username=function(e,r){var n=t.Authority.username(e,r);return t.from(void 0,n,void 0,void 0,void 0)},t.password=function(e){var r=t.Authority.password(e);return t.from(void 0,r,void 0,void 0,void 0)},t.host=function(e){var r=t.Authority.host(e);return t.from(void 0,r,void 0,void 0,void 0)},t.hostPart=function(e){var r=t.Authority.hostPart(e);return t.from(void 0,r,void 0,void 0,void 0)},t.hostName=function(e){var r=t.Authority.hostName(e);return t.from(void 0,r,void 0,void 0,void 0)},t.hostIPv4=function(e){var r=t.Authority.hostIPv4(e);return t.from(void 0,r,void 0,void 0,void 0)},t.hostIPv6=function(e){var r=t.Authority.hostIPv6(e);return t.from(void 0,r,void 0,void 0,void 0)},t.port=function(e){var r=t.Authority.port(e);return t.from(void 0,r,void 0,void 0,void 0)},t.portPart=function(e){var r=t.Authority.portPart(e);return t.from(void 0,r,void 0,void 0,void 0)},t.portNumber=function(e){var r=t.Authority.portNumber(e);return t.from(void 0,r,void 0,void 0,void 0)},t.path=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=t.Path.from.apply(void 0,e);return t.from(void 0,void 0,n,void 0,void 0)},t.pathPart=function(e){var r=t.Path.parse(e);return t.from(void 0,void 0,r,void 0,void 0)},t.query=function(e){return e=t.Query.fromAny(e),t.from(void 0,void 0,void 0,e,void 0)},t.queryPart=function(e){var r=t.Query.parse(e);return t.from(void 0,void 0,void 0,r,void 0)},t.fragment=function(e){return e=t.Fragment.fromAny(e),t.from(void 0,void 0,void 0,void 0,e)},t.fragmentPart=function(e){var r=t.Fragment.parse(e);return t.from(void 0,void 0,void 0,void 0,r)},t.fragmentIdentifier=function(e){var r=t.Fragment.from(e);return t.from(void 0,void 0,void 0,void 0,r)},t.standardParser=function(){return this._standardParser||(this._standardParser=new t.Parser),this._standardParser},t.parse=function(e){return t.standardParser().parseAbsoluteString(e)},t.isUnreservedChar=function(t){return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||45===t||46===t||95===t||126===t},t.isSubDelimChar=function(t){return 33===t||36===t||38===t||40===t||41===t||42===t||43===t||44===t||59===t||61===t||39===t},t.isSchemeChar=function(t){return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||43===t||45===t||46===t},t.isUserInfoChar=function(e){return t.isUnreservedChar(e)||t.isSubDelimChar(e)||58===e},t.isUserChar=function(e){return t.isUnreservedChar(e)||t.isSubDelimChar(e)},t.isHostChar=function(e){return t.isUnreservedChar(e)||t.isSubDelimChar(e)},t.isPathChar=function(e){return t.isUnreservedChar(e)||t.isSubDelimChar(e)||58===e||64===e},t.isQueryChar=function(e){return t.isUnreservedChar(e)||t.isSubDelimChar(e)||47===e||58===e||63===e||64===e},t.isParamChar=function(e){return t.isUnreservedChar(e)||33===e||36===e||40===e||41===e||42===e||43===e||44===e||47===e||58===e||59===e||63===e||64===e||39===e},t.isFragmentChar=function(e){return t.isUnreservedChar(e)||t.isSubDelimChar(e)||47===e||58===e||63===e||64===e},t.isAlpha=function(t){return t>=65&&t<=90||t>=97&&t<=122},t.toLowerCase=function(t){return t>=65&&t<=90?t+32:t},t.writeScheme=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);if(!(n>0&&t.isSchemeChar(o)||0===n&&t.isAlpha(o)))throw new es("Invalid scheme: "+e);r=r.write(o)}},t.writeUserInfo=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isUserInfoChar(o)?r=r.write(o):t.writeEncoded(o,r)}},t.writeUser=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isUserChar(o)?r=r.write(o):t.writeEncoded(o,r)}},t.writeHost=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isHostChar(o)?r=r.write(o):t.writeEncoded(o,r)}},t.writeHostLiteral=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isHostChar(o)||58===o?r=r.write(o):t.writeEncoded(o,r)}},t.writePathSegment=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isPathChar(o)?r=r.write(o):t.writeEncoded(o,r)}},t.writeQuery=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isQueryChar(o)?r=r.write(o):t.writeEncoded(o,r)}},t.writeParam=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isParamChar(o)?r=r.write(o):t.writeEncoded(o,r)}},t.writeFragment=function(e,r){for(var n=0,i=e.length;n<i;n+=1){var o=e.charCodeAt(n);t.isFragmentChar(o)?r=r.write(o):t.writeEncoded(o,r)}},t.writeEncoded=function(e,r){0===e?(t.writePctEncoded(192,r),t.writePctEncoded(128,r)):e>=0&&e<=127?t.writePctEncoded(e,r):e>=128&&e<=2047?(t.writePctEncoded(192|e>>>6,r),t.writePctEncoded(128|63&e,r)):e>=2048&&e<=65535||e>=57344&&e<=65535?(t.writePctEncoded(224|e>>>12,r),t.writePctEncoded(128|e>>>6&63,r),t.writePctEncoded(128|63&e,r)):e>=65536&&e<=1114111?(t.writePctEncoded(240|e>>>18,r),t.writePctEncoded(128|e>>>12&63,r),t.writePctEncoded(128|e>>>6&63,r),t.writePctEncoded(128|63&e,r)):(t.writePctEncoded(239,r),t.writePctEncoded(191,r),t.writePctEncoded(189,r))},t.writePctEncoded=function(t,e){e=e.write(37).write(wt.lowercase().encodeDigit(t>>>4&15)).write(wt.lowercase().encodeDigit(15&t))},t.form=function(){return t._form||(t._form=new t.Form(t.empty())),t._form},t}(),ns=function(){function t(t){this._name=t}return t.prototype.isDefined=function(){return 0!==this._name.length},t.prototype.name=function(){return this._name},t.prototype.toAny=function(){return 0!==this._name.length?this._name:void 0},t.prototype.compareTo=function(t){var e=this._name.localeCompare(t._name);return e<0?-1:e>0?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this._name===e._name},t.prototype.hashCode=function(){return f.hash(this._name)},t.prototype.debug=function(t){t=t.write("UriScheme").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)},t.prototype.display=function(t){rs.writeScheme(this._name,t)},t.prototype.toString=function(){return this._name},t.undefined=function(){return void 0===t._undefined&&(t._undefined=new t("")),t._undefined},t.from=function(e){var r=t.cache(),n=r.get(e);return n||r.put(e,new t(e))},t.fromAny=function(e){if(null==e)return t.undefined();if(e instanceof t)return e;if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.parse=function(t){return rs.standardParser().parseSchemeString(t)},t.cache=function(){if(void 0===t._cache){t._cache=new x(4)}return t._cache},t}();rs.Scheme=ns;var is=function(){function t(t,e,r){this._user=t,this._host=e,this._port=r}return t.prototype.isDefined=function(){return this._user.isDefined()||this._host.isDefined()||this._port.isDefined()},t.prototype.user=function(t){return void 0===t?this._user:(t=rs.User.fromAny(t))!==this._user?this.copy(t,this._host,this._port):this},t.prototype.userPart=function(t){return void 0===t?this._user.toString():this.user(rs.User.parse(t))},t.prototype.username=function(t,e){return void 0===t?this._user._username||"":void 0===e?this.user(this._user.username(t)):this.user(rs.User.from(t,e))},t.prototype.password=function(t){return void 0===t?this._user.password():this.user(this._user.password(t))},t.prototype.host=function(t){return void 0===t?this._host:(t=rs.Host.fromAny(t))!==this._host?this.copy(this._user,t,this._port):this},t.prototype.hostPart=function(t){return void 0===t?this._host.toString():this.host(rs.Host.parse(t))},t.prototype.hostAddress=function(){return this._host.address()},t.prototype.hostName=function(t){return void 0===t?this._host.name():this.host(rs.Host.from(t))},t.prototype.hostIPv4=function(t){return void 0===t?this._host.ipv4():this.host(rs.Host.ipv4(t))},t.prototype.hostIPv6=function(t){return void 0===t?this._host.ipv6():this.host(rs.Host.ipv6(t))},t.prototype.port=function(t){return void 0===t?this._port:(t=rs.Port.fromAny(t))!==this._port?this.copy(this._user,this._host,t):this},t.prototype.portPart=function(t){return void 0===t?this._port.toString():this.port(rs.Port.parse(t))},t.prototype.portNumber=function(t){return void 0===t?this._port.number():this.port(rs.Port.from(t))},t.prototype.copy=function(e,r,n){return t.from(e,r,n)},t.prototype.toAny=function(t){return this.isDefined()&&(t=t||{},this._user.toAny(t),this._host.isDefined()&&(t.host=this._host.toAny()),this._port.isDefined()&&(t.port=this._port.toAny())),t},t.prototype.compareTo=function(t){var e=this.toString().localeCompare(t.toString());return e<0?-1:e>0?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this.toString()===e.toString()},t.prototype.hashCode=function(){return void 0===this._hashCode&&(this._hashCode=f.hash(this.toString())),this._hashCode},t.prototype.debug=function(t){t=t.write("UriAuthority").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)},t.prototype.display=function(t){void 0!==this._string?t=t.write(this._string):(this._user.isDefined()&&t.display(this._user).write(64),t.display(this._host),this._port.isDefined()&&(t=t.write(58).display(this._port)))},t.prototype.toString=function(){return void 0===this._string&&(this._string=Z.display(this)),this._string},t.undefined=function(){return void 0===t._undefined&&(t._undefined=new t(rs.User.undefined(),rs.Host.undefined(),rs.Port.undefined())),t._undefined},t.from=function(e,r,n){return void 0===e&&(e=rs.User.undefined()),void 0===r&&(r=rs.Host.undefined()),void 0===n&&(n=rs.Port.undefined()),e.isDefined()||r.isDefined()||n.isDefined()?new t(e,r,n):t.undefined()},t.fromAny=function(e){if(null==e)return t.undefined();if(e instanceof t)return e;if("object"==typeof e){var r=rs.User.fromAny(e.user||e),n=rs.Host.fromAny(e.host),i=rs.Port.fromAny(e.port);return t.from(r,n,i)}if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.user=function(e){return e=rs.User.fromAny(e),t.from(e,void 0,void 0)},t.userPart=function(e){var r=rs.User.parse(e);return t.from(r,void 0,void 0)},t.username=function(e,r){var n=rs.User.from(e,r);return t.from(n,void 0,void 0)},t.password=function(e){var r=rs.User.from("",e);return t.from(r,void 0,void 0)},t.host=function(e){return e=rs.Host.fromAny(e),t.from(void 0,e,void 0)},t.hostPart=function(e){var r=rs.Host.parse(e);return t.from(void 0,r,void 0)},t.hostName=function(e){var r=rs.Host.from(e);return t.from(void 0,r,void 0)},t.hostIPv4=function(e){var r=rs.Host.ipv4(e);return t.from(void 0,r,void 0)},t.hostIPv6=function(e){var r=rs.Host.ipv6(e);return t.from(void 0,r,void 0)},t.port=function(e){return e=rs.Port.fromAny(e),t.from(void 0,void 0,e)},t.portPart=function(e){var r=rs.Port.parse(e);return t.from(void 0,void 0,r)},t.portNumber=function(e){var r=rs.Port.from(e);return t.from(void 0,void 0,r)},t.parse=function(t){return rs.standardParser().parseAuthorityString(t)},t}();rs.Authority=is;var os=function(){function t(t,e){this._username=t,this._password=e}return t.prototype.isDefined=function(){return null!==this._username},t.prototype.username=function(t){return void 0===t?this._username||"":t!==this._username?this.copy(t,this._password):this},t.prototype.password=function(t){return void 0===t?this._password:t!==this._password?this.copy(this._username,t):this},t.prototype.copy=function(e,r){return t.from(e,r)},t.prototype.toAny=function(t){return null!==this._username&&((t=t||{}).username=this._username,null!==this._password&&(t.password=this._password)),t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this._username===e._username&&this._password===e._password)},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(f.mix(t._hashSeed,f.hash(this._username)),f.hash(this._password)))},t.prototype.debug=function(t){t=t.write("UriUser").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)},t.prototype.display=function(t){null!=this._username&&(rs.writeUser(this._username,t),null!=this._password&&(t=t.write(58),rs.writeUser(this._password,t)))},t.prototype.toString=function(){return Z.display(this)},t.undefined=function(){return void 0===t._undefined&&(t._undefined=new t(null,null)),t._undefined},t.from=function(e,r){return void 0===r&&(r=null),null!==e||null!==r?new t(e||"",r):t.undefined()},t.fromAny=function(e){if(null==e)return t.undefined();if(e instanceof t)return e;if("object"==typeof e){var r="string"==typeof e.username?e.username:null,n="string"==typeof e.password?e.password:null;return t.from(r,n)}if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.parse=function(t){return rs.standardParser().parseUserString(t)},t}();rs.User=os;var ss=function(){function t(){}return t.prototype.isDefined=function(){return!0},t.prototype.name=function(){return null},t.prototype.ipv4=function(){return null},t.prototype.ipv6=function(){return null},t.prototype.toAny=function(){return this.toString()},t.prototype.compareTo=function(t){var e=this.toString().localeCompare(t.toString());return e<0?-1:e>0?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this.toString()===e.toString()},t.prototype.hashCode=function(){return void 0===this._hashCode&&(this._hashCode=f.hash(this.toString())),this._hashCode},t.undefined=function(){return void 0===t._undefined&&(t._undefined=new rs.HostUndefined),t._undefined},t.from=function(e){var r=t.cache(),n=r.get(e);return n instanceof rs.HostName?n:r.put(e,new rs.HostName(e))},t.ipv4=function(e){var r=t.cache(),n=r.get(e);return n instanceof rs.HostIPv4?n:r.put(e,new rs.HostIPv4(e))},t.ipv6=function(e){var r=t.cache(),n=r.get(e);return n instanceof rs.HostIPv6?n:r.put(e,new rs.HostIPv6(e))},t.fromAny=function(e){if(null==e)return t.undefined();if(e instanceof t)return e;if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.parse=function(t){return rs.standardParser().parseHostString(t)},t.cache=function(){if(void 0===t._cache){t._cache=new x(16)}return t._cache},t}();rs.Host=ss;var us=function(t){function e(e){var r=t.call(this)||this;return r._address=e,r}return y(e,t),e.prototype.address=function(){return this._address},e.prototype.name=function(){return this._address},e.prototype.debug=function(t){t=t.write("UriHost").write(46).write("name").write(40).debug(this._address).write(41)},e.prototype.display=function(t){rs.writeHost(this._address,t)},e.prototype.toString=function(){return this._address},e}(ss);rs.HostName=us;var as=function(t){function e(e){var r=t.call(this)||this;return r._address=e,r}return y(e,t),e.prototype.address=function(){return this._address},e.prototype.ipv4=function(){return this._address},e.prototype.debug=function(t){t=t.write("UriHost").write(46).write("ipv4").write(40).debug(this._address).write(41)},e.prototype.display=function(t){rs.writeHost(this._address,t)},e.prototype.toString=function(){return this._address},e}(ss);rs.HostIPv4=as;var ps=function(t){function e(e){var r=t.call(this)||this;return r._address=e,r}return y(e,t),e.prototype.address=function(){return this._address},e.prototype.ipv6=function(){return this._address},e.prototype.debug=function(t){t=t.write("UriHost").write(46).write("ipv6").write(40).debug(this._address).write(41)},e.prototype.display=function(t){null!=this._string?t=t.write(this._string):(t=t.write(91),rs.writeHostLiteral(this._address,t),t=t.write(93))},e.prototype.toString=function(){return null==this._string&&(this._string="["+this.address+"]"),this._string},e}(ss);rs.HostIPv6=ps;var hs=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isDefined=function(){return!1},e.prototype.address=function(){return""},e.prototype.debug=function(t){t=t.write("UriHost").write(46).write("undefined").write(40).write(41)},e.prototype.display=function(t){},e.prototype.toString=function(){return""},e}(ss);rs.HostUndefined=hs;var fs=function(){function t(t){this._number=t}return t.prototype.isDefined=function(){return 0!==this._number},t.prototype.number=function(){return this._number},t.prototype.valueOf=function(){return this._number},t.prototype.toAny=function(){return this._number},t.prototype.compareTo=function(t){return this._number<t._number?-1:this._number>t._number?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this._number===e._number},t.prototype.hashCode=function(){return void 0===t._hashSeed&&(t._hashSeed=f.seed(t)),f.mash(f.mix(t._hashSeed,this._number))},t.prototype.debug=function(t){t=t.write("UriPort").write(46),this.isDefined()?(t=t.write("from").write(40),Z.displayNumber(this._number,t),t=t.write(41)):t=t.write("undefined").write(40).write(41)},t.prototype.display=function(t){Z.displayNumber(this._number,t)},t.prototype.toString=function(){return""+this._number},t.undefined=function(){return void 0===t._undefined&&(t._undefined=new t(0)),t._undefined},t.from=function(e){if(e>0){var r=t.cache(),n=r.get(e);return void 0!==n?n:r.put(e,new t(e))}if(0===e)return t.undefined();throw new TypeError(""+e)},t.fromAny=function(e){if(null==e)return t.undefined();if(e instanceof t)return e;if("number"==typeof e)return t.from(e);if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.parse=function(t){return rs.standardParser().parsePortString(t)},t.cache=function(){if(void 0===t._cache){t._cache=new x(4)}return t._cache},t}();rs.Port=fs;var cs=function(){function t(){}return Object.defineProperty(t.prototype,"length",{get:function(){for(var t=0,e=this;!e.isEmpty();)t+=1,e=e.tail();return t},enumerable:!0,configurable:!0}),t.prototype.get=function(t){for(var e=0,r=this;!r.isEmpty();){if(!(e<t))return r.head();e+=1,r=r.tail()}},t.prototype.name=function(){if(this.isEmpty())return"";for(var t=this;;){var e=t.tail();if(e.isEmpty())return t.isRelative()?t.head():"";t=e}},t.prototype.appended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(arguments.length>0){var r=new rs.PathBuilder;return r.addPath(this),r.push.apply(r,arguments),r.bind()}return this},t.prototype.appendedSlash=function(){var t=new rs.PathBuilder;return t.addPath(this),t.addSlash(),t.bind()},t.prototype.appendedSegment=function(t){var e=new rs.PathBuilder;return e.addPath(this),e.addSegment(t),e.bind()},t.prototype.prepended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(arguments.length>0){var r=new rs.PathBuilder;return r.push.apply(r,arguments),r.addPath(this),r.bind()}return this},t.prototype.prependedSlash=function(){return t.slash(this)},t.prototype.prependedSegment=function(e){return this.isEmpty()||this.isAbsolute()?t.segment(e,this):t.segment(e,t.slash(this))},t.prototype.removeDotSegments=function(){for(var e=this,r=new rs.PathBuilder;!e.isEmpty();){var n=e.head();if("."===n||".."===n)(e=e.tail()).isEmpty()||(e=e.tail());else if(e.isAbsolute()){var i=e.tail();if(i.isEmpty())r.push(e.head()),e=e.tail();else{var o=i.head();"."===o?(e=i.tail()).isEmpty()&&(e=t.slash()):".."===o?((e=i.tail()).isEmpty()&&(e=t.slash()),r.isEmpty()||r.pop().isAbsolute()||r.isEmpty()||r.pop()):(r.push(n,o),e=i.tail())}}else r.push(e.head()),e=e.tail()}return r.bind()},t.prototype.merge=function(t){if(this.isEmpty())return t;for(var e=new rs.PathBuilder,r=this;;){var n=r.tail();if(n.isEmpty()){r.isAbsolute()&&e.addSlash();break}r.isAbsolute()?e.addSlash():e.addSegment(r.head()),r=n}return e.addPath(t),e.bind()},t.prototype.unmerge=function(e,r){void 0===r&&(r=e);for(var n=this;;){if(n.isEmpty())return e.isEmpty()||e.tail().isEmpty()?e:e.tail();if(n.isRelative())return e;if(e.isRelative())return t.slash(e);var i=n.tail(),o=e.tail();if(!i.isEmpty()&&o.isEmpty())return t.slash();if(i.isEmpty()||o.isEmpty()||i.head()!==o.head())return o;if(i=i.tail(),o=o.tail(),!i.isEmpty()&&o.isEmpty())return r;n=i,e=o}},t.prototype.toAny=function(){for(var t=[],e=this;!e.isEmpty();)t.push(e.head()),e=e.tail();return t},t.prototype.compareTo=function(t){var e=this.toString().localeCompare(t.toString());return e<0?-1:e>0?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this.toString()===e.toString()},t.prototype.hashCode=function(){return void 0===this._hashCode&&(this._hashCode=f.hash(this.toString())),this._hashCode},t.prototype.display=function(t){for(var e=this;!e.isEmpty();)e.isAbsolute()?t=t.write(47):rs.writePathSegment(e.head(),t),e=e.tail()},t.builder=function(){return new rs.PathBuilder},t.empty=function(){return void 0===t._empty&&(t._empty=new rs.PathEmpty),t._empty},t.slash=function(e){return void 0===e&&(e=t.empty()),e===t.empty()?(void 0===t._slash&&(t._slash=new rs.PathSlash(e)),t._slash):new rs.PathSlash(e)},t.segment=function(e,r){return void 0===r&&(r=t.empty()),e=this.cacheSegment(e),new rs.PathSegment(e,r)},t.from=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=new rs.PathBuilder;return r.push.apply(r,arguments),r.bind()},t.fromAny=function(e){if(null==e)return t.empty();if(e instanceof t)return e;if(Array.isArray(e))return t.from.apply(void 0,arguments);if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.parse=function(t){return rs.standardParser().parsePathString(t)},t.segmentCache=function(){if(void 0===t._segmentCache){t._segmentCache=new k(64)}return t._segmentCache},t.cacheSegment=function(t){return t.length<=32?this.segmentCache().put(t):t},t}();rs.Path=cs;var ls=function(t){function e(e,r){var n=t.call(this)||this;return n._head=e,n._tail=r,n}return y(e,t),e.prototype.isDefined=function(){return!0},e.prototype.isAbsolute=function(){return!1},e.prototype.isRelative=function(){return!0},e.prototype.isEmpty=function(){return!1},e.prototype.head=function(){return this._head},e.prototype.tail=function(){return this._tail},e.prototype.setTail=function(t){t.isAbsolute()?this._tail=t:this._tail=cs.slash(t)},e.prototype.dealias=function(){return new e(this._head,this._tail)},e.prototype.prependedSegment=function(t){return cs.segment(t,cs.slash(this))},e.prototype.debug=function(t){t=t.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)},e.prototype.display=function(e){void 0!==this._string?e=e.write(this._string):t.prototype.display.call(this,e)},e.prototype.toString=function(){return void 0===this._string&&(this._string=Z.display(this)),this._string},e}(cs);rs.PathSegment=ls;var ds=function(t){function e(e){var r=t.call(this)||this;return r._tail=e,r}return y(e,t),e.prototype.isDefined=function(){return!0},e.prototype.isAbsolute=function(){return!0},e.prototype.isRelative=function(){return!1},e.prototype.isEmpty=function(){return!1},e.prototype.head=function(){return"/"},e.prototype.tail=function(){return this._tail},e.prototype.setTail=function(t){this._tail=t},e.prototype.dealias=function(){return new e(this._tail)},e.prototype.prependedSegment=function(t){return cs.segment(t,this)},e.prototype.debug=function(t){t=t.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)},e.prototype.display=function(e){void 0!==this._string?e=e.write(this._string):t.prototype.display.call(this,e)},e.prototype.toString=function(){return void 0===this._string&&(this._string=Z.display(this)),this._string},e}(cs);rs.PathSlash=ds;var ys=function(t){function e(){return t.call(this)||this}return y(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isAbsolute=function(){return!1},e.prototype.isRelative=function(){return!0},e.prototype.isEmpty=function(){return!0},e.prototype.head=function(){throw new Error("Empty UriPath")},e.prototype.tail=function(){throw new Error("Empty UriPath")},e.prototype.setTail=function(t){throw new Error("Empty UriPath")},e.prototype.dealias=function(){return this},e.prototype.appended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return cs.from.apply(void 0,arguments)},e.prototype.appendedSlash=function(){return cs.slash()},e.prototype.appendedSegment=function(t){return cs.segment(t)},e.prototype.prepended=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return cs.from.apply(void 0,arguments)},e.prototype.prependedSlash=function(){return cs.slash()},e.prototype.prependedSegment=function(t){return cs.segment(t)},e.prototype.merge=function(t){return t},e.prototype.debug=function(t){t=t.write("UriPath").write(46).write("empty").write(40).write(41)},e.prototype.display=function(t){},e.prototype.toString=function(){return""},e}(cs);rs.PathEmpty=ys;var _s=function(){function t(){this._first=rs.Path.empty(),this._last=null,this._size=0,this._aliased=0}return t.prototype.isEmpty=function(){return 0===this._size},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0;r<t.length;r+=1){var n=t[r];n instanceof rs.Path?this.addPath(n):Array.isArray(n)?this.push.apply(this,n):"/"===n?this.addSlash():this.addSegment(n)}},t.prototype.bind=function(){return this._aliased=0,this._first},t.prototype.addSlash=function(){var t=rs.Path.slash().dealias(),e=this._size;0===e?this._first=t:this.dealias(e-1).setTail(t),this._last=t,this._size=e+1,this._aliased+=1},t.prototype.addSegment=function(t){var e=rs.Path.segment(t,rs.Path.empty()),r=this._size;0===r?this._first=e:this.dealias(r-1).setTail(e),this._last=e,this._size=r+1,this._aliased+=1},t.prototype.addPath=function(t){if(!t.isEmpty()){var e=this._size;for(0===e?this._first=t:this.dealias(e-1).setTail(t),e+=1;;){var r=t.tail();if(r.isEmpty())break;t=r,e+=1}this._last=t,this._size=e}},t.prototype.pop=function(){var t=this._size,e=this._aliased;if(0===t)throw new Error("Empty UriPath");if(1===t){var r=this._first;return this._first=r.tail(),r.tail().isEmpty()&&(this._last=null),this._size=t-1,e>0&&(this._aliased=e-1),r}var n=this.dealias(t-2);return n.setTail(rs.Path.empty()),this._last=n,this._size=t-1,this._aliased=e-1,n.tail()},t.prototype.dealias=function(t){var e=0,r=null,n=this._first;if(this._aliased<=t){for(;e<this._aliased;)r=n,n=n.tail(),e+=1;for(;e<=t;){var i=n.dealias();0===e?this._first=i:r.setTail(i),r=i,n=n.tail(),e+=1}e===this._size&&(this._last=r),this._aliased=e}else if(0===t)r=this._first;else if(t===this._size-1)r=this._last;else for(;e<=t;)r=n,n=n.tail(),e+=1;return r},t}();rs.PathBuilder=_s;var vs=function(){function t(){}return Object.defineProperty(t.prototype,"length",{get:function(){for(var t=0,e=this;!e.isEmpty();)t+=1,e=e.tail();return t},enumerable:!0,configurable:!0}),t.prototype.has=function(t){for(var e=this;!e.isEmpty();){if(t===e.key())return!0;e=e.tail()}return!1},t.prototype.get=function(t){for(var e=this;!e.isEmpty();){if(t===e.key())return e.value();e=e.tail()}},t.prototype.updated=function(t,e){for(var r=this,n=new rs.QueryBuilder,i=!1;!r.isEmpty();)t===r.key()?(n.addParam(t,e),i=!0):n.addParam(r.key(),r.value()),r=r.tail();return i||n.addParam(t,e),n.bind()},t.prototype.removed=function(t){for(var e=this,r=new rs.QueryBuilder,n=!1;!e.isEmpty();)t===e.key()?n=!0:r.addParam(e.key(),e.value()),e=e.tail();return n?r.bind():this},t.prototype.appended=function(t,e){var r=new rs.QueryBuilder;return r.addQuery(this),r.add(t,e),r.bind()},t.prototype.prepended=function(t,e){var r=new rs.QueryBuilder;return r.add(t,e),r.addQuery(this),r.bind()},t.prototype.toAny=function(t){if(this.isDefined()){t=t||{};for(var e=this,r=0;!e.isEmpty();){var n=e.key();null!==n?t[n]=e.value():t["$"+r]=e.value(),e=e.tail(),r+=1}}return t},t.prototype.compareTo=function(t){var e=this.toString().localeCompare(t.toString());return e<0?-1:e>0?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this.toString()===e.toString()},t.prototype.hashCode=function(){return void 0===this._hashCode&&(this._hashCode=f.hash(this.toString())),this._hashCode},t.prototype.display=function(t){for(var e=this,r=!0;!e.isEmpty();){r?r=!1:t=t.write(38);var n=e.key();null!==n&&(rs.writeParam(n,t),t=t.write(61)),rs.writeQuery(e.value(),t),e=e.tail()}},t.builder=function(){return new rs.QueryBuilder},t.undefined=function(){return void 0===t._undefined&&(t._undefined=new rs.QueryUndefined),t._undefined},t.param=function(e,r,n){return void 0===n?(n=r,r=e,e=null):null!==e&&(e=this.cacheKey(e)),void 0===n&&(n=t.undefined()),new rs.QueryParam(e,r,n)},t.from=function(t,e){var r=new rs.QueryBuilder;return r.add(t,e),r.bind()},t.fromAny=function(e){if(null==e)return t.undefined();if(e instanceof t)return e;if("object"==typeof e){var r=new rs.QueryBuilder;return r.add(e),r.bind()}if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.parse=function(t){return rs.standardParser().parseQueryString(t)},t.keyCache=function(){if(void 0===t._keyCache){t._keyCache=new k(64)}return t._keyCache},t.cacheKey=function(e){return e.length<=32?t.keyCache().put(e):e},t}();rs.Query=vs;var ms=function(t){function e(e,r,n){var i=t.call(this)||this;return i._key=e,i._value=r,i._tail=n,i}return y(e,t),e.prototype.isDefined=function(){return!0},e.prototype.isEmpty=function(){return!1},e.prototype.head=function(){return[this._key,this._value]},e.prototype.key=function(){return this._key},e.prototype.value=function(){return this._value},e.prototype.tail=function(){return this._tail},e.prototype.setTail=function(t){this._tail=t},e.prototype.dealias=function(){return new e(this._key,this._value,this._tail)},e.prototype.debug=function(t){t=t.write("UriQuery").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)},e.prototype.display=function(e){void 0!==this._string?e=e.write(this._string):t.prototype.display.call(this,e)},e.prototype.toString=function(){return void 0===this._string&&(this._string=Z.display(this)),this._string},e}(vs);rs.QueryParam=ms;var ws=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isEmpty=function(){return!0},e.prototype.head=function(){throw new Error("Undefined Query")},e.prototype.key=function(){throw new Error("Undefined Query")},e.prototype.value=function(){throw new Error("Undefined Query")},e.prototype.tail=function(){throw new Error("Undefined Query")},e.prototype.setTail=function(t){throw new Error("Undefined Query")},e.prototype.dealias=function(){return this},e.prototype.updated=function(t,e){return vs.param(t,e,this)},e.prototype.removed=function(t){return this},e.prototype.appended=function(t,e){return vs.from(t,e)},e.prototype.prepended=function(t,e){return vs.from(t,e)},e.prototype.debug=function(t){t=t.write("UriQuery").write(46).write("undefined").write(40).write(41)},e.prototype.display=function(t){},e.prototype.toString=function(){return""},e}(vs);rs.QueryUndefined=ws;var gs=function(){function t(){this._first=rs.Query.undefined(),this._last=null,this._size=0,this._aliased=0}return t.prototype.isEmpty=function(){return 0===this._size},t.prototype.add=function(t,e){if(void 0!==e)this.addParam(t,e);else if("string"==typeof t)this.addParam(null,t);else if(t instanceof rs.Query)this.addQuery(t);else{var r=t;for(var n in r){var i=n,o=r[n];36===n.charCodeAt(0)&&(i=null),this.addParam(i,o)}}},t.prototype.bind=function(){return this._aliased=0,this._first},t.prototype.addParam=function(t,e){void 0===e&&(e=t,t=null);var r=rs.Query.param(t,e,rs.Query.undefined()),n=this._size;0===n?this._first=r:this.dealias(n-1).setTail(r),this._last=r,this._size=n+1,this._aliased+=1},t.prototype.addQuery=function(t){if(!t.isEmpty()){var e=this._size;for(0===e?this._first=t:this.dealias(e-1).setTail(t),e+=1;;){var r=t.tail();if(r.isEmpty())break;t=r,e+=1}this._last=t,this._size=e}},t.prototype.dealias=function(t){var e=0,r=null,n=this._first;if(this._aliased<=t){for(;e<this._aliased;)r=n,n=n.tail(),e+=1;for(;e<=t;){var i=n.dealias();0===e?this._first=i:r.setTail(i),r=i,n=n.tail(),e+=1}e===this._size&&(this._last=r),this._aliased=e}else if(0===t)r=this._first;else if(t===this._size-1)r=this._last;else for(;e<=t;)r=n,n=n.tail(),e+=1;return r},t}();rs.QueryBuilder=gs;var bs=function(){function t(t){this._identifier=t}return t.prototype.isDefined=function(){return null!==this._identifier},t.prototype.identifier=function(){return this._identifier},t.prototype.toAny=function(){return null!==this._identifier?this._identifier:void 0},t.prototype.compareTo=function(t){var e=this.toString().localeCompare(t.toString());return e<0?-1:e>0?1:0},t.prototype.equals=function(e){return this===e||e instanceof t&&this._identifier===e._identifier},t.prototype.hashCode=function(){return f.hash(this._identifier)},t.prototype.debug=function(t){t=t.write("UriFragment").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)},t.prototype.display=function(t){void 0!==this._string?t=t.write(this._string):null!==this._identifier&&rs.writeFragment(this._identifier,t)},t.prototype.toString=function(){return null==this._string&&(this._string=Z.display(this)),this._string},t.undefined=function(){return void 0===t._undefined&&(t._undefined=new t(null)),t._undefined},t.from=function(e){if(null!==e){var r=t.cache(),n=r.get(e);return n||r.put(e,new t(e))}return t.undefined()},t.fromAny=function(e){if(null==e)return t.undefined();if(e instanceof t)return e;if("string"==typeof e)return t.parse(e);throw new TypeError(""+e)},t.parse=function(t){return rs.standardParser().parseFragmentString(t)},t.cache=function(){if(void 0===t._cache){t._cache=new x(32)}return t._cache},t}();rs.Fragment=bs;var Ss=function(){function t(){}return t.prototype.absolute=function(t,e,r,n,i){return rs.from(t,e,r,n,i)},t.prototype.scheme=function(t){return rs.Scheme.from(t)},t.prototype.authority=function(t,e,r){return rs.Authority.from(t,e,r)},t.prototype.user=function(t,e){return rs.User.from(t,e)},t.prototype.hostName=function(t){return rs.Host.from(t)},t.prototype.hostIPv4=function(t){return rs.Host.ipv4(t)},t.prototype.hostIPv6=function(t){return rs.Host.ipv6(t)},t.prototype.port=function(t){return rs.Port.from(t)},t.prototype.pathEmpty=function(){return rs.Path.empty()},t.prototype.pathBuilder=function(){return new rs.PathBuilder},t.prototype.queryBuilder=function(){return new rs.QueryBuilder},t.prototype.fragment=function(t){return rs.Fragment.from(t)},t.prototype.absoluteParser=function(){return new t.AbsoluteParser(this)},t.prototype.parseAbsolute=function(e){return t.AbsoluteParser.parse(e,this)},t.prototype.parseAbsoluteString=function(t){var e=X.stringInput(t),r=this.parseAbsolute(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.schemeParser=function(){return new t.SchemeParser(this)},t.prototype.parseScheme=function(e){return t.SchemeParser.parse(e,this)},t.prototype.parseSchemeString=function(t){var e=X.stringInput(t),r=this.parseScheme(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.authorityParser=function(){return new t.AuthorityParser(this)},t.prototype.parseAuthority=function(e){return t.AuthorityParser.parse(e,this)},t.prototype.parseAuthorityString=function(t){var e=X.stringInput(t),r=this.parseAuthority(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.userParser=function(){return new t.UserParser(this)},t.prototype.parseUser=function(e){return t.UserParser.parse(e,this)},t.prototype.parseUserString=function(t){var e=X.stringInput(t),r=this.parseUser(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.hostParser=function(){return new t.HostParser(this)},t.prototype.parseHost=function(e){return t.HostParser.parse(e,this)},t.prototype.parseHostString=function(t){var e=X.stringInput(t),r=this.parseHost(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.hostAddressParser=function(){return new t.HostAddressParser(this)},t.prototype.parseHostAddress=function(e){return t.HostAddressParser.parse(e,this)},t.prototype.hostLiteralParser=function(){return new t.HostLiteralParser(this)},t.prototype.parseHostLiteral=function(e){return t.HostLiteralParser.parse(e,this)},t.prototype.portParser=function(){return new t.PortParser(this)},t.prototype.parsePort=function(e){return t.PortParser.parse(e,this)},t.prototype.parsePortString=function(t){var e=X.stringInput(t),r=this.parsePort(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.pathParser=function(e){return new t.PathParser(this,e)},t.prototype.parsePath=function(e,r){return t.PathParser.parse(e,this,r)},t.prototype.parsePathString=function(t){var e=X.stringInput(t),r=this.parsePath(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.queryParser=function(e){return new t.QueryParser(this,e)},t.prototype.parseQuery=function(e,r){return t.QueryParser.parse(e,this,r)},t.prototype.parseQueryString=function(t){var e=X.stringInput(t),r=this.parseQuery(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t.prototype.fragmentParser=function(){return new t.FragmentParser(this)},t.prototype.parseFragment=function(e){return t.FragmentParser.parse(e,this)},t.prototype.parseFragmentString=function(t){var e=X.stringInput(t),r=this.parseFragment(e);return e.isCont()&&!r.isError()&&(r=ht.error(at.unexpected(e))),r.bind()},t}();rs.Parser=Ss;var xs=function(t){function e(e,r,n,i,o,s,u){var a=t.call(this)||this;return a.uri=e,a.schemeParser=r,a.authorityParser=n,a.pathParser=i,a.queryParser=o,a.fragmentParser=s,a.step=u,a}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.schemeParser,this.authorityParser,this.pathParser,this.queryParser,this.fragmentParser,this.step)},e.parse=function(t,r,n,i,o,s,u,a){void 0===a&&(a=1);var p=0;if(1===a)if(t.isCont()){for(var h=t.clone();h.isCont()&&(p=h.head(),rs.isSchemeChar(p));)h.step();a=h.isCont()&&58===p?2:3}else t.isDone()&&(a=3);if(2===a)if((n=n?n.feed(t):r.parseScheme(t)).isDone()){if(t.isCont()&&58===t.head())t=t.step(),a=3;else if(!t.isEmpty())return ht.error(at.expected(58,t))}else if(n.isError())return n.asError();if(3===a)if(t.isCont())47===(p=t.head())?(t=t.step(),a=4):63===p?(t=t.step(),a=7):35===p?(t=t.step(),a=8):a=6;else if(t.isDone())return ht.done(r.absolute(n&&n.bind()));if(4===a)if(t.isCont()&&47===t.head())t=t.step(),a=5;else if(t.isCont()){var f=r.pathBuilder();f.addSlash(),o=r.parsePath(t,f),a=6}else if(t.isDone())return ht.done(r.absolute(n&&n.bind(),void 0,rs.Path.slash()));if(5===a)if((i=i?i.feed(t):r.parseAuthority(t)).isDone()){if(t.isCont())63===(p=t.head())?(t=t.step(),a=7):35===p?(t=t.step(),a=8):a=6;else if(t.isDone())return ht.done(r.absolute(n&&n.bind(),i&&i.bind()))}else if(i.isError())return i.asError();if(6===a)if((o=o?o.feed(t):r.parsePath(t)).isDone()){if(t.isCont()&&63===t.head())t=t.step(),a=7;else if(t.isCont()&&35===t.head())t=t.step(),a=8;else if(!t.isEmpty())return ht.done(r.absolute(n&&n.bind(),i&&i.bind(),o.bind()))}else if(o.isError())return o.asError();if(7===a)if((s=s?s.feed(t):r.parseQuery(t)).isDone()){if(t.isCont()&&35===t.head())t=t.step(),a=8;else if(!t.isEmpty())return ht.done(r.absolute(n&&n.bind(),i&&i.bind(),o&&o.bind(),s.bind()))}else if(s.isError())return s.asError();if(8===a){if((u=u?u.feed(t):r.parseFragment(t)).isDone())return ht.done(r.absolute(n&&n.bind(),i&&i.bind(),o&&o.bind(),s&&s.bind(),u.bind()));if(u.isError())return u.asError()}return new e(r,n,i,o,s,u,a)},e}(ht);Ss.AbsoluteParser=xs;var Es=function(t){function e(e,r,n){var i=t.call(this)||this;return i.uri=e,i.output=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.output,this.step)},e.parse=function(t,r,n,i){void 0===i&&(i=1);var o=0;if(1===i)if(t.isCont()&&(o=t.head(),rs.isAlpha(o)))t=t.step(),n=(n=n||St.decodedString()).write(rs.toLowerCase(o)),i=2;else if(!t.isEmpty())return ht.error(at.expected("scheme",t));if(2===i){for(;t.isCont()&&(o=t.head(),rs.isSchemeChar(o));)t=t.step(),n.write(rs.toLowerCase(o));if(!t.isEmpty())return ht.done(r.scheme(n.bind()))}return new e(r,n,i)},e}(ht);Ss.SchemeParser=Es;var ks=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.uri=e,s.userParser=r,s.hostParser=n,s.portParser=i,s.step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.userParser,this.hostParser,this.portParser,this.step)},e.parse=function(t,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s)if(t.isCont()){for(var a=t.clone();a.isCont()&&(64!==(u=a.head())&&47!==u);)a.step();s=a.isCont()&&64===u?2:3}else t.isDone()&&(s=3);if(2===s)if((n=n?n.feed(t):r.parseUser(t)).isDone()){if(t.isCont()&&64===t.head())t=t.step(),s=3;else if(!t.isEmpty())return ht.error(at.expected(64,t))}else if(n.isError())return n.asError();if(3===s)if((i=i?i.feed(t):r.parseHost(t)).isDone()){if(t.isCont()&&58===t.head())t=t.step(),s=4;else if(!t.isEmpty())return ht.done(r.authority(n&&n.bind(),i.bind()))}else if(i.isError())return i.asError();if(4===s){if((o=o?o.feed(t):r.parsePort(t)).isDone())return ht.done(r.authority(n&&n.bind(),i.bind(),o.bind()));if(o.isError())return o.asError()}return new e(r,n,i,o,s)},e}(ht);Ss.AuthorityParser=ks;var Cs=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.uri=e,s.usernameOutput=r,s.passwordOutput=n,s.c1=i,s.step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.usernameOutput,this.passwordOutput,this.c1,this.step)},e.parse=function(t,r,n,i,o,s){void 0===o&&(o=0),void 0===s&&(s=1);for(var u=0;;){if(1===s){for(n=n||St.decodedString();t.isCont()&&(u=t.head(),rs.isUserChar(u));)t=t.step(),n.write(u);if(t.isCont()&&58===u)t=t.step(),s=4;else if(t.isCont()&&37===u)t=t.step(),s=2;else if(!t.isEmpty())return ht.done(r.user(n.bind()))}if(2===s)if(t.isCont()&&(u=t.head(),wt.isDigit(u)))t=t.step(),o=u,s=3;else if(!t.isEmpty())return ht.error(at.expected("hex digit",t));if(3===s){if(t.isCont()&&(u=t.head(),wt.isDigit(u))){t=t.step(),n.write(wt.decodeDigit(o)<<4|wt.decodeDigit(u)),o=0,s=1;continue}if(!t.isEmpty())return ht.error(at.expected("hex digit",t))}if(4===s){for(i=i||St.decodedString();t.isCont()&&(u=t.head(),rs.isUserInfoChar(u));)t=t.step(),i.write(u);if(t.isCont()&&37===u)t=t.step(),s=5;else if(!t.isEmpty())return ht.done(r.user(n.bind(),i.bind()))}if(5===s)if(t.isCont()&&(u=t.head(),wt.isDigit(u)))t=t.step(),o=u,s=6;else if(!t.isEmpty())return ht.error(at.expected("hex digit",t));if(6===s){if(t.isCont()&&(u=t.head(),wt.isDigit(u))){t=t.step(),i.write(wt.decodeDigit(o)<<4|wt.decodeDigit(u)),o=0,s=4;continue}if(!t.isEmpty())return ht.error(at.expected("hex digit",t))}break}return new e(r,n,i,o,s)},e}(ht);Ss.UserParser=Cs;var Os=function(t){function e(e){var r=t.call(this)||this;return r.uri=e,r}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri)},e.parse=function(t,r){return t.isCont()?91===t.head()?r.parseHostLiteral(t):r.parseHostAddress(t):t.isDone()?ht.done(r.hostName("")):new e(r)},e}(ht);Ss.HostParser=Os;var As=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.uri=e,s.output=r,s.c1=n,s.x=i,s.step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.output,this.c1,this.x,this.step)},e.parse=function(t,r,n,i,o,s){void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=1);var u=0;for(n=n||St.decodedString();s<=4;){for(;t.isCont()&&(u=t.head(),ut.isDigit(u));)t=t.step(),n=n.write(u),o=10*o+ut.decodeDigit(u);if(!t.isCont()){if(t.isEmpty())break;return 4===s&&o<=255?ht.done(r.hostIPv4(n.bind())):ht.done(r.hostName(n.bind()))}if(!(46===u&&s<4&&o<=255)){if(!rs.isHostChar(u)&&37!==u&&4===s&&o<=255)return ht.done(r.hostIPv4(n.bind()));o=0,s=5;break}t=t.step(),n=n.write(u),o=0,s+=1}for(;;){if(5===s){for(;t.isCont()&&(u=t.head(),rs.isHostChar(u));)t=t.step(),n.write(rs.toLowerCase(u));if(t.isCont()&&37===u)t=t.step(),s=6;else if(!t.isEmpty())return ht.done(r.hostName(n.bind()))}if(6===s)if(t.isCont()&&(u=t.head(),wt.isDigit(u)))t=t.step(),i=u,s=7;else if(!t.isEmpty())return ht.error(at.expected("hex digit",t));if(7===s){if(t.isCont()&&(u=t.head(),wt.isDigit(u))){t=t.step(),n.write(wt.decodeDigit(i)<<4|wt.decodeDigit(u)),i=0,s=5;continue}if(!t.isEmpty())return ht.error(at.expected("hex digit",t))}break}return new e(r,n,i,o,s)},e}(ht);Ss.HostAddressParser=As;var Is=function(t){function e(e,r,n){var i=t.call(this)||this;return i.uri=e,i.output=r,i.step=n,i}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.output,this.step)},e.parse=function(t,r,n,i){void 0===i&&(i=1);var o=0;if(1===i)if(t.isCont()&&91===t.head())t=t.step(),i=2;else if(!t.isEmpty())return ht.error(at.expected(91,t));if(2===i){for(n=n||St.decodedString();t.isCont()&&(o=t.head(),rs.isHostChar(o)||58===o);)t=t.step(),n=n.write(rs.toLowerCase(o));if(t.isCont()&&93===o)return t=t.step(),ht.done(r.hostIPv6(n.bind()));if(!t.isEmpty())return ht.error(at.expected(93,t))}return new e(r,n,i)},e}(ht);Ss.HostLiteralParser=Is;var Ds=function(t){function e(e,r){var n=t.call(this)||this;return n.uri=e,n.number=r,n}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.number)},e.parse=function(t,r,n){void 0===n&&(n=0);for(var i=0;t.isCont()&&(i=t.head(),ut.isDigit(i));)t=t.step(),n=10*n+ut.decodeDigit(i);return t.isEmpty()?new e(r,n):ht.done(r.port(n))},e}(ht);Ss.PortParser=Ds;var Ms=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.uri=e,s.builder=r,s.output=n,s.c1=i,s.step=o,s}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.builder,this.output,this.c1,this.step)},e.parse=function(t,r,n,i,o,s){void 0===o&&(o=0),void 0===s&&(s=1);for(var u=0;;){if(1===s){for(;t.isCont()&&(u=t.head(),rs.isPathChar(u));)i=i||St.decodedString(),t=t.step(),i=i.write(u);if(t.isCont()&&47===u){t=t.step(),n=n||r.pathBuilder(),i&&(n.addSegment(i.bind()),i=void 0),n.addSlash();continue}if(t.isCont()&&37===u)t=t.step(),s=2;else if(!t.isEmpty())return i&&(n=n||r.pathBuilder()).addSegment(i.bind()),n?ht.done(n.bind()):ht.done(r.pathEmpty())}if(2===s)if(t.isCont()&&(u=t.head(),wt.isDigit(u)))t=t.step(),o=u,s=3;else if(!t.isEmpty())return ht.error(at.expected("hex digit",t));if(3===s){if(t.isCont()&&(u=t.head(),wt.isDigit(u))){i=i||St.decodedString(),t=t.step(),i=i.write(wt.decodeDigit(o)<<4|wt.decodeDigit(u)),o=0,s=1;continue}if(!t.isEmpty())return ht.error(at.expected("hex digit",t))}break}return new e(r,n,i,o,s)},e}(ht);Ss.PathParser=Ms;var Ts=function(t){function e(e,r,n,i,o,s){var u=t.call(this)||this;return u.uri=e,u.builder=r,u.keyOutput=n,u.valueOutput=i,u.c1=o,u.step=s,u}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.builder,this.keyOutput,this.valueOutput,this.c1,this.step)},e.parse=function(t,r,n,i,o,s,u){void 0===s&&(s=0),void 0===u&&(u=1);for(var a=0;;){if(1===u){for(i=i||St.decodedString();t.isCont()&&(a=t.head(),rs.isParamChar(a));)t=t.step(),i.write(a);if(t.isCont()&&61===a)t=t.step(),u=4;else{if(t.isCont()&&38===a){t=t.step(),(n=n||r.queryBuilder()).addParam(i.bind()),i=void 0;continue}if(t.isCont()&&37===a)t=t.step(),u=2;else if(!t.isEmpty())return(n=n||r.queryBuilder()).addParam(i.bind()),ht.done(n.bind())}}if(2===u)if(t.isCont()&&(a=t.head(),wt.isDigit(a)))t=t.step(),s=a,u=3;else if(!t.isEmpty())return ht.error(at.expected("hex digit",t));if(3===u){if(t.isCont()&&(a=t.head(),wt.isDigit(a))){t=t.step(),i.write(wt.decodeDigit(s)<<4|wt.decodeDigit(a)),s=0,u=1;continue}if(!t.isEmpty())return ht.error(at.expected("hex digit",t))}if(4===u){for(o=o||St.decodedString();t.isCont()&&(a=t.head(),rs.isParamChar(a)||61===a);)t=t.step(),o.write(a);if(t.isCont()&&38===a){t=t.step(),(n=n||r.queryBuilder()).addParam(i.bind(),o.bind()),i=void 0,o=void 0,u=1;continue}if(t.isCont()&&38===a)t=t.step(),u=5;else if(!t.isEmpty())return(n=n||r.queryBuilder()).addParam(i.bind(),o.bind()),ht.done(n.bind())}if(5===u)if(t.isCont()&&(a=t.head(),wt.isDigit(a)))t=t.step(),s=a,u=6;else if(!t.isEmpty())return ht.error(at.expected("hex digit",t));if(6===u){if(t.isCont()&&(a=t.head(),wt.isDigit(a))){t=t.step(),o.write(wt.decodeDigit(s)<<4|wt.decodeDigit(a)),s=0,u=4;continue}if(!t.isEmpty())return ht.error(at.expected("hex digit",t))}break}return new e(r,n,i,o,s,u)},e}(ht);Ss.QueryParser=Ts;var Ps=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o.uri=e,o.output=r,o.c1=n,o.step=i,o}return y(e,t),e.prototype.feed=function(t){return e.parse(t,this.uri,this.output,this.c1,this.step)},e.parse=function(t,r,n,i,o){void 0===i&&(i=0),void 0===o&&(o=1);var s=0;for(n=n||St.decodedString();;){if(1===o){for(;t.isCont()&&(s=t.head(),rs.isFragmentChar(s));)t=t.step(),n=n.write(s);if(t.isCont()&&37===s)t=t.step(),o=2;else if(!t.isEmpty())return ht.done(r.fragment(n.bind()))}if(2===o)if(t.isCont()&&(s=t.head(),wt.isDigit(s)))t=t.step(),i=s,o=3;else if(!t.isEmpty())return ht.error(at.expected("hex digit",t));if(3===o){if(t.isCont()&&(s=t.head(),wt.isDigit(s))){t=t.step(),n=n.write(wt.decodeDigit(i)<<4|wt.decodeDigit(s)),i=0,o=1;continue}if(!t.isEmpty())return ht.error(at.expected("hex digit",t))}break}return new e(r,n,i,o)},e}(ht);Ss.FragmentParser=Ps;var Vs=function(t){function e(e){var r=t.call(this)||this;return r._unit=e,r}return y(e,t),e.prototype.unit=function(t){return 0===arguments.length?this._unit:new e(t)},e.prototype.mold=function(t,e){return void 0===e?fe.from(t.toString()):e.concat(fe.from(t.toString()))},e.prototype.cast=function(t,e){var r=t.target();try{var n=r.stringValue();if("string"==typeof n)return rs.parse(n)}catch(t){}},e}(be);rs.Form=Vs;var Us=function(){function t(t,e){void 0===e&&(e=32),this._base=t,this._resolveCache=new x(e),this._unresolveCache=new x(e)}return t.prototype.resolve=function(t){t=rs.fromAny(t);var e=this._resolveCache.get(t);return void 0===e&&(e=this._base.resolve(t),this._resolveCache.put(t,e)),e},t.prototype.unresolve=function(t){t=rs.fromAny(t);var e=this._unresolveCache.get(t);return void 0===e&&(e=this._base.unresolve(t),this._unresolveCache.put(t,e)),e},t}(),Rs=function(){function t(){}return t.prototype.tag=function(){return this.constructor.tag()},t.prototype.prio=function(t){return void 0===t?0:this},t.prototype.rate=function(t){return void 0===t?0:this},t.prototype.toRecon=function(){return Yi.toString(this.toValue())},t.prototype.toString=function(){return Z.debug(this)},t.tag=function(){},t.fromValue=function(e){switch(e.tag()){case"event":return t.EventMessage.fromValue(e);case"command":return t.CommandMessage.fromValue(e);case"link":return t.LinkRequest.fromValue(e);case"linked":return t.LinkedResponse.fromValue(e);case"sync":return t.SyncRequest.fromValue(e);case"synced":return t.SyncedResponse.fromValue(e);case"unlink":return t.UnlinkRequest.fromValue(e);case"unlinked":return t.UnlinkedResponse.fromValue(e);case"auth":return t.AuthRequest.fromValue(e);case"authed":return t.AuthedResponse.fromValue(e);case"deauth":return t.DeauthRequest.fromValue(e);case"deauthed":return t.DeauthedResponse.fromValue(e);default:return}},t.parseRecon=function(e){return t.fromValue(Yi.parse(e))},t}(),Fs=function(t){function e(e){var r=t.call(this)||this;return r._body=e,r}return y(e,t),e.prototype.node=function(t){return void 0===t?rs.empty():this},e.prototype.lane=function(t){return void 0===t?rs.empty():this},e.prototype.body=function(t){return void 0===t?this._body:(t=ne.fromAny(t),this.copy(t))},e.prototype.equals=function(t){return this===t||t instanceof e&&this.__proto__.constructor===t.__proto__.constructor&&this._body.equals(t._body)},e.prototype.hashCode=function(){return f.mash(f.mix(f.seed(this.__proto__),this._body.hashCode()))},e.prototype.debug=function(t){t=t.write(this.__proto__.constructor.name).write(46).write("of").write(40),this._body.isDefined()&&(t=t.debug(this._body)),t=t.write(41)},e.prototype.toValue=function(){return te.of(this.tag()).concat(this._body)},e.fromValue=function(t,e){if(t.header(e.tag()).isDefined())return new e(t.body())},e}(Rs),zs=function(t){function e(e,r,n){var i=t.call(this)||this;return i._node=e,i._lane=r,i._body=n,i}return y(e,t),e.prototype.node=function(t){return void 0===t?this._node:(t=rs.fromAny(t),this.copy(t,this._lane,this._body))},e.prototype.lane=function(t){return void 0===t?this._lane:(t=rs.fromAny(t),this.copy(this._node,t,this._body))},e.prototype.body=function(t){return void 0===t?this._body:(t=ne.fromAny(t),this.copy(this._node,this._lane,t))},e.prototype.toValue=function(){var t=oe.create(2).slot("node",this._node.toString()).slot("lane",this._lane.toString());return te.of(this.tag(),t).concat(this._body)},e.prototype.equals=function(t){return this===t||t instanceof e&&this.__proto__.constructor===t.__proto__.constructor&&(this._node.equals(t._node)&&this._lane.equals(t._lane)&&this._body.equals(t._body))},e.prototype.hashCode=function(){return f.mash(f.mix(f.mix(f.mix(f.seed(this.__proto__),this._node.hashCode()),this._lane.hashCode()),this._body.hashCode()))},e.prototype.debug=function(t){t=t.write(this.__proto__.constructor.name).write(46).write("of").write(40).debug(this._node.toString()).write(", ").debug(this._lane.toString()),this._body.isDefined()&&(t=t.write(", ").debug(this._body)),t=t.write(41)},e.fromValue=function(t,e){var r,n;if(t.header(e.tag()).forEach(function(t,e){var i=t.key.stringValue(void 0);void 0!==i?"node"===i?r=rs.parse(t.toValue().stringValue("")):"lane"===i&&(n=rs.parse(t.toValue().stringValue(""))):t instanceof ne&&(0===e?r=rs.parse(t.stringValue("")):1===e&&(n=rs.parse(t.stringValue(""))))}),r&&n){var i=t.body();return new e(r,n,i)}},e}(Rs),Ls=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s._node=e,s._lane=r,s._prio=n,s._rate=i,s._body=o,s}return y(e,t),e.prototype.node=function(t){return void 0===t?this._node:(t=rs.fromAny(t),this.copy(t,this._lane,this._prio,this._rate,this._body))},e.prototype.lane=function(t){return void 0===t?this._lane:(t=rs.fromAny(t),this.copy(this._node,t,this._prio,this._rate,this._body))},e.prototype.prio=function(t){return void 0===t?this._prio:this.copy(this._node,this._lane,t,this._rate,this._body)},e.prototype.rate=function(t){return void 0===t?this._rate:this.copy(this._node,this._lane,this._prio,t,this._body)},e.prototype.body=function(t){return void 0===t?this._body:(t=ne.fromAny(t),this.copy(this._node,this._lane,this._prio,this._rate,t))},e.prototype.equals=function(t){return this===t||t instanceof e&&this.__proto__.constructor===t.__proto__.constructor&&(this._node.equals(t._node)&&this._lane.equals(t._lane)&&this._prio===t._prio&&this._rate===t._rate&&this._body.equals(t._body))},e.prototype.hashCode=function(){return f.mash(f.mix(f.mix(f.mix(f.mix(f.mix(f.seed(this.__proto__),this._node.hashCode()),this._lane.hashCode()),f.hash(this._prio)),f.hash(this._rate)),this._body.hashCode()))},e.prototype.debug=function(t){t=t.write(this.__proto__.constructor.name).write(46).write("of").write(40).debug(this._node.toString()).write(", ").debug(this._lane.toString()),(this._prio||this._rate)&&(t=t.write(", ").debug(this._prio).write(", ").debug(this._rate)),this._body.isDefined()&&(t=t.write(", ").debug(this._body)),t=t.write(41)},e.prototype.toValue=function(){var t=oe.create(4).slot("node",this._node.toString()).slot("lane",this._lane.toString());return this._prio&&t.slot("prio",this._prio),this._rate&&t.slot("rate",this._rate),te.of(this.tag(),t).concat(this._body)},e.fromValue=function(t,e){var r,n,i=0,o=0;if(t.header(e.tag()).forEach(function(t,e){var s=t.key.stringValue(void 0);void 0!==s?"node"===s?r=rs.parse(t.toValue().stringValue("")):"lane"===s?n=rs.parse(t.toValue().stringValue("")):"prio"===s?i=t.numberValue(i):"rate"===s&&(o=t.numberValue(o)):t instanceof ne&&(0===e?r=rs.parse(t.stringValue("")):1===e&&(n=rs.parse(t.stringValue(""))))}),r&&n){var s=t.body();return new e(r,n,i,o,s)}},e}(Rs),qs=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return y(e,t),e.prototype.copy=function(t,r,n){return new e(t,r,n)},e.tag=function(){return"event"},e.fromValue=function(t){return zs.fromValue(t,e)},e.of=function(t,r,n){return void 0===n&&(n=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n=ne.fromAny(n))},e}(zs);Rs.EventMessage=qs;var Bs=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return y(e,t),e.prototype.copy=function(t,r,n){return new e(t,r,n)},e.tag=function(){return"command"},e.fromValue=function(t){return zs.fromValue(t,e)},e.of=function(t,r,n){return void 0===n&&(n=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n=ne.fromAny(n))},e}(zs);Rs.CommandMessage=Bs;var Ns=function(t){function e(e,r,n,i,o){return t.call(this,e,r,n,i,o)||this}return y(e,t),e.prototype.copy=function(t,r,n,i,o){return new e(t,r,n,i,o)},e.tag=function(){return"link"},e.fromValue=function(t){return Ls.fromValue(t,e)},e.of=function(t,r,n,i,o){return void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n,i,o=ne.fromAny(o))},e}(Ls);Rs.LinkRequest=Ns;var Ks=function(t){function e(e,r,n,i,o){return t.call(this,e,r,n,i,o)||this}return y(e,t),e.prototype.copy=function(t,r,n,i,o){return new e(t,r,n,i,o)},e.tag=function(){return"linked"},e.fromValue=function(t){return Ls.fromValue(t,e)},e.of=function(t,r,n,i,o){return void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n,i,o=ne.fromAny(o))},e}(Ls);Rs.LinkedResponse=Ks;var Ws=function(t){function e(e,r,n,i,o){return t.call(this,e,r,n,i,o)||this}return y(e,t),e.prototype.copy=function(t,r,n,i,o){return new e(t,r,n,i,o)},e.tag=function(){return"sync"},e.fromValue=function(t){return Ls.fromValue(t,e)},e.of=function(t,r,n,i,o){return void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n,i,o=ne.fromAny(o))},e}(Ls);Rs.SyncRequest=Ws;var js=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return y(e,t),e.prototype.copy=function(t,r,n){return new e(t,r,n)},e.tag=function(){return"synced"},e.fromValue=function(t){return zs.fromValue(t,e)},e.of=function(t,r,n){return void 0===n&&(n=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n=ne.fromAny(n))},e}(zs);Rs.SyncedResponse=js;var Hs=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return y(e,t),e.prototype.copy=function(t,r,n){return new e(t,r,n)},e.tag=function(){return"unlink"},e.fromValue=function(t){return zs.fromValue(t,e)},e.of=function(t,r,n){return void 0===n&&(n=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n=ne.fromAny(n))},e}(zs);Rs.UnlinkRequest=Hs;var Gs=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return y(e,t),e.prototype.copy=function(t,r,n){return new e(t,r,n)},e.tag=function(){return"unlinked"},e.fromValue=function(t){return zs.fromValue(t,e)},e.of=function(t,r,n){return void 0===n&&(n=ne.absent()),new e(t=rs.fromAny(t),r=rs.fromAny(r),n=ne.fromAny(n))},e}(zs);Rs.UnlinkedResponse=Gs;var Qs=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.copy=function(t){return new e(t)},e.tag=function(){return"auth"},e.fromValue=function(t){return Fs.fromValue(t,e)},e.of=function(t){return void 0===t&&(t=ne.absent()),new e(t=ne.fromAny(t))},e}(Fs);Rs.AuthRequest=Qs;var Xs=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.copy=function(t){return new e(t)},e.tag=function(){return"authed"},e.fromValue=function(t){return Fs.fromValue(t,e)},e.of=function(t){return void 0===t&&(t=ne.absent()),new e(t=ne.fromAny(t))},e}(Fs);Rs.AuthedResponse=Xs;var Zs=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.copy=function(t){return new e(t)},e.tag=function(){return"deauth"},e.fromValue=function(t){return Fs.fromValue(t,e)},e.of=function(t){return void 0===t&&(t=ne.absent()),new e(t=ne.fromAny(t))},e}(Fs);Rs.DeauthRequest=Zs;var Ys=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.copy=function(t){return new e(t)},e.tag=function(){return"deauthed"},e.fromValue=function(t){return Fs.fromValue(t,e)},e.of=function(t){return void 0===t&&(t=ne.absent()),new e(t=ne.fromAny(t))},e}(Fs);Rs.DeauthedResponse=Ys;var $s,Js=function(){return function(){}}(),tu=function(t){function e(e,r,n){void 0===n&&(n={});var i=t.call(this)||this;return i._context=e,i._hostUri=r,i._options=n,i._downlinks=new zt,i._downlinkCount=0,i._authenticated=!1,i._session=ne.absent(),i._uriCache=new Us(r),i._sendBuffer=[],i._reconnectTimer=0,i._reconnectTimeout=0,i._idleTimer=0,i.open=i.open.bind(i),i.checkIdle=i.checkIdle.bind(i),i}return y(e,t),e.prototype.hostUri=function(){return this._hostUri},e.prototype.credentials=function(){return this._options.credentials||ne.absent()},e.prototype.maxReconnectTimeout=function(){return this._options.maxReconnectTimeout||3e4},e.prototype.idleTimeout=function(){return this._options.idleTimeout||1e3},e.prototype.sendBufferSize=function(){return this._options.sendBufferSize||1024},e.prototype.isAuthenticated=function(){return this._authenticated},e.prototype.session=function(){return this._session},e.prototype.isIdle=function(){return!this._sendBuffer.length&&!this._downlinkCount},e.prototype.resolve=function(t){return this._uriCache.resolve(t)},e.prototype.unresolve=function(t){return this._uriCache.unresolve(t)},e.prototype.authenticate=function(t){if(!(t=ne.fromAny(t)).equals(this._options.credentials))if(this._options.credentials=t,this.isConnected()){var e=Qs.of(t);this.push(e)}else this.open()},e.prototype.openDownlink=function(t){this.clearIdle();var e=this.resolve(t.nodeUri()),r=t.laneUri();this._downlinkCount||this.open();var n=this._downlinks.get(e);if(n||(n=new zt,this._downlinks.set(e,n)),n.get(r))throw new Error("duplicate downlink");n.set(r,t),this._downlinkCount+=1,t.openUp(this),this.isConnected()&&t.hostDidConnect(this)},e.prototype.unlinkDownlink=function(t){var e=this.resolve(t.nodeUri()),r=t.laneUri(),n=this._downlinks.get(e);if(n&&n.get(r)&&this.isConnected()){var i=Hs.of(this.unresolve(e),r);t.onUnlinkRequest(i,this),this.push(i)}},e.prototype.closeDownlink=function(t){var e=this.resolve(t.nodeUri()),r=t.laneUri(),n=this._downlinks.get(e);n&&n.get(r)&&(this._downlinkCount-=1,n.delete(r),n.isEmpty()&&this._downlinks.delete(e),this._downlinkCount||this.watchIdle(),t.closeUp(this))},e.prototype.command=function(t,e,r){t=rs.fromAny(t),t=this.resolve(t),e=rs.fromAny(e),r=ne.fromAny(r);var n=Bs.of(this.unresolve(t),e,r);this.push(n)},e.prototype.onEnvelope=function(t){t instanceof qs?this.onEventMessage(t):t instanceof Bs?this.onCommandMessage(t):t instanceof Ns?this.onLinkRequest(t):t instanceof Ks?this.onLinkedResponse(t):t instanceof Ws?this.onSyncRequest(t):t instanceof js?this.onSyncedResponse(t):t instanceof Hs?this.onUnlinkRequest(t):t instanceof Gs?this.onUnlinkedResponse(t):t instanceof Qs?this.onAuthRequest(t):t instanceof Xs?this.onAuthedResponse(t):t instanceof Zs?this.onDeauthRequest(t):t instanceof Ys?this.onDeauthedResponse(t):this.onUnknownEnvelope(t)},e.prototype.onEventMessage=function(t){var e=this.resolve(t.node()),r=t.lane(),n=this._downlinks.get(e);if(n){var i=n.get(r);if(i){var o=t.node(e);i.onEventMessage(o,this)}}},e.prototype.onCommandMessage=function(t){},e.prototype.onLinkRequest=function(t){},e.prototype.onLinkedResponse=function(t){var e=this.resolve(t.node()),r=t.lane(),n=this._downlinks.get(e);if(n){var i=n.get(r);if(i){var o=t.node(e);i.onLinkedResponse(o,this)}}},e.prototype.onSyncRequest=function(t){},e.prototype.onSyncedResponse=function(t){var e=this.resolve(t.node()),r=t.lane(),n=this._downlinks.get(e);if(n){var i=n.get(r);if(i){var o=t.node(e);i.onSyncedResponse(o,this)}}},e.prototype.onUnlinkRequest=function(t){},e.prototype.onUnlinkedResponse=function(t){var e=this.resolve(t.node()),r=t.lane(),n=this._downlinks.get(e);if(n){var i=n.get(r);if(i){var o=t.node(e);i.onUnlinkedResponse(o,this)}}},e.prototype.onAuthRequest=function(t){},e.prototype.onAuthedResponse=function(t){this._authenticated=!0,this._session=t.body(),this._context.hostDidAuthenticate(t.body(),this)},e.prototype.onDeauthRequest=function(t){},e.prototype.onDeauthedResponse=function(t){this._authenticated=!1,this._session=ne.absent(),this._context.hostDidDeauthenticate(t.body(),this)},e.prototype.onUnknownEnvelope=function(t){},e.prototype.onConnect=function(){this._reconnectTimeout=0,this._context.hostDidConnect(this),this._downlinks.forEach(function(t,e){e.forEach(function(t,e){e.hostDidConnect(this)},this)},this)},e.prototype.onDisconnect=function(){this._authenticated=!1,this._session=ne.absent(),this._context.hostDidDisconnect(this),this._downlinks.forEach(function(t,e){e.forEach(function(t,e){e.hostDidDisconnect(this)},this)},this)},e.prototype.onError=function(t){this._context.hostDidFail(t,this),this._downlinks.forEach(function(e,r){r.forEach(function(e,r){r.hostDidFail(t,this)},this)},this)},e.prototype.reconnect=function(){this._reconnectTimer||(this._reconnectTimeout?this._reconnectTimeout=Math.min(Math.floor(1.8*this._reconnectTimeout),this.maxReconnectTimeout()):this._reconnectTimeout=Math.floor(500+1e3*Math.random()),this._reconnectTimer=setTimeout(this.open,this._reconnectTimeout))},e.prototype.clearReconnect=function(){this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=0)},e.prototype.watchIdle=function(){!this._idleTimer&&this.isConnected()&&this.isIdle()&&(this._idleTimer=setTimeout(this.checkIdle,this.idleTimeout()))},e.prototype.clearIdle=function(){this._idleTimer&&(clearTimeout(this._idleTimer),this._idleTimer=0)},e.prototype.checkIdle=function(){this.isConnected()&&this.isIdle()&&this.close()},e.prototype.close=function(){this._context.closeHost(this)},e.prototype.closeUp=function(){this._downlinks.forEach(function(t,e){e.forEach(function(t,e){e.closeUp(this)},this)},this)},e}(Js),eu=function(t){function e(e,r,n){void 0===n&&(n={});var i=t.call(this,e,r,n)||this;return i.onWebSocketOpen=i.onWebSocketOpen.bind(i),i.onWebSocketMessage=i.onWebSocketMessage.bind(i),i.onWebSocketClose=i.onWebSocketClose.bind(i),i.onWebSocketError=i.onWebSocketError.bind(i),i}return y(e,t),Object.defineProperty(e.prototype,"WebSocket",{get:function(){return this._options.WebSocket||"undefined"!=typeof WebSocket&&WebSocket||"function"==typeof require&&require("ws")||void 0},enumerable:!0,configurable:!0}),e.prototype.isConnected=function(){return!!this._socket&&this._socket.readyState===this._socket.OPEN},e.prototype.open=function(){if(this.clearReconnect(),!this._socket){var t=this.WebSocket;if(!t)throw new Error("WebSocket undefined");var e=this._hostUri,r=e.schemeName();"warp"===r||"swim"===r?e=e.scheme("ws"):"warps"!==r&&"swims"!==r||(e=e.scheme("wss")),this._options.protocols?this._socket=new t(e.toString(),this._options.protocols):this._socket=new t(e.toString()),this._socket.onopen=this.onWebSocketOpen,this._socket.onmessage=this.onWebSocketMessage,this._socket.onclose=this.onWebSocketClose,this._socket.onerror=this.onWebSocketError}},e.prototype.close=function(){this.clearReconnect(),this.clearIdle(),this._socket?(this._socket.close(),this._context.isOnline()||this.onWebSocketClose()):t.prototype.close.call(this)},e.prototype.push=function(t){if(this.isConnected()){this.clearIdle();var e=t.toRecon();this._socket.send(e),this.watchIdle()}else if(t instanceof Bs){if(!(this._sendBuffer.length<this.sendBufferSize()))throw new Error("send buffer overflow");this._sendBuffer.push(t),this.open()}},e.prototype.onWebSocketOpen=function(){if(this.isConnected()){var t=this.credentials();if(t.isDefined()){var e=new Qs(t);this.push(e)}this.onConnect();for(var r=void 0;(r=this._sendBuffer.shift())&&this.isConnected();)this.push(r);this.watchIdle()}else this.close()},e.prototype.onWebSocketMessage=function(t){var e=t.data;if("string"==typeof e){var r=Rs.parseRecon(e);r?this.onEnvelope(r):this.onUnknownEnvelope(e)}},e.prototype.onWebSocketClose=function(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=void 0),this.onDisconnect(),this.clearIdle(),this.isIdle()?this.close():this._context.isOnline()&&this.reconnect()},e.prototype.onWebSocketError=function(){this.onError(),this._socket&&this._socket.close()},e}(tu),ru=function(){function t(t,e,r,n,i,o,s){void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=ne.absent()),this._context=t,this._hostUri=e,this._nodeUri=r,this._laneUri=n,this._prio=i,this._rate=o,this._body=s,this._views=[],this._host=null,this._status=0}return t.prototype.hostUri=function(){return this._hostUri},t.prototype.nodeUri=function(){return this._nodeUri},t.prototype.laneUri=function(){return this._laneUri},t.prototype.prio=function(){return this._prio},t.prototype.rate=function(){return this._rate},t.prototype.body=function(){return this._body},t.prototype.keepLinked=function(){for(var t=0;t<this._views.length;t+=1)if(this._views[t].keepLinked())return!0;return!1},t.prototype.keepSynced=function(){for(var t=0;t<this._views.length;t+=1)if(this._views[t].keepSynced())return!0;return!1},t.prototype.isConnected=function(){return!(!this._host||!this._host.isConnected())},t.prototype.isAuthenticated=function(){return!(!this._host||!this._host.isAuthenticated())},t.prototype.isLinked=function(){return 0!=(2&this._status)},t.prototype.isSynced=function(){return 0!=(8&this._status)},t.prototype.session=function(){return this._host?this._host.session():ne.absent()},t.prototype.addDownlink=function(t){this._views.push(t)},t.prototype.removeDownlink=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e]===t&&(this._views.splice(e,1),t.closeUp());0===this._views.length&&this.unlink()},t.prototype.onEventMessage=function(t,e){for(var r=0;r<this._views.length;r+=1)this._views[r].onEventMessage(t)},t.prototype.onCommandMessage=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].onCommandMessage(t)},t.prototype.onLinkRequest=function(t){this._status|=1;for(var e=0;e<this._views.length;e+=1)this._views[e].onLinkRequest(t)},t.prototype.onLinkedResponse=function(t,e){this._status=-2&this._status|2;for(var r=0;r<this._views.length;r+=1)this._views[r].onLinkedResponse(t)},t.prototype.onSyncRequest=function(t){this._status|=4;for(var e=0;e<this._views.length;e+=1)this._views[e].onSyncRequest(t)},t.prototype.onSyncedResponse=function(t,e){this._status=-5&this._status|8;for(var r=0;r<this._views.length;r+=1)this._views[r].onSyncedResponse(t)},t.prototype.onUnlinkRequest=function(t,e){this._status=-6&this._status|16;for(var r=0;r<this._views.length;r+=1)this._views[r].onUnlinkRequest(t)},t.prototype.onUnlinkedResponse=function(t,e){this._status&=-17;for(var r=0;r<this._views.length;r+=1)this._views[r].onUnlinkedResponse(t);0===this._status&&this.close()},t.prototype.hostDidConnect=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].hostDidConnect();var r,n=this._host.unresolve(this._nodeUri);this.keepSynced()?(r=Ws.of(n,this._laneUri,this._prio,this._rate,this._body),this.onSyncRequest(r)):(r=Ns.of(n,this._laneUri,this._prio,this._rate,this._body),this.onLinkRequest(r)),this._host.push(r)},t.prototype.hostDidDisconnect=function(t){this._status=0;for(var e=!1,r=0;r<this._views.length;r+=1){var n=this._views[r];n.hostDidDisconnect(),e=e||n.keepLinked()}e||this.close()},t.prototype.hostDidFail=function(t,e){for(var r=0;r<this._views.length;r+=1)this._views[r].hostDidFail(t)},t.prototype.command=function(t){t=ne.fromAny(t),this.onCommandMessage(t),this._host.command(this._nodeUri,this._laneUri,t)},t.prototype.unlink=function(){this._status=16,this._context.unlinkDownlink(this)},t.prototype.close=function(){this._context.closeDownlink(this)},t.prototype.openUp=function(t){this._host=t;for(var e=0;e<this._views.length;e+=1)this._views[e].openUp(t)},t.prototype.closeUp=function(){var t=this._views;this._views=[];for(var e=0;e<t.length;e+=1)t[e].closeUp()},t}();($s=t.DownlinkFlags||(t.DownlinkFlags={}))[$s.KeepLinked=1]="KeepLinked",$s[$s.KeepSynced=2]="KeepSynced",$s[$s.KeepLinkedSynced=3]="KeepLinkedSynced";var nu=function(){function t(t,e,r,n,i,o,s,u,a,p,h){var f;void 0===n&&(n=rs.empty()),void 0===i&&(i=rs.empty()),void 0===o&&(o=rs.empty()),void 0===s&&(s=0),void 0===u&&(u=0),void 0===a&&(a=ne.absent()),void 0===p&&(p=0),void 0===h&&(h=null),h?Array.isArray(h)||(h=[f=h]):h=[],r&&(f=f||{},h=h?h.concat(f):[f],n=void 0!==r.hostUri?rs.fromAny(r.hostUri):n,i=void 0!==r.nodeUri?rs.fromAny(r.nodeUri):i,o=void 0!==r.laneUri?rs.fromAny(r.laneUri):o,s=void 0!==r.prio?r.prio:s,u=void 0!==r.rate?r.rate:u,a=void 0!==r.body?ne.fromAny(r.body):a,f.onEvent=r.onEvent||f.onEvent,f.onCommand=r.onCommand||f.onCommand,f.willLink=r.willLink||f.willLink,f.didLink=r.didLink||f.didLink,f.willSync=r.willSync||f.willSync,f.didSync=r.didSync||f.didSync,f.willUnlink=r.willUnlink||f.willUnlink,f.didUnlink=r.didUnlink||f.didUnlink,f.didConnect=r.didConnect||f.didConnect,f.didDisconnect=r.didDisconnect||f.didDisconnect,f.didClose=r.didClose||f.didClose,f.didFail=r.didFail||f.didFail),this._context=t,this._owner=e,this._hostUri=n,this._nodeUri=i,this._laneUri=o,this._prio=s,this._rate=u,this._body=a,this._flags=p,this._model=null,this._observers=h}return t.prototype.hostUri=function(t){return void 0===t?this._hostUri:(t=rs.fromAny(t),this.copy(this._context,this._owner,t,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers))},t.prototype.nodeUri=function(t){return void 0===t?this._nodeUri:(t=rs.fromAny(t),this.copy(this._context,this._owner,this._hostUri,t,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers))},t.prototype.laneUri=function(t){return void 0===t?this._laneUri:(t=rs.fromAny(t),this.copy(this._context,this._owner,this._hostUri,this._nodeUri,t,this._prio,this._rate,this._body,this._flags,this._observers))},t.prototype.prio=function(t){return void 0===t?this._prio:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,t,this._rate,this._body,this._flags,this._observers)},t.prototype.rate=function(t){return void 0===t?this._rate:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,t,this._body,this._flags,this._observers)},t.prototype.body=function(t){return void 0===t?this._body:(t=ne.fromAny(t),this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,t,this._flags,this._observers))},t.prototype.keepLinked=function(t){if(void 0===t)return 0!=(1&this._flags);var e=t?1|this._flags:-2&this._flags;return this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,e,this._observers)},t.prototype.keepSynced=function(t){if(void 0===t)return 0!=(2&this._flags);var e=t?2|this._flags:-3&this._flags;return this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,e,this._observers)},t.prototype.observe=function(t){for(var e=this._observers,r=e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];return n[r]=t,this._observers=n,this},t.prototype.unobserve=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n],o=i===t;if(!o)for(var s in i)if(i[s]===t){o=!0;break}if(o){if(r>1){for(var u=new Array(r-1),a=0;a<n;a+=1)u[a]=e[a];for(a=n+1;a<r;a+=1)u[a-1]=e[a];this._observers=u}else this._observers=null;break}}return this},t.prototype.onEvent=function(t){return this.observe({onEvent:t})},t.prototype.onCommand=function(t){return this.observe({onCommand:t})},t.prototype.willLink=function(t){return this.observe({willLink:t})},t.prototype.didLink=function(t){return this.observe({didLink:t})},t.prototype.willSync=function(t){return this.observe({willSync:t})},t.prototype.didSync=function(t){return this.observe({didSync:t})},t.prototype.willUnlink=function(t){return this.observe({willUnlink:t})},t.prototype.didUnlink=function(t){return this.observe({didUnlink:t})},t.prototype.didConnect=function(t){return this.observe({didConnect:t})},t.prototype.didDisconnect=function(t){return this.observe({didDisconnect:t})},t.prototype.didClose=function(t){return this.observe({didClose:t})},t.prototype.didFail=function(t){return this.observe({didFail:t})},t.prototype.isConnected=function(){return!!this._model&&this._model.isConnected()},t.prototype.isAuthenticated=function(){return!!this._model&&this._model.isAuthenticated()},t.prototype.isLinked=function(){return!!this._model&&this._model.isLinked()},t.prototype.isSynced=function(){return!!this._model&&this._model.isSynced()},t.prototype.session=function(){return this._model?this._model.session():ne.absent()},t.prototype.onEventMessage=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.onEvent&&i.onEvent(t.body(),this)}},t.prototype.onCommandMessage=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.onCommand&&i.onCommand(t,this)}},t.prototype.onLinkRequest=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willLink&&i.willLink(this)}},t.prototype.onLinkedResponse=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didLink&&i.didLink(this)}},t.prototype.onSyncRequest=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willSync&&i.willSync(this)}},t.prototype.onSyncedResponse=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didSync&&i.didSync(this)}},t.prototype.onUnlinkRequest=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willUnlink&&i.willUnlink(this)}},t.prototype.onUnlinkedResponse=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didUnlink&&i.didUnlink(this)}},t.prototype.hostDidConnect=function(){for(var t=this._observers,e=t?t.length:0,r=0;r<e;r+=1){var n=t[r];n.didConnect&&n.didConnect(this)}},t.prototype.hostDidDisconnect=function(){for(var t=this._observers,e=t?t.length:0,r=0;r<e;r+=1){var n=t[r];n.didDisconnect&&n.didDisconnect(this)}},t.prototype.hostDidFail=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didFail&&i.didFail(t,this)}},t.prototype.command=function(t){this._model.command(t)},t.prototype.close=function(){this._owner&&this._owner.removeDownlink(this),this._model&&this._model.removeDownlink(this)},t.prototype.openUp=function(t){},t.prototype.closeUp=function(){for(var t=this._observers,e=t?t.length:0,r=0;r<e;r+=1){var n=t[r];n.didClose&&n.didClose(this)}},t.initForm=function(){return t._initForm||(t._initForm=new iu),t._initForm},t}(),iu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.tag=function(e){return 0===arguments.length?"link":void 0!==e?t.prototype.tag.call(this,e):this},e.prototype.mold=function(t){if(t){var e=oe.create();return void 0!==t.hostUri&&e.slot("host",rs.fromAny(t.hostUri).toString()),void 0!==t.nodeUri&&e.slot("node",rs.fromAny(t.nodeUri).toString()),void 0!==t.laneUri&&e.slot("lane",rs.fromAny(t.laneUri).toString()),void 0!==t.prio&&e.slot("prio",t.prio),void 0!==t.rate&&e.slot("rate",t.rate),void 0!==t.body&&e.slot("body",t.body),void 0!==t.type&&e.slot("type",t.type),oe.of(te.of("link",e))}return Xt.extant()},e.prototype.cast=function(t){var e=t.toValue().get("link");if(e.isDefined()){var r={},n=e.get("host");n.isDefined()&&(r.hostUri=n.cast(rs.form()));var i=e.get("node");i.isDefined()&&(r.nodeUri=i.cast(rs.form()));var o=e.get("lane");o.isDefined()&&(r.laneUri=o.cast(rs.form()));var s=e.get("prio");s.isDefined()&&(r.prio=s.numberValue());var u=e.get("rate");u.isDefined()&&(r.rate=u.numberValue());var a=e.get("body");a.isDefined()&&(r.body=a);var p=e.get("type");return p.isDefined()&&(r.type=p.stringValue()),r}},e}(be),ou=function(t){function e(e,r,n,i,o,s,u){return t.call(this,e,r,n,i,o,s,u)||this}return y(e,t),e.prototype.type=function(){return"event"},e}(ru),su=function(t){function e(e,r,n,i,o,s,u,a,p,h,f){return void 0===h&&(h=1),t.call(this,e,r,n,i,o,s,u,a,p,h,f)||this}return y(e,t),e.prototype.copy=function(t,r,n,i,o,s,u,a,p,h){return new e(t,r,void 0,n,i,o,s,u,a,p,h)},e.prototype.type=function(){return"event"},e.prototype.observe=function(e){return t.prototype.observe.call(this,e)},e.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var r=this._hostUri;r.isEmpty()&&(r=e.base(),e=r.unresolve(e));var n=this._context.getDownlink(r,e,t);if(n){if(!(n instanceof ou))throw new Error("downlink type mismatch");n.addDownlink(this)}else(n=new ou(this._context,r,e,t,this._prio,this._rate,this._body)).addDownlink(this),this._context.openDownlink(n);return this._model=n,this._owner&&this._owner.addDownlink(this),this},e}(nu),uu=function(t){function e(e,r,n,i,o,s,u,a){void 0===a&&(a=new Wt);var p=t.call(this,e,r,n,i,o,s,u)||this;return p._state=a,p}return y(e,t),e.prototype.type=function(){return"list"},e.prototype.isEmpty=function(){return this._state.isEmpty()},Object.defineProperty(e.prototype,"length",{get:function(){return this._state.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t,e){return this._state.get(t,e)||ne.absent()},e.prototype.getEntry=function(t,e){return this._state.getEntry(t,e)},e.prototype.set=function(t,e,r){if(void 0!==r&&(t=this._state.lookup(r,t))<0)throw new RangeError(""+r);if(t<0||t>=this._state.length)throw new RangeError(""+t);e=this.listWillUpdate(t,e);var n=this._state.getEntry(t);this._state.set(t,e),this.listDidUpdate(t,e,n[1]);var i=oe.create(2).slot("key",n[0]).slot("index",t);return this.command(te.of("update",i).concat(e)),this},e.prototype.insert=function(t,e,r){if(t<0||t>this._state.length)throw new RangeError(""+t);e=this.listWillInsert(t,e),this._state.insert(t,e,r);var n=this._state.getEntry(t);this.listDidInsert(t,e);var i=oe.create(2).slot("key",n[0]).slot("index",t);return this.command(te.of("insert",i).concat(e)),this},e.prototype.remove=function(t,e){if(void 0!==e&&(t=this._state.lookup(e,t))<0)throw new RangeError(""+e);if(t<0||t>this._state.length)throw new RangeError(""+t);this.listWillRemove(t);var r=this._state.getEntry(t);this._state.remove(t),this.listDidRemove(t,r[1]);var n=oe.create(2).slot("key",r[0]).slot("index",t);return this.command(oe.create(1).attr("remove",n)),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0;r<t.length;r+=1){var n=this._state.length+r,i=this.listWillInsert(n,t[r]);this._state.insert(n,i);var o=this._state.getEntry(n);this.listDidInsert(n,i);var s=oe.create(2).slot("key",o[0]).slot("index",n);this.command(te.of("insert",s).concat(i))}return this._state.length},e.prototype.pop=function(){var t=this._state.length-1;if(t>=0){this.listWillRemove(t);var e=this._state.getEntry(t);this._state.remove(t),this.listDidRemove(t,e[1]);var r=oe.create(2).slot("key",e[0]).slot("index",t);return this.command(oe.create(1).attr("remove",r)),e[1]}return ne.absent()},e.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t.length-1;r>=0;r-=1){var n=this.listWillInsert(0,t[r]);this._state.insert(0,n);var i=this._state.getEntry(0);this.listDidInsert(0,n);var o=oe.create(2).slot("key",i[0]).slot("index",0);this.command(te.of("insert",o).concat(n))}return this._state.length},e.prototype.shift=function(){if(this._state.length>0){this.listWillRemove(0);var t=this._state.getEntry(0);this._state.remove(0),this.listDidRemove(0,t[1]);var e=oe.create(2).slot("key",t[0]).slot("index",0);return this.command(oe.create(1).attr("remove",e)),t[1]}return ne.absent()},e.prototype.move=function(t,e,r){if(void 0!==r&&(t=this._state.lookup(r,t))<0)throw new RangeError(""+r);if(t<0||t>=this._state.length)throw new RangeError(""+t);if(e<0||e>=this._state.length)throw new RangeError(""+e);if(t!==e){var n=this._state.getEntry(t);this.listWillMove(t,e,n[1]),this._state.remove(t).insert(e,n[1],n[0]),this.listDidMove(t,e,n[1]);var i=oe.create(2).slot("key",n[0]).slot("from",t).slot("to",e);this.command(oe.create(1).attr("move",i))}return this},e.prototype.splice=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];t<0&&(t=this._state.length+t),t=Math.min(Math.max(0,t),this._state.length),void 0===e&&(e=this._state.length-t);for(var i=[],o=t,s=t+e;o<s;o+=1){this.listWillRemove(t);var u=this._state.getEntry(t);i.push(u[1]),this._state.remove(t),this.listDidRemove(t,u[1]);var a=oe.create(2).slot("key",u[0]).slot("index",t);this.command(oe.create(1).attr("remove",a))}for(o=0;o<r.length;o+=1){var p=t+o,h=this.listWillInsert(p,r[o]);this._state.insert(p,h);var f=this._state.getEntry(p);this.listDidInsert(p,h);a=oe.create(2).slot("key",f[0]).slot("index",p);this.command(te.of("insert",a).concat(h))}return i},e.prototype.clear=function(){this.listWillClear(),this._state.clear(),this.listDidClear(),this.command(oe.create(1).attr("clear"))},e.prototype.forEach=function(t,e){return this._state.forEach(function(r,n,i,o){return t.call(e,r,n,this,o)},this)},e.prototype.values=function(){return this._state.values()},e.prototype.keys=function(){return this._state.keys()},e.prototype.entries=function(){return this._state.entries()},e.prototype.snapshot=function(){return this._state.clone()},e.prototype.setState=function(t){this._state=t},e.prototype.onEventMessage=function(e,r){t.prototype.onEventMessage.call(this,e,r);var n=e.body(),i=n.tag();if("update"===i){var o=n.head().toValue();(s=this._state.lookup(o.get("key"),o.get("index").numberValue()))>=0?this.onUpdateEvent(s,n.body(),o.get("key")):this.onInsertEvent(o.get("index").numberValue(0),n.body(),o.get("key"))}else if("insert"===i){o=n.head().toValue();(s=this._state.lookup(o.get("key"),o.get("index").numberValue()))<0?this.onInsertEvent(o.get("index").numberValue(0),n.body(),o.get("key")):this.onUpdateEvent(s,n.body(),o.get("key"))}else if("move"===i){o=n.head().toValue();(s=this._state.lookup(o.get("key"),o.get("from").numberValue()))>=0&&this.onMoveEvent(s,o.get("to").numberValue(0),o.get("key"))}else if("remove"===i){var s;o=n.head().toValue();(s=this._state.lookup(o.get("key"),o.get("index").numberValue()))>=0&&this.onRemoveEvent(s,o.get("key"))}else if("drop"===i){o=n.head();this.onDropEvent(o.numberValue(0))}else if("take"===i){o=n.head();this.onTakeEvent(o.numberValue(0))}else"clear"===i&&this.onClearEvent()},e.prototype.onUpdateEvent=function(t,e,r){e=this.listWillUpdate(t,e);var n=this._state.get(t)||ne.absent();this._state.set(t,e),this.listDidUpdate(t,e,n)},e.prototype.onInsertEvent=function(t,e,r){e=this.listWillInsert(t,e),this._state.insert(t,e,r),this.listDidInsert(t,e)},e.prototype.onMoveEvent=function(t,e,r){if(t!==(e=Math.min(Math.max(0,e),this._state.length))){var n=this._state.get(t)||ne.absent();this.listWillMove(t,e,n),this._state.remove(t).insert(e,n,r),this.listDidMove(t,e,n)}},e.prototype.onRemoveEvent=function(t,e){this.listWillRemove(t);var r=this._state.get(t)||ne.absent();this._state.remove(t),this.listDidRemove(t,r)},e.prototype.onDropEvent=function(t){this.listWillDrop(t),this._state.drop(t),this.listDidDrop(t)},e.prototype.onTakeEvent=function(t){this.listWillTake(t),this._state.take(t),this.listDidTake(t)},e.prototype.onClearEvent=function(){this.listWillClear(),this._state.clear(),this.listDidClear()},e.prototype.listWillInsert=function(t,e){for(var r=0;r<this._views.length;r+=1)e=this._views[r].listWillInsert(t,e);return e},e.prototype.listDidInsert=function(t,e){for(var r=0;r<this._views.length;r+=1)this._views[r].listDidInsert(t,e)},e.prototype.listWillUpdate=function(t,e){for(var r=0;r<this._views.length;r+=1)e=this._views[r].listWillUpdate(t,e);return e},e.prototype.listDidUpdate=function(t,e,r){for(var n=0;n<this._views.length;n+=1)this._views[n].listDidUpdate(t,e,r)},e.prototype.listWillMove=function(t,e,r){for(var n=0;n<this._views.length;n+=1)this._views[n].listWillMove(t,e,r)},e.prototype.listDidMove=function(t,e,r){for(var n=0;n<this._views.length;n+=1)this._views[n].listDidMove(t,e,r)},e.prototype.listWillRemove=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillRemove(t)},e.prototype.listDidRemove=function(t,e){for(var r=0;r<this._views.length;r+=1)this._views[r].listDidRemove(t,e)},e.prototype.listWillDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillDrop(t)},e.prototype.listDidDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listDidDrop(t)},e.prototype.listWillTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillTake(t)},e.prototype.listDidTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listDidTake(t)},e.prototype.listWillClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].listWillClear()},e.prototype.listDidClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].listDidClear()},e}(ru),au=function(t){function e(e,r,n,i,o,s,u,a,p,h,f,c,l){void 0===h&&(h=3);var d=t.call(this,e,r,n,i,o,s,u,a,p,h,f)||this;if(n){var y=d._observers[d._observers.length-1];y.willInsert=n.willInsert||y.willInsert,y.didInsert=n.didInsert||y.didInsert,y.willUpdate=n.willUpdate||y.willUpdate,y.didUpdate=n.didUpdate||y.didUpdate,y.willMove=n.willMove||y.willMove,y.didMove=n.didMove||y.didMove,y.willRemove=n.willRemove||y.willRemove,y.didRemove=n.didRemove||y.didRemove,y.willDrop=n.willDrop||y.willDrop,y.didDrop=n.didDrop||y.didDrop,y.willTake=n.willTake||y.willTake,y.didTake=n.didTake||y.didTake,y.willClear=n.willClear||y.willClear,y.didClear=n.didClear||y.didClear,c=n.valueForm?n.valueForm:c}return d._valueForm=c||be.forValue(),d._state0=l,d}return y(e,t),e.prototype.copy=function(t,r,n,i,o,s,u,a,p,h,f,c){return 10===arguments.length&&(f=this._valueForm,c=this._state0),new e(t,r,void 0,n,i,o,s,u,a,p,h,f,c)},e.prototype.type=function(){return"list"},e.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,t,this._state0)},e.prototype.isEmpty=function(){return this._model.isEmpty()},Object.defineProperty(e.prototype,"length",{get:function(){return this._model.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t,e){return this._model.get(t,e).coerce(this._valueForm)},e.prototype.getEntry=function(t,e){var r=this._model.getEntry(t,e);if(r)return[r[0].coerce(this._valueForm),r[1]]},e.prototype.set=function(t,e,r){var n=this._valueForm.mold(e);return this._model.set(t,n,r),this},e.prototype.insert=function(t,e,r){var n=this._valueForm.mold(e);return this._model.insert(t,n,r),this},e.prototype.remove=function(t,e){return this._model.remove(t,e),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=new Array(t.length),n=0;n<t.length;n+=1)r[n]=this._valueForm.mold(t[n]);return this._model.push.apply(this._model,r)},e.prototype.pop=function(){return this._model.pop().coerce(this._valueForm)},e.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=new Array(t.length),n=0;n<t.length;n+=1)r[n]=this._valueForm.mold(t[n]);return this._model.unshift.apply(this._model,r)},e.prototype.shift=function(){return this._model.shift().coerce(this._valueForm)},e.prototype.move=function(t,e,r){return this._model.move(t,e,r),this},e.prototype.splice=function(t,e){for(var r,n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var o=new Array(n.length),s=0;s<n.length;s+=1)o[s]=this._valueForm.mold(n[s]);var u=(r=this._model).splice.apply(r,[t,e].concat(o)),a=new Array(u.length);for(s=0;s<u.length;s+=1)a[s]=u[s].coerce(this._valueForm);return a},e.prototype.clear=function(){this._model.clear()},e.prototype.forEach=function(t,e){return this._valueForm===be.forValue()?this._model._state.forEach(t,e):this._model._state.forEach(function(r,n,i,o){var s=r.coerce(this._valueForm);return t.call(e,s,n,this,o)},this)},e.prototype.values=function(){var t=this._model.values();return this._valueForm===be.forValue()?t:new Er(t,this._valueForm)},e.prototype.keys=function(){return this._model.keys()},e.prototype.entries=function(){var t=this._model.entries();return this._valueForm===be.forValue()?t:new kr(t,be.forValue(),this._valueForm)},e.prototype.snapshot=function(){return this._model.snapshot()},e.prototype.setState=function(t){this._model.setState(t)},e.prototype.observe=function(e){return t.prototype.observe.call(this,e)},e.prototype.willInsert=function(t){return this.observe({willInsert:t})},e.prototype.didInsert=function(t){return this.observe({didInsert:t})},e.prototype.willUpdate=function(t){return this.observe({willUpdate:t})},e.prototype.didUpdate=function(t){return this.observe({didUpdate:t})},e.prototype.willMove=function(t){return this.observe({willMove:t})},e.prototype.didMove=function(t){return this.observe({didMove:t})},e.prototype.willRemove=function(t){return this.observe({willRemove:t})},e.prototype.didRemove=function(t){return this.observe({didRemove:t})},e.prototype.willDrop=function(t){return this.observe({willDrop:t})},e.prototype.didDrop=function(t){return this.observe({didDrop:t})},e.prototype.willTake=function(t){return this.observe({willTake:t})},e.prototype.didTake=function(t){return this.observe({didTake:t})},e.prototype.willClear=function(t){return this.observe({willClear:t})},e.prototype.didClear=function(t){return this.observe({didClear:t})},e.prototype.listWillInsert=function(t,e){for(var r,n=this._observers,i=n?n.length:0,o=0;o<i;o+=1){var s=n[o];if(s.willInsert){void 0===r&&(r=e.coerce(this._valueForm));var u=s.willInsert(t,r,this);void 0!==u&&(r=u,e=this._valueForm.mold(r))}}return e},e.prototype.listDidInsert=function(t,e){for(var r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];if(o.didInsert){var s=e.coerce(this._valueForm);o.didInsert(t,s,this)}}},e.prototype.listWillUpdate=function(t,e){for(var r,n=this._observers,i=n?n.length:0,o=0;o<i;o+=1){var s=n[o];if(s.willUpdate){void 0===r&&(r=e.coerce(this._valueForm));var u=s.willUpdate(t,r,this);void 0!==u&&(r=u,e=this._valueForm.mold(r))}}return e},e.prototype.listDidUpdate=function(t,e,r){for(var n,i,o=this._observers,s=o?o.length:0,u=0;u<s;u+=1){var a=o[u];a.didUpdate&&(void 0===n&&(n=e.coerce(this._valueForm)),void 0===i&&(i=r.coerce(this._valueForm)),a.didUpdate(t,n,i,this))}},e.prototype.listWillMove=function(t,e,r){for(var n,i=this._observers,o=i?i.length:0,s=0;s<o;s+=1){var u=i[s];u.willMove&&(void 0===n&&(n=r.coerce(this._valueForm)),u.willMove(t,e,n,this))}},e.prototype.listDidMove=function(t,e,r){for(var n,i=this._observers,o=i?i.length:0,s=0;s<o;s+=1){var u=i[s];u.didMove&&(void 0===n&&(n=r.coerce(this._valueForm)),u.didMove(t,e,n,this))}},e.prototype.listWillRemove=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willRemove&&i.willRemove(t,this)}},e.prototype.listDidRemove=function(t,e){for(var r,n=this._observers,i=n?n.length:0,o=0;o<i;o+=1){var s=n[o];s.didRemove&&(void 0===r&&(r=e.coerce(this._valueForm)),s.didRemove(t,r,this))}},e.prototype.listWillDrop=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willDrop&&i.willDrop(t,this)}},e.prototype.listDidDrop=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didDrop&&i.didDrop(t,this)}},e.prototype.listWillTake=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willTake&&i.willTake(t,this)}},e.prototype.listDidTake=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didTake&&i.didTake(t,this)}},e.prototype.listWillClear=function(){for(var t=this._observers,e=t?t.length:0,r=0;r<e;r+=1){var n=t[r];n.willClear&&n.willClear(this)}},e.prototype.listDidClear=function(){for(var t=this._observers,e=t?t.length:0,r=0;r<e;r+=1){var n=t[r];n.didClear&&n.didClear(this)}},e.prototype.initialState=function(t){return void 0===t?this._state0||null:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._valueForm,t||void 0)},e.prototype.didAliasModel=function(){this.onLinkedResponse(),this._model._state.forEach(function(t,e){this.listDidInsert(e,t)},this),this.onSyncedResponse()},e.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var r=this._hostUri;r.isEmpty()&&(r=e.base(),e=r.unresolve(e));var n=this._context.getDownlink(r,e,t);if(n){if(!(n instanceof uu))throw new Error("downlink type mismatch");n.addDownlink(this),this._model=n,this.didAliasModel()}else(n=new uu(this._context,r,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(n),this._model=n;return this._owner&&this._owner.addDownlink(this),this},e}(nu),pu=function(t){function e(e,r,n,i,o,s,u,a){void 0===a&&(a=new zt);var p=t.call(this,e,r,n,i,o,s,u)||this;return p._state=a,p}return y(e,t),e.prototype.type=function(){return"map"},Object.defineProperty(e.prototype,"size",{get:function(){return this._state.size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this._state.isEmpty()},e.prototype.has=function(t){return this._state.has(t)},e.prototype.get=function(t){return this._state.get(t)||ne.absent()},e.prototype.getEntry=function(t){return this._state.getEntry(t)},e.prototype.set=function(t,e){e=this.mapWillUpdate(t,e);var r=this._state.get(t)||ne.absent();this._state.set(t,e),this.mapDidUpdate(t,e,r);var n=oe.create(1).slot("key",t);return this.command(te.of("update",n).concat(e)),this},e.prototype.delete=function(t){if(this._state.has(t)){this.mapWillRemove(t);var e=this._state.get(t)||ne.absent();this._state.delete(t),this.mapDidRemove(t,e);var r=oe.create(1).slot("key",t);return this.command(oe.create(1).attr("remove",r)),!0}return!1},e.prototype.drop=function(t){return this.mapWillDrop(t),this._state.drop(t),this.mapDidDrop(t),this.command(oe.create(1).attr("drop",t)),this},e.prototype.take=function(t){return this.mapWillTake(t),this._state.take(t),this.mapDidTake(t),this.command(oe.create(1).attr("take",t)),this},e.prototype.clear=function(){this.mapWillClear(),this._state.clear(),this.mapDidClear(),this.command(oe.create(1).attr("clear"))},e.prototype.forEach=function(t,e){return this._state.forEach(function(r,n){return t.call(e,r,n,this)},this)},e.prototype.keys=function(){return this._state.keys()},e.prototype.values=function(){return this._state.values()},e.prototype.entries=function(){return this._state.entries()},e.prototype.snapshot=function(){return this._state.clone()},e.prototype.setState=function(t){this._state=t},e.prototype.onEventMessage=function(e,r){t.prototype.onEventMessage.call(this,e,r);var n=e.body(),i=n.tag();if("update"===i){var o=n.head().toValue();this.onUpdateEvent(o.get("key"),n.body())}else if("remove"===i){o=n.head().toValue();this.onRemoveEvent(o.get("key"))}else if("drop"===i){o=n.head().toValue();this.onDropEvent(o.numberValue(0))}else if("take"===i){o=n.head().toValue();this.onTakeEvent(o.numberValue(0))}else"clear"===i&&this.onClearEvent()},e.prototype.onUpdateEvent=function(t,e){e=this.mapWillUpdate(t,e);var r=this._state.get(t)||ne.absent();this._state.set(t,e),this.mapDidUpdate(t,e,r)},e.prototype.onRemoveEvent=function(t){this.mapWillRemove(t);var e=this._state.get(t)||ne.absent();this._state.delete(t),this.mapDidRemove(t,e)},e.prototype.onDropEvent=function(t){this.mapWillDrop(t),this._state.drop(t),this.mapDidDrop(t)},e.prototype.onTakeEvent=function(t){this.mapWillTake(t),this._state.take(t),this.mapDidTake(t)},e.prototype.onClearEvent=function(){this.mapWillClear(),this._state.clear(),this.mapDidClear()},e.prototype.mapWillUpdate=function(t,e){for(var r=0;r<this._views.length;r+=1)e=this._views[r].mapWillUpdate(t,e);return e},e.prototype.mapDidUpdate=function(t,e,r){for(var n=0;n<this._views.length;n+=1)this._views[n].mapDidUpdate(t,e,r)},e.prototype.mapWillRemove=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillRemove(t)},e.prototype.mapDidRemove=function(t,e){for(var r=0;r<this._views.length;r+=1)this._views[r].mapDidRemove(t,e)},e.prototype.mapWillDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillDrop(t)},e.prototype.mapDidDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapDidDrop(t)},e.prototype.mapWillTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillTake(t)},e.prototype.mapDidTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapDidTake(t)},e.prototype.mapWillClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].mapWillClear()},e.prototype.mapDidClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].mapDidClear()},e}(ru),hu=function(t){function e(e,r,n,i,o,s,u,a,p,h,f,c,l,d){void 0===h&&(h=3);var y=t.call(this,e,r,n,i,o,s,u,a,p,h,f)||this;if(n){var _=y._observers[y._observers.length-1];_.willUpdate=n.willUpdate||_.willUpdate,_.didUpdate=n.didUpdate||_.didUpdate,_.willRemove=n.willRemove||_.willRemove,_.didRemove=n.didRemove||_.didRemove,_.willDrop=n.willDrop||_.willDrop,_.didDrop=n.didDrop||_.didDrop,_.willTake=n.willTake||_.willTake,_.didTake=n.didTake||_.didTake,_.willClear=n.willClear||_.willClear,_.didClear=n.didClear||_.didClear,c=n.keyForm?n.keyForm:c,l=n.valueForm?n.valueForm:l}return y._keyForm=c||be.forValue(),y._valueForm=l||be.forValue(),y._state0=d,y._input=null,y._effects=new zt,y._outlets=new zt,y._outputs=null,y._version=-1,y}return y(e,t),e.prototype.copy=function(t,r,n,i,o,s,u,a,p,h,f,c,l){return 10===arguments.length&&(l=this._state0,f=this._keyForm,c=this._valueForm),new e(t,r,void 0,n,i,o,s,u,a,p,h,f,c,l)},e.prototype.type=function(){return"map"},e.prototype.keyForm=function(t){return void 0===t?this._keyForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,t,this._valueForm,this._state0)},e.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._keyForm,t,this._state0)},Object.defineProperty(e.prototype,"size",{get:function(){return this._model.size},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this._model.isEmpty()},e.prototype.has=function(t){var e=this._keyForm.mold(t);return this._model.has(e)},e.prototype.get=function(t){if(void 0===t)return this;var e=this._keyForm.mold(t);return this._model.get(e).coerce(this._valueForm)},e.prototype.getEntry=function(t){var e=this._model.getEntry(t);if(e)return[e[0].coerce(this._keyForm),e[1].coerce(this._valueForm)]},e.prototype.firstKey=function(){var t=this._model._state.firstKey();if(void 0!==t){var e=this._keyForm.cast(t);if(void 0!==e)return e}return this._keyForm.unit()},e.prototype.firstValue=function(){var t=this._model._state.firstValue();if(void 0!==t){var e=this._valueForm.cast(t);if(void 0!==e)return e}return this._valueForm.unit()},e.prototype.firstEntry=function(){var t=this._model._state.firstEntry();if(void 0!==t)return[this._keyForm.cast(t[0]),this._valueForm.cast(t[1])]},e.prototype.lastKey=function(){var t=this._model._state.lastKey();if(void 0!==t){var e=this._keyForm.cast(t);if(void 0!==e)return e}return this._keyForm.unit()},e.prototype.lastValue=function(){var t=this._model._state.lastValue();if(void 0!==t){var e=this._valueForm.cast(t);if(void 0!==e)return e}return this._valueForm.unit()},e.prototype.lastEntry=function(){var t=this._model._state.lastEntry();if(void 0!==t)return[this._keyForm.cast(t[0]),this._valueForm.cast(t[1])]},e.prototype.nextKey=function(t){var e=this._keyForm.mold(t),r=this._model._state.nextKey(e);if(void 0!==r){var n=this._keyForm.cast(r);if(void 0!==n)return n}return this._keyForm.unit()},e.prototype.nextValue=function(t){var e=this._keyForm.mold(t),r=this._model._state.nextValue(e);if(void 0!==r){var n=this._valueForm.cast(r);if(void 0!==n)return n}return this._valueForm.unit()},e.prototype.nextEntry=function(t){var e=this._keyForm.mold(t),r=this._model._state.nextEntry(e);if(void 0!==r)return[this._keyForm.cast(r[0]),this._valueForm.cast(r[1])]},e.prototype.previousKey=function(t){var e=this._keyForm.mold(t),r=this._model._state.previousKey(e);if(void 0!==r){var n=this._keyForm.cast(r);if(void 0!==n)return n}return this._keyForm.unit()},e.prototype.previousValue=function(t){var e=this._keyForm.mold(t),r=this._model._state.previousValue(e);if(void 0!==r){var n=this._valueForm.cast(r);if(void 0!==n)return n}return this._valueForm.unit()},e.prototype.previousEntry=function(t){var e=this._keyForm.mold(t),r=this._model._state.previousEntry(e);if(void 0!==r)return[this._keyForm.cast(r[0]),this._valueForm.cast(r[1])]},e.prototype.set=function(t,e){var r=this._keyForm.mold(t),n=this._valueForm.mold(e);return this._model.set(r,n),this},e.prototype.delete=function(t){var e=this._keyForm.mold(t);return this._model.delete(e)},e.prototype.drop=function(t){return this._model.drop(t),this},e.prototype.take=function(t){return this._model.take(t),this},e.prototype.clear=function(){this._model.clear()},e.prototype.forEach=function(t,e){return this._keyForm===be.forValue()&&this._valueForm===be.forValue()?this._model._state.forEach(t,e):this._model._state.forEach(function(r,n){var i=r.coerce(this._keyForm),o=n.coerce(this._valueForm);return t.call(e,i,o,this)},this)},e.prototype.keys=function(){var t=this._model.keys();return this._keyForm===be.forValue()?t:new Er(t,this._keyForm)},e.prototype.values=function(){var t=this._model.values();return this._valueForm===be.forValue()?t:new Er(t,this._valueForm)},e.prototype.entries=function(){var t=this._model.entries();return this._keyForm===be.forValue()&&this._valueForm===be.forValue()?t:new kr(t,this._keyForm,this._valueForm)},e.prototype.snapshot=function(){return this._model.snapshot()},e.prototype.setState=function(t){this._model.setState(t)},e.prototype.observe=function(e){return t.prototype.observe.call(this,e)},e.prototype.willUpdate=function(t){return this.observe({willUpdate:t})},e.prototype.didUpdate=function(t){return this.observe({didUpdate:t})},e.prototype.willRemove=function(t){return this.observe({willRemove:t})},e.prototype.didRemove=function(t){return this.observe({didRemove:t})},e.prototype.willDrop=function(t){return this.observe({willDrop:t})},e.prototype.didDrop=function(t){return this.observe({didDrop:t})},e.prototype.willTake=function(t){return this.observe({willTake:t})},e.prototype.didTake=function(t){return this.observe({didTake:t})},e.prototype.willClear=function(t){return this.observe({willClear:t})},e.prototype.didClear=function(t){return this.observe({didClear:t})},e.prototype.mapWillUpdate=function(t,e){for(var r,n,i=this._observers,o=i?i.length:0,s=0;s<o;s+=1){var u=i[s];if(u.willUpdate){void 0===r&&(r=t.coerce(this._keyForm)),void 0===n&&(n=e.coerce(this._valueForm));var a=u.willUpdate(r,n,this);void 0!==a&&(n=a,e=this._valueForm.mold(n))}}return e},e.prototype.mapDidUpdate=function(t,e,r){for(var n,i,o=this._observers,s=o?o.length:0,u=t.coerce(this._keyForm),a=0;a<s;a+=1){var p=o[a];p.didUpdate&&(void 0===n&&(n=e.coerce(this._valueForm)),void 0===i&&(i=r.coerce(this._valueForm)),p.didUpdate(u,n,i,this))}this.invalidateInputKey(u,0),this.reconcileInput(0)},e.prototype.mapWillRemove=function(t){for(var e,r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];o.willRemove&&(void 0===e&&(e=t.coerce(this._keyForm)),o.willRemove(e,this))}},e.prototype.mapDidRemove=function(t,e){for(var r,n=this._observers,i=n?n.length:0,o=t.coerce(this._keyForm),s=0;s<i;s+=1){var u=n[s];u.didRemove&&(void 0===r&&(r=e.coerce(this._valueForm)),u.didRemove(o,r,this))}this.invalidateInputKey(o,1),this.reconcileInput(0)},e.prototype.mapWillDrop=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willDrop&&i.willDrop(t,this)}},e.prototype.mapDidDrop=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didDrop&&i.didDrop(t,this)}},e.prototype.mapWillTake=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.willTake&&i.willTake(t,this)}},e.prototype.mapDidTake=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didTake&&i.didTake(t,this)}},e.prototype.mapWillClear=function(){for(var t=this._observers,e=t?t.length:0,r=0;r<e;r+=1){var n=t[r];n.willClear&&n.willClear(this)}},e.prototype.mapDidClear=function(){for(var t=this._observers,e=t?t.length:0,r=0;r<e;r+=1){var n=t[r];n.didClear&&n.didClear(this)}},e.prototype.initialState=function(t){return void 0===t?this._state0||null:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._keyForm,this._valueForm,t||void 0)},e.prototype.didAliasModel=function(){this.onLinkedResponse(),this._model._state.forEach(function(t,e){this.mapDidUpdate(t,e,ne.absent())},this),this.onSyncedResponse()},e.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var r=this._hostUri;r.isEmpty()&&(r=e.base(),e=r.unresolve(e));var n=this._context.getDownlink(r,e,t);if(n){if(!(n instanceof pu))throw new Error("downlink type mismatch");n.addDownlink(this),this._model=n,this.didAliasModel()}else(n=new pu(this._context,r,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(n),this._model=n;return this._owner&&this._owner.addDownlink(this),this},e.prototype.keyIterator=function(){return this.keys()},e.prototype.input=function(){return this._input},e.prototype.bindInput=function(t){if(!Ir.is(t))throw new TypeError(""+t);null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},e.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},e.prototype.disconnectInputs=function(){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())},e.prototype.outlet=function(t){var e=this._outlets.get(t);return void 0===e&&(e=new Ur(this,t),this._outlets=this._outlets.updated(t,e)),e},e.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},e.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},e.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},e.prototype.unbindOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1)t[e].unbindInput()}},e.prototype.disconnectOutputs=function(){var t=this._outlets;t.isEmpty()&&(this._outlets=new zt,t.forEach(function(t,e){e.disconnectOutputs()},this));var e=this._outputs;if(null!==e){this._outputs=null;for(var r=0,n=e.length;r<n;r+=1){var i=e[r];i.unbindInput(),i.disconnectOutputs()}}},e.prototype.invalidateOutputKey=function(t,e){this.invalidateKey(t,e)},e.prototype.invalidateInputKey=function(t,e){this.invalidateKey(t,e)},e.prototype.invalidateKey=function(t,e){var r=this._effects;if(r.get(t)!==e){this.willInvalidateKey(t,e),this._effects=r.updated(t,e),this._version=-1,this.onInvalidateKey(t,e);for(var n=null!==this._outputs?this._outputs.length:0,i=0;i<n;i+=1){var o=this._outputs[i];Ar.is(o)?o.invalidateOutputKey(t,e):o.invalidateOutput()}var s=this._outlets.get(t);void 0!==s&&s.invalidateInput(),this.didInvalidateKey(t,e)}},e.prototype.invalidateOutput=function(){this.invalidate()},e.prototype.invalidateInput=function(){this.invalidate()},e.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this._outlets.forEach(function(t,e){e.invalidateInput()},this),this.didInvalidate()}},e.prototype.reconcileOutputKey=function(t,e){this.reconcileKey(t,e)},e.prototype.reconcileInputKey=function(t,e){this.reconcileKey(t,e)},e.prototype.reconcileKey=function(t,e){if(this._version<0){var r=this._effects,n=r.get(t);if(void 0!==n){this.willReconcileKey(t,n,e),this._effects=r.removed(t),null!==this._input&&this._input.reconcileInputKey(t,e),this.onReconcileKey(t,n,e);for(var i=0,o=null!==this._outputs?this._outputs.length:0;i<o;i+=1){var s=this._outputs[i];Ar.is(s)&&s.reconcileOutputKey(t,e)}var u=this._outlets.get(t);void 0!==u&&u.reconcileInput(e),this.didReconcileKey(t,n,e)}}},e.prototype.reconcileOutput=function(t){this.reconcile(t)},e.prototype.reconcileInput=function(t){this.reconcile(t)},e.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._effects.forEach(function(e){this.reconcileKey(e,t)},this),this._version=t,this.onReconcile(t);for(var e=0,r=null!==this._outputs?this._outputs.length:0;e<r;e+=1)this._outputs[e].reconcileOutput(t);this.didReconcile(t)}},e.prototype.willInvalidateKey=function(t,e){},e.prototype.onInvalidateKey=function(t,e){},e.prototype.didInvalidateKey=function(t,e){},e.prototype.willInvalidate=function(){},e.prototype.onInvalidate=function(){},e.prototype.didInvalidate=function(){},e.prototype.willReconcileKey=function(t,e,r){},e.prototype.onReconcileKey=function(t,e,r){if(0===e){if(null!==this._input){var n=this._input.get(t);void 0!==n?this.set(t,n):this.delete(t)}}else 1===e&&this.delete(t)},e.prototype.didReconcileKey=function(t,e,r){},e.prototype.willReconcile=function(t){},e.prototype.onReconcile=function(t){},e.prototype.didReconcile=function(t){},e.prototype.memoize=function(){return this},e.prototype.filter=function(t){var e=new Zr(t);return e.bindInput(this),e},e.prototype.map=function(t){var e;return 1===t.length?((e=new $r(t)).bindInput(this),e):((e=new tn(t)).bindInput(this),e)},e.prototype.reduce=function(t,e,r){var n=new rn(t,e,r);return n.bindInput(this),n},e.prototype.watch=function(t){return 1===t.length?(new on(t).bindInput(this),this):(new un(t).bindInput(this),this)},e}(nu),fu=function(t){function e(e,r,n,i,o,s,u,a){void 0===a&&(a=ne.absent());var p=t.call(this,e,r,n,i,o,s,u)||this;return p._state=a,p}return y(e,t),e.prototype.type=function(){return"value"},e.prototype.get=function(){return this._state},e.prototype.set=function(t){t=this.valueWillSet(t);var e=this._state;this.setState(t),this.valueDidSet(t,e),this.command(t)},e.prototype.setState=function(t){this._state=t},e.prototype.onEventMessage=function(e,r){t.prototype.onEventMessage.call(this,e,r),this.onSetEvent(e.body())},e.prototype.onSetEvent=function(t){t=this.valueWillSet(t);var e=this._state;this.setState(t),this.valueDidSet(t,e)},e.prototype.valueWillSet=function(t){for(var e=0;e<this._views.length;e+=1)t=this._views[e].valueWillSet(t);return t},e.prototype.valueDidSet=function(t,e){for(var r=0;r<this._views.length;r+=1)this._views[r].valueDidSet(t,e)},e}(ru),cu=function(t){function e(e,r,n,i,o,s,u,a,p,h,f,c,l){void 0===h&&(h=3),void 0===l&&(l=ne.absent());var d=t.call(this,e,r,n,i,o,s,u,a,p,h,f)||this;if(n){var y=d._observers[d._observers.length-1];y.willSet=n.willSet||y.willSet,y.didSet=n.didSet||y.didSet,c=n.valueForm?n.valueForm:c}return d._valueForm=c||be.forValue(),d._state0=l,d._input=null,d._outputs=null,d._version=-1,d}return y(e,t),e.prototype.copy=function(t,r,n,i,o,s,u,a,p,h,f,c){return 10===arguments.length&&(c=this._state0,f=this._valueForm),new e(t,r,void 0,n,i,o,s,u,a,p,h,f,c)},e.prototype.type=function(){return"value"},e.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,t,this._state0)},e.prototype.get=function(){return this._model.get().coerce(this._valueForm)},e.prototype.set=function(t){var e=this._valueForm.mold(t);this._model.set(e)},e.prototype.setState=function(t){this._model.setState(t)},e.prototype.observe=function(e){return t.prototype.observe.call(this,e)},e.prototype.willSet=function(t){return this.observe({willSet:t})},e.prototype.didSet=function(t){return this.observe({didSet:t})},e.prototype.valueWillSet=function(t){for(var e,r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];if(o.willSet){void 0===e&&(e=t.coerce(this._valueForm));var s=o.willSet(e,this);void 0!==s&&(e=s,t=this._valueForm.mold(e))}}return t},e.prototype.valueDidSet=function(t,e){for(var r,n,i=this._observers,o=i?i.length:0,s=0;s<o;s+=1){var u=i[s];u.didSet&&(void 0===r&&(r=t.coerce(this._valueForm)),void 0===n&&(n=e.coerce(this._valueForm)),u.didSet(r,n,this))}this.invalidate(),this.reconcile(0)},e.prototype.initialState=function(t){return void 0===t?this._state0:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this._observers,this._valueForm,t)},e.prototype.didAliasModel=function(){this.onLinkedResponse(),this.valueDidSet(this._model.get(),ne.absent()),this.onSyncedResponse()},e.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var r=this._hostUri;r.isEmpty()&&(r=e.base(),e=r.unresolve(e));var n=this._context.getDownlink(r,e,t);if(n){if(!(n instanceof fu))throw new Error("downlink type mismatch");n.addDownlink(this),this._model=n,this.didAliasModel()}else(n=new fu(this._context,r,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(n),this._model=n;return this._owner&&this._owner.addDownlink(this),this},e.prototype.input=function(){return this._input},e.prototype.bindInput=function(t){null!==this._input&&this._input.unbindOutput(this),this._input=t,null!==this._input&&this._input.bindOutput(this)},e.prototype.unbindInput=function(){null!==this._input&&this._input.unbindOutput(this),this._input=null},e.prototype.disconnectInputs=function(){var t=this._input;null!==t&&(t.unbindOutput(this),this._input=null,t.disconnectInputs())},e.prototype.outputIterator=function(){return null!==this._outputs?l.array(this._outputs):l.empty()},e.prototype.bindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];n[r]=t,this._outputs=n},e.prototype.unbindOutput=function(t){for(var e=this._outputs,r=null!==e?e.length:0,n=0;n<r;n+=1)if(e[n]===t){if(r>1){for(var i=new Array(r-1),o=0;o<n;o+=1)i[o]=e[o];for(o=n;o<r-1;o+=1)i[o]=e[o+1];this._outputs=i}else this._outputs=null;break}},e.prototype.unbindOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1)t[e].unbindInput()}},e.prototype.disconnectOutputs=function(){var t=this._outputs;if(null!==t){this._outputs=null;for(var e=0,r=t.length;e<r;e+=1){var n=t[e];n.unbindInput(),n.disconnectOutputs()}}},e.prototype.invalidateOutput=function(){this.invalidate()},e.prototype.invalidateInput=function(){this.invalidate()},e.prototype.invalidate=function(){if(this._version>=0){this.willInvalidate(),this._version=-1,this.onInvalidate();for(var t=null!==this._outputs?this._outputs.length:0,e=0;e<t;e+=1)this._outputs[e].invalidateOutput();this.didInvalidate()}},e.prototype.reconcileOutput=function(t){this.reconcile(t)},e.prototype.reconcileInput=function(t){this.reconcile(t)},e.prototype.reconcile=function(t){if(this._version<0){this.willReconcile(t),this._version=t,null!==this._input&&this._input.reconcileInput(t),this.onReconcile(t);for(var e=null!==this._outputs?this._outputs.length:0,r=0;r<e;r+=1)this._outputs[r].reconcileOutput(t);this.didReconcile(t)}},e.prototype.willInvalidate=function(){},e.prototype.onInvalidate=function(){},e.prototype.didInvalidate=function(){},e.prototype.willReconcile=function(t){},e.prototype.onReconcile=function(t){if(null!==this._input){var e=this._input.get();void 0!==e&&this.set(e)}},e.prototype.didReconcile=function(t){},e.prototype.memoize=function(){return this},e.prototype.map=function(t){var e=new $r(t);return e.bindInput(this),e},e.prototype.watch=function(t){return new on(t).bindInput(this),this},e}(nu),lu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e}(mn),du=function(t){function e(e){var r=t.call(this)||this;return r._downlink=e,r}return y(e,t),Object.defineProperty(e.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this._downlink.isEmpty()},e.prototype.isArray=function(){return!0},e.prototype.isObject=function(){return this._downlink.isEmpty()},Object.defineProperty(e.prototype,"length",{get:function(){return this._downlink.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._downlink.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return!1},e.prototype.get=function(t){return void 0===t?this:ne.absent()},e.prototype.getAttr=function(t){return ne.absent()},e.prototype.getSlot=function(t){return ne.absent()},e.prototype.getItem=function(t){t instanceof ce&&(t=t.value);var e=this._downlink.length;return t<0&&(t=e+t),(t=Math.min(Math.max(0,t),e-1))>=0?this._downlink.get(t):Xt.absent()},e.prototype.set=function(t,e){throw new Error("unsupported")},e.prototype.setAttr=function(t,e){throw new Error("unsupported")},e.prototype.setSlot=function(t,e){throw new Error("unsupported")},e.prototype.setItem=function(t,e){t instanceof ce&&(t=t.value);var r=this._downlink.length;return t<0&&(t=r+t),(t=Math.min(Math.max(0,t),r-1))>=0&&this._downlink.set(t,ne.fromAny(e)),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._downlink.push.apply(this._downlink,arguments)},e.prototype.splice=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return this._downlink.splice.apply(this._downlink,arguments)},e.prototype.delete=function(t){return Xt.absent()},e.prototype.clear=function(){this._downlink.clear()},e.prototype.forEach=function(t,e){return this._downlink.forEach(function(r,n){return t.call(e,r,n)})},e.prototype.keyIterator=function(){return l.empty()},e}(lu),yu=function(t){function e(e){var r=t.call(this)||this;return r._downlink=e,r._downlink.observe(r),r}return y(e,t),Object.defineProperty(e.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return this._downlink.isEmpty()},e.prototype.isArray=function(){return this._downlink.isEmpty()},e.prototype.isObject=function(){return!0},Object.defineProperty(e.prototype,"length",{get:function(){return this._downlink.size},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._downlink.has(t)},e.prototype.get=function(t){return void 0===t?this:this._downlink.get(t)},e.prototype.getAttr=function(t){return ne.absent()},e.prototype.getSlot=function(t){return this.get(t)},e.prototype.getItem=function(t){t instanceof ce&&(t=t.value);var e=this._downlink.size;if(t<0&&(t=e+t),(t=Math.min(Math.max(0,t),e-1))>=0){var r=this._downlink.getEntry(t);return ee.of(r[0],r[1])}return Xt.absent()},e.prototype.set=function(t,e){return this._downlink.set(t,e),this},e.prototype.setAttr=function(t,e){throw new Error("unsupported")},e.prototype.setSlot=function(t,e){return this.set(t,e)},e.prototype.setItem=function(t,e){throw new Error("unsupported")},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];throw new Error("unsupported")},e.prototype.splice=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];throw new Error("unsupported")},e.prototype.delete=function(t){t=ne.fromAny(t);var e=this._downlink.get(t);return this._downlink.delete(t)?ee.of(t,e):Xt.absent()},e.prototype.clear=function(){this._downlink.clear()},e.prototype.forEach=function(t,e){var r=0;return this._downlink.forEach(function(n,i){var o=t.call(e,ee.of(n,i),r);return r+=1,o})},e.prototype.keyIterator=function(){return this._downlink.keys()},e.prototype.didUpdate=function(t,e,r){this.invalidateInputKey(t,0),this.reconcileInput(0)},e.prototype.didRemove=function(t,e){this.invalidateInputKey(t,1),this.reconcileInput(0)},e.prototype.didDrop=function(t){},e.prototype.didTake=function(t){},e.prototype.didClear=function(){},e}(lu),_u=function(t){function e(e){var r=t.call(this)||this;return r._downlink=e,r._downlink.observe(r),r}return y(e,t),Object.defineProperty(e.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){var t=this._downlink.get();return t instanceof oe?t.isEmpty():!t.isDefined()},e.prototype.isArray=function(){var t=this._downlink.get();return!(t instanceof oe)||t.isArray()},e.prototype.isObject=function(){var t=this._downlink.get();return t instanceof oe?t.isObject():!t.isDefined()},Object.defineProperty(e.prototype,"length",{get:function(){var t=this._downlink.get();return t instanceof oe?t.length:t.isDefined()?1:0},enumerable:!0,configurable:!0}),e.prototype.has=function(t){var e=this._downlink.get();return e instanceof oe&&e.has(t)},e.prototype.get=function(t){if(void 0===t)return this;var e=this._downlink.get();return e instanceof oe?e.get(t):ne.absent()},e.prototype.getAttr=function(t){var e=this._downlink.get();return e instanceof oe?e.getAttr(t):ne.absent()},e.prototype.getSlot=function(t){var e=this._downlink.get();return e instanceof oe?e.getSlot(t):ne.absent()},e.prototype.getField=function(t){var e=this._downlink.get();return e instanceof oe?e.getField(t):void 0},e.prototype.getItem=function(t){var e=this._downlink.get();return e instanceof oe?e.getItem(t):e},e.prototype.set=function(t,e){var r=this._downlink.get();if(!(r instanceof oe))throw new Error("unsupported");return r.set(t,e),this},e.prototype.setAttr=function(t,e){var r=this._downlink.get();if(!(r instanceof oe))throw new Error("unsupported");return r.setAttr(t,e),this},e.prototype.setSlot=function(t,e){var r=this._downlink.get();if(!(r instanceof oe))throw new Error("unsupported");return r.setSlot(t,e),this},e.prototype.setItem=function(t,e){var r=this._downlink.get();return r instanceof oe?r.setItem(t,e):this._downlink.set(Xt.fromAny(e).toValue()),this},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this._downlink.get();if(r instanceof oe)return r.push.apply(r,arguments);throw new Error("unsupported")},e.prototype.splice=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=this._downlink.get();if(i instanceof oe)return i.splice.apply(i,arguments);throw new Error("unsupported")},e.prototype.delete=function(t){var e=this._downlink.get();return e instanceof oe?e.delete(t):ne.absent()},e.prototype.clear=function(){var t=this._downlink.get();if(!(t instanceof oe))throw new Error("unsupported");t.clear()},e.prototype.forEach=function(t,e){return this._downlink.get().forEach(t,e)},e.prototype.keyIterator=function(){if(this._downlink.get()instanceof oe)throw new Error;return l.empty()},e.prototype.didSet=function(t,e){this.invalidateInput(),this.reconcileInput(0)},e}(lu),vu=function(t){function e(e){var r=t.call(this)||this;return r.swim=e,r}return y(e,t),e.prototype.transmute=function(t){if("link"===t.tag()){var e=new mu(this.swim,t);return e.compile(),e}return t},e}(Sn),mu=function(t){function e(e,r){var n=t.call(this,r)||this;return n.hostUri=n.inoutlet(),n.nodeUri=n.inoutlet(),n.laneUri=n.inoutlet(),n.prio=n.inoutlet(),n.rate=n.inoutlet(),n.bodyValue=n.inoutlet(),n.type=n.inoutlet(),n.swim=e,n}return y(e,t),e.prototype.getOutput=function(t){if((t=this.outlet(t))===this.state){if(this.downlink instanceof cu)return this.downlink.get();if(this.downlinkRecord)return this.downlinkRecord}},e.prototype.onReconcile=function(t){var e=this.castInput(this.hostUri,be.forString()),r=this.castInput(this.nodeUri,be.forString()),n=this.castInput(this.laneUri,be.forString()),i=this.castInput(this.prio,be.forNumber(),0),o=this.castInput(this.rate,be.forNumber(),0),s=this.getInput(this.bodyValue),u=this.castInput(this.type,be.forString(),void 0);if(e!==this.inputHostUri||r!==this.inputNodeUri||n!==this.inputLaneUri||i!==this.inputPrio||o!==this.inputRate||(void 0===s?void 0!==this.inputBody:!s.equals(this.inputBody))||u!==this.inputType){this.downlink&&(this.downlink.close(),this.downlink=void 0,this.downlinkRecord=void 0),this.inputHostUri=e,this.inputNodeUri=r,this.inputLaneUri=n,this.inputPrio=i,this.inputRate=o,this.inputBody=s,this.inputType=u;var a=this.swim||Eu;if("map"===u){var p=a.downlinkMap();void 0!==e&&(p=p.hostUri(e)),void 0!==r&&(p=p.nodeUri(r)),void 0!==n&&(p=p.laneUri(n)),0!==i&&(p=p.prio(i)),0!==o&&(p=p.rate(o)),void 0!==s&&(p=p.body(s)),p=p.open(),this.state=p,this.downlink=p,this.downlinkRecord=new yu(p)}else if("value"===u){p=a.downlinkValue();void 0!==e&&(p=p.hostUri(e)),void 0!==r&&(p=p.nodeUri(r)),void 0!==n&&(p=p.laneUri(n)),void 0!==i&&(p=p.prio(i)),void 0!==o&&(p=p.rate(o)),void 0!==s&&(p=p.body(s)),p=p.open(),this.state=p,this.downlink=p}}},e.transmuter=function(t){return void 0===t?(e._transmuter||(e._transmuter=new vu),e._transmuter):new vu(t)},_([_n],e.prototype,"hostUri",void 0),_([_n],e.prototype,"nodeUri",void 0),_([_n],e.prototype,"laneUri",void 0),_([_n],e.prototype,"prio",void 0),_([_n],e.prototype,"rate",void 0),_([_n("body")],e.prototype,"bodyValue",void 0),_([_n],e.prototype,"type",void 0),_([yn],e.prototype,"state",void 0),e}(gn),wu=function(){function t(t){this._context=t,this._host=void 0,this._downlinks=[],this._observers=null}return t.prototype.isConnected=function(){return!!this._host&&this._host.isConnected()},t.prototype.isAuthenticated=function(){return!!this._host&&this._host.isAuthenticated()},t.prototype.session=function(){return this._host?this._host.session():ne.absent()},t.prototype.authenticate=function(t){this._context.authenticate(this.hostUri(),t)},t.prototype.addDownlink=function(t){0===this._downlinks.length&&this.open(),this._downlinks.push(t)},t.prototype.removeDownlink=function(t){var e=this._downlinks.indexOf(t);e>=0&&(this._downlinks.splice(e,1),0===this._downlinks.length&&this.close())},t.prototype.open=function(){this._context.openRef(this)},t.prototype.close=function(){this._context.closeRef(this)},t.prototype.closeUp=function(){var t=this._downlinks;this._downlinks=[];for(var e=0,r=t.length;e<r;e+=1)t[e].close()},t.prototype.observe=function(t){for(var e=this._observers,r=e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];return n[r]=t,this._observers=n,this},t.prototype.unobserve=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n],o=i===t;if(!o)for(var s in i)if(i[s]===t){o=!0;break}if(o){if(r>1){for(var u=new Array(r-1),a=0;a<n;a+=1)u[a]=e[a];for(a=n+1;a<r;a+=1)u[a-1]=e[a];this._observers=u}else this._observers=null;break}}return this},t.prototype.didConnect=function(t){return this.observe({didConnect:t})},t.prototype.didAuthenticate=function(t){return this.observe({didAuthenticate:t})},t.prototype.didDeauthenticate=function(t){return this.observe({didDeauthenticate:t})},t.prototype.didDisconnect=function(t){return this.observe({didDisconnect:t})},t.prototype.didFail=function(t){return this.observe({didFail:t})},t.prototype.hostDidConnect=function(t){this._host=t;for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didConnect&&i.didConnect(t,this)}},t.prototype.hostDidAuthenticate=function(t,e){for(var r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];o.didAuthenticate&&o.didAuthenticate(t,e,this)}},t.prototype.hostDidDeauthenticate=function(t,e){for(var r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];o.didDeauthenticate&&o.didDeauthenticate(t,e,this)}},t.prototype.hostDidDisconnect=function(t){this._host=void 0;for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didDisconnect&&i.didDisconnect(t,this)}},t.prototype.hostDidFail=function(t,e){for(var r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];o.didFail&&o.didFail(t,e,this)}},t}(),gu=function(t){function e(e,r,n,i){var o=t.call(this,e)||this;return o._hostUri=r,o._nodeUri=n,o._laneUri=i,o}return y(e,t),e.prototype.hostUri=function(){return this._hostUri},e.prototype.nodeUri=function(){return this._nodeUri},e.prototype.laneUri=function(){return this._laneUri},e.prototype.hostRef=function(t){return t=rs.fromAny(t),new Su(this._context,t)},e.prototype.nodeRef=function(t){return t=rs.fromAny(t),new bu(this._context,this._hostUri,t)},e.prototype.laneRef=function(t){return t=rs.fromAny(t),new e(this._context,this._hostUri,this._nodeUri,t)},e.prototype.downlink=function(t){return new su(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.downlinkList=function(t){return new au(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.downlinkMap=function(t){return new hu(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.downlinkValue=function(t){return new cu(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},e.prototype.command=function(t){this._context.command(this._hostUri,this._nodeUri,this._laneUri,t)},e}(wu),bu=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i._hostUri=r,i._nodeUri=n,i}return y(e,t),e.prototype.hostUri=function(){return this._hostUri},e.prototype.nodeUri=function(){return this._nodeUri},e.prototype.hostRef=function(t){return t=rs.fromAny(t),new Su(this._context,t)},e.prototype.nodeRef=function(t){return t=rs.fromAny(t),new e(this._context,this._hostUri,t)},e.prototype.laneRef=function(t){return t=rs.fromAny(t),new gu(this._context,this._hostUri,this._nodeUri,t)},e.prototype.downlink=function(t){return new su(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.downlinkList=function(t){return new au(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.downlinkMap=function(t){return new hu(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.downlinkValue=function(t){return new cu(this._context,this,t,this._hostUri,this._nodeUri)},e.prototype.command=function(t,e){this._context.command(this._hostUri,this._nodeUri,t,e)},e}(wu),Su=function(t){function e(e,r){var n=t.call(this,e)||this;return n._hostUri=r,n}return y(e,t),e.prototype.hostUri=function(){return this._hostUri},e.prototype.hostRef=function(t){return t=rs.fromAny(t),new e(this._context,t)},e.prototype.nodeRef=function(t){return t=rs.fromAny(t),new bu(this._context,this._hostUri,t)},e.prototype.laneRef=function(t,e){return t=rs.fromAny(t),e=rs.fromAny(e),new gu(this._context,this._hostUri,t,e)},e.prototype.downlink=function(t){return new su(this._context,this,t,this._hostUri)},e.prototype.downlinkList=function(t){return new au(this._context,this,t,this._hostUri)},e.prototype.downlinkMap=function(t){return new hu(this._context,this,t,this._hostUri)},e.prototype.downlinkValue=function(t){return new cu(this._context,this,t,this._hostUri)},e.prototype.command=function(t,e,r){this._context.command(this._hostUri,t,e,r)},e}(wu),xu=function(){function t(t){void 0===t&&(t={}),this._options=t,this._hosts=new zt,this._downlinks=new zt,this._downlinkCount=0,this._refs=[],this._online=!0,this._observers=null,this.onOnline=this.onOnline.bind(this),this.onOffline=this.onOffline.bind(this),this.watchOnline(!!t.keepOnline)}return t.prototype.isOnline=function(t){return void 0===t?this._online:(this._online!==t&&(this._online=t,this._hosts.forEach(function(e,r){t?r.open():r.close()},this)),this)},t.prototype.keepOnline=function(t){return void 0===t?!!this._options.keepOnline:(this._options.keepOnline!==t&&(this._options.keepOnline=t,this.watchOnline(t)),this)},t.prototype.watchOnline=function(t){"object"==typeof window&&(t?(window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)):(window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline)))},t.prototype.onOnline=function(t){this.isOnline(!0)},t.prototype.onOffline=function(t){this.isOnline(!1)},t.prototype.getHost=function(t){return t=rs.fromAny(t),this._hosts.get(t)},t.prototype.openHost=function(t){t=rs.fromAny(t);var e=this._hosts.get(t);return e||(e=new eu(this,t,this._options),this._hosts.set(t,e)),e},t.prototype.closeHost=function(t){this._hosts.get(t.hostUri())&&(this._hosts.delete(t.hostUri()),t.closeUp())},t.prototype.getDownlink=function(t,e,r){var n=this._downlinks.get(t);if(n){var i=n.get(e);if(i)return i.get(r)}},t.prototype.openDownlink=function(t){var e=t.hostUri(),r=t.nodeUri(),n=t.laneUri(),i=this._downlinks.get(e);i||(i=new zt,this._downlinks.set(e,i));var o=i.get(r);if(o||(o=new zt,i.set(r,o)),o.has(n))throw new Error("duplicate downlink");o.set(n,t),this._downlinkCount+=1,this.openHost(e).openDownlink(t)},t.prototype.unlinkDownlink=function(t){var e=t.hostUri(),r=this.getHost(e);r&&r.unlinkDownlink(t)},t.prototype.closeDownlink=function(t){var e=t.hostUri(),r=t.nodeUri(),n=t.laneUri(),i=this._downlinks.get(e);if(i){var o=i.get(r);if(o&&o.get(n)){this._downlinkCount-=1,o.delete(n),o.isEmpty()&&(i.delete(r),i.isEmpty()&&this._downlinks.delete(e));var s=this.getHost(e);s&&s.closeDownlink(t)}}},t.prototype.downlink=function(t){return new su(this,void 0,t)},t.prototype.downlinkList=function(t){return new au(this,void 0,t)},t.prototype.downlinkMap=function(t){return new hu(this,void 0,t)},t.prototype.downlinkValue=function(t){return new cu(this,void 0,t)},t.prototype.openRef=function(t){this._refs.push(t)},t.prototype.closeRef=function(t){var e=this._refs.indexOf(t);e>=0&&(this._refs.splice(e,1),t.closeUp())},t.prototype.hostRef=function(t){return t=rs.fromAny(t),new Su(this,t)},t.prototype.nodeRef=function(t,e){return t=rs.fromAny(t),void 0===e?(t=(e=t).base(),e=t.unresolve(e)):e=rs.fromAny(e),new bu(this,t,e)},t.prototype.laneRef=function(t,e,r){return t=rs.fromAny(t),e=rs.fromAny(e),void 0===r?(r=e,t=(e=t).base(),e=t.unresolve(e)):r=rs.fromAny(r),new gu(this,t,e,r)},t.prototype.authenticate=function(t,e){t=rs.fromAny(t),e=ne.fromAny(e),this.openHost(t).authenticate(e)},t.prototype.command=function(t,e,r,n){t=rs.fromAny(t),e=rs.fromAny(e),3===arguments.length?(n=r,r=e,t=(e=t).base(),e=t.unresolve(e)):r=rs.fromAny(r),n=ne.fromAny(n),this.openHost(t).command(e,r,n)},t.prototype.close=function(){var t=this._refs;this._refs=[];for(var e=0;e<t.length;e+=1)t[e].closeUp();var r=this._downlinks.clone();this._downlinks.clear(),this._downlinkCount=0,r.forEach(function(t,e){e.forEach(function(e,r){r.forEach(function(e,r){r.closeUp();var n=this.getHost(t);n&&n.closeDownlink(r)},this)},this)},this);var n=this._hosts.clone();this._hosts.clear(),n.forEach(function(t,e){e.closeUp()},this)},t.prototype.observe=function(t){for(var e=this._observers,r=e?e.length:0,n=new Array(r+1),i=0;i<r;i+=1)n[i]=e[i];return n[r]=t,this._observers=n,this},t.prototype.unobserve=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n],o=i===t;if(!o)for(var s in i)if(i[s]===t){o=!0;break}if(o){if(r>1){for(var u=new Array(r-1),a=0;a<n;a+=1)u[a]=e[a];for(a=n+1;a<r;a+=1)u[a-1]=e[a];this._observers=u}else this._observers=null;break}}return this},t.prototype.didConnect=function(t){return this.observe({didConnect:t})},t.prototype.didAuthenticate=function(t){return this.observe({didAuthenticate:t})},t.prototype.didDeauthenticate=function(t){return this.observe({didDeauthenticate:t})},t.prototype.didDisconnect=function(t){return this.observe({didDisconnect:t})},t.prototype.didFail=function(t){return this.observe({didFail:t})},t.prototype.hostDidConnect=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didConnect&&i.didConnect(t,this)}for(n=0;n<this._refs.length;n+=1){var o=this._refs[n];o.hostUri().equals(t.hostUri())&&o.hostDidConnect(t)}},t.prototype.hostDidAuthenticate=function(t,e){for(var r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];o.didAuthenticate&&o.didAuthenticate(t,e,this)}for(i=0;i<this._refs.length;i+=1){var s=this._refs[i];s.hostUri().equals(e.hostUri())&&s.hostDidAuthenticate(t,e)}},t.prototype.hostDidDeauthenticate=function(t,e){for(var r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];o.didDeauthenticate&&o.didDeauthenticate(t,e,this)}for(i=0;i<this._refs.length;i+=1){var s=this._refs[i];s.hostUri().equals(e.hostUri())&&s.hostDidDeauthenticate(t,e)}},t.prototype.hostDidDisconnect=function(t){for(var e=this._observers,r=e?e.length:0,n=0;n<r;n+=1){var i=e[n];i.didDisconnect&&i.didDisconnect(t,this)}for(n=0;n<this._refs.length;n+=1){var o=this._refs[n];o.hostUri().equals(t.hostUri())&&o.hostDidDisconnect(t)}},t.prototype.hostDidFail=function(t,e){for(var r=this._observers,n=r?r.length:0,i=0;i<n;i+=1){var o=r[i];o.didFail&&o.didFail(t,e,this)}for(i=0;i<this._refs.length;i+=1){var s=this._refs[i];s.hostUri().equals(e.hostUri())&&s.hostDidFail(t,e)}},t}(),Eu=new xu,ku=Eu.isOnline.bind(Eu),Cu=Eu.keepOnline.bind(Eu),Ou=Eu.downlink.bind(Eu),Au=Eu.downlinkList.bind(Eu),Iu=Eu.downlinkMap.bind(Eu),Du=Eu.downlinkValue.bind(Eu),Mu=Eu.hostRef.bind(Eu),Tu=Eu.nodeRef.bind(Eu),Pu=Eu.laneRef.bind(Eu),Vu=Eu.authenticate.bind(Eu),Uu=Eu.command.bind(Eu);t.NativeOrder=r,t.Random=s,t.Murmur3=f,t.Objects=c,t.FromAny={is:function(t){return!!("object"==typeof t&&t||"function"==typeof t)&&"function"==typeof t.fromAny}},t.ToAny={is:function(t){return!("object"!=typeof t||!t)&&"function"==typeof t.toAny}},t.Cursor=l,t.CursorEmpty=v,t.CursorUnary=m,t.CursorArray=w,t.AssertException=g,t.assert=b,t.Severity=S,t.HashGenCacheMap=x,t.HashGenCacheSet=k,t.Tag=O,t.Mark=A,t.Span=I,t.InputException=D,t.InputSettings=Y,t.Input=F,t.InputBuffer=$,t.OutputException=T,t.OutputSettings=M,t.Output=P,t.OutputBuffer=rt,t.ParserException=pt,t.Parser=ht,t.WriterException=K,t.Writer=W,t.OutputStyle=st,t.Format=Z,t.Diagnostic=at,t.UtfErrorMode=lt,t.Unicode=X,t.Utf8=St,t.Binary=mt,t.Base10=ut,t.Base10NumberParser=xt,t.Base10IntegerWriter=kt,t.Base16=wt,t.Base16Parser=Ct,t.Base16Writer=Ot,t.Base16IntegerWriter=At,t.Base64=It,t.Base64Parser=Tt,t.Base64Writer=Pt,t.KeysCursor=Vt,t.ValuesCursor=Ut,t.NodeCursor=Rt,t.BTreeContext=Ft,t.BTree=zt,t.BTreePage=Lt,t.BTreeLeaf=qt,t.BTreeNode=Bt,t.BTreeNodeCursor=Nt,t.STreeContext=Kt,t.STree=Wt,t.STreePage=jt,t.STreeLeaf=Ht,t.STreeNode=Gt,t.STreeNodeCursor=Qt,t.Item=Xt,t.Field=Zt,t.Attr=te,t.Slot=ee,t.Value=ne,t.ValueBuilder=re,t.Record=oe,t.RecordMap=se,t.RecordMapView=ue,t.Data=pe,t.Text=fe,t.Num=ce,t.Bool=le,t.Expression=de,t.Operator=ye,t.Selector=_e,t.Func=ve,t.Extant=me,t.Absent=we,t.FormException=ge,t.Form=be,t.InterpreterException=Yt,t.InterpreterSettings=$t,t.Interpreter=Jt,t.BinaryOperator=Se,t.UnaryOperator=xe,t.ConditionalOperator=Ee,t.OrOperator=ke,t.AndOperator=Ce,t.BitwiseOrOperator=Oe,t.BitwiseXorOperator=Ae,t.BitwiseAndOperator=Ie,t.LtOperator=De,t.LeOperator=Me,t.EqOperator=Te,t.NeOperator=Pe,t.GeOperator=Ve,t.GtOperator=Ue,t.PlusOperator=Re,t.MinusOperator=Fe,t.TimesOperator=ze,t.DivideOperator=Le,t.ModuloOperator=qe,t.NotOperator=Be,t.BitwiseNotOperator=Ne,t.NegativeOperator=Ke,t.PositiveOperator=We,t.InvokeOperator=je,t.IdentitySelector=He,t.GetSelector=Ge,t.GetAttrSelector=Qe,t.GetItemSelector=Xe,t.KeysSelector=Ze,t.ValuesSelector=Ye,t.ChildrenSelector=$e,t.DescendantsSelector=Je,t.FilterSelector=tr,t.LiteralSelector=er,t.LambdaFunc=rr,t.BridgeFunc=nr,t.MathModule=ir,t.TagForm=yr,t.UnitForm=_r,t.StringForm=vr,t.NumberForm=mr,t.BooleanForm=wr,t.AnyForm=gr,t.ItemForm=br,t.ValueForm=Sr,t.ValueCursor=Er,t.ValueEntryCursor=kr,t.Inlet=Cr,t.Outlet=Or,t.MapInlet=Ar,t.MapOutlet=Ir,t.StreamletException=Dr,t.StreamletScope=Mr,t.Streamlet={is:function(t){if("object"==typeof t&&t){var e=t;return"function"==typeof e.streamletScope&&"function"==typeof e.setStreamletScope&&"function"==typeof e.streamletContext&&"function"==typeof e.setStreamletContext}return!1}},t.AbstractInlet=Tr,t.AbstractOutlet=Pr,t.AbstractInoutlet=Vr,t.KeyOutlet=Ur,t.AbstractMapInlet=Rr,t.AbstractMapOutlet=Fr,t.AbstractMapInoutlet=zr,t.AbstractMapInletOutlet=Lr,t.AbstractMapInletMapOutlet=qr,t.OutletInlet=Br,t.OutletMapInlet=Nr,t.ValueInput=Kr,t.ValueOutput=Wr,t.MapInput=jr,t.MapOutput=Hr,t.InletDescriptor=fn,t.OutletDescriptor=cn,t.AbstractStreamlet=dn,t.StreamletInlet=an,t.StreamletOutlet=pn,t.StreamletInoutlet=hn,t.In=function(t,e){if(1===arguments.length)return"string"==typeof t&&(t={name:t}),dn.decorateInlet.bind(void 0,t);dn.decorateInlet({},t,e)},t.Out=yn,t.Inout=_n,t.MemoizeValueCombinator=Gr,t.MemoizeMapCombinator=Qr,t.FilterFieldsOperator=Xr,t.FilterFieldsCombinator=Zr,t.MapValueOperator=Yr,t.MapValueCombinator=$r,t.MapFieldValuesOperator=Jr,t.MapFieldValuesCombinator=tn,t.ReduceFieldsOperator=en,t.ReduceFieldsCombinator=rn,t.WatchValueOperator=nn,t.WatchValueCombinator=on,t.WatchFieldsOperator=sn,t.WatchFieldsCombinator=un,t.RecordOutlet=vn,t.AbstractRecordOutlet=mn,t.RecordStreamlet=wn,t.AbstractRecordStreamlet=gn,t.RecordFieldUpdater=bn,t.RecordModel=xn,t.RecordScope=En,t.Transmuter=Sn,t.Dataflow=Zn,t.GetOutlet=kn,t.BinaryOutlet=Cn,t.UnaryOutlet=On,t.ConditionalOutlet=An,t.OrOutlet=In,t.AndOutlet=Dn,t.BitwiseOrOutlet=Mn,t.BitwiseXorOutlet=Tn,t.BitwiseAndOutlet=Pn,t.LtOutlet=Vn,t.LeOutlet=Un,t.EqOutlet=Rn,t.NeOutlet=Fn,t.GeOutlet=zn,t.GtOutlet=Ln,t.PlusOutlet=qn,t.MinusOutlet=Bn,t.TimesOutlet=Nn,t.DivideOutlet=Kn,t.ModuloOutlet=Wn,t.NotOutlet=jn,t.BitwiseNotOutlet=Hn,t.NegativeOutlet=Gn,t.PositiveOutlet=Qn,t.InvokeOutlet=Xn,t.Recon=Yi,t.ReconParser=ki,t.ReconStructureParser=Ci,t.ReconWriter=Xi,t.ReconStructureWriter=Zi,t.Shape=$i,t.R2Shape=Ji,t.VectorR2=to,t.PointR2=eo,t.SegmentR2=ro,t.BoxR2=io,t.CircleR2=no,t.TimeZone=oo,t.TimeZoneForm=so,t.DateTimeLocale=uo,t.DateTime=ao,t.DateTimeParser=po,t.DateTimeForm=ho,t.DateTimeFormat=co,t.DateTimeSpecifiers=fo,t.TimeInterval=No,t.UnitTimeInterval=Ko,t.YearFormat=lo,t.MonthOfYearFormat=yo,t.MonthFormat=_o,t.ShortMonthFormat=vo,t.DayOfMonthFormat=mo,t.WeekdayFormat=wo,t.ShortWeekdayFormat=go,t.Hour24Format=bo,t.Hour12Format=So,t.PeriodFormat=xo,t.MinuteFormat=Eo,t.SecondFormat=ko,t.MillisecondFormat=Co,t.PatternFormat=Oo,t.YearParser=Ao,t.MonthOfYearParser=Io,t.MonthParser=Do,t.ShortMonthParser=Mo,t.DayOfMonthParser=To,t.WeekdayParser=Po,t.ShortWeekdayParser=Vo,t.Hour24Parser=Uo,t.Hour12Parser=Ro,t.PeriodParser=Fo,t.MinuteParser=zo,t.SecondParser=Lo,t.MillisecondParser=qo,t.PatternParser=Bo,t.FilterInterval=Wo,t.YearInterval=jo,t.YearsInterval=Ho,t.MonthInterval=Go,t.WeekInterval=Qo,t.DayInterval=Xo,t.HourInterval=Zo,t.MinuteInterval=Yo,t.SecondInterval=$o,t.MillisecondInterval=Jo,t.MillisecondsInterval=ts,t.UriException=es,t.Uri=rs,t.UriScheme=ns,t.UriAuthority=is,t.UriUser=os,t.UriHost=ss,t.UriHostName=us,t.UriHostIPv4=as,t.UriHostIPv6=ps,t.UriHostUndefined=hs,t.UriPort=fs,t.UriPath=cs,t.UriPathSegment=ls,t.UriPathSlash=ds,t.UriPathEmpty=ys,t.UriPathBuilder=_s,t.UriQuery=vs,t.UriQueryParam=ms,t.UriQueryUndefined=ws,t.UriQueryBuilder=gs,t.UriFragment=bs,t.UriParser=Ss,t.UriAbsoluteParser=xs,t.UriSchemeParser=Es,t.UriAuthorityParser=ks,t.UriUserParser=Cs,t.UriHostParser=Os,t.UriHostAddressParser=As,t.UriHostLiteralParser=Is,t.UriPortParser=Ds,t.UriPathParser=Ms,t.UriQueryParser=Ts,t.UriFragmentParser=Ps,t.UriForm=Vs,t.UriCache=Us,t.Envelope=Rs,t.HostAddressed=Fs,t.LaneAddressed=zs,t.LinkAddressed=Ls,t.EventMessage=qs,t.CommandMessage=Bs,t.LinkRequest=Ns,t.LinkedResponse=Ks,t.SyncRequest=Ws,t.SyncedResponse=js,t.UnlinkRequest=Hs,t.UnlinkedResponse=Gs,t.AuthRequest=Qs,t.AuthedResponse=Xs,t.DeauthRequest=Zs,t.DeauthedResponse=Ys,t.client=Eu,t.isOnline=ku,t.keepOnline=Cu,t.downlink=Ou,t.downlinkList=Au,t.downlinkMap=Iu,t.downlinkValue=Du,t.hostRef=Mu,t.nodeRef=Tu,t.laneRef=Pu,t.authenticate=Vu,t.command=Uu,t.SwimClient=xu,t.Host=Js,t.RemoteHost=tu,t.WebSocketHost=eu,t.DownlinkModel=ru,t.Downlink=nu,t.EventDownlinkModel=ou,t.EventDownlink=su,t.ListDownlinkModel=uu,t.ListDownlink=au,t.MapDownlinkModel=pu,t.MapDownlink=hu,t.ValueDownlinkModel=fu,t.ValueDownlink=cu,t.DownlinkRecord=lu,t.ListDownlinkRecord=du,t.MapDownlinkRecord=yu,t.ValueDownlinkRecord=_u,t.DownlinkStreamlet=mu,t.DownlinkTransmuter=vu,t.BaseRef=wu,t.HostRef=Su,t.NodeRef=bu,t.LaneRef=gu,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=swim-core.js.map